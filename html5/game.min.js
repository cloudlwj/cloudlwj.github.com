var cc=cc||{};cc._tmp=cc._tmp||{};cc._LogInfos={};_p=window;_p=Object.prototype;delete window._p;cc.newElement=function(a){return document.createElement(a)};cc._addEventListener=function(a,b,d,e){a.addEventListener(b,d,e)};cc._isNodeJs="undefined"!==typeof require&&require("fs");cc.each=function(a,b,d){if(a)if(a instanceof Array)for(var e=0,f=a.length;e<f&&!1!==b.call(d,a[e],e);e++);else for(e in a)if(!1===b.call(d,a[e],e))break};
cc.isCrossOrigin=function(a){if(!a)return cc.log("invalid URL"),!1;var b=a.indexOf("://");if(-1==b)return!1;b=a.indexOf("/",b+3);return(-1==b?a:a.substring(0,b))!=location.origin};
cc.async={_counterFunc:function(a){var b=this.counter;if(!b.err){var d=b.length,e=b.results,f=b.option,g=f.cb,h=f.cbTarget,k=f.trigger,f=f.triggerTarget;if(a){if(b.err=a,g)return g.call(h,a)}else{var m=Array.apply(null,arguments).slice(1),n=m.length;0==n?m=null:1==n&&(m=m[0]);e[this.index]=m;b.count--;k&&k.call(f,m,d-b.count,d);0==b.count&&g&&g.apply(h,[null,e])}}},_emptyFunc:function(){},parallel:function(a,b,d){var e=cc.async;if(void 0!==d)"function"==typeof b&&(b={trigger:b}),b.cb=d||b.cb;else if(void 0!==
b)"function"==typeof b&&(b={cb:b});else if(void 0!==a)b={};else throw"arguments error!";var f=(d=a instanceof Array)?a.length:Object.keys(a).length;if(0==f)b.cb&&b.cb.call(b.cbTarget,null);else{var g={length:f,count:f,option:b,results:d?[]:{}};cc.each(a,function(a,d){if(g.err)return!1;var f=b.cb||b.trigger?e._counterFunc.bind({counter:g,index:d}):e._emptyFunc;a(f,d)})}},map:function(a,b,d){var e=this,f=arguments.length;"function"==typeof b&&(b={iterator:b});if(3===f)b.cb=d||b.cb;else if(2>f)throw"arguments error!";
"function"==typeof b&&(b={iterator:b});if(void 0!==d)b.cb=d||b.cb;else if(void 0===a)throw"arguments error!";var g=(f=a instanceof Array)?a.length:Object.keys(a).length;if(0===g)b.cb&&b.cb.call(b.cbTarget,null);else{var h={length:g,count:g,option:b,results:f?[]:{}};cc.each(a,function(a,d){if(h.err)return!1;var f=b.cb?e._counterFunc.bind({counter:h,index:d}):e._emptyFunc;b.iterator.call(b.iteratorTarget,a,d,f)})}}};
cc.path={join:function(){for(var a=arguments.length,b="",d=0;d<a;d++)b=(b+(""==b?"":"/")+arguments[d]).replace(/(\/|\\\\)$/,"");return b},extname:function(a){return(a=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(a))?a[1]:null},mainFileName:function(a){if(a){var b=a.lastIndexOf(".");if(-1!==b)return a.substring(0,b)}return a},basename:function(a,b){var d=a.indexOf("?");0<d&&(a=a.substring(0,d));d=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(a.replace(/(\/|\\\\)$/,""));if(!d)return null;d=d[2];return b&&a.substring(a.length-
b.length).toLowerCase()==b.toLowerCase()?d.substring(0,d.length-b.length):d},dirname:function(a){return a.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(a,b){b=b||"";var d=a.indexOf("?"),e="";0<d&&(e=a.substring(d),a=a.substring(0,d));d=a.lastIndexOf(".");return 0>d?a+b+e:a.substring(0,d)+b+e},changeBasename:function(a,b,d){if(0==b.indexOf("."))return this.changeExtname(a,b);var e=a.indexOf("?"),f="";d=d?this.extname(a):"";0<e&&(f=a.substring(e),a=a.substring(0,e));e=a.lastIndexOf("/");
return a.substring(0,0>=e?0:e+1)+b+d+f}};
cc.loader={_jsCache:{},_register:{},_langPathCache:{},_aliases:{},resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},_getArgs4Js:function(a){var b=a[0],d=a[1],e=a[2],f=["",null,null];if(1===a.length)f[1]=b instanceof Array?b:[b];else if(2===a.length)"function"==typeof d?(f[1]=b instanceof Array?b:[b],f[2]=d):(f[0]=b||"",f[1]=d instanceof Array?d:[d]);else if(3===a.length)f[0]=b||"",f[1]=d instanceof
Array?d:[d],f[2]=e;else throw"arguments error to load js!";return f},loadJs:function(a,b,d){var e=this,f=e._jsCache,g=e._getArgs4Js(arguments);-1<navigator.userAgent.indexOf("Trident/5")?e._loadJs4Dependency(g[0],g[1],0,g[2]):cc.async.map(g[1],function(a,b,d){a=cc.path.join(g[0],a);if(f[a])return d(null);e._createScript(a,!1,d)},g[2])},loadJsWithImg:function(a,b,d){var e=this._loadJsImg(),f=this._getArgs4Js(arguments);this.loadJs(f[0],f[1],function(a){if(a)throw a;e.parentNode.removeChild(e);if(f[2])f[2]()})},
_createScript:function(a,b,d){var e=document,f=cc.newElement("script");f.async=b;f.src=a;this._jsCache[a]=!0;cc._addEventListener(f,"load",function(){this.removeEventListener("load",arguments.callee,!1);d()},!1);cc._addEventListener(f,"error",function(){d("Load "+a+" failed!")},!1);e.body.appendChild(f)},_loadJs4Dependency:function(a,b,d,e){if(d>=b.length)e&&e();else{var f=this;f._createScript(cc.path.join(a,b[d]),!1,function(g){if(g)return e(g);f._loadJs4Dependency(a,b,d+1,e)})}},_loadJsImg:function(){var a=
document,b=a.getElementById("cocos2d_loadJsImg");if(!b){b=cc.newElement("img");cc._loadingImage&&(b.src=cc._loadingImage);a=a.getElementById(cc.game.config.id);a.style.backgroundColor="black";a.parentNode.appendChild(b);var d=getComputedStyle?getComputedStyle(a):a.currentStyle;d||(d={width:a.width,height:a.height});b.style.left=a.offsetLeft+(parseFloat(d.width)-b.width)/2+"px";b.style.top=a.offsetTop+(parseFloat(d.height)-b.height)/2+"px";b.style.position="absolute"}return b},loadTxt:function(a,b){if(cc._isNodeJs)require("fs").readFile(a,
function(a,d){a?b(a):b(null,d.toString())});else{var d=this.getXMLHttpRequest(),e="load "+a+" failed!";d.open("GET",a,!0);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(d.setRequestHeader("Accept-Charset","utf-8"),d.onreadystatechange=function(){4==d.readyState&&200==d.status?b(null,d.responseText):b(e)}):(d.overrideMimeType&&d.overrideMimeType("text/plain; charset\x3dutf-8"),d.onload=function(){4==d.readyState&&200==d.status?b(null,d.responseText):b(e)});d.send(null)}},_loadTxtSync:function(a){if(cc._isNodeJs)return require("fs").readFileSync(a).toString();
var b=this.getXMLHttpRequest();b.open("GET",a,!1);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?b.setRequestHeader("Accept-Charset","utf-8"):b.overrideMimeType&&b.overrideMimeType("text/plain; charset\x3dutf-8");b.send(null);return 4==!b.readyState||200!=b.status?null:b.responseText},loadJson:function(a,b){this.loadTxt(a,function(d,e){try{d?b(d):b(null,JSON.parse(e))}catch(f){throw"load json ["+a+"] failed : "+f;}})},_checkIsImageURL:function(a){return null!=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(a)},
loadImg:function(a,b,d){var e=!0;void 0!==d?e=null==b.isCrossOrigin?e:b.isCrossOrigin:void 0!==b&&(d=b);var f=new Image;e&&"file://"!=location.origin&&(f.crossOrigin="Anonymous");cc._addEventListener(f,"load",function(){this.removeEventListener("load",arguments.callee,!1);this.removeEventListener("error",arguments.callee,!1);d&&d(null,f)});cc._addEventListener(f,"error",function(){this.removeEventListener("error",arguments.callee,!1);d&&d("load image failed")});f.src=a;return f},_loadResIterator:function(a,
b,d){var e=this,f=null,g=a.type;g?(g="."+g.toLowerCase(),f=a.src?a.src:a.name+g):(f=a,g=cc.path.extname(f));if(b=e.cache[f])return d(null,b);b=e._register[g.toLowerCase()];if(!b)return cc.error("loader for ["+g+"] not exists!"),d();g=b.getBasePath?b.getBasePath():e.resPath;g=e.getUrl(g,f);b.load(g,f,a,function(a,b){a?(cc.log(a),e.cache[f]=null,delete e.cache[f],d()):(e.cache[f]=b,d(null,b))})},getUrl:function(a,b){var d=this._langPathCache,e=cc.path;if(void 0!==a&&void 0===b){b=a;var f=e.extname(b),
f=f?f.toLowerCase():"";a=(f=this._register[f])?f.getBasePath?f.getBasePath():this.resPath:this.resPath}b=cc.path.join(a||"",b);if(b.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(d[b])return d[b];e=e.extname(b)||"";b=d[b]=b.substring(0,b.length-e.length)+"_"+cc.sys.language+e}return b},load:function(a,b,d){if(void 0!==d)"function"==typeof b&&(b={trigger:b});else if(void 0!==b)"function"==typeof b&&(d=b,b={});else if(void 0!==a)b={};else throw"arguments error!";b.cb=function(a,b){a&&cc.log(a);d&&d(b)};a instanceof
Array||(a=[a]);b.iterator=this._loadResIterator;b.iteratorTarget=this;cc.async.map(a,b)},_handleAliases:function(a,b){var d=this._aliases,e=[],f;for(f in a){var g=a[f];d[f]=g;e.push(g)}this.load(e,b)},loadAliases:function(a,b){var d=this,e=d.getRes(a);e?d._handleAliases(e.filenames,b):d.load(a,function(a){d._handleAliases(a[0].filenames,b)})},register:function(a,b){if(a&&b){if("string"==typeof a)return this._register[a.trim().toLowerCase()]=b;for(var d=0,e=a.length;d<e;d++)this._register["."+a[d].trim().toLowerCase()]=
b}},getRes:function(a){return this.cache[a]||this.cache[this._aliases[a]]},release:function(a){var b=this.cache,d=this._aliases;delete b[a];delete b[d[a]];delete d[a]},releaseAll:function(){var a=this.cache,b=this._aliases,d;for(d in a)delete a[d];for(d in b)delete b[d]}};
(function(){var a=window,b,d;"undefined"!==typeof document.hidden?(b="hidden",d="visibilitychange"):"undefined"!==typeof document.mozHidden?(b="mozHidden",d="mozvisibilitychange"):"undefined"!==typeof document.msHidden?(b="msHidden",d="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(b="webkitHidden",d="webkitvisibilitychange");var e=function(){cc.eventManager&&cc.game._eventHide&&cc.eventManager.dispatchEvent(cc.game._eventHide)},f=function(){cc.eventManager&&cc.game._eventShow&&
cc.eventManager.dispatchEvent(cc.game._eventShow)};b?cc._addEventListener(document,d,function(){document[b]?e():f()},!1):(cc._addEventListener(a,"blur",e,!1),cc._addEventListener(a,"focus",f,!1));"onpageshow"in window&&"onpagehide"in window&&(cc._addEventListener(a,"pagehide",e,!1),cc._addEventListener(a,"pageshow",f,!1));d=a=null})();cc.log=cc.warn=cc.error=cc.assert=function(){};
cc.create3DContext=function(a,b){for(var d=["webgl","experimental-webgl","webkit-3d","moz-webgl"],e=null,f=0;f<d.length;++f){try{e=a.getContext(d[f],b)}catch(g){}if(e)break}return e};
cc._initSys=function(a,b){cc._RENDER_TYPE_CANVAS=0;cc._RENDER_TYPE_WEBGL=1;var d=cc.sys={};d.LANGUAGE_ENGLISH="en";d.LANGUAGE_CHINESE="zh";d.LANGUAGE_FRENCH="fr";d.LANGUAGE_ITALIAN="it";d.LANGUAGE_GERMAN="de";d.LANGUAGE_SPANISH="es";d.LANGUAGE_RUSSIAN="ru";d.LANGUAGE_KOREAN="ko";d.LANGUAGE_JAPANESE="ja";d.LANGUAGE_HUNGARIAN="hu";d.LANGUAGE_PORTUGUESE="pt";d.LANGUAGE_ARABIC="ar";d.LANGUAGE_NORWEGIAN="no";d.LANGUAGE_POLISH="pl";d.OS_WINDOWS="Windows";d.OS_IOS="iOS";d.OS_OSX="OS X";d.OS_UNIX="UNIX";
d.OS_LINUX="Linux";d.OS_ANDROID="Android";d.OS_UNKNOWN="Unknown";d.BROWSER_TYPE_WECHAT="wechat";d.BROWSER_TYPE_ANDROID="androidbrowser";d.BROWSER_TYPE_IE="ie";d.BROWSER_TYPE_QQ="qqbrowser";d.BROWSER_TYPE_MOBILE_QQ="mqqbrowser";d.BROWSER_TYPE_UC="ucbrowser";d.BROWSER_TYPE_360="360browser";d.BROWSER_TYPE_BAIDU_APP="baiduboxapp";d.BROWSER_TYPE_BAIDU="baidubrowser";d.BROWSER_TYPE_MAXTHON="maxthon";d.BROWSER_TYPE_OPERA="opera";d.BROWSER_TYPE_MIUI="miuibrowser";d.BROWSER_TYPE_FIREFOX="firefox";d.BROWSER_TYPE_SAFARI=
"safari";d.BROWSER_TYPE_CHROME="chrome";d.BROWSER_TYPE_UNKNOWN="unknown";d.isNative=!1;var e=[d.BROWSER_TYPE_BAIDU,d.BROWSER_TYPE_OPERA,d.BROWSER_TYPE_FIREFOX,d.BROWSER_TYPE_CHROME,d.BROWSER_TYPE_SAFARI],f=[d.BROWSER_TYPE_BAIDU,d.BROWSER_TYPE_OPERA,d.BROWSER_TYPE_FIREFOX,d.BROWSER_TYPE_CHROME,d.BROWSER_TYPE_SAFARI,d.BROWSER_TYPE_UC,d.BROWSER_TYPE_QQ,d.BROWSER_TYPE_MOBILE_QQ,d.BROWSER_TYPE_IE],g=window,h=g.navigator,k=document.documentElement,m=h.userAgent.toLowerCase();d.isMobile=-1!=m.indexOf("mobile")||
-1!=m.indexOf("android");var n=h.language,n=(n=n?n:h.browserLanguage)?n.split("-")[0]:d.LANGUAGE_ENGLISH;d.language=n;var n=d.BROWSER_TYPE_UNKNOWN,q=m.match(/micromessenger|qqbrowser|mqqbrowser|ucbrowser|360browser|baiduboxapp|baidubrowser|maxthon|trident|opera|miuibrowser|firefox/i)||m.match(/chrome|safari/i);q&&0<q.length&&(n=q[0].toLowerCase(),"micromessenger"==n?n=d.BROWSER_TYPE_WECHAT:"safari"===n&&m.match(/android.*applewebkit/)?n=d.BROWSER_TYPE_ANDROID:"trident"==n&&(n=d.BROWSER_TYPE_IE));
d.browserType=n;d._supportMultipleAudio=-1<f.indexOf(d.browserType);f=parseInt(a[b.renderMode]);n=cc._RENDER_TYPE_WEBGL;q=cc.newElement("Canvas");cc._supportRender=!0;e=-1==e.indexOf(d.browserType);if(1===f||0===f&&(d.isMobile||e))n=cc._RENDER_TYPE_CANVAS;d._canUseCanvasNewBlendModes=function(){var a=document.createElement("canvas");a.width=1;a.height=1;a=a.getContext("2d");a.fillStyle="#000";a.fillRect(0,0,1,1);a.globalCompositeOperation="multiply";a.fillStyle="#fff";a.fillRect(0,0,1,1);return 0===
a.getImageData(0,0,1,1).data[0]};d._supportCanvasNewBlendModes=d._canUseCanvasNewBlendModes();n!=cc._RENDER_TYPE_WEBGL||g.WebGLRenderingContext&&cc.create3DContext(q,{stencil:!0,preserveDrawingBuffer:!0})||(0==f?n=cc._RENDER_TYPE_CANVAS:cc._supportRender=!1);if(n==cc._RENDER_TYPE_CANVAS)try{q.getContext("2d")}catch(s){cc._supportRender=!1}cc._renderType=n;try{d._supportWebAudio=!!new (g.AudioContext||g.webkitAudioContext||g.mozAudioContext)}catch(u){d._supportWebAudio=!1}try{var t=d.localStorage=
g.localStorage;t.setItem("storage","");t.removeItem("storage");t=null}catch(v){"SECURITY_ERR"!==v.name&&"QuotaExceededError"!==v.name||cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option"),d.localStorage=function(){}}t=d.capabilities={canvas:!0};cc._renderType==cc._RENDER_TYPE_WEBGL&&(t.opengl=!0);void 0!==k.ontouchstart||h.msPointerEnabled?t.touches=!0:void 0!==k.onmouseup&&(t.mouse=!0);void 0!==k.onkeyup&&(t.keyboard=!0);if(g.DeviceMotionEvent||g.DeviceOrientationEvent)t.accelerometer=
!0;g=m.match(/(iPad|iPhone|iPod)/i)?!0:!1;m=m.match(/android/i)||h.platform.match(/android/i)?!0:!1;k=d.OS_UNKNOWN;-1!=h.appVersion.indexOf("Win")?k=d.OS_WINDOWS:g?k=d.OS_IOS:-1!=h.appVersion.indexOf("Mac")?k=d.OS_OSX:-1!=h.appVersion.indexOf("X11")?k=d.OS_UNIX:-1!=h.appVersion.indexOf("Linux")?k=d.OS_LINUX:m&&(k=d.OS_ANDROID);d.os=k;d.garbageCollect=function(){};d.dumpRoot=function(){};d.restartVM=function(){};d.dump=function(){var a;a=""+("isMobile : "+this.isMobile+"\r\n");a+="language : "+this.language+
"\r\n";a+="browserType : "+this.browserType+"\r\n";a+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n";a+="os : "+this.os+"\r\n";cc.log(a)}};cc.ORIENTATION_PORTRAIT=0;cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1;cc.ORIENTATION_LANDSCAPE_LEFT=2;cc.ORIENTATION_LANDSCAPE_RIGHT=3;cc._drawingUtil=null;cc._renderContext=null;cc._canvas=null;cc._gameDiv=null;cc._rendererInitialized=!1;cc._setupCalled=!1;
cc._setup=function(a,b,d){if(!cc._setupCalled){cc._setupCalled=!0;var e=window;e.requestAnimFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame;var f=cc.$(a)||cc.$("#"+a),g;"CANVAS"==f.tagName?(b=b||f.width,d=d||f.height,g=cc.container=cc.newElement("DIV"),a=cc._canvas=f,a.parentNode.insertBefore(g,a),a.appendTo(g),g.setAttribute("id","Cocos2dGameContainer")):("DIV"!=f.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),
b=b||f.clientWidth,d=d||f.clientHeight,g=cc.container=f,a=cc._canvas=cc.$(cc.newElement("CANVAS")),f.appendChild(a));a.addClass("gameCanvas");a.setAttribute("width",b||480);a.setAttribute("height",d||320);a.setAttribute("tabindex",99);a.style.outline="none";f=g.style;f.width=(b||480)+"px";f.height=(d||320)+"px";f.margin="0 auto";f.position="relative";f.overflow="hidden";g.top="100%";cc._renderType==cc._RENDER_TYPE_WEBGL&&(cc._renderContext=cc.webglContext=cc.create3DContext(a,{stencil:!0,preserveDrawingBuffer:!0,
antialias:!cc.sys.isMobile,alpha:!1}));cc._renderContext?(e.gl=cc._renderContext,cc._drawingUtil=new cc.DrawingPrimitiveWebGL(cc._renderContext),cc._rendererInitialized=!0,cc.textureCache._initializingRenderer(),cc.shaderCache._init()):(cc._renderContext=a.getContext("2d"),cc._mainRenderContextBackup=cc._renderContext,cc._renderContext.translate(0,a.height),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(cc._renderContext):null);cc._gameDiv=g;cc.log(cc.ENGINE_VERSION);cc._setContextMenuEnable(!1);
cc.sys.isMobile&&(b=cc.newElement("style"),b.type="text/css",document.body.appendChild(b),b.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}");cc.view=cc.EGLView._getInstance();cc.inputManager.registerSystemEvent(cc._canvas);cc.director=cc.Director._getInstance();cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view);cc.winSize=cc.director.getWinSize();cc.saxParser=new cc.SAXParser;
cc.plistParser=new cc.PlistParser}};cc._checkWebGLRenderMode=function(){if(cc._renderType!==cc._RENDER_TYPE_WEBGL)throw"This feature supports WebGL render mode only.";};cc._isContextMenuEnable=!1;cc._setContextMenuEnable=function(a){cc._isContextMenuEnable=a;cc._canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1}};
cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",_eventHide:null,_eventShow:null,_onBeforeStartArr:[],CONFIG_KEY:{engineDir:"engineDir",dependencies:"dependencies",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList",classReleaseMode:"classReleaseMode"},_prepareCalled:!1,
_prepared:!1,_paused:!0,_intervalId:null,config:null,onStart:null,onStop:null,setFrameRate:function(a){this.config[this.CONFIG_KEY.frameRate]=a;this._intervalId&&clearInterval(this._intervalId);this._paused=!0;this._runMainLoop()},_runMainLoop:function(){var a=this,b,d=a.config,e=a.CONFIG_KEY,f=window,g=d[e.frameRate],h=cc.director;h.setDisplayStats(d[e.showFPS]);f.requestAnimFrame&&60==g?(b=function(){a._paused||(h.mainLoop(),f.requestAnimFrame(b))},f.requestAnimFrame(b)):(b=function(){h.mainLoop()},
a._intervalId=setInterval(b,1E3/g));a._paused=!1},run:function(a){var b=this,d=function(){a&&(b.config[b.CONFIG_KEY.id]=a);b._prepareCalled?cc._supportRender&&(b._checkPrepare=setInterval(function(){b._prepared&&(cc._setup(b.config[b.CONFIG_KEY.id]),b._runMainLoop(),b._eventHide=b._eventHide||new cc.EventCustom(b.EVENT_HIDE),b._eventHide.setUserData(b),b._eventShow=b._eventShow||new cc.EventCustom(b.EVENT_SHOW),b._eventShow.setUserData(b),b.onStart(),clearInterval(b._checkPrepare))},10)):b.prepare(function(){cc._supportRender&&
(cc._setup(b.config[b.CONFIG_KEY.id]),b._runMainLoop(),b._eventHide=b._eventHide||new cc.EventCustom(b.EVENT_HIDE),b._eventHide.setUserData(b),b._eventShow=b._eventShow||new cc.EventCustom(b.EVENT_SHOW),b._eventShow.setUserData(b),b.onStart())})};document.body?d():cc._addEventListener(window,"load",function(){this.removeEventListener("load",arguments.callee,!1);d()},!1)},_initConfig:function(){var a=this.CONFIG_KEY,b=function(b){b[a.engineDir]=b[a.engineDir]||"frameworks/cocos2d-html5";null==b[a.debugMode]&&
(b[a.debugMode]=0);b[a.frameRate]=b[a.frameRate]||60;null==b[a.renderMode]&&(b[a.renderMode]=1);return b};if(document.ccConfig)this.config=b(document.ccConfig);else try{for(var d=document.getElementsByTagName("script"),e=0;e<d.length;e++){var f=d[e].getAttribute("cocos");if(""==f||f)break}var g,h,k;if(e<d.length){if(g=d[e].src)k=/(.*)\//.exec(g)[0],cc.loader.resPath=k,g=cc.path.join(k,"project.json");h=cc.loader._loadTxtSync(g)}h||(h=cc.loader._loadTxtSync("project.json"));var m=JSON.parse(h);this.config=
b(m||{})}catch(n){cc.log("Failed to read or parse project.json"),this.config=b({})}cc._initSys(this.config,a)},_jsAddedCache:{},_getJsListOfModule:function(a,b,d){var e=this._jsAddedCache;if(e[b])return null;d=d||"";var f=[],g=a[b];if(!g)throw"can not find module ["+b+"]";b=cc.path;for(var h=0,k=g.length;h<k;h++){var m=g[h];if(!e[m]){var n=b.extname(m);n?".js"==n.toLowerCase()&&f.push(b.join(d,m)):(n=this._getJsListOfModule(a,m,d))&&(f=f.concat(n));e[m]=1}}return f},prepare:function(a){var b=this,
d=b.config,e=b.CONFIG_KEY,f=d[e.engineDir],g=cc.loader;if(cc._supportRender){b._prepareCalled=!0;var h=d[e.jsList]||[];cc.Class?g.loadJsWithImg("",h,function(d){if(d)throw d;b._prepared=!0;a&&a()}):(e=cc.path.join(f,"moduleConfig.json"),g.loadJson(e,function(e,g){if(e)throw e;var n=d.modules||[],q=g.module,s=[];cc._renderType==cc._RENDER_TYPE_WEBGL?n.splice(0,0,"shaders"):0>n.indexOf("core")&&n.splice(0,0,"core");for(var u=0,t=n.length;u<t;u++){var v=b._getJsListOfModule(q,n[u],f);v&&(s=s.concat(v))}s=
s.concat(h);cc.loader.loadJsWithImg(s,function(d){if(d)throw d;b._prepared=!0;a&&a()})}))}else cc.error("Can not support render!")}};cc.game._initConfig();cc._LogInfos={ActionManager_addAction:"cc.ActionManager.addAction(): action must be non-null",ActionManager_removeAction:"cocos2d: removeAction: Target not found",ActionManager_removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",ActionManager_removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",ActionManager_getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",ActionManager_getActionByTag_2:"cocos2d : getActionByTag(tag \x3d %s): Action not found",
configuration_dumpInfo:"cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from ccConfig.js)",configuration_loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",configuration_loadConfigFile_2:"Please load the resource first : %s",Director_resume:"cocos2d: Director: Error in gettimeofday",Director_setProjection:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",
Director_popScene:"running scene should not null",Director_pushScene:"the scene should not null",arrayVerifyType:"element type is wrong!",Scheduler_scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",Scheduler_scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",Scheduler_scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",Scheduler_pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",
Scheduler_resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",Scheduler_isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null",Node_getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",Node_setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",Node_getRotation:"RotationX !\x3d RotationY. Don't know which one to return",Node_getScale:"ScaleX !\x3d ScaleY. Don't know which one to return",Node_addChild:"An Node can't be added as a child of itself.",
Node_addChild_2:"child already added. It can't be added again",Node_addChild_3:"child must be non-null",Node_removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",Node_removeChildByTag:"argument tag is an invalid tag",Node_removeChildByTag_2:"cocos2d: removeChildByTag(tag \x3d %s): child not found!",Node_removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",Node_stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",
Node_getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",Node_resumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",Node_pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",Node__arrayMakeObjectsPerformSelector:"Unknown callback function",Node_reorderChild:"child must be non-null",Node_runAction:"cc.Node.runAction(): action must be non-null",Node_schedule:"callback function must be non-null",Node_schedule_2:"interval must be positive",
Node_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",AtlasNode_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",AtlasNode_initWithTileFile:"",AtlasNode__initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",_EventListenerKeyboard_checkAvailable:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",_EventListenerTouchOneByOne_checkAvailable:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",
_EventListenerTouchAllAtOnce_checkAvailable:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",_EventListenerAcceleration_checkAvailable:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil",EventListener_create:"Invalid parameter.",__getListenerID:"Don't call this method if the event is for touch.",eventManager__forceAddEventListener:"Invalid scene graph priority!",eventManager_addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",
eventManager_removeListeners:"Invalid listener type!",eventManager_setPriority:"Can't set fixed priority with scene graph based listener.",eventManager_addListener_2:"Invalid parameters.",eventManager_addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",eventManager_addListener_4:"The listener has been registered, please don't register it again.",LayerMultiplex_initWithLayers:"parameters should not be ending with null in Javascript",LayerMultiplex_switchTo:"Invalid index in MultiplexLayer switchTo message",
LayerMultiplex_switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_addLayer:"cc.Layer.addLayer(): layer should be non-null",EGLView_setDesignResolutionSize:"Resolution not valid",EGLView_setDesignResolutionSize_2:"should set resolutionPolicy",inputManager_handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex \x3d %s",swap:"cc.swap is being modified from original macro, please check usage",checkGLErrorDebug:"WebGL error %s",animationCache__addAnimationsWithDictionary:"cocos2d: cc.AnimationCache: No animations were found in provided dictionary.",
animationCache__addAnimationsWithDictionary_2:"cc.AnimationCache. Invalid animation format",animationCache_addAnimations:"cc.AnimationCache.addAnimations(): File could not be found",animationCache__parseVersion1:"cocos2d: cc.AnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion1_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",
animationCache__parseVersion1_3:"cocos2d: cc.AnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",animationCache__parseVersion1_4:"cocos2d: cc.AnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",animationCache__parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",
animationCache__parseVersion2_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache_addAnimations_2:"cc.AnimationCache.addAnimations(): Invalid texture file name",Sprite_reorderChild:"cc.Sprite.reorderChild(): this child is not in children list",Sprite_ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",
Sprite_setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",Sprite_setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",Sprite_setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",Sprite__updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",Sprite_initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",
Sprite_initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",Sprite_initWithSpriteFrameName1:" is null, please check.",Sprite_initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",Sprite_setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",Sprite_reorderChild_2:"cc.Sprite.reorderChild(): child should be non-null",Sprite_addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",
Sprite_addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",Sprite_addChild_3:"cc.Sprite.addChild(): child should be non-null",Sprite_setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",Sprite_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",
Sprite_addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",Sprite_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",Sprite_setSpriteFrame:"Invalid spriteFrameName",Sprite_setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",Sprite_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",
Sprite_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",Sprite_addChild_6:"cc.SpriteBatchNode.addChild(): child should be non-null",SpriteBatchNode_addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",SpriteBatchNode_increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",SpriteBatchNode_increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",
SpriteBatchNode_reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",SpriteBatchNode_removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",SpriteBatchNode_addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",SpriteBatchNode_reorderChild_2:"cc.SpriteBatchNode.addChild():child should be non-null",spriteFrameCache__getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",
spriteFrameCache_addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",spriteFrameCache__checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",spriteFrameCache_getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",spriteFrameCache__getFrameConfig_2:"Please load the resource first : %s",spriteFrameCache_addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",spriteFrameCache_addSpriteFrames_3:"Argument must be non-nil",
CCSpriteBatchNode_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",CCSpriteBatchNode_addChild_2:"cc.Sprite.addChild(): child should be non-null",
CCSpriteBatchNode_setSpriteFrame:"Invalid spriteFrameName",CCSpriteBatchNode_setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",CCSpriteBatchNode_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null",TextureAtlas_initWithFile:"cocos2d: Could not open file: %s",
TextureAtlas_insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",TextureAtlas_initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",TextureAtlas_updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",TextureAtlas_updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",TextureAtlas_insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",TextureAtlas_insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",TextureAtlas_insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",
TextureAtlas_insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",TextureAtlas_removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",TextureAtlas_removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",TextureAtlas_moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",TextureAtlas_moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",TextureAtlas_moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex",
textureCache_addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_addPVRImage:"addPVRImage does not support on HTML5",textureCache_addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",textureCache_dumpCachedTextureInfo:"cocos2d: '%s' id\x3d%s %s x %s",textureCache_dumpCachedTextureInfo_2:"cocos2d: '%s' id\x3d HTMLCanvasElement %s x %s",textureCache_dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",
textureCache_addUIImage_2:"cc.Texture.addUIImage(): image should be non-null",Texture2D_initWithETCFile:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData:"initWithPVRTCData does not support on HTML5",Texture2D_addImage:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",Texture2D_initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",
Texture2D_initWithString:"initWithString isn't supported on cocos2d-html5",Texture2D_initWithETCFile_2:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile_2:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",Texture2D_bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",Texture2D__initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",
Texture2D_addImage_2:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithData:"NSInternalInconsistencyException",MissingFile:"Missing file: %s",radiansToDegress:"cc.radiansToDegress() should be called cc.radiansToDegrees()",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager__updateListeners:"If program goes here, there should be event in dispatch.",EventManager__updateListeners_2:"_inDispatch should be 1 here."};
cc._logToWebPage=function(a){if(cc._canvas){var b=cc._logList,d=document;if(!b){var e=d.createElement("Div"),b=e.style;e.setAttribute("id","logInfoDiv");cc._canvas.parentNode.appendChild(e);e.setAttribute("width","200");e.setAttribute("height",cc._canvas.height);b.zIndex="99999";b.position="absolute";b.top="0";b.left="0";b=cc._logList=d.createElement("textarea");d=b.style;b.setAttribute("rows","20");b.setAttribute("cols","30");b.setAttribute("disabled",!0);e.appendChild(b);d.backgroundColor="transparent";
d.borderBottom="1px solid #cccccc";d.borderRightWidth="0px";d.borderLeftWidth="0px";d.borderTopWidth="0px";d.borderTopStyle="none";d.borderRightStyle="none";d.borderLeftStyle="none";d.padding="0px";d.margin=0}a="string"==typeof a?a:JSON.stringify(a);b.value=b.value+a+"\r\n";b.scrollTop=b.scrollHeight}};cc._formatString=function(a){if("object"===typeof a)try{return JSON.stringify(a)}catch(b){return""}else return a};
console.log&&(cc.log=function(a){for(var b=1;b<arguments.length;b++)a=a.replace(/(%s)|(%d)/,cc._formatString(arguments[b]));console.log(a)},cc.warn=console.warn?function(a){for(var b=1;b<arguments.length;b++)a=a.replace(/(%s)|(%d)/,cc._formatString(arguments[b]));console.warn(a)}:cc.log,cc.error=console.error?function(a){for(var b=1;b<arguments.length;b++)a=a.replace(/(%s)|(%d)/,cc._formatString(arguments[b]));console.error(a)}:cc.log,cc.assert=function(a,b){if(!a&&b){for(var d=2;d<arguments.length;d++)b=
b.replace(/(%s)|(%d)/,cc._formatString(arguments[d]));throw b;}});var mode=cc.game.config[cc.game.CONFIG_KEY.debugMode],ccGame=cc.game;console.log&&mode===ccGame.DEBUG_MODE_INFO||(cc.log=mode==ccGame.DEBUG_MODE_INFO_FOR_WEB_PAGE?cc._logToWebPage.bind(cc):function(){});mode&&mode!=ccGame.DEBUG_MODE_NONE&&mode!=ccGame.DEBUG_MODE_ERROR&&mode!=ccGame.DEBUG_MODE_ERROR_FOR_WEB_PAGE||(cc.warn=function(){});
mode!=ccGame.DEBUG_MODE_INFO_FOR_WEB_PAGE&&mode!=ccGame.DEBUG_MODE_WARN_FOR_WEB_PAGE&&console.warn||(cc.warn=cc._logToWebPage.bind(cc));
mode&&mode!=ccGame.DEBUG_MODE_NONE?mode!=ccGame.DEBUG_MODE_INFO_FOR_WEB_PAGE&&mode!=ccGame.DEBUG_MODE_WARN_FOR_WEB_PAGE&&mode!=ccGame.DEBUG_MODE_ERROR_FOR_WEB_PAGE&&console.error||(cc.error=cc._logToWebPage.bind(cc),cc.assert=function(a,b){if(!a&&b){for(var d=2;d<arguments.length;d++)b=b.replace("%s",arguments[d]);cc._logToWebPage(b)}}):(cc.error=function(){},cc.assert=function(){});cc.loader.loadBinary=function(a,b){var d=this,e=this.getXMLHttpRequest(),f="load "+a+" failed!";e.open("GET",a,!0);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(e.setRequestHeader("Accept-Charset","x-user-defined"),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=cc._convertResponseBodyToText(e.responseBody);b(null,d._str2Uint8Array(a))}else b(f)}):(e.overrideMimeType&&e.overrideMimeType("text/plain; charset\x3dx-user-defined"),e.onload=function(){4==
e.readyState&&200==e.status?b(null,d._str2Uint8Array(e.responseText)):b(f)});e.send(null)};cc.loader._str2Uint8Array=function(a){if(!a)return null;for(var b=new Uint8Array(a.length),d=0;d<a.length;d++)b[d]=a.charCodeAt(d)&255;return b};
cc.loader.loadBinarySync=function(a){var b=this.getXMLHttpRequest(),d="load "+a+" failed!";b.open("GET",a,!1);a=null;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){b.setRequestHeader("Accept-Charset","x-user-defined");b.send(null);if(200!=b.status)return cc.log(d),null;(b=cc._convertResponseBodyToText(b.responseBody))&&(a=this._str2Uint8Array(b))}else{b.overrideMimeType&&b.overrideMimeType("text/plain; charset\x3dx-user-defined");b.send(null);if(200!=b.status)return cc.log(d),
null;a=this._str2Uint8Array(b.responseText)}return a};var Uint8Array=Uint8Array||Array;
if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){var IEBinaryToArray_ByteStr_Script='\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr \x3d CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex \x3d LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last \x3d Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last \x3d ""\r\n   End If\r\nEnd Function\r\n',myVBScript=
cc.newElement("script");myVBScript.type="text/vbscript";myVBScript.textContent=IEBinaryToArray_ByteStr_Script;document.body.appendChild(myVBScript);cc._convertResponseBodyToText=function(a){for(var b={},d=0;256>d;d++)for(var e=0;256>e;e++)b[String.fromCharCode(d+256*e)]=String.fromCharCode(d)+String.fromCharCode(e);d=IEBinaryToArray_ByteStr(a);a=IEBinaryToArray_ByteStr_Last(a);return d.replace(/[\s\S]/g,function(a){return b[a]})+a}};cc=cc||{};cc._loadingImage="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAANACwAAAAAEAAQAAAEO5DJSau9OOvNex0IMnDIsiCkiW6g6BmKYlBFkhSUEgQKlQCARG6nEBwOgl+QApMdCIRD7YZ5RjlGpCUCACH5BAUAAA0ALAAAAgAOAA4AAAQ6kLGB0JA4M7QW0hrngRllkYyhKAYqKUGguAws0ypLS8JxCLQDgXAIDg+FRKIA6v0SAECCBpXSkstMBAAh+QQFAAANACwAAAAACgAQAAAEOJDJORAac6K1kDSKYmydpASBUl0mqmRfaGTCcQgwcxDEke+9XO2WkxQSiUIuAQAkls0n7JgsWq8RACH5BAUAAA0ALAAAAAAOAA4AAAQ6kMlplDIzTxWC0oxwHALnDQgySAdBHNWFLAvCukc215JIZihVIZEogDIJACBxnCSXTcmwGK1ar1hrBAAh+QQFAAANACwAAAAAEAAKAAAEN5DJKc4RM+tDyNFTkSQF5xmKYmQJACTVpQSBwrpJNteZSGYoFWjIGCAQA2IGsVgglBOmEyoxIiMAIfkEBQAADQAsAgAAAA4ADgAABDmQSVZSKjPPBEDSGucJxyGA1XUQxAFma/tOpDlnhqIYN6MEAUXvF+zldrMBAjHoIRYLhBMqvSmZkggAIfkEBQAADQAsBgAAAAoAEAAABDeQyUmrnSWlYhMASfeFVbZdjHAcgnUQxOHCcqWylKEohqUEAYVkgEAMfkEJYrFA6HhKJsJCNFoiACH5BAUAAA0ALAIAAgAOAA4AAAQ3kMlJq704611SKloCAEk4lln3DQgyUMJxCBKyLAh1EMRR3wiDQmHY9SQslyIQUMRmlmVTIyRaIgA7";var cc=cc||{},ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),compileSuper:function(a,b,d){a=a.toString();var e=a.indexOf("("),f=a.indexOf(")"),e=a.substring(e+1,f),e=e.trim(),f=a.indexOf("{"),g=a.lastIndexOf("}");for(a=a.substring(f+1,g);-1!=a.indexOf("this._super");){var f=a.indexOf("this._super"),g=a.indexOf("(",f),h=a.indexOf(")",g),h=a.substring(g+1,h),h=(h=h.trim())?",":"";a=a.substring(0,f)+"ClassManager["+d+"]."+b+".call(this"+h+a.substring(g+1)}return Function(e,a)},getNewID:function(){return this.id++},
getNewInstanceId:function(){return this.instanceId++}};ClassManager.compileSuper.ClassManager=ClassManager;
(function(){var a=/\b_super\b/,b=cc.game.config[cc.game.CONFIG_KEY.classReleaseMode];b&&console.log("release Mode");cc.Class=function(){};cc.Class.extend=function(d){function e(){this.__instanceId=ClassManager.getNewInstanceId();this.ctor&&this.ctor.apply(this,arguments)}var f=this.prototype,g=Object.create(f),h=ClassManager.getNewID();ClassManager[h]=f;var k={writable:!0,enumerable:!1,configurable:!0};g.__instanceId=null;e.id=h;k.value=h;Object.defineProperty(g,"__pid",k);e.prototype=g;k.value=e;
Object.defineProperty(e.prototype,"constructor",k);this.__getters__&&(e.__getters__=cc.clone(this.__getters__));this.__setters__&&(e.__setters__=cc.clone(this.__setters__));for(var m=0,n=arguments.length;m<n;++m){var q=arguments[m],s;for(s in q){var u="function"===typeof q[s],t="function"===typeof f[s],v=a.test(q[s]);b&&u&&t&&v?(k.value=ClassManager.compileSuper(q[s],s,h),Object.defineProperty(g,s,k)):u&&t&&v?(k.value=function(a,b){return function(){var d=this._super;this._super=f[a];var e=b.apply(this,
arguments);this._super=d;return e}}(s,q[s]),Object.defineProperty(g,s,k)):u?(k.value=q[s],Object.defineProperty(g,s,k)):g[s]=q[s];if(u){var w,A;if(this.__getters__&&this.__getters__[s]){var u=this.__getters__[s],z;for(z in this.__setters__)if(this.__setters__[z]==u){A=z;break}cc.defineGetterSetter(g,u,q[s],q[A]?q[A]:g[A],s,A)}if(this.__setters__&&this.__setters__[s]){u=this.__setters__[s];for(z in this.__getters__)if(this.__getters__[z]==u){w=z;break}cc.defineGetterSetter(g,u,q[w]?q[w]:g[w],q[s],
w,s)}}}}e.extend=cc.Class.extend;e.implement=function(a){for(var b in a)g[b]=a[b]};return e};Function.prototype.bind=Function.prototype.bind||function(a){var b=this;return function(){var f=Array.prototype.slice.call(arguments);return b.apply(a||null,f)}}})();
cc.defineGetterSetter=function(a,b,d,e,f,g){if(a.__defineGetter__)d&&a.__defineGetter__(b,d),e&&a.__defineSetter__(b,e);else if(Object.defineProperty){var h={enumerable:!1,configurable:!0};d&&(h.get=d);e&&(h.set=e);Object.defineProperty(a,b,h)}else throw Error("browser does not support getters");if(!f&&!g)for(var h=null!=d,k=void 0!=e,m=Object.getOwnPropertyNames(a),n=0;n<m.length;n++){var q=m[n];if((a.__lookupGetter__?!a.__lookupGetter__(q):!Object.getOwnPropertyDescriptor(a,q))&&"function"===typeof a[q]){var s=
a[q];if(h&&s===d&&(f=q,!k||g))break;if(k&&s===e&&(g=q,!h||f))break}}a=a.constructor;f&&(a.__getters__||(a.__getters__={}),a.__getters__[f]=b);g&&(a.__setters__||(a.__setters__={}),a.__setters__[g]=b)};cc.clone=function(a){var b=a.constructor?new a.constructor:{},d;for(d in a){var e=a[d];b[d]="object"!=typeof e||!e||e instanceof cc.Node||e instanceof HTMLElement?e:cc.clone(e)}return b};cc=cc||{};cc._tmp=cc._tmp||{};cc.associateWithNative=function(a,b){};
cc.KEY={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,
f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,",":186,equal:187,"\x3d":187,";":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,"]":221,closebracket:221,backslash:220,quote:222,space:32};cc.FMT_JPG=0;cc.FMT_PNG=1;cc.FMT_TIFF=2;cc.FMT_RAWDATA=3;cc.FMT_WEBP=4;cc.FMT_UNKNOWN=5;
cc.getImageFormatByData=function(a){return 8<a.length&&137==a[0]&&80==a[1]&&78==a[2]&&71==a[3]&&13==a[4]&&10==a[5]&&26==a[6]&&10==a[7]?cc.FMT_PNG:2<a.length&&(73==a[0]&&73==a[1]||77==a[0]&&77==a[1]||255==a[0]&&216==a[1])?cc.FMT_TIFF:cc.FMT_UNKNOWN};cc.inherits=function(a,b){function d(){}d.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new d;a.prototype.constructor=a};
cc.base=function(a,b,d){var e=arguments.callee.caller;if(e.superClass_)return ret=e.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var f=Array.prototype.slice.call(arguments,2),g=!1,h=a.constructor;h;h=h.superClass_&&h.superClass_.constructor)if(h.prototype[b]===e)g=!0;else if(g)return h.prototype[b].apply(a,f);if(a[b]===e)return a.constructor.prototype[b].apply(a,f);throw Error("cc.base called from a method of one name to a method of a different name");};cc.Point=function(a,b){this.x=a||0;this.y=b||0};cc.p=function(a,b){return void 0==a?{x:0,y:0}:void 0==b?{x:a.x,y:a.y}:{x:a,y:b}};cc.pointEqualToPoint=function(a,b){return a&&b&&a.x===b.x&&a.y===b.y};cc.Size=function(a,b){this.width=a||0;this.height=b||0};cc.size=function(a,b){return void 0===a?{width:0,height:0}:void 0===b?{width:a.width,height:a.height}:{width:a,height:b}};cc.sizeEqualToSize=function(a,b){return a&&b&&a.width==b.width&&a.height==b.height};
cc.Rect=function(a,b,d,e){this.x=a||0;this.y=b||0;this.width=d||0;this.height=e||0};cc.rect=function(a,b,d,e){return void 0===a?{x:0,y:0,width:0,height:0}:void 0===b?{x:a.x,y:a.y,width:a.width,height:a.height}:{x:a,y:b,width:d,height:e}};cc.rectEqualToRect=function(a,b){return a&&b&&a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height};cc._rectEqualToZero=function(a){return a&&0===a.x&&0===a.y&&0===a.width&&0===a.height};
cc.rectContainsRect=function(a,b){return a&&b?!(a.x>=b.x||a.y>=b.y||a.x+a.width<=b.x+b.width||a.y+a.height<=b.y+b.height):!1};cc.rectGetMaxX=function(a){return a.x+a.width};cc.rectGetMidX=function(a){return a.x+a.width/2};cc.rectGetMinX=function(a){return a.x};cc.rectGetMaxY=function(a){return a.y+a.height};cc.rectGetMidY=function(a){return a.y+a.height/2};cc.rectGetMinY=function(a){return a.y};
cc.rectContainsPoint=function(a,b){return b.x>=cc.rectGetMinX(a)&&b.x<=cc.rectGetMaxX(a)&&b.y>=cc.rectGetMinY(a)&&b.y<=cc.rectGetMaxY(a)};cc.rectIntersectsRect=function(a,b){var d=a.y+a.height,e=b.x+b.width,f=b.y+b.height;return!(a.x+a.width<b.x||e<a.x||d<b.y||f<a.y)};cc.rectOverlapsRect=function(a,b){return!(a.x+a.width<b.x||b.x+b.width<a.x||a.y+a.height<b.y||b.y+b.height<a.y)};
cc.rectUnion=function(a,b){var d=cc.rect(0,0,0,0);d.x=Math.min(a.x,b.x);d.y=Math.min(a.y,b.y);d.width=Math.max(a.x+a.width,b.x+b.width)-d.x;d.height=Math.max(a.y+a.height,b.y+b.height)-d.y;return d};cc.rectIntersection=function(a,b){var d=cc.rect(Math.max(cc.rectGetMinX(a),cc.rectGetMinX(b)),Math.max(cc.rectGetMinY(a),cc.rectGetMinY(b)),0,0);d.width=Math.min(cc.rectGetMaxX(a),cc.rectGetMaxX(b))-cc.rectGetMinX(d);d.height=Math.min(cc.rectGetMaxY(a),cc.rectGetMaxY(b))-cc.rectGetMinY(d);return d};cc.SAXParser=cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(a){return this._parseXML(a)},_parseXML:function(a){var b;this._isSupportDOMParser?b=this._parser.parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a));return b}});
cc.PlistParser=cc.SAXParser.extend({parse:function(a){a=this._parseXML(a).documentElement;if("plist"!=a.tagName)throw"Not a plist file!";for(var b=null,d=0,e=a.childNodes.length;d<e&&(b=a.childNodes[d],1!=b.nodeType);d++);return this._parseNode(b)},_parseNode:function(a){var b=null,d=a.tagName;if("dict"==d)b=this._parseDict(a);else if("array"==d)b=this._parseArray(a);else if("string"==d)if(1==a.childNodes.length)b=a.firstChild.nodeValue;else for(b="",d=0;d<a.childNodes.length;d++)b+=a.childNodes[d].nodeValue;
else"false"==d?b=!1:"true"==d?b=!0:"real"==d?b=parseFloat(a.firstChild.nodeValue):"integer"==d&&(b=parseInt(a.firstChild.nodeValue,10));return b},_parseArray:function(a){for(var b=[],d=0,e=a.childNodes.length;d<e;d++){var f=a.childNodes[d];1==f.nodeType&&b.push(this._parseNode(f))}return b},_parseDict:function(a){for(var b={},d=null,e=0,f=a.childNodes.length;e<f;e++){var g=a.childNodes[e];1==g.nodeType&&("key"==g.tagName?d=g.firstChild.nodeValue:b[d]=this._parseNode(g))}return b}});cc._txtLoader={load:function(a,b,d,e){cc.loader.loadTxt(a,e)}};cc.loader.register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader);cc._jsonLoader={load:function(a,b,d,e){cc.loader.loadJson(a,e)}};cc.loader.register(["json","ExportJson"],cc._jsonLoader);cc._imgLoader={load:function(a,b,d,e){cc.loader.cache[b]=cc.loader.loadImg(a,function(a,d){if(a)return e(a);cc.textureCache.handleLoadedTexture(b);e(null,d)})}};cc.loader.register("png jpg bmp jpeg gif ico".split(" "),cc._imgLoader);
cc._serverImgLoader={load:function(a,b,d,e){cc.loader.cache[b]=cc.loader.loadImg(d.src,function(a,d){if(a)return e(a);cc.textureCache.handleLoadedTexture(b);e(null,d)})}};cc.loader.register(["serverImg"],cc._serverImgLoader);cc._plistLoader={load:function(a,b,d,e){cc.loader.loadTxt(a,function(a,b){if(a)return e(a);e(null,cc.plistParser.parse(b))})}};cc.loader.register(["plist"],cc._plistLoader);
cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(a,b,d){var e=document,f=cc.path,g=this.TYPE,h=cc.newElement("style");h.type="text/css";e.body.appendChild(h);var k="@font-face { font-family:"+a+"; src:";if(b instanceof Array)for(var m=0,n=b.length;m<n;m++)d=f.extname(b[m]).toLowerCase(),k+="url('"+b[m]+"') format('"+g[d]+"')",k+=m==n-1?";":",";else k+="url('"+b+"') format('"+g[d]+"');";h.textContent+=k+"};";b=cc.newElement("div");d=
b.style;d.fontFamily=a;b.innerHTML=".";d.position="absolute";d.left="-100px";d.top="-100px";e.body.appendChild(b)},load:function(a,b,d,e){b=d.type;a=d.name;b=d.srcs;"string"==typeof d?(b=cc.path.extname(d),a=cc.path.basename(d,b),this._loadFont(a,d,b)):this._loadFont(a,b);e(null,!0)}};cc.loader.register(["font","eot","ttf","woff","svg"],cc._fontLoader);cc._binaryLoader={load:function(a,b,d,e){cc.loader.loadBinary(a,e)}};window.CocosEngine=cc.ENGINE_VERSION="Cocos2d-html5 v3.0 RC0";cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0;cc.DIRECTOR_STATS_POSITION=cc.p(0,0);cc.DIRECTOR_FPS_INTERVAL=0.5;cc.COCOSNODE_RENDER_SUBPIXEL=1;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1;cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=0;cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0;cc.TEXTURE_ATLAS_USE_VAO=0;cc.TEXTURE_NPOT_SUPPORT=0;cc.RETINA_DISPLAY_SUPPORT=1;cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd";cc.USE_LA88_LABELS=1;cc.SPRITE_DEBUG_DRAW=0;
cc.SPRITEBATCHNODE_DEBUG_DRAW=0;cc.LABELBMFONT_DEBUG_DRAW=0;cc.LABELATLAS_DEBUG_DRAW=0;cc.IS_RETINA_DISPLAY_SUPPORTED=1;cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas";cc.ENABLE_STACKABLE_ACTIONS=1;cc.ENABLE_GL_STATE_CACHE=1;cc.$=function(a){var b=this==cc?document:this;if(a=a instanceof HTMLElement?a:b.querySelector(a))a.find=a.find||cc.$,a.hasClass=a.hasClass||function(a){return this.className.match(RegExp("(\\s|^)"+a+"(\\s|$)"))},a.addClass=a.addClass||function(a){this.hasClass(a)||(this.className&&(this.className+=" "),this.className+=a);return this},a.removeClass=a.removeClass||function(a){this.hasClass(a)&&(this.className=this.className.replace(a,""));return this},a.remove=a.remove||function(){this.parentNode&&
this.parentNode.removeChild(this);return this},a.appendTo=a.appendTo||function(a){a.appendChild(this);return this},a.prependTo=a.prependTo||function(a){a.childNodes[0]?a.insertBefore(this,a.childNodes[0]):a.appendChild(this);return this},a.transforms=a.transforms||function(){this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew);return this},a.position=a.position||{x:0,y:0},a.rotation=a.rotation||0,a.scale=a.scale||{x:1,y:1},a.skew=
a.skew||{x:0,y:0},a.translates=function(a,b){this.position.x=a;this.position.y=b;this.transforms();return this},a.rotate=function(a){this.rotation=a;this.transforms();return this},a.resize=function(a,b){this.scale.x=a;this.scale.y=b;this.transforms();return this},a.setSkew=function(a,b){this.skew.x=a;this.skew.y=b;this.transforms();return this};return a};
switch(cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz";cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit";cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O";cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms";cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform";
cc.$.translate=cc.$.hd?function(a){return"translate3d("+a.x+"px, "+a.y+"px, 0) "}:function(a){return"translate("+a.x+"px, "+a.y+"px) "};cc.$.rotate=cc.$.hd?function(a){return"rotateZ("+a+"deg) "}:function(a){return"rotate("+a+"deg) "};cc.$.scale=function(a){return"scale("+a.x+", "+a.y+") "};cc.$.skew=function(a){return"skewX("+-a.x+"deg) skewY("+a.y+"deg)"};cc.$new=function(a){return cc.$(document.createElement(a))};
cc.$.findpos=function(a){var b=0,d=0;do b+=a.offsetLeft,d+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:d}};cc.INVALID_INDEX=-1;cc.PI=Math.PI;cc.FLT_MAX=parseFloat("3.402823466e+38F");cc.FLT_MIN=parseFloat("1.175494351e-38F");cc.RAD=cc.PI/180;cc.DEG=180/cc.PI;cc.UINT_MAX=4294967295;cc.swap=function(a,b,d){if("object"==typeof d&&"undefined"!=typeof d.x&&"undefined"!=typeof d.y){var e=d[a];d[a]=d[b];d[b]=e}else cc.log(cc._LogInfos.swap)};cc.lerp=function(a,b,d){return a+(b-a)*d};cc.rand=function(){return 16777215*Math.random()};cc.randomMinus1To1=function(){return 2*(Math.random()-0.5)};cc.random0To1=Math.random;
cc.degreesToRadians=function(a){return a*cc.RAD};cc.radiansToDegrees=function(a){return a*cc.DEG};cc.radiansToDegress=function(a){cc.log(cc._LogInfos.radiansToDegress);return a*cc.DEG};cc.REPEAT_FOREVER=Number.MAX_VALUE-1;cc.BLEND_SRC=cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?1:770;cc.BLEND_DST=771;cc.nodeDrawSetup=function(a){a._shaderProgram&&(a._shaderProgram.use(),a._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())};cc.enableDefaultGLStates=function(){};
cc.disableDefaultGLStates=function(){};cc.incrementGLDraws=function(a){cc.g_NumberOfDraws+=a};cc.FLT_EPSILON=1.192092896E-7;cc.contentScaleFactor=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.director.getContentScaleFactor()}:function(){return 1};cc.pointPointsToPixels=function(a){var b=cc.contentScaleFactor();return cc.p(a.x*b,a.y*b)};cc.pointPixelsToPoints=function(a){var b=cc.contentScaleFactor();return cc.p(a.x/b,a.y/b)};
cc._pointPixelsToPointsOut=function(a,b){var d=cc.contentScaleFactor();b.x=a.x/d;b.y=a.y/d};cc.sizePointsToPixels=function(a){var b=cc.contentScaleFactor();return cc.size(a.width*b,a.height*b)};cc.sizePixelsToPoints=function(a){var b=cc.contentScaleFactor();return cc.size(a.width/b,a.height/b)};cc._sizePixelsToPointsOut=function(a,b){var d=cc.contentScaleFactor();b.width=a.width/d;b.height=a.height/d};
cc.rectPixelsToPoints=cc.IS_RETINA_DISPLAY_SUPPORTED?function(a){var b=cc.contentScaleFactor();return cc.rect(a.x/b,a.y/b,a.width/b,a.height/b)}:function(a){return a};cc.rectPointsToPixels=cc.IS_RETINA_DISPLAY_SUPPORTED?function(a){var b=cc.contentScaleFactor();return cc.rect(a.x*b,a.y*b,a.width*b,a.height*b)}:function(a){return a};cc.ONE=1;cc.ZERO=0;cc.SRC_ALPHA=770;cc.SRC_ALPHA_SATURATE=776;cc.SRC_COLOR=768;cc.DST_ALPHA=772;cc.DST_COLOR=774;cc.ONE_MINUS_SRC_ALPHA=771;cc.ONE_MINUS_SRC_COLOR=769;
cc.ONE_MINUS_DST_ALPHA=773;cc.ONE_MINUS_DST_COLOR=775;cc.ONE_MINUS_CONSTANT_ALPHA=32772;cc.ONE_MINUS_CONSTANT_COLOR=32770;cc.checkGLErrorDebug=function(){if(cc.renderMode==cc._RENDER_TYPE_WEBGL){var a=cc._renderContext.getError();a&&cc.log(CC._localZOrder.checkGLErrorDebug,a)}};cc.DEVICE_ORIENTATION_PORTRAIT=0;cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT=1;cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN=2;cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT=3;cc.DEVICE_MAX_ORIENTATIONS=2;cc.VERTEX_ATTRIB_FLAG_NONE=0;
cc.VERTEX_ATTRIB_FLAG_POSITION=1;cc.VERTEX_ATTRIB_FLAG_COLOR=2;cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4;cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS;cc.GL_ALL=0;cc.VERTEX_ATTRIB_POSITION=0;cc.VERTEX_ATTRIB_COLOR=1;cc.VERTEX_ATTRIB_TEX_COORDS=2;cc.VERTEX_ATTRIB_MAX=3;cc.UNIFORM_PMATRIX=0;cc.UNIFORM_MVMATRIX=1;cc.UNIFORM_MVPMATRIX=2;cc.UNIFORM_TIME=3;cc.UNIFORM_SINTIME=4;cc.UNIFORM_COSTIME=5;cc.UNIFORM_RANDOM01=6;
cc.UNIFORM_SAMPLER=7;cc.UNIFORM_MAX=8;cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor";cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest";cc.SHADER_POSITION_COLOR="ShaderPositionColor";cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture";cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor";cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color";cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor";cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor";
cc.UNIFORM_PMATRIX_S="CC_PMatrix";cc.UNIFORM_MVMATRIX_S="CC_MVMatrix";cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix";cc.UNIFORM_TIME_S="CC_Time";cc.UNIFORM_SINTIME_S="CC_SinTime";cc.UNIFORM_COSTIME_S="CC_CosTime";cc.UNIFORM_RANDOM01_S="CC_Random01";cc.UNIFORM_SAMPLER_S="CC_Texture0";cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value";cc.ATTRIBUTE_NAME_COLOR="a_color";cc.ATTRIBUTE_NAME_POSITION="a_position";cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord";cc.ITEM_SIZE=32;cc.CURRENT_ITEM=3233828865;cc.ZOOM_ACTION_TAG=3233828866;
cc.NORMAL_TAG=8801;cc.SELECTED_TAG=8802;cc.DISABLE_TAG=8803;cc=cc||{};cc._tmp=cc._tmp||{};
cc._tmp.WebGLColor=function(){cc.color=function(a,d,e,f,g,h){return void 0===a?new cc.Color(0,0,0,255,g,h):"string"===typeof a?(a=cc.hexToColor(a),new cc.Color(a.r,a.g,a.b,a.a)):"object"===typeof a?new cc.Color(a.r,a.g,a.b,a.a,a.arrayBuffer,a.offset):new cc.Color(a,d,e,f,g,h)};cc.Color=function(a,d,e,f,g,h){this._arrayBuffer=g||new ArrayBuffer(cc.Color.BYTES_PER_ELEMENT);this._offset=h||0;g=this._arrayBuffer;h=this._offset;var k=Uint8Array.BYTES_PER_ELEMENT;this._rU8=new Uint8Array(g,h,1);this._gU8=
new Uint8Array(g,h+k,1);this._bU8=new Uint8Array(g,h+2*k,1);this._aU8=new Uint8Array(g,h+3*k,1);this._rU8[0]=a||0;this._gU8[0]=d||0;this._bU8[0]=e||0;this._aU8[0]=f||255;void 0===f&&(this.a_undefined=!0)};cc.Color.BYTES_PER_ELEMENT=4;var a=cc.Color.prototype;a._getR=function(){return this._rU8[0]};a._setR=function(a){this._rU8[0]=0>a?0:a};a._getG=function(){return this._gU8[0]};a._setG=function(a){this._gU8[0]=0>a?0:a};a._getB=function(){return this._bU8[0]};a._setB=function(a){this._bU8[0]=0>a?0:
a};a._getA=function(){return this._aU8[0]};a._setA=function(a){this._aU8[0]=0>a?0:a};cc.defineGetterSetter(a,"r",a._getR,a._setR);cc.defineGetterSetter(a,"g",a._getG,a._setG);cc.defineGetterSetter(a,"b",a._getB,a._setB);cc.defineGetterSetter(a,"a",a._getA,a._setA);cc.Vertex2F=function(a,d,e,f){this._arrayBuffer=e||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT);this._offset=f||0;this._xF32=new Float32Array(this._arrayBuffer,this._offset,1);this._yF32=new Float32Array(this._arrayBuffer,this._offset+
4,1);this._xF32[0]=a||0;this._yF32[0]=d||0};cc.Vertex2F.BYTES_PER_ELEMENT=8;Object.defineProperties(cc.Vertex2F.prototype,{x:{get:function(){return this._xF32[0]},set:function(a){this._xF32[0]=a},enumerable:!0},y:{get:function(){return this._yF32[0]},set:function(a){this._yF32[0]=a},enumerable:!0}});cc.Vertex3F=function(a,d,e,f,g){this._arrayBuffer=f||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT);this._offset=g||0;f=this._arrayBuffer;g=this._offset;this._xF32=new Float32Array(f,g,1);this._xF32[0]=
a||0;this._yF32=new Float32Array(f,g+Float32Array.BYTES_PER_ELEMENT,1);this._yF32[0]=d||0;this._zF32=new Float32Array(f,g+2*Float32Array.BYTES_PER_ELEMENT,1);this._zF32[0]=e||0};cc.Vertex3F.BYTES_PER_ELEMENT=12;Object.defineProperties(cc.Vertex3F.prototype,{x:{get:function(){return this._xF32[0]},set:function(a){this._xF32[0]=a},enumerable:!0},y:{get:function(){return this._yF32[0]},set:function(a){this._yF32[0]=a},enumerable:!0},z:{get:function(){return this._zF32[0]},set:function(a){this._zF32[0]=
a},enumerable:!0}});cc.Tex2F=function(a,d,e,f){this._arrayBuffer=e||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT);this._offset=f||0;this._uF32=new Float32Array(this._arrayBuffer,this._offset,1);this._vF32=new Float32Array(this._arrayBuffer,this._offset+4,1);this._uF32[0]=a||0;this._vF32[0]=d||0};cc.Tex2F.BYTES_PER_ELEMENT=8;Object.defineProperties(cc.Tex2F.prototype,{u:{get:function(){return this._uF32[0]},set:function(a){this._uF32[0]=a},enumerable:!0},v:{get:function(){return this._vF32[0]},set:function(a){this._vF32[0]=
a},enumerable:!0}});cc.Quad2=function(a,d,e,f,g,h){this._arrayBuffer=g||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT);this._offset=h||0;g=this._arrayBuffer;h=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=a?new cc.Vertex2F(a.x,a.y,g,0):new cc.Vertex2F(0,0,g,0);this._tr=d?new cc.Vertex2F(d.x,d.y,g,h):new cc.Vertex2F(0,0,g,h);this._bl=e?new cc.Vertex2F(e.x,e.y,g,2*h):new cc.Vertex2F(0,0,g,2*h);this._br=f?new cc.Vertex2F(f.x,f.y,g,3*h):new cc.Vertex2F(0,0,g,3*h)};cc.Quad2.BYTES_PER_ELEMENT=32;cc.Quad3=function(a,
d,e,f){this.bl=a||new cc.Vertex3F(0,0,0);this.br=d||new cc.Vertex3F(0,0,0);this.tl=e||new cc.Vertex3F(0,0,0);this.tr=f||new cc.Vertex3F(0,0,0)};Object.defineProperties(cc.Quad2.prototype,{tl:{get:function(){return this._tl},set:function(a){this._tl.x=a.x;this._tl.y=a.y},enumerable:!0},tr:{get:function(){return this._tr},set:function(a){this._tr.x=a.x;this._tr.y=a.y},enumerable:!0},bl:{get:function(){return this._bl},set:function(a){this._bl.x=a.x;this._bl.y=a.y},enumerable:!0},br:{get:function(){return this._br},
set:function(a){this._br.x=a.x;this._br.y=a.y},enumerable:!0}});cc.V3F_C4B_T2F=function(a,d,e,f,g){this._arrayBuffer=f||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT);this._offset=g||0;f=this._arrayBuffer;g=this._offset;var h=cc.Vertex3F.BYTES_PER_ELEMENT;this._vertices=a?new cc.Vertex3F(a.x,a.y,a.z,f,g):new cc.Vertex3F(0,0,0,f,g);this._colors=d?cc.color(d.r,d.g,d.b,d.a,f,g+h):cc.color(0,0,0,0,f,g+h);this._texCoords=e?new cc.Tex2F(e.u,e.v,f,g+h+cc.Color.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,f,g+
h+cc.Color.BYTES_PER_ELEMENT)};cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24;Object.defineProperties(cc.V3F_C4B_T2F.prototype,{vertices:{get:function(){return this._vertices},set:function(a){var d=this._vertices;d.x=a.x;d.y=a.y;d.z=a.z},enumerable:!0},colors:{get:function(){return this._colors},set:function(a){var d=this._colors;d.r=a.r;d.g=a.g;d.b=a.b;d.a=a.a},enumerable:!0},texCoords:{get:function(){return this._texCoords},set:function(a){this._texCoords.u=a.u;this._texCoords.v=a.v},enumerable:!0}});cc.V3F_C4B_T2F_Quad=
function(a,d,e,f,g,h){this._arrayBuffer=g||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);this._offset=h||0;g=this._arrayBuffer;h=this._offset;var k=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=a?new cc.V3F_C4B_T2F(a.vertices,a.colors,a.texCoords,g,h):new cc.V3F_C4B_T2F(null,null,null,g,h);this._bl=d?new cc.V3F_C4B_T2F(d.vertices,d.colors,d.texCoords,g,h+k):new cc.V3F_C4B_T2F(null,null,null,g,h+k);this._tr=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,g,h+2*k):new cc.V3F_C4B_T2F(null,
null,null,g,h+2*k);this._br=f?new cc.V3F_C4B_T2F(f.vertices,f.colors,f.texCoords,g,h+3*k):new cc.V3F_C4B_T2F(null,null,null,g,h+3*k)};cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96;Object.defineProperties(cc.V3F_C4B_T2F_Quad.prototype,{tl:{get:function(){return this._tl},set:function(a){var d=this._tl;d.vertices=a.vertices;d.colors=a.colors;d.texCoords=a.texCoords},enumerable:!0},bl:{get:function(){return this._bl},set:function(a){var d=this._bl;d.vertices=a.vertices;d.colors=a.colors;d.texCoords=a.texCoords},
enumerable:!0},tr:{get:function(){return this._tr},set:function(a){var d=this._tr;d.vertices=a.vertices;d.colors=a.colors;d.texCoords=a.texCoords},enumerable:!0},br:{get:function(){return this._br},set:function(a){var d=this._br;d.vertices=a.vertices;d.colors=a.colors;d.texCoords=a.texCoords},enumerable:!0},arrayBuffer:{get:function(){return this._arrayBuffer},enumerable:!0}});cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad};cc.V3F_C4B_T2F_QuadCopy=function(a){if(!a)return cc.V3F_C4B_T2F_QuadZero();
var d=a.tl,e=a.bl,f=a.tr;a=a.br;return{tl:{vertices:{x:d.vertices.x,y:d.vertices.y,z:d.vertices.z},colors:{r:d.colors.r,g:d.colors.g,b:d.colors.b,a:d.colors.a},texCoords:{u:d.texCoords.u,v:d.texCoords.v}},bl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},tr:{vertices:{x:f.vertices.x,y:f.vertices.y,z:f.vertices.z},colors:{r:f.colors.r,g:f.colors.g,b:f.colors.b,a:f.colors.a},texCoords:{u:f.texCoords.u,
v:f.texCoords.v}},br:{vertices:{x:a.vertices.x,y:a.vertices.y,z:a.vertices.z},colors:{r:a.colors.r,g:a.colors.g,b:a.colors.b,a:a.colors.a},texCoords:{u:a.texCoords.u,v:a.texCoords.v}}}};cc.V3F_C4B_T2F_QuadsCopy=function(a){if(!a)return[];for(var d=[],e=0;e<a.length;e++)d.push(cc.V3F_C4B_T2F_QuadCopy(a[e]));return d};cc.V2F_C4B_T2F=function(a,d,e,f,g){this._arrayBuffer=f||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT);this._offset=g||0;f=this._arrayBuffer;g=this._offset;var h=cc.Vertex2F.BYTES_PER_ELEMENT;
this._vertices=a?new cc.Vertex2F(a.x,a.y,f,g):new cc.Vertex2F(0,0,f,g);this._colors=d?cc.color(d.r,d.g,d.b,d.a,f,g+h):cc.color(0,0,0,0,f,g+h);this._texCoords=e?new cc.Tex2F(e.u,e.v,f,g+h+cc.Color.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,f,g+h+cc.Color.BYTES_PER_ELEMENT)};cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20;Object.defineProperties(cc.V2F_C4B_T2F.prototype,{vertices:{get:function(){return this._vertices},set:function(a){this._vertices.x=a.x;this._vertices.y=a.y},enumerable:!0},colors:{get:function(){return this._colors},
set:function(a){var d=this._colors;d.r=a.r;d.g=a.g;d.b=a.b;d.a=a.a},enumerable:!0},texCoords:{get:function(){return this._texCoords},set:function(a){this._texCoords.u=a.u;this._texCoords.v=a.v},enumerable:!0}});cc.V2F_C4B_T2F_Triangle=function(a,d,e,f,g){this._arrayBuffer=f||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT);this._offset=g||0;f=this._arrayBuffer;g=this._offset;var h=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=a?new cc.V2F_C4B_T2F(a.vertices,a.colors,a.texCoords,f,g):new cc.V2F_C4B_T2F(null,
null,null,f,g);this._b=d?new cc.V2F_C4B_T2F(d.vertices,d.colors,d.texCoords,f,g+h):new cc.V2F_C4B_T2F(null,null,null,f,g+h);this._c=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,f,g+2*h):new cc.V2F_C4B_T2F(null,null,null,f,g+2*h)};cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60;Object.defineProperties(cc.V2F_C4B_T2F_Triangle.prototype,{a:{get:function(){return this._a},set:function(a){var d=this._a;d.vertices=a.vertices;d.colors=a.colors;d.texCoords=a.texCoords},enumerable:!0},b:{get:function(){return this._b},
set:function(a){var d=this._b;d.vertices=a.vertices;d.colors=a.colors;d.texCoords=a.texCoords},enumerable:!0},c:{get:function(){return this._c},set:function(a){var d=this._c;d.vertices=a.vertices;d.colors=a.colors;d.texCoords=a.texCoords},enumerable:!0}})};cc._tmp.PrototypeColor=function(){var a=cc.color;a._getWhite=function(){return a(255,255,255)};a._getYellow=function(){return a(255,255,0)};a._getBlue=function(){return a(0,0,255)};a._getGreen=function(){return a(0,255,0)};a._getRed=function(){return a(255,0,0)};a._getMagenta=function(){return a(255,0,255)};a._getBlack=function(){return a(0,0,0)};a._getOrange=function(){return a(255,127,0)};a._getGray=function(){return a(166,166,166)};cc.defineGetterSetter(a,"WHITE",a._getWhite);cc.defineGetterSetter(a,
"YELLOW",a._getYellow);cc.defineGetterSetter(a,"BLUE",a._getBlue);cc.defineGetterSetter(a,"GREEN",a._getGreen);cc.defineGetterSetter(a,"RED",a._getRed);cc.defineGetterSetter(a,"MAGENTA",a._getMagenta);cc.defineGetterSetter(a,"BLACK",a._getBlack);cc.defineGetterSetter(a,"ORANGE",a._getOrange);cc.defineGetterSetter(a,"GRAY",a._getGray)};cc.Color=function(a,b,d,e){this.r=a||0;this.g=b||0;this.b=d||0;this.a=e||255};cc.color=function(a,b,d,e){return void 0===a?{r:0,g:0,b:0,a:255}:"string"===typeof a?cc.hexToColor(a):"object"===typeof a?{r:a.r,g:a.g,b:a.b,a:a.a||255}:{r:a,g:b,b:d,a:e||255}};cc.colorEqual=function(a,b){return a.r===b.r&&a.g===b.g&&a.b===b.b};cc.Acceleration=function(a,b,d,e){this.x=a||0;this.y=b||0;this.z=d||0;this.timestamp=e||0};cc.Vertex2F=function(a,b){this.x=a||0;this.y=b||0};
cc.vertex2=function(a,b){return new cc.Vertex2F(a,b)};cc.Vertex3F=function(a,b,d){this.x=a||0;this.y=b||0;this.z=d||0};cc.vertex3=function(a,b,d){return new cc.Vertex3F(a,b,d)};cc.Tex2F=function(a,b){this.u=a||0;this.v=b||0};cc.tex2=function(a,b){return new cc.Tex2F(a,b)};cc.BlendFunc=function(a,b){this.src=a;this.dst=b};cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)};cc.hexToColor=function(a){a=a.replace(/^#?/,"0x");a=parseInt(a);return cc.color(a>>16,(a>>8)%256,a%256)};
cc.colorToHex=function(a){var b=a.r.toString(16),d=a.g.toString(16),e=a.b.toString(16);return"#"+(16>a.r?"0"+b:b)+(16>a.g?"0"+d:d)+(16>a.b?"0"+e:e)};cc.TEXT_ALIGNMENT_LEFT=0;cc.TEXT_ALIGNMENT_CENTER=1;cc.TEXT_ALIGNMENT_RIGHT=2;cc.VERTICAL_TEXT_ALIGNMENT_TOP=0;cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1;cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2;
cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={};this._valueMapTb={};this.__currId=2<<(0|10*Math.random())},__getKey:function(){this.__currId++;return"key_"+this.__currId},setObject:function(a,b){if(null!=b){var d=this.__getKey();this._keyMapTb[d]=b;this._valueMapTb[d]=a}},objectForKey:function(a){if(null==a)return null;var b=this._keyMapTb,d;for(d in b)if(b[d]===a)return this._valueMapTb[d];return null},valueForKey:function(a){return this.objectForKey(a)},
removeObjectForKey:function(a){if(null!=a){var b=this._keyMapTb,d;for(d in b)if(b[d]===a){delete this._valueMapTb[d];delete b[d];break}}},removeObjectsForKeys:function(a){if(null!=a)for(var b=0;b<a.length;b++)this.removeObjectForKey(a[b])},allKeys:function(){var a=[],b=this._keyMapTb,d;for(d in b)a.push(b[d]);return a},removeAllObjects:function(){this._keyMapTb={};this._valueMapTb={}},count:function(){return this.allKeys().length}});
cc.FontDefinition=function(){this.fontName="Arial";this.fontSize=12;this.textAlign=cc.TEXT_ALIGNMENT_CENTER;this.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this.fillStyle=cc.color(255,255,255,255);this.boundingHeight=this.boundingWidth=0;this.strokeEnabled=!1;this.strokeStyle=cc.color(255,255,255,255);this.lineWidth=1;this.shadowEnabled=!1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowOpacity=1};
cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc.assert("function"===typeof cc._tmp.WebGLColor,cc._LogInfos.MissingFile,"CCTypesWebGL.js"),cc._tmp.WebGLColor(),delete cc._tmp.WebGLColor);cc.assert("function"===typeof cc._tmp.PrototypeColor,cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js");cc._tmp.PrototypeColor();delete cc._tmp.PrototypeColor;cc.Touches=[];cc.TouchesIntergerDict={};
cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!0,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_indexBitsUsed:0,_maxTouches:5,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_captured:!1,_wnd:null,_hDC:null,_hRC:null,
_supportTouch:!1,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,ctor:function(){var a=document,b=cc.ContainerStrategy,d=cc.ContentStrategy;this._frame=cc.container.parentNode===a.body?a.documentElement:cc.container.parentNode;this._frameSize=cc.size(0,0);this._initFrameSize();var a=cc._canvas.width,e=cc._canvas.height;this._designResolutionSize=cc.size(a,e);this._originalDesignResolutionSize=cc.size(a,e);this._viewPortRect=cc.rect(0,0,
a,e);this._visibleRect=cc.rect(0,0,a,e);this._contentTranslateLeftTop={left:0,top:0};this._viewName="Cocos2dHTML5";a=cc.sys;this.enableRetina(a.os==a.OS_IOS||a.os==a.OS_OSX);cc.visibleRect&&cc.visibleRect.init(this._visibleRect);this._rpExactFit=new cc.ResolutionPolicy(b.EQUAL_TO_FRAME,d.EXACT_FIT);this._rpShowAll=new cc.ResolutionPolicy(b.PROPORTION_TO_FRAME,d.SHOW_ALL);this._rpNoBorder=new cc.ResolutionPolicy(b.EQUAL_TO_FRAME,d.NO_BORDER);this._rpFixedHeight=new cc.ResolutionPolicy(b.EQUAL_TO_FRAME,
d.FIXED_HEIGHT);this._rpFixedWidth=new cc.ResolutionPolicy(b.EQUAL_TO_FRAME,d.FIXED_WIDTH);this._hDC=cc._canvas;this._hRC=cc._renderContext},_resizeEvent:function(){var a=this._originalDesignResolutionSize.width,b=this._originalDesignResolutionSize.height;this._resizeCallback&&(this._initFrameSize(),this._resizeCallback.call());0<a&&this.setDesignResolutionSize(a,b,this._resolutionPolicy)},resizeWithBrowserSize:function(a){a?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,a=this._resizeEvent.bind(this),
cc._addEventListener(window,"resize",a,!1)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!0,a=this._resizeEvent.bind(this),window.removeEventListener("resize",a,!1))},setResizeCallback:function(a){if("function"==typeof a||null==a)this._resizeCallback=a},_initFrameSize:function(){var a=this._frameSize;a.width=this._frame.clientWidth;a.height=this._frame.clientHeight},_adjustSizeKeepCanvasSize:function(){var a=this._originalDesignResolutionSize.width,b=this._originalDesignResolutionSize.height;
0<a&&this.setDesignResolutionSize(a,b,this._resolutionPolicy)},_setViewPortMeta:function(a,b){if(this._isAdjustViewPort){var d={"user-scalable":"no","maximum-scale":"1.0","initial-scale":"1.0"},e=document.getElementsByName("viewport"),f;0==e.length?(e=cc.newElement("meta"),e.name="viewport",e.content="",document.head.appendChild(e)):e=e[0];if(cc.sys.isMobile&&cc.sys.browserType==cc.sys.BROWSER_TYPE_FIREFOX)e.content="initial-scale:1";else{f=e.content;for(var g in d)RegExp(g).test(f)||(f+=(""==f?"":
",")+g+"\x3d"+d[g]);e.content=f}}},_setScaleXYForRenderTexture:function(){var a=cc.contentScaleFactor();this._scaleY=this._scaleX=a},_resetScale:function(){this._scaleX=this._originalScaleX;this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(a){this._isAdjustViewPort=a},enableRetina:function(a){this._retinaEnabled=a?!0:!1},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(a){this._autoFullScreen=
a?!0:!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return null!=this._hDC&&null!=this._hRC},setFrameZoomFactor:function(a){this._frameZoomFactor=a;this.centerWindow();cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(a){},setContentTranslateLeftTop:function(a,b){this._contentTranslateLeftTop={left:a,top:b}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},
getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(a,b){this._frameSize.width=a;this._frameSize.height=b;this._frame.style.width=a+"px";this._frame.style.height=b+"px";this._resizeEvent();cc.director.setProjection(cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},
canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(a){if(a instanceof cc.ResolutionPolicy)this._resolutionPolicy=a;else{var b=cc.ResolutionPolicy;a===b.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit);a===b.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll);a===b.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder);a===b.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight);a===b.FIXED_WIDTH&&(this._resolutionPolicy=
this._rpFixedWidth)}},setDesignResolutionSize:function(a,b,d){if(isNaN(a)||0==a||isNaN(b)||0==b)cc.log(cc._LogInfos.EGLView_setDesignResolutionSize);else{this.setResolutionPolicy(d);var e=this._resolutionPolicy;if(e){e.preApply(this);var f=this._frameSize.width,g=this._frameSize.height;cc.sys.isMobile&&this._setViewPortMeta(this._frameSize.width,this._frameSize.height);this._initFrameSize();if(d!=this._resolutionPolicy||a!=this._originalDesignResolutionSize.width||b!=this._originalDesignResolutionSize.height||
f!=this._frameSize.width||g!=this._frameSize.height)this._designResolutionSize=cc.size(a,b),this._originalDesignResolutionSize=cc.size(a,b),a=e.apply(this,this._designResolutionSize),a.scale&&2==a.scale.length&&(this._scaleX=a.scale[0],this._scaleY=a.scale[1]),a.viewport&&(a=this._viewPortRect=a.viewport,b=this._visibleRect,b.width=cc._canvas.width/this._scaleX,b.height=cc._canvas.height/this._scaleY,b.x=-a.x/this._scaleX,b.y=-a.y/this._scaleY),a=cc.director,cc.winSize.width=a._winSizeInPoints.width=
this._visibleRect.width,cc.winSize.height=a._winSizeInPoints.height=this._visibleRect.height,e.postApply(this),cc._renderType==cc._RENDER_TYPE_WEBGL&&(a._createStatsLabel(),a.setGLDefaultValues()),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.DOM&&cc.DOM._resetEGLViewDiv(),cc.visibleRect&&cc.visibleRect.init(this._visibleRect)}else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2)}},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},
setViewPortInPoints:function(a,b,d,e){var f=this._frameZoomFactor,g=this._scaleX,h=this._scaleY;cc._renderContext.viewport(a*g*f+this._viewPortRect.x*f,b*h*f+this._viewPortRect.y*f,d*g*f,e*h*f)},setScissorInPoints:function(a,b,d,e){var f=this._frameZoomFactor,g=this._scaleX,h=this._scaleY;cc._renderContext.scissor(a*g*f+this._viewPortRect.x*f,b*h*f+this._viewPortRect.y*f,d*g*f,e*h*f)},isScissorEnabled:function(){var a=cc._renderContext;return a.isEnabled(a.SCISSOR_TEST)},getScissorRect:function(){var a=
cc._renderContext,b=this._scaleX,d=this._scaleY,a=a.getParameter(a.SCISSOR_BOX);return cc.rect((a[0]-this._viewPortRect.x)/b,(a[1]-this._viewPortRect.y)/d,a[2]/b,a[3]/d)},setViewName:function(a){null!=a&&0<a.length&&(this._viewName=a)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(a,
b,d){return{x:this._devicePixelRatio*(a-d.left),y:this._devicePixelRatio*(d.top+d.height-b)}},_convertMouseToLocationInView:function(a,b){var d=this._viewPortRect;a.x=(this._devicePixelRatio*(a.x-b.left)-d.x)/this._scaleX;a.y=(this._devicePixelRatio*(b.top+b.height-a.y)-d.y)/this._scaleY},_convertTouchesWithScale:function(a){for(var b=this._viewPortRect,d=this._scaleX,e=this._scaleY,f,g,h,k=0;k<a.length;k++)f=a[k],g=f._point,h=f._prevPoint,f._setPoint((g.x-b.x)/d,(g.y-b.y)/e),f._setPrevPoint((h.x-
b.x)/d,(h.y-b.y)/e)}});cc.EGLView._getInstance=function(){this._instance||(this._instance=this._instance||new cc.EGLView,this._instance.initialize());return this._instance};
cc.ContainerStrategy=cc.Class.extend({preApply:function(a){},apply:function(a,b){},postApply:function(a){},_setupContainer:function(a,b,d){var e=a._frame;cc.view._autoFullScreen&&cc.sys.isMobile&&e==document.documentElement&&cc.screen.autoFullScreen(e);var e=cc._canvas,f=cc.container;f.style.width=e.style.width=b+"px";f.style.height=e.style.height=d+"px";f=a._devicePixelRatio=1;a.isRetinaEnabled()&&(f=a._devicePixelRatio=window.devicePixelRatio||1);e.width=b*f;e.height=d*f;a=document.body;var g;a&&
(g=a.style)&&(g.paddingTop=g.paddingTop||"0px",g.paddingRight=g.paddingRight||"0px",g.paddingBottom=g.paddingBottom||"0px",g.paddingLeft=g.paddingLeft||"0px",g.borderTop=g.borderTop||"0px",g.borderRight=g.borderRight||"0px",g.borderBottom=g.borderBottom||"0px",g.borderLeft=g.borderLeft||"0px",g.marginTop=g.marginTop||"0px",g.marginRight=g.marginRight||"0px",g.marginBottom=g.marginBottom||"0px",g.marginLeft=g.marginLeft||"0px")},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);
var a=document.body.style;a.width=window.innerWidth+"px";a.height=window.innerHeight+"px";a.overflow="hidden";a=cc.container.style;a.position="fixed";a.left=a.top="0px";document.body.scrollTop=0}});
cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(a,b,d,e,f,g){2>Math.abs(a-d)&&(d=a);2>Math.abs(b-e)&&(e=b);a=cc.rect(Math.round((a-d)/2),Math.round((b-e)/2),d,e);cc._renderType==cc._RENDER_TYPE_CANVAS&&cc._renderContext.translate(a.x,a.y+e);this._result.scale=[f,g];this._result.viewport=a;return this._result},preApply:function(a){},apply:function(a,b){return{scale:[1,1]}},postApply:function(a){}});
(function(){var a=cc.ContainerStrategy.extend({apply:function(a){this._setupContainer(a,a._frameSize.width,a._frameSize.height)}}),b=cc.ContainerStrategy.extend({apply:function(a,b){var d=a._frameSize.width,e=a._frameSize.height,f=cc.container.style,q=b.width,s=b.height,u=d/q,t=e/s,v,w;u<t?(v=d,w=s*u):(v=q*t,w=e);q=Math.round((d-v)/2);w=Math.round((e-w)/2);this._setupContainer(a,d-2*q,e-2*w);f.marginLeft=q+"px";f.marginRight=q+"px";f.marginTop=w+"px";f.marginBottom=w+"px"}});a.extend({preApply:function(a){this._super(a);
a._frame=document.documentElement},apply:function(a){this._super(a);this._fixContainer()}});b.extend({preApply:function(a){this._super(a);a._frame=document.documentElement},apply:function(a,b){this._super(a,b);this._fixContainer()}});var d=cc.ContainerStrategy.extend({apply:function(a){this._setupContainer(a,cc._canvas.width,cc._canvas.height)}});cc.ContainerStrategy.EQUAL_TO_FRAME=new a;cc.ContainerStrategy.PROPORTION_TO_FRAME=new b;cc.ContainerStrategy.ORIGINAL_CONTAINER=new d;var a=cc.ContentStrategy.extend({apply:function(a,
b){var d=cc._canvas.width,e=cc._canvas.height;return this._buildResult(d,e,d,e,d/b.width,e/b.height)}}),b=cc.ContentStrategy.extend({apply:function(a,b){var d=cc._canvas.width,e=cc._canvas.height,f=b.width,q=b.height,s=d/f,u=e/q,t=0,v,w;s<u?(t=s,v=d,w=q*t):(t=u,v=f*t,w=e);return this._buildResult(d,e,v,w,t,t)}}),d=cc.ContentStrategy.extend({apply:function(a,b){var d=cc._canvas.width,e=cc._canvas.height,f=b.width,q=b.height,s=d/f,u=e/q,t,v,w;s<u?(t=u,v=f*t,w=e):(t=s,v=d,w=q*t);return this._buildResult(d,
e,v,w,t,t)}}),e=cc.ContentStrategy.extend({apply:function(a,b){var d=cc._canvas.width,e=cc._canvas.height,f=e/b.height;return this._buildResult(d,e,d,e,f,f)},postApply:function(a){cc.director._winSizeInPoints=a.getVisibleSize()}}),f=cc.ContentStrategy.extend({apply:function(a,b){var d=cc._canvas.width,e=cc._canvas.height,f=d/b.width;return this._buildResult(d,e,d,e,f,f)},postApply:function(a){cc.director._winSizeInPoints=a.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new a;cc.ContentStrategy.SHOW_ALL=
new b;cc.ContentStrategy.NO_BORDER=new d;cc.ContentStrategy.FIXED_HEIGHT=new e;cc.ContentStrategy.FIXED_WIDTH=new f})();
cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(a,b){this.setContainerStrategy(a);this.setContentStrategy(b)},preApply:function(a){this._containerStrategy.preApply(a);this._contentStrategy.preApply(a)},apply:function(a,b){this._containerStrategy.apply(a,b);return this._contentStrategy.apply(a,b)},postApply:function(a){this._containerStrategy.postApply(a);this._contentStrategy.postApply(a)},setContainerStrategy:function(a){a instanceof cc.ContainerStrategy&&
(this._containerStrategy=a)},setContentStrategy:function(a){a instanceof cc.ContentStrategy&&(this._contentStrategy=a)}});cc.ResolutionPolicy.EXACT_FIT=0;cc.ResolutionPolicy.NO_BORDER=1;cc.ResolutionPolicy.SHOW_ALL=2;cc.ResolutionPolicy.FIXED_HEIGHT=3;cc.ResolutionPolicy.FIXED_WIDTH=4;cc.ResolutionPolicy.UNKNOWN=5;cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen",
"mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var a,b,d=this._fnMap,e;a=0;for(l=d.length;a<l;a++)if((b=d[a])&&b[1]in document){a=0;for(e=b.length;a<e;a++)this._fn[d[0][a]]=b[a];break}this._supportsFullScreen=void 0!=this._fn.requestFullscreen;this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return this._supportsFullScreen&&document[this._fn.fullscreenEnabled]},
requestFullScreen:function(a,b){if(this._supportsFullScreen){a=a||document.documentElement;a[this._fn.requestFullscreen]();if(b){var d=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(d,this._preOnFullScreenChange);this._preOnFullScreenChange=b;cc._addEventListener(document,d,b,!1)}return a[this._fn.requestFullscreen]()}},exitFullScreen:function(){return this._supportsFullScreen?document[this._fn.exitFullscreen]():!0},autoFullScreen:function(a,b){function d(){f.requestFullScreen(a,
b);e.removeEventListener(f._touchEvent,d)}a=a||document.body;var e=cc._canvas||a,f=this;this.requestFullScreen(a,b);cc._addEventListener(e,this._touchEvent,d)}};cc.screen.init();cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(a){var b=this.width=a.width,d=this.height=a.height,e=a.x;a=a.y;var f=a+d,g=e+b;this.topLeft.x=e;this.topLeft.y=f;this.topRight.x=g;this.topRight.y=f;this.top.x=e+b/2;this.top.y=f;this.bottomLeft.x=e;this.bottomLeft.y=a;this.bottomRight.x=g;this.bottomRight.y=a;this.bottom.x=e+b/2;this.bottom.y=
a;this.center.x=e+b/2;this.center.y=a+d/2;this.left.x=e;this.left.y=a+d/2;this.right.x=g;this.right.y=a+d/2}};cc.UIInterfaceOrientationLandscapeLeft=-90;cc.UIInterfaceOrientationLandscapeRight=90;cc.UIInterfaceOrientationPortraitUpsideDown=180;cc.UIInterfaceOrientationPortrait=0;
cc.inputManager={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var a=this._indexBitsUsed,b=0;b<this._maxTouches;b++){if(!(a&1))return this._indexBitsUsed|=1<<b,b;a>>=1}return-1},_removeUsedIndexBit:function(a){0>a||
a>=this._maxTouches||(a=~(1<<a),this._indexBitsUsed&=a)},_glView:null,handleTouchesBegin:function(a){for(var b,d,e,f=[],g=this._touchesIntegerDict,h=0,k=a.length;h<k;h++)b=a[h],e=b.getID(),d=g[e],null==d&&(d=this._getUnUsedIndex(),-1==d?cc.log(cc._LogInfos.inputManager_handleTouchesBegin,d):(b=this._touches[d]=b,g[e]=d,f.push(b)));0<f.length&&(this._glView._convertTouchesWithScale(f),a=new cc.EventTouch(f),a._eventCode=cc.EventTouch.EventCode.BEGAN,cc.eventManager.dispatchEvent(a))},handleTouchesMove:function(a){for(var b,
d,e=[],f=this._touches,g=0,h=a.length;g<h;g++)b=a[g],d=b.getID(),d=this._touchesIntegerDict[d],null!=d&&f[d]&&(f[d]._setPoint(b._point),f[d]._setPrevPoint(b._prevPoint),e.push(f[d]));0<e.length&&(this._glView._convertTouchesWithScale(e),a=new cc.EventTouch(e),a._eventCode=cc.EventTouch.EventCode.MOVED,cc.eventManager.dispatchEvent(a))},handleTouchesEnd:function(a){a=this.getSetOfTouchesEndOrCancel(a);0<a.length&&(this._glView._convertTouchesWithScale(a),a=new cc.EventTouch(a),a._eventCode=cc.EventTouch.EventCode.ENDED,
cc.eventManager.dispatchEvent(a))},handleTouchesCancel:function(a){a=this.getSetOfTouchesEndOrCancel(a);0<a.length&&(this._glView._convertTouchesWithScale(a),a=new cc.EventTouch(a),a._eventCode=cc.EventTouch.EventCode.CANCELLED,cc.eventManager.dispatchEvent(a))},getSetOfTouchesEndOrCancel:function(a){for(var b,d,e,f=[],g=this._touches,h=this._touchesIntegerDict,k=0,m=a.length;k<m;k++)b=a[k],e=b.getID(),d=h[e],null!=d&&g[d]&&(g[d]._setPoint(b._point),g[d]._setPrevPoint(b._prevPoint),f.push(g[d]),this._removeUsedIndexBit(d),
delete h[e]);return f},getHTMLElementPosition:function(a){var b=document.documentElement,d=window,e=null,e="function"===typeof a.getBoundingClientRect?a.getBoundingClientRect():a instanceof HTMLCanvasElement?{left:0,top:0,width:a.width,height:a.height}:{left:0,top:0,width:parseInt(a.style.width),height:parseInt(a.style.height)};return{left:e.left+d.pageXOffset-b.clientLeft,top:e.top+d.pageYOffset-b.clientTop,width:e.width,height:e.height}},getPreTouch:function(a){for(var b=null,d=this._preTouchPool,
e=a.getId(),f=d.length-1;0<=f;f--)if(d[f].getId()==e){b=d[f];break}b||(b=a);return b},setPreTouch:function(a){for(var b=!1,d=this._preTouchPool,e=a.getId(),f=d.length-1;0<=f;f--)if(d[f].getId()==e){d[f]=a;b=!0;break}b||(50>=d.length?d.push(a):(d[this._preTouchPoolPointer]=a,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(a,b,d){var e=this._preTouchPoint;a=this._glView.convertToLocationInView(a,b,d);b=new cc.Touch(a.x,a.y);b._setPrevPoint(e.x,e.y);e.x=a.x;e.y=a.y;
return b},getMouseEvent:function(a,b,d){var e=this._prevMousePoint;this._glView._convertMouseToLocationInView(a,b);b=new cc.EventMouse(d);b.setLocation(a.x,a.y);b._setPrevCursor(e.x,e.y);e.x=a.x;e.y=a.y;return b},getPointByEvent:function(a,b){if(null!=a.pageX)return{x:a.pageX,y:a.pageY};b.left-=document.body.scrollLeft;b.top-=document.body.scrollTop;return{x:a.clientX,y:a.clientY}},getTouchesByEvent:function(a,b){for(var d=[],e=this._glView,f,g,h=this._preTouchPoint,k=a.changedTouches.length,m=0;m<
k;m++)if(f=a.changedTouches[m]){var n;n=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?e.convertToLocationInView(f.pageX,f.pageY,b):e.convertToLocationInView(f.clientX,f.clientY,b);null!=f.identifier?(f=new cc.Touch(n.x,n.y,f.identifier),g=this.getPreTouch(f).getLocation(),f._setPrevPoint(g.x,g.y),this.setPreTouch(f)):(f=new cc.Touch(n.x,n.y),f._setPrevPoint(h.x,h.y));h.x=n.x;h.y=n.y;d.push(f)}return d},registerSystemEvent:function(a){if(!this._isRegisterEvent){var b=this._glView=cc.view,d=this,
e="touches"in cc.sys.capabilities;"mouse"in cc.sys.capabilities&&(cc._addEventListener(window,"mousedown",function(){d._mousePressed=!0},!1),cc._addEventListener(window,"mouseup",function(b){var f=d._mousePressed;d._mousePressed=!1;if(f){var f=d.getHTMLElementPosition(a),g=d.getPointByEvent(b,f);cc.rectContainsPoint(new cc.Rect(f.left,f.top,f.width,f.height),g)||(e||d.handleTouchesEnd([d.getTouchByXY(g.x,g.y,f)]),f=d.getMouseEvent(g,f,cc.EventMouse.UP),f.setButton(b.button),cc.eventManager.dispatchEvent(f))}},
!1),cc._addEventListener(a,"mousedown",function(b){d._mousePressed=!0;var f=d.getHTMLElementPosition(a),g=d.getPointByEvent(b,f);e||d.handleTouchesBegin([d.getTouchByXY(g.x,g.y,f)]);f=d.getMouseEvent(g,f,cc.EventMouse.DOWN);f.setButton(b.button);cc.eventManager.dispatchEvent(f);b.stopPropagation();b.preventDefault();a.focus()},!1),cc._addEventListener(a,"mouseup",function(b){d._mousePressed=!1;var f=d.getHTMLElementPosition(a),g=d.getPointByEvent(b,f);e||d.handleTouchesEnd([d.getTouchByXY(g.x,g.y,
f)]);f=d.getMouseEvent(g,f,cc.EventMouse.UP);f.setButton(b.button);cc.eventManager.dispatchEvent(f);b.stopPropagation();b.preventDefault()},!1),cc._addEventListener(a,"mousemove",function(b){var f=d.getHTMLElementPosition(a),g=d.getPointByEvent(b,f);e||d.handleTouchesMove([d.getTouchByXY(g.x,g.y,f)]);f=d.getMouseEvent(g,f,cc.EventMouse.MOVE);d._mousePressed?f.setButton(b.button):f.setButton(null);cc.eventManager.dispatchEvent(f);b.stopPropagation();b.preventDefault()},!1),cc._addEventListener(a,"mousewheel",
function(b){var e=d.getHTMLElementPosition(a),f=d.getPointByEvent(b,e),e=d.getMouseEvent(f,e,cc.EventMouse.SCROLL);e.setButton(b.button);e.setScrollData(0,b.wheelDelta);cc.eventManager.dispatchEvent(e);b.stopPropagation();b.preventDefault()},!1),cc._addEventListener(a,"DOMMouseScroll",function(b){var e=d.getHTMLElementPosition(a),f=d.getPointByEvent(b,e),e=d.getMouseEvent(f,e,cc.EventMouse.SCROLL);e.setButton(b.button);e.setScrollData(0,-120*b.detail);cc.eventManager.dispatchEvent(e);b.stopPropagation();
b.preventDefault()},!1));if(window.navigator.msPointerEnabled){var f={MSPointerDown:d.handleTouchesBegin,MSPointerMove:d.handleTouchesMove,MSPointerUp:d.handleTouchesEnd,MSPointerCancel:d.handleTouchesCancel},g;for(g in f)(function(b,e){cc._addEventListener(a,b,function(b){var f=d.getHTMLElementPosition(a);f.left-=document.documentElement.scrollLeft;f.top-=document.documentElement.scrollTop;e.call(d,[d.getTouchByXY(b.clientX,b.clientY,f)]);b.stopPropagation()},!1)})(g,f[g])}e&&(cc._addEventListener(a,
"touchstart",function(b){if(b.changedTouches){var e=d.getHTMLElementPosition(a);e.left-=document.body.scrollLeft;e.top-=document.body.scrollTop;d.handleTouchesBegin(d.getTouchesByEvent(b,e));b.stopPropagation();b.preventDefault();a.focus()}},!1),cc._addEventListener(a,"touchmove",function(b){if(b.changedTouches){var e=d.getHTMLElementPosition(a);e.left-=document.body.scrollLeft;e.top-=document.body.scrollTop;d.handleTouchesMove(d.getTouchesByEvent(b,e));b.stopPropagation();b.preventDefault()}},!1),
cc._addEventListener(a,"touchend",function(b){if(b.changedTouches){var e=d.getHTMLElementPosition(a);e.left-=document.body.scrollLeft;e.top-=document.body.scrollTop;d.handleTouchesEnd(d.getTouchesByEvent(b,e));b.stopPropagation();b.preventDefault()}},!1),cc._addEventListener(a,"touchcancel",function(e){if(e.changedTouches){var f=d.getHTMLElementPosition(a);f.left-=document.body.scrollLeft;f.top-=document.body.scrollTop;b.handleTouchesCancel(d.getTouchesByEvent(e,f));e.stopPropagation();e.preventDefault()}},
!1));this._registerKeyboardEvent();this._registerAccelerometerEvent();this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(a){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration)));this._accelCurTime+=a}};var _p=cc.inputManager;_p.setAccelerometerEnabled=function(a){this._accelEnabled!==a&&(this._accelEnabled=a,a=cc.director.getScheduler(),this._accelEnabled?(this._accelCurTime=0,a.scheduleUpdateForTarget(this)):(this._accelCurTime=0,a.unscheduleUpdateForTarget(this)))};_p.setAccelerometerInterval=function(a){this._accelInterval!==a&&(this._accelInterval=a)};
_p._registerKeyboardEvent=function(){cc._addEventListener(cc._canvas,"keydown",function(a){cc.eventManager.dispatchEvent(new cc.EventKeyboard(a.keyCode,!0));a.stopPropagation();a.preventDefault()},!1);cc._addEventListener(cc._canvas,"keyup",function(a){cc.eventManager.dispatchEvent(new cc.EventKeyboard(a.keyCode,!1));a.stopPropagation();a.preventDefault()},!1)};
_p._registerAccelerometerEvent=function(){var a=window;this._acceleration=new cc.Acceleration;this._accelDeviceEvent=a.DeviceMotionEvent||a.DeviceOrientationEvent;cc.sys.browserType==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var b=this._accelDeviceEvent==a.DeviceMotionEvent?"devicemotion":"deviceorientation",d=navigator.userAgent;if(/Android/.test(d)||/Adr/.test(d)&&cc.sys.browserType==cc.BROWSER_TYPE_UC)this._minus=-1;cc._addEventListener(a,b,this.didAccelerate.bind(this),
!1)};
_p.didAccelerate=function(a){var b=window;if(this._accelEnabled){var d=this._acceleration;if(this._accelDeviceEvent==window.DeviceMotionEvent){var e=a.accelerationIncludingGravity;d.x=this._accelMinus*e.x*0.1;d.y=this._accelMinus*e.y*0.1;d.z=0.1*e.z}else d.x=a.gamma/90*0.981,d.y=0.981*-(a.beta/90),d.z=a.alpha/90*0.981;d.timestamp=a.timeStamp||Date.now();a=d.x;b.orientation===cc.UIInterfaceOrientationLandscapeRight?(d.x=-d.y,d.y=a):b.orientation===cc.UIInterfaceOrientationLandscapeLeft?(d.x=d.y,d.y=
-a):b.orientation===cc.UIInterfaceOrientationPortraitUpsideDown&&(d.x=-d.x,d.y=-d.y)}};delete _p;cc.AffineTransform=function(a,b,d,e,f,g){this.a=a;this.b=b;this.c=d;this.d=e;this.tx=f;this.ty=g};cc.affineTransformMake=function(a,b,d,e,f,g){return{a:a,b:b,c:d,d:e,tx:f,ty:g}};cc.pointApplyAffineTransform=function(a,b){return{x:b.a*a.x+b.c*a.y+b.tx,y:b.b*a.x+b.d*a.y+b.ty}};cc._pointApplyAffineTransform=function(a,b,d){return{x:d.a*a+d.c*b+d.tx,y:d.b*a+d.d*b+d.ty}};cc.sizeApplyAffineTransform=function(a,b){return{width:b.a*a.width+b.c*a.height,height:b.b*a.width+b.d*a.height}};
cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};
cc.rectApplyAffineTransform=function(a,b){var d=cc.rectGetMinY(a),e=cc.rectGetMinX(a),f=cc.rectGetMaxX(a),g=cc.rectGetMaxY(a),h=cc._pointApplyAffineTransform(e,d,b),d=cc._pointApplyAffineTransform(f,d,b),e=cc._pointApplyAffineTransform(e,g,b),k=cc._pointApplyAffineTransform(f,g,b),f=Math.min(h.x,d.x,e.x,k.x),g=Math.max(h.x,d.x,e.x,k.x),m=Math.min(h.y,d.y,e.y,k.y),h=Math.max(h.y,d.y,e.y,k.y);return cc.rect(f,m,g-f,h-m)};
cc._rectApplyAffineTransformIn=function(a,b){var d=cc.rectGetMinY(a),e=cc.rectGetMinX(a),f=cc.rectGetMaxX(a),g=cc.rectGetMaxY(a),h=cc._pointApplyAffineTransform(e,d,b),d=cc._pointApplyAffineTransform(f,d,b),e=cc._pointApplyAffineTransform(e,g,b),k=cc._pointApplyAffineTransform(f,g,b),f=Math.min(h.x,d.x,e.x,k.x),g=Math.max(h.x,d.x,e.x,k.x),m=Math.min(h.y,d.y,e.y,k.y),h=Math.max(h.y,d.y,e.y,k.y);a.x=f;a.y=m;a.width=g-f;a.height=h-m;return a};
cc.affineTransformTranslate=function(a,b,d){return{a:a.a,b:a.b,c:a.c,d:a.d,tx:a.tx+a.a*b+a.c*d,ty:a.ty+a.b*b+a.d*d}};cc.affineTransformScale=function(a,b,d){return{a:a.a*b,b:a.b*b,c:a.c*d,d:a.d*d,tx:a.tx,ty:a.ty}};cc.affineTransformRotate=function(a,b){var d=Math.sin(b),e=Math.cos(b);return{a:a.a*e+a.c*d,b:a.b*e+a.d*d,c:a.c*e-a.a*d,d:a.d*e-a.b*d,tx:a.tx,ty:a.ty}};
cc.affineTransformConcat=function(a,b){return{a:a.a*b.a+a.b*b.c,b:a.a*b.b+a.b*b.d,c:a.c*b.a+a.d*b.c,d:a.c*b.b+a.d*b.d,tx:a.tx*b.a+a.ty*b.c+b.tx,ty:a.tx*b.b+a.ty*b.d+b.ty}};cc.affineTransformEqualToTransform=function(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty};cc.affineTransformInvert=function(a){var b=1/(a.a*a.d-a.b*a.c);return{a:b*a.d,b:-b*a.b,c:-b*a.c,d:b*a.a,tx:b*(a.c*a.ty-a.d*a.tx),ty:b*(a.b*a.tx-a.a*a.ty)}};cc.POINT_EPSILON=parseFloat("1.192092896e-07F");cc.pNeg=function(a){return cc.p(-a.x,-a.y)};cc.pAdd=function(a,b){return cc.p(a.x+b.x,a.y+b.y)};cc.pSub=function(a,b){return cc.p(a.x-b.x,a.y-b.y)};cc.pMult=function(a,b){return cc.p(a.x*b,a.y*b)};cc.pMidpoint=function(a,b){return cc.pMult(cc.pAdd(a,b),0.5)};cc.pDot=function(a,b){return a.x*b.x+a.y*b.y};cc.pCross=function(a,b){return a.x*b.y-a.y*b.x};cc.pPerp=function(a){return cc.p(-a.y,a.x)};cc.pRPerp=function(a){return cc.p(a.y,-a.x)};
cc.pProject=function(a,b){return cc.pMult(b,cc.pDot(a,b)/cc.pDot(b,b))};cc.pRotate=function(a,b){return cc.p(a.x*b.x-a.y*b.y,a.x*b.y+a.y*b.x)};cc.pUnrotate=function(a,b){return cc.p(a.x*b.x+a.y*b.y,a.y*b.x-a.x*b.y)};cc.pLengthSQ=function(a){return cc.pDot(a,a)};cc.pDistanceSQ=function(a,b){return cc.pLengthSQ(cc.pSub(a,b))};cc.pLength=function(a){return Math.sqrt(cc.pLengthSQ(a))};cc.pDistance=function(a,b){return cc.pLength(cc.pSub(a,b))};cc.pNormalize=function(a){return cc.pMult(a,1/cc.pLength(a))};
cc.pForAngle=function(a){return cc.p(Math.cos(a),Math.sin(a))};cc.pToAngle=function(a){return Math.atan2(a.y,a.x)};cc.clampf=function(a,b,d){if(b>d){var e=b;b=d;d=e}return a<b?b:a<d?a:d};cc.pClamp=function(a,b,d){return cc.p(cc.clampf(a.x,b.x,d.x),cc.clampf(a.y,b.y,d.y))};cc.pFromSize=function(a){return cc.p(a.width,a.height)};cc.pCompOp=function(a,b){return cc.p(b(a.x),b(a.y))};cc.pLerp=function(a,b,d){return cc.pAdd(cc.pMult(a,1-d),cc.pMult(b,d))};
cc.pFuzzyEqual=function(a,b,d){return a.x-d<=b.x&&b.x<=a.x+d&&a.y-d<=b.y&&b.y<=a.y+d?!0:!1};cc.pCompMult=function(a,b){return cc.p(a.x*b.x,a.y*b.y)};cc.pAngleSigned=function(a,b){var d=cc.pNormalize(a),e=cc.pNormalize(b),d=Math.atan2(d.x*e.y-d.y*e.x,cc.pDot(d,e));return Math.abs(d)<cc.POINT_EPSILON?0:d};cc.pAngle=function(a,b){var d=Math.acos(cc.pDot(cc.pNormalize(a),cc.pNormalize(b)));return Math.abs(d)<cc.POINT_EPSILON?0:d};
cc.pRotateByAngle=function(a,b,d){a=cc.pSub(a,b);var e=Math.cos(d);d=Math.sin(d);var f=a.x;a.x=f*e-a.y*d+b.x;a.y=f*d+a.y*e+b.y;return a};cc.pLineIntersect=function(a,b,d,e,f){if(a.x==b.x&&a.y==b.y||d.x==e.x&&d.y==e.y)return!1;var g=b.x-a.x;b=b.y-a.y;var h=e.x-d.x;e=e.y-d.y;var k=a.x-d.x;a=a.y-d.y;d=e*g-h*b;f.x=h*a-e*k;f.y=g*a-b*k;if(0==d)return 0==f.x||0==f.y?!0:!1;f.x/=d;f.y/=d;return!0};
cc.pSegmentIntersect=function(a,b,d,e){var f=cc.p(0,0);return cc.pLineIntersect(a,b,d,e,f)&&0<=f.x&&1>=f.x&&0<=f.y&&1>=f.y?!0:!1};cc.pIntersectPoint=function(a,b,d,e){var f=cc.p(0,0);return cc.pLineIntersect(a,b,d,e,f)?(d=cc.p(0,0),d.x=a.x+f.x*(b.x-a.x),d.y=a.y+f.x*(b.y-a.y),d):cc.p(0,0)};cc.pSameAs=function(a,b){return null!=a&&null!=b?a.x==b.x&&a.y==b.y:!1};cc.pZeroIn=function(a){a.x=0;a.y=0};cc.pIn=function(a,b){a.x=b.x;a.y=b.y};cc.pMultIn=function(a,b){a.x*=b;a.y*=b};
cc.pSubIn=function(a,b){a.x-=b.x;a.y-=b.y};cc.pAddIn=function(a,b){a.x+=b.x;a.y+=b.y};cc.pNormalizeIn=function(a){cc.pMultIn(a,1/Math.sqrt(a.x*a.x+a.y*a.y))};cc.vertexLineToPolygon=function(a,b,d,e,f){f+=e;if(!(1>=f)){b*=0.5;for(var g,h=f-1,k=e;k<f;k++){g=2*k;var m=cc.p(a[2*k],a[2*k+1]),n;if(0===k)n=cc.pPerp(cc.pNormalize(cc.pSub(m,cc.p(a[2*(k+1)],a[2*(k+1)+1]))));else if(k===h)n=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(a[2*(k-1)],a[2*(k-1)+1]),m)));else{n=cc.p(a[2*(k-1)],a[2*(k-1)+1]);var q=cc.p(a[2*(k+1)],a[2*(k+1)+1]),s=cc.pNormalize(cc.pSub(q,m)),u=cc.pNormalize(cc.pSub(n,m)),t=Math.acos(cc.pDot(s,u));n=t<cc.degreesToRadians(70)?cc.pPerp(cc.pNormalize(cc.pMidpoint(s,
u))):t<cc.degreesToRadians(170)?cc.pNormalize(cc.pMidpoint(s,u)):cc.pPerp(cc.pNormalize(cc.pSub(q,n)))}n=cc.pMult(n,b);d[2*g]=m.x+n.x;d[2*g+1]=m.y+n.y;d[2*(g+1)]=m.x-n.x;d[2*(g+1)+1]=m.y-n.y}for(k=0==e?0:e-1;k<h;k++)g=2*k,a=g+2,b=cc.vertex2(d[2*g],d[2*g+1]),f=cc.vertex2(d[2*(g+1)],d[2*(g+1)+1]),g=cc.vertex2(d[2*a],d[2*a]),e=cc.vertex2(d[2*(a+1)],d[2*(a+1)+1]),b=!cc.vertexLineIntersect(b.x,b.y,e.x,e.y,f.x,f.y,g.x,g.y),!b.isSuccess&&(0>b.value||1<b.value)&&(b.isSuccess=!0),b.isSuccess&&(d[2*a]=e.x,
d[2*a+1]=e.y,d[2*(a+1)]=g.x,d[2*(a+1)+1]=g.y)}};cc.vertexLineIntersect=function(a,b,d,e,f,g,h,k){if(a==d&&b==e||f==h&&g==k)return{isSuccess:!1,value:0};d-=a;e-=b;f-=a;g-=b;h-=a;k-=b;a=Math.sqrt(d*d+e*e);d/=a;e/=a;b=f*d+g*e;g=g*d-f*e;f=b;b=h*d+k*e;k=k*d-h*e;h=b;return g==k?{isSuccess:!1,value:0}:{isSuccess:!0,value:(h+(f-h)*k/(k-g))/a}};cc.vertexListIsClockwise=function(a){for(var b=0,d=a.length;b<d;b++){var e=a[(b+1)%d],f=a[(b+2)%d];if(0<cc.pCross(cc.pSub(e,a[b]),cc.pSub(f,e)))return!1}return!0};cc.CGAffineToGL=function(a,b){b[2]=b[3]=b[6]=b[7]=b[8]=b[9]=b[11]=b[14]=0;b[10]=b[15]=1;b[0]=a.a;b[4]=a.c;b[12]=a.tx;b[1]=a.b;b[5]=a.d;b[13]=a.ty};cc.GLToCGAffine=function(a,b){b.a=a[0];b.c=a[4];b.tx=a[12];b.b=a[1];b.d=a[5];b.ty=a[13]};cc.Touch=cc.Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(a,b,d){this._point=cc.p(a||0,b||0);this._id=d||0},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,
this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){return this._id},setTouchInfo:function(a,b,d){this._prevPoint=this._point;this._point=cc.p(b||0,d||0);this._id=a;this._startPointCaptured||(this._startPoint=cc.p(this._point),this._startPointCaptured=
!0)},_setPoint:function(a,b){void 0===b?(this._point.x=a.x,this._point.y=a.y):(this._point.x=a,this._point.y=b)},_setPrevPoint:function(a,b){this._prevPoint=void 0===b?cc.p(a.x,a.y):cc.p(a||0,b||0)}});cc.Event=cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(a){this._currentTarget=a},ctor:function(a){this._type=a},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}});cc.Event.TOUCH=0;cc.Event.KEYBOARD=1;cc.Event.ACCELERATION=2;cc.Event.MOUSE=3;cc.Event.CUSTOM=4;
cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM);this._eventName=a},setUserData:function(a){this._userData=a},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}});
cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE);this._eventType=a},setScrollData:function(a,b){this._scrollX=a;this._scrollY=b},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(a,b){this._x=a;this._y=b},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-
this._y}},_setPrevCursor:function(a,b){this._prevX=a;this._prevY=b},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(a){this._button=a},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}});cc.EventMouse.NONE=0;cc.EventMouse.DOWN=1;cc.EventMouse.UP=2;cc.EventMouse.MOVE=3;
cc.EventMouse.SCROLL=4;cc.EventMouse.BUTTON_LEFT=0;cc.EventMouse.BUTTON_RIGHT=2;cc.EventMouse.BUTTON_MIDDLE=1;cc.EventMouse.BUTTON_4=3;cc.EventMouse.BUTTON_5=4;cc.EventMouse.BUTTON_6=5;cc.EventMouse.BUTTON_7=6;cc.EventMouse.BUTTON_8=7;
cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH);this._touches=a||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(a){this._eventCode=a},_setTouches:function(a){this._touches=a}});cc.EventTouch.MAX_TOUCHES=5;cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3};cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!1,_isEnabled:!0,ctor:function(a,b,d){this._onEvent=d;this._type=a||0;this._listenerID=b||""},_setPaused:function(a){this._paused=a},_isPaused:function(){return this._paused},_setRegistered:function(a){this._registered=a},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(a){this._fixedPriority=
a},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(a){this._node=a},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!=this._onEvent},clone:function(){return null},setEnabled:function(a){this._isEnabled=a},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}});cc.EventListener.UNKNOWN=0;cc.EventListener.TOUCH_ONE_BY_ONE=1;cc.EventListener.TOUCH_ALL_AT_ONCE=2;
cc.EventListener.KEYBOARD=3;cc.EventListener.MOUSE=4;cc.EventListener.ACCELERATION=5;cc.EventListener.CUSTOM=6;
cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(a,b){this._onCustomEvent=b;var d=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,a,function(a){null!=d._onCustomEvent&&d._onCustomEvent(a)})},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!=this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}});
cc._EventListenerCustom.create=function(a,b){return new cc._EventListenerCustom(a,b)};
cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var a=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,function(b){var d=cc.EventMouse;switch(b._eventType){case d.DOWN:if(a.onMouseDown)a.onMouseDown(b);break;case d.UP:if(a.onMouseUp)a.onMouseUp(b);break;case d.MOVE:if(a.onMouseMove)a.onMouseMove(b);break;case d.SCROLL:if(a.onMouseScroll)a.onMouseScroll(b)}})},
clone:function(){var a=new cc._EventListenerMouse;a.onMouseDown=this.onMouseDown;a.onMouseUp=this.onMouseUp;a.onMouseMove=this.onMouseMove;a.onMouseScroll=this.onMouseScroll;return a},checkAvailable:function(){return!0}});cc._EventListenerMouse.LISTENER_ID="__cc_mouse";cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse};
cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null);this._claimedTouches=[]},setSwallowTouches:function(a){this.swallowTouches=a},clone:function(){var a=new cc._EventListenerTouchOneByOne;a.onTouchBegan=this.onTouchBegan;a.onTouchMoved=this.onTouchMoved;
a.onTouchEnded=this.onTouchEnded;a.onTouchCancelled=this.onTouchCancelled;a.swallowTouches=this.swallowTouches;return a},checkAvailable:function(){return this.onTouchBegan?!0:(cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1)}});cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one";cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne};
cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var a=new cc._EventListenerTouchAllAtOnce;a.onTouchesBegan=this.onTouchesBegan;a.onTouchesMoved=this.onTouchesMoved;a.onTouchesEnded=this.onTouchesEnded;a.onTouchesCancelled=this.onTouchesCancelled;return a},
checkAvailable:function(){return null==this.onTouchesBegan&&null==this.onTouchesMoved&&null==this.onTouchesEnded&&null==this.onTouchesCancelled?(cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1):!0}});cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once";cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce};
cc.EventListener.create=function(a){cc.assert(a&&a.event,cc._LogInfos.EventListener_create);var b=a.event;delete a.event;var d=null;b===cc.EventListener.TOUCH_ONE_BY_ONE?d=new cc._EventListenerTouchOneByOne:b===cc.EventListener.TOUCH_ALL_AT_ONCE?d=new cc._EventListenerTouchAllAtOnce:b===cc.EventListener.MOUSE?d=new cc._EventListenerMouse:b===cc.EventListener.CUSTOM?(d=new cc._EventListenerCustom(a.eventName,a.callback),delete a.eventName,delete a.callback):b===cc.EventListener.KEYBOARD?d=new cc._EventListenerKeyboard:
b===cc.EventListener.ACCELERATION&&(d=new cc._EventListenerAcceleration(a.callback),delete a.callback);for(var e in a)d[e]=a[e];return d};cc.copyArray=function(a){var b,d=a.length,e=Array(d);for(b=0;b<d;b+=1)e[b]=a[b];return e};
cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[];this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(a){0==a._getFixedPriority()?this._sceneGraphListeners.push(a):this._fixedListeners.push(a)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=
0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0;this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}});
cc.__getListenerID=function(a){var b=cc.Event,d=a.getType();if(d===b.ACCELERATION)return cc._EventListenerAcceleration.LISTENER_ID;if(d===b.CUSTOM)return a.getEventName();if(d===b.KEYBOARD)return cc._EventListenerKeyboard.LISTENER_ID;if(d===b.MOUSE)return cc._EventListenerMouse.LISTENER_ID;d===b.TOUCH&&cc.log(cc._LogInfos.__getListenerID);return""};
cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(a){null!=this._nodeListenersMap[a.__instanceId]&&this._dirtyNodes.push(a);a=a.getChildren();for(var b=0,d=a.length;b<d;b++)this._setDirtyForNode(a[b])},
pauseTarget:function(a,b){var d=this._nodeListenersMap[a.__instanceId],e,f;if(d)for(e=0,f=d.length;e<f;e++)d[e]._setPaused(!0);if(!0===b)for(d=a.getChildren(),e=0,f=d.length;e<f;e++)this.pauseTarget(d[e],!0)},resumeTarget:function(a,b){var d=this._nodeListenersMap[a.__instanceId],e,f;if(d)for(e=0,f=d.length;e<f;e++)d[e]._setPaused(!1);this._setDirtyForNode(a);if(!0===b)for(d=a.getChildren(),e=0,f=d.length;e<f;e++)this.resumeTarget(d[e],!0)},_addListener:function(a){0===this._inDispatch?this._forceAddEventListener(a):
this._toAddedListeners.push(a)},_forceAddEventListener:function(a){var b=a._getListenerID(),d=this._listenersMap[b];d||(d=new cc._EventListenerVector,this._listenersMap[b]=d);d.push(a);0==a._getFixedPriority()?(this._setDirty(b,this.DIRTY_SCENE_GRAPH_PRIORITY),b=a._getSceneGraphPriority(),null==b&&cc.log(cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(b,a),b.isRunning()&&this.resumeTarget(b)):this._setDirty(b,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(a){return this._listenersMap[a]},
_updateDirtyFlagForSceneGraph:function(){if(0!=this._dirtyNodes.length){for(var a=this._dirtyNodes,b,d,e=this._nodeListenersMap,f=0,g=a.length;f<g;f++)if(b=e[a[f].__instanceId])for(var h=0,k=b.length;h<k;h++)(d=b[h])&&this._setDirty(d._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(a){if(a)for(var b,d=0;d<a.length;)b=a[d],b._setRegistered(!1),null!=b._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(b._getSceneGraphPriority(),
b),b._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(a,b):++d},_removeListenersForListenerID:function(a){var b=this._listenersMap[a];if(b){var d=b.getFixedPriorityListeners(),e=b.getSceneGraphPriorityListeners();this._removeAllListenersInVector(e);this._removeAllListenersInVector(d);delete this._priorityDirtyFlagMap[a];this._inDispatch||(b.clear(),delete this._listenersMap[a])}d=this._toAddedListeners;for(b=0;b<d.length;)(e=d[b])&&e._getListenerID()==a?cc.arrayRemoveObject(d,
e):++b},_sortEventListeners:function(a){var b=this.DIRTY_NONE,d=this._priorityDirtyFlagMap;d[a]&&(b=d[a]);b!=this.DIRTY_NONE&&(d[a]=this.DIRTY_NONE,b&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(a),b&this.DIRTY_SCENE_GRAPH_PRIORITY&&((b=cc.director.getRunningScene())?this._sortListenersOfSceneGraphPriority(a,b):d[a]=this.DIRTY_SCENE_GRAPH_PRIORITY))},_sortListenersOfSceneGraphPriority:function(a,b){var d=this._getListeners(a);if(d){var e=d.getSceneGraphPriorityListeners();e&&0!==
e.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(b,!0),d.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(a,b){var d=cc.eventManager._nodePriorityMap;return d[b._getSceneGraphPriority().__instanceId]-d[a._getSceneGraphPriority().__instanceId]},_sortListenersOfFixedPriority:function(a){if(a=this._listenersMap[a]){var b=a.getFixedPriorityListeners();if(b&&0!==b.length){b.sort(this._sortListenersOfFixedPriorityAsc);
for(var d=0,e=b.length;d<e&&!(0<=b[d]._getFixedPriority());)++d;a.gt0Index=d}}},_sortListenersOfFixedPriorityAsc:function(a,b){return a._getFixedPriority()-b._getFixedPriority()},_onUpdateListeners:function(a){if(a=this._listenersMap[a]){var b=a.getFixedPriorityListeners(),d=a.getSceneGraphPriorityListeners(),e,f;if(d)for(e=0;e<d.length;)f=d[e],f._isRegistered()?++e:cc.arrayRemoveObject(d,f);if(b)for(e=0;e<b.length;)f=b[e],f._isRegistered()?++e:cc.arrayRemoveObject(b,f);d&&0===d.length&&a.clearSceneGraphListeners();
b&&0===b.length&&a.clearFixedListeners()}},_updateListeners:function(a){var b=this._inDispatch;cc.assert(0<b,cc._LogInfos.EventManager__updateListeners);a.getType()==cc.Event.TOUCH?(this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(cc.__getListenerID(a));if(!(1<b)){cc.assert(1==b,cc._LogInfos.EventManager__updateListeners_2);a=this._listenersMap;var b=this._priorityDirtyFlagMap,d;for(d in a)a[d].empty()&&
(delete b[d],delete a[d]);d=this._toAddedListeners;if(0!==d.length){a=0;for(b=d.length;a<b;a++)this._forceAddEventListener(d[a]);this._toAddedListeners.length=0}}},_onTouchEventCallback:function(a,b){if(!a._isRegistered)return!1;var d=b.event,e=b.selTouch;d._setCurrentTarget(a._node);var f=!1,g,h=d.getEventCode(),k=cc.EventTouch.EventCode;if(h==k.BEGAN)a.onTouchBegan&&(f=a.onTouchBegan(e,d))&&a._registered&&a._claimedTouches.push(e);else if(0<a._claimedTouches.length&&-1!=(g=a._claimedTouches.indexOf(e)))if(f=
!0,h===k.MOVED&&a.onTouchMoved)a.onTouchMoved(e,d);else if(h===k.ENDED){if(a.onTouchEnded)a.onTouchEnded(e,d);a._registered&&a._claimedTouches.splice(g,1)}else if(h===k.CANCELLED){if(a.onTouchCancelled)a.onTouchCancelled(e,d);a._registered&&a._claimedTouches.splice(g,1)}return d.isStopped()?(cc.eventManager._updateListeners(d),!0):f&&a._registered&&a.swallowTouches?(b.needsMutableSet&&b.touches.splice(e,1),!0):!1},_dispatchTouchEvent:function(a){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID);
this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var b=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),d=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!=b||null!=d){var e=a.getTouches(),f=cc.copyArray(e),g={event:a,needsMutableSet:b&&d,touches:f,selTouch:null};if(b)for(var h=0;h<e.length;h++)if(g.selTouch=e[h],this._dispatchEventToListeners(b,this._onTouchEventCallback,g),a.isStopped())return;if(d&&0<f.length&&(this._dispatchEventToListeners(d,
this._onTouchesEventCallback,{event:a,touches:f}),a.isStopped()))return;this._updateListeners(a)}},_onTouchesEventCallback:function(a,b){if(!a._registered)return!1;var d=cc.EventTouch.EventCode,e=b.event,f=b.touches,g=e.getEventCode();e._setCurrentTarget(a._node);if(g==d.BEGAN&&a.onTouchesBegan)a.onTouchesBegan(f,e);else if(g==d.MOVED&&a.onTouchesMoved)a.onTouchesMoved(f,e);else if(g==d.ENDED&&a.onTouchesEnded)a.onTouchesEnded(f,e);else if(g==d.CANCELLED&&a.onTouchesCancelled)a.onTouchesCancelled(f,
e);return e.isStopped()?(cc.eventManager._updateListeners(e),!0):!1},_associateNodeAndEventListener:function(a,b){var d=this._nodeListenersMap[a.__instanceId];d||(d=[],this._nodeListenersMap[a.__instanceId]=d);d.push(b)},_dissociateNodeAndEventListener:function(a,b){var d=this._nodeListenersMap[a.__instanceId];d&&(cc.arrayRemoveObject(d,b),0===d.length&&delete this._nodeListenersMap[a.__instanceId])},_dispatchEventToListeners:function(a,b,d){var e=!1,f=a.getFixedPriorityListeners(),g=a.getSceneGraphPriorityListeners(),
h=0,k;if(f&&0!==f.length)for(;h<a.gt0Index;++h)if(k=f[h],k.isEnabled()&&!k._isPaused()&&k._isRegistered()&&b(k,d)){e=!0;break}if(g&&!e)for(a=0;a<g.length;a++)if(k=g[a],k.isEnabled()&&!k._isPaused()&&k._isRegistered()&&b(k,d)){e=!0;break}if(f&&!e)for(;h<f.length&&(k=f[h],!k.isEnabled()||k._isPaused()||!k._isRegistered()||!b(k,d));++h);},_setDirty:function(a,b){var d=this._priorityDirtyFlagMap;d[a]=null==d[a]?b:b|d[a]},_visitTarget:function(a,b){var d=a.getChildren(),e=0,f=d.length,g=this._globalZOrderNodeMap,
h=this._nodeListenersMap;if(0<f){for(var k;e<f;e++)if((k=d[e])&&0>k.getLocalZOrder())this._visitTarget(k,!1);else break;null!=h[a.__instanceId]&&(g[a.getGlobalZOrder()]||(g[a.getGlobalZOrder()]=[]),g[a.getGlobalZOrder()].push(a.__instanceId));for(;e<f;e++)(k=d[e])&&this._visitTarget(k,!1)}else null!=h[a.__instanceId]&&(g[a.getGlobalZOrder()]||(g[a.getGlobalZOrder()]=[]),g[a.getGlobalZOrder()].push(a.__instanceId));if(b){var d=[],m;for(m in g)d.push(m);d.sort(this._sortNumberAsc);m=d.length;k=this._nodePriorityMap;
for(e=0;e<m;e++)for(f=g[d[e]],h=0;h<f.length;h++)k[f[h]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(a,b){return a-b},addListener:function(a,b){cc.assert(a&&b,cc._LogInfos.eventManager_addListener_2);if(!(a instanceof cc.EventListener))cc.assert("number"!==typeof b,cc._LogInfos.eventManager_addListener_3),a=cc.EventListener.create(a);else if(a._isRegistered()){cc.log(cc._LogInfos.eventManager_addListener_4);return}a.checkAvailable()&&("number"==typeof b?0==b?cc.log(cc._LogInfos.eventManager_addListener):
(a._setSceneGraphPriority(null),a._setFixedPriority(b),a._setRegistered(!0),a._setPaused(!1),this._addListener(a)):(a._setSceneGraphPriority(b),a._setFixedPriority(0),a._setRegistered(!0),this._addListener(a)))},addCustomListener:function(a,b){var d=cc._EventListenerCustom.create(a,b);this.addListener(d,1);return d},removeListener:function(a){if(null!=a){var b,d=this._listenersMap,e;for(e in d){var f=d[e],g=f.getFixedPriorityListeners();b=f.getSceneGraphPriorityListeners();(b=this._removeListenerInVector(b,
a))?this._setDirty(a._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(b=this._removeListenerInVector(g,a))&&this._setDirty(a._getListenerID(),this.DIRTY_FIXED_PRIORITY);f.empty()&&(delete this._priorityDirtyFlagMap[a._getListenerID()],delete d[e]);if(b)break}if(!b)for(d=this._toAddedListeners,e=0,f=d.length;e<f;e++)if(g=d[e],g==a){cc.arrayRemoveObject(d,g);break}}},_removeListenerInVector:function(a,b){if(null==a)return!1;for(var d=0,e=a.length;d<e;d++){var f=a[d];if(f==b)return f._setRegistered(!1),
null!=f._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(f._getSceneGraphPriority(),f),f._setSceneGraphPriority(null)),0==this._inDispatch&&cc.arrayRemoveObject(a,f),!0}return!1},removeListeners:function(a,b){if(a instanceof cc.Node){delete this._nodePriorityMap[a.__instanceId];cc.arrayRemoveObject(this._dirtyNodes,a);var d=this._nodeListenersMap[a.__instanceId];if(d){for(var e=cc.copyArray(d),d=0;d<e.length;d++)this.removeListener(e[d]);e.length=0;e=this._toAddedListeners;for(d=0;d<
e.length;){var f=e[d];f._getSceneGraphPriority()==a?(f._setSceneGraphPriority(null),f._setRegistered(!1),e.splice(d,1)):++d}if(!0===b)for(e=a.getChildren(),d=0,f=e.length;d<f;d++)this.removeListeners(e[d],!0)}}else a==cc.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):a==cc.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):a==cc.EventListener.MOUSE?this._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):
a==cc.EventListener.ACCELERATION?this._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):a==cc.EventListener.KEYBOARD?this._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.eventManager_removeListeners)},removeCustomListeners:function(a){this._removeListenersForListenerID(a)},removeAllListeners:function(){var a=this._listenersMap,b=this._internalCustomListenerIDs,d;for(d in a)-1===b.indexOf(d)&&this._removeListenersForListenerID(d)},setPriority:function(a,
b){if(null!=a){var d=this._listenersMap,e;for(e in d){var f=d[e].getFixedPriorityListeners();if(f&&-1!=f.indexOf(a)){null!=a._getSceneGraphPriority()&&cc.log(cc._LogInfos.eventManager_setPriority);a._getFixedPriority()!==b&&(a._setFixedPriority(b),this._setDirty(a._getListenerID(),this.DIRTY_FIXED_PRIORITY));break}}}},setEnabled:function(a){this._isEnabled=a},isEnabled:function(){return this._isEnabled},dispatchEvent:function(a){if(this._isEnabled){this._updateDirtyFlagForSceneGraph();this._inDispatch++;
if(!a||!a.getType)throw"event is undefined";if(a.getType()==cc.Event.TOUCH)this._dispatchTouchEvent(a);else{var b=cc.__getListenerID(a);this._sortEventListeners(b);b=this._listenersMap[b];null!=b&&this._dispatchEventToListeners(b,this._onListenerCallback,a);this._updateListeners(a)}this._inDispatch--}},_onListenerCallback:function(a,b){b._setCurrentTarget(a._getSceneGraphPriority());a._onEvent(b);return b.isStopped()},dispatchCustomEvent:function(a,b){var d=new cc.EventCustom(a);d.setUserData(b);
this.dispatchEvent(d)}};cc.EventAcceleration=cc.Event.extend({_acc:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.ACCELERATION);this._acc=a}});cc.EventKeyboard=cc.Event.extend({_keyCode:0,_isPressed:!1,ctor:function(a,b){cc.Event.prototype.ctor.call(this,cc.Event.KEYBOARD);this._keyCode=a;this._isPressed=b}});
cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(a){this._onAccelerationEvent=a;var b=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,function(a){b._onAccelerationEvent(a._acc,a)})},checkAvailable:function(){cc.assert(this._onAccelerationEvent,cc._LogInfos._EventListenerAcceleration_checkAvailable);return!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}});
cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration";cc._EventListenerAcceleration.create=function(a){return new cc._EventListenerAcceleration(a)};
cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var a=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,function(b){if(b._isPressed){if(a.onKeyPressed)a.onKeyPressed(b._keyCode,b)}else if(a.onKeyReleased)a.onKeyReleased(b._keyCode,b)})},clone:function(){var a=new cc._EventListenerKeyboard;a.onKeyPressed=this.onKeyPressed;a.onKeyReleased=this.onKeyReleased;return a},checkAvailable:function(){return null==
this.onKeyPressed&&null==this.onKeyReleased?(cc.log(cc._LogInfos._EventListenerKeyboard_checkAvailable),!1):!0}});cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard";cc._EventListenerKeyboard.create=function(){return new cc._EventListenerKeyboard};cc._tmp.WebGLCCNode=function(){var a=cc.Node.prototype;a._transform4x4=null;a._stackMatrix=null;a._glServerState=null;a._camera=null;a.ctor=function(){this._initNode();var a=new cc.kmMat4;a.mat[2]=a.mat[3]=a.mat[6]=a.mat[7]=a.mat[8]=a.mat[9]=a.mat[11]=a.mat[14]=0;a.mat[10]=a.mat[15]=1;this._transform4x4=a;this._glServerState=0;this._stackMatrix=new cc.kmMat4};a.setNodeDirty=function(){!1===this._transformDirty&&(this._transformDirty=this._inverseDirty=!0)};a.visit=function(){if(this._visible){var a=
cc._renderContext,d,e=cc.current_stack;e.stack.push(e.top);cc.kmMat4Assign(this._stackMatrix,e.top);e.top=this._stackMatrix;var f=this.grid;f&&f._active&&f.beforeDraw();this.transform();var g=this._children;if(g&&0<g.length){var h=g.length;this.sortAllChildren();for(d=0;d<h;d++)if(g[d]&&0>g[d]._localZOrder)g[d].visit();else break;for(this.draw(a);d<h;d++)g[d]&&g[d].visit()}else this.draw(a);this.arrivalOrder=0;f&&f._active&&f.afterDraw(this);e.top=e.stack.pop()}};a.transform=function(){var a=this._transform4x4,
d=cc.current_stack.top,e=this.nodeToParentTransform(),f=a.mat;f[0]=e.a;f[4]=e.c;f[12]=e.tx;f[1]=e.b;f[5]=e.d;f[13]=e.ty;f[14]=this._vertexZ;cc.kmMat4Multiply(d,d,a);null==this._camera||null!=this.grid&&this.grid.isActive()||(a=this._anchorPointInPoints.x,d=this._anchorPointInPoints.y,0!==a||0!==d?(cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(a|=0,d|=0),cc.kmGLTranslatef(a,d,0),this._camera.locate(),cc.kmGLTranslatef(-a,-d,0)):this._camera.locate())};a.nodeToParentTransform=a._nodeToParentTransformForWebGL};cc._tmp.PrototypeCCNode=function(){var a=cc.Node.prototype;cc.defineGetterSetter(a,"x",a.getPositionX,a.setPositionX);cc.defineGetterSetter(a,"y",a.getPositionY,a.setPositionY);cc.defineGetterSetter(a,"width",a._getWidth,a._setWidth);cc.defineGetterSetter(a,"height",a._getHeight,a._setHeight);cc.defineGetterSetter(a,"anchorX",a._getAnchorX,a._setAnchorX);cc.defineGetterSetter(a,"anchorY",a._getAnchorY,a._setAnchorY);cc.defineGetterSetter(a,"skewX",a.getSkewX,a.setSkewX);cc.defineGetterSetter(a,"skewY",
a.getSkewY,a.setSkewY);cc.defineGetterSetter(a,"zIndex",a.getLocalZOrder,a.setLocalZOrder);cc.defineGetterSetter(a,"vertexZ",a.getVertexZ,a.setVertexZ);cc.defineGetterSetter(a,"rotation",a.getRotation,a.setRotation);cc.defineGetterSetter(a,"rotationX",a.getRotationX,a.setRotationX);cc.defineGetterSetter(a,"rotationY",a.getRotationY,a.setRotationY);cc.defineGetterSetter(a,"scale",a.getScale,a.setScale);cc.defineGetterSetter(a,"scaleX",a.getScaleX,a.setScaleX);cc.defineGetterSetter(a,"scaleY",a.getScaleY,
a.setScaleY);cc.defineGetterSetter(a,"children",a.getChildren);cc.defineGetterSetter(a,"childrenCount",a.getChildrenCount);cc.defineGetterSetter(a,"parent",a.getParent,a.setParent);cc.defineGetterSetter(a,"visible",a.isVisible,a.setVisible);cc.defineGetterSetter(a,"running",a.isRunning);cc.defineGetterSetter(a,"ignoreAnchor",a.isIgnoreAnchorPointForPosition,a.ignoreAnchorPointForPosition);cc.defineGetterSetter(a,"actionManager",a.getActionManager,a.setActionManager);cc.defineGetterSetter(a,"scheduler",
a.getScheduler,a.setScheduler);cc.defineGetterSetter(a,"shaderProgram",a.getShaderProgram,a.setShaderProgram);cc.defineGetterSetter(a,"glServerState",a.getGLServerState,a.setGLServerState);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"opacityModifyRGB",a.isOpacityModifyRGB,a.setOpacityModifyRGB);cc.defineGetterSetter(a,"cascadeOpacity",a.isCascadeOpacityEnabled,a.setCascadeOpacityEnabled);cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,
"cascadeColor",a.isCascadeColorEnabled,a.setCascadeColorEnabled)};cc.NODE_TAG_INVALID=-1;cc.s_globalOrderOfArrival=1;
cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_anchorPointInPoints:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_transformDirty:!0,_inverseDirty:!0,_cacheDirty:!0,_cachedParent:null,_transformGLDirty:null,_transform:null,_inverse:null,_reorderChildDirty:!1,_shaderProgram:null,
arrivalOrder:0,_actionManager:null,_scheduler:null,_eventDispatcher:null,_initializedNode:!1,_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_rotationRadiansX:0,_rotationRadiansY:0,_className:"Node",_showNode:!1,_name:"",_displayedOpacity:255,_realOpacity:255,_displayedColor:null,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_usingNormalizedPosition:!1,_hashOfName:0,_initNode:function(){this._anchorPoint=cc.p(0,0);this._anchorPointInPoints=
cc.p(0,0);this._contentSize=cc.size(0,0);this._position=cc.p(0,0);this._children=[];this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0};var a=cc.director;this._actionManager=a.getActionManager();this._scheduler=a.getScheduler();this._initializedNode=!0;this._additionalTransform=cc.affineTransformMakeIdentity();cc.ComponentContainer&&(this._componentContainer=new cc.ComponentContainer(this));this._realOpacity=this._displayedOpacity=255;this._displayedColor=cc.color(255,255,255,255);this._realColor=cc.color(255,
255,255,255);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1},init:function(){!1===this._initializedNode&&this._initNode();return!0},_arrayMakeObjectsPerformSelector:function(a,b){if(a&&0!==a.length){var d,e=a.length,f;d=cc.Node.StateCallbackType;switch(b){case d.onEnter:for(d=0;d<e;d++)if(f=a[d])f.onEnter();break;case d.onExit:for(d=0;d<e;d++)if(f=a[d])f.onExit();break;case d.onEnterTransitionDidFinish:for(d=0;d<e;d++)if(f=a[d])f.onEnterTransitionDidFinish();break;case d.cleanup:for(d=0;d<
e;d++)(f=a[d])&&f.cleanup();break;case d.updateTransform:for(d=0;d<e;d++)(f=a[d])&&f.updateTransform();break;case d.onExitTransitionDidStart:for(d=0;d<e;d++)if(f=a[d])f.onExitTransitionDidStart();break;case d.sortAllChildren:for(d=0;d<e;d++)(f=a[d])&&f.sortAllChildren();break;default:cc.assert(0,cc._LogInfos.Node__arrayMakeObjectsPerformSelector)}}},setNodeDirty:null,attr:function(a){for(var b in a)this[b]=a[b]},getSkewX:function(){return this._skewX},setSkewX:function(a){this._skewX=a;this.setNodeDirty()},
getSkewY:function(){return this._skewY},setSkewY:function(a){this._skewY=a;this.setNodeDirty()},setLocalZOrder:function(a){this._localZOrder=a;this._parent&&this._parent.reorderChild(this,a);cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(a){this._localZOrder=a},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){cc.log(cc._LogInfos.Node_getZOrder);return this.getLocalZOrder()},setZOrder:function(a){cc.log(cc._LogInfos.Node_setZOrder);this.setLocalZOrder(a)},
setGlobalZOrder:function(a){this._globalZOrder!=a&&(this._globalZOrder=a,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(a){this._vertexZ=a},getRotation:function(){this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node_getRotation);return this._rotationX},setRotation:function(a){this._rotationX=this._rotationY=a;this._rotationRadiansX=0.017453292519943295*this._rotationX;this._rotationRadiansY=
0.017453292519943295*this._rotationY;this.setNodeDirty()},getRotationX:function(){return this._rotationX},setRotationX:function(a){this._rotationX=a;this._rotationRadiansX=0.017453292519943295*this._rotationX;this.setNodeDirty()},getRotationY:function(){return this._rotationY},setRotationY:function(a){this._rotationY=a;this._rotationRadiansY=0.017453292519943295*this._rotationY;this.setNodeDirty()},getScale:function(){this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale);return this._scaleX},
setScale:function(a,b){this._scaleX=a;this._scaleY=b||0===b?b:a;this.setNodeDirty()},getScaleX:function(){return this._scaleX},setScaleX:function(a){this._scaleX=a;this.setNodeDirty()},getScaleY:function(){return this._scaleY},setScaleY:function(a){this._scaleY=a;this.setNodeDirty()},setPosition:function(a,b){var d=this._position;void 0===b?(d.x=a.x,d.y=a.y):(d.x=a,d.y=b);this.setNodeDirty()},getPosition:function(){return cc.p(this._position)},getPositionX:function(){return this._position.x},setPositionX:function(a){this._position.x=
a;this.setNodeDirty()},getPositionY:function(){return this._position.y},setPositionY:function(a){this._position.y=a;this.setNodeDirty()},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(a){this._visible=a;this.setNodeDirty()},getAnchorPoint:function(){return this._anchorPoint},setAnchorPoint:function(a,b){var d=this._anchorPoint;if(void 0===b){if(a.x===d.x&&a.y===d.y)return;d.x=a.x;
d.y=a.y}else{if(a===d.x&&b===d.y)return;d.x=a;d.y=b}var e=this._anchorPointInPoints,f=this._contentSize;e.x=f.width*d.x;e.y=f.height*d.y;this.setNodeDirty()},_getAnchor:function(){return this._anchorPoint},_setAnchor:function(a){var b=a.x;a=a.y;this._anchorPoint.x!==b&&(this._anchorPoint.x=b,this._anchorPointInPoints.x=this._contentSize.width*b);this._anchorPoint.y!==a&&(this._anchorPoint.y=a,this._anchorPointInPoints.y=this._contentSize.height*a);this.setNodeDirty()},_getAnchorX:function(){return this._anchorPoint.x},
_setAnchorX:function(a){this._anchorPoint.x!==a&&(this._anchorPoint.x=a,this._anchorPointInPoints.x=this._contentSize.width*a,this.setNodeDirty())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(a){this._anchorPoint.y!==a&&(this._anchorPoint.y=a,this._anchorPointInPoints.y=this._contentSize.height*a,this.setNodeDirty())},getAnchorPointInPoints:function(){return this._anchorPointInPoints},_getWidth:function(){return this._contentSize.width},_setWidth:function(a){this._contentSize.width=
a;this._anchorPointInPoints.x=a*this._anchorPoint.x;this.setNodeDirty()},_getHeight:function(){return this._contentSize.height},_setHeight:function(a){this._contentSize.height=a;this._anchorPointInPoints.y=a*this._anchorPoint.y;this.setNodeDirty()},getContentSize:function(){return this._contentSize},setContentSize:function(a,b){var d=this._contentSize;if(void 0===b){if(a.width===d.width&&a.height===d.height)return;d.width=a.width;d.height=a.height}else{if(a===d.width&&b===d.height)return;d.width=
a;d.height=b}var e=this._anchorPointInPoints,f=this._anchorPoint;e.x=d.width*f.x;e.y=d.height*f.y;this.setNodeDirty()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(a){this._parent=a},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(a){a!=this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=a,this.setNodeDirty())},getTag:function(){return this.tag},
setTag:function(a){this.tag=a},setName:function(a){this._name},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(a){this.userData=a},getUserObject:function(){return this.userObject},setUserObject:function(a){this.userObject!=a&&(this.userObject=a)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(a){this.arrivalOrder=a},getActionManager:function(){this._actionManager||(this._actionManager=cc.director.getActionManager());
return this._actionManager},setActionManager:function(a){this._actionManager!=a&&(this.stopAllActions(),this._actionManager=a)},getScheduler:function(){this._scheduler||(this._scheduler=cc.director.getScheduler());return this._scheduler},setScheduler:function(a){this._scheduler!=a&&(this.unscheduleAllCallbacks(),this._scheduler=a)},getBoundingBox:function(){var a=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(a,this.nodeToParentTransform())},cleanup:function(){this.stopAllActions();
this.unscheduleAllCallbacks();cc.eventManager.removeListeners(this);this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.cleanup)},getChildByTag:function(a){var b=this._children;if(null!=b)for(var d=0;d<b.length;d++){var e=b[d];if(e&&e.tag==a)return e}return null},getChildByName:function(a){if(!a)return cc.log("Invalid name"),null;for(var b=this._children,d=0,e=b.length;d<e;d++)if(b[d]._name==a)return b[d];return null},addChild:function(a,b,d){b=void 0===b?a._localZOrder:
b;var e,f=!1;switch(typeof d){case "undefined":d=void 0;e=a._name;break;case "string":e=d;d=void 0;break;case "number":f=!0,e=""}cc.assert(a,cc._LogInfos.Node_addChild_3);cc.assert(null===a._parent,"child already added. It can't be added again");this.addChildHelper(a,b,d,e,f)},addChildHelper:function(a,b,d,e,f){this._children||(this._children=[]);this._insertChild(a,b);f?a.setTag(d):a.setName(e);a.setParent(this);a.setOrderOfArrival(this.s_globalOrderOfArrival++);if(this._running&&(a.onEnter(),this._isTransitionFinished))a.onEnterTransitionDidFinish();
this._cascadeColorEnabled&&this._enableCascadeColor();this._cascadeOpacityEnabled&&this._enableCascadeOpacity()},getName:function(){return this._name},setName:function(a){this._name=a},removeFromParent:function(a){this._parent&&(null==a&&(a=!0),this._parent.removeChild(this,a))},removeFromParentAndCleanup:function(a){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup);this.removeFromParent(a)},removeChild:function(a,b){0!==this._children.length&&(null==b&&(b=!0),-1<this._children.indexOf(a)&&this._detachChild(a,
b),this.setNodeDirty())},removeChildByTag:function(a,b){a===cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node_removeChildByTag);var d=this.getChildByTag(a);null==d?cc.log(cc._LogInfos.Node_removeChildByTag_2,a):this.removeChild(d,b)},removeAllChildrenWithCleanup:function(a){cc.log(cc._LogInfos.Node_removeAllChildrenWithCleanup);this.removeAllChildren(a)},removeAllChildren:function(a){var b=this._children;if(null!=b){null==a&&(a=!0);for(var d=0;d<b.length;d++){var e=b[d];e&&(this._running&&(e.onExitTransitionDidStart(),
e.onExit()),a&&e.cleanup(),e.parent=null)}this._children.length=0}},_detachChild:function(a,b){this._running&&(a.onExitTransitionDidStart(),a.onExit());b&&a.cleanup();a.parent=null;cc.arrayRemoveObject(this._children,a)},_insertChild:function(a,b){this._reorderChildDirty=!0;this._children.push(a);a._setLocalZOrder(b)},reorderChild:function(a,b){cc.assert(a,cc._LogInfos.Node_reorderChild);this._reorderChildDirty=!0;a.arrivalOrder=cc.s_globalOrderOfArrival;cc.s_globalOrderOfArrival++;a._setLocalZOrder(b);
this.setNodeDirty()},sortAllChildren:function(){if(this._reorderChildDirty){var a=this._children,b=a.length,d,e,f;for(d=1;d<b;d++){f=a[d];for(e=d-1;0<=e;){if(f._localZOrder<a[e]._localZOrder)a[e+1]=a[e];else if(f._localZOrder===a[e]._localZOrder&&f.arrivalOrder<a[e].arrivalOrder)a[e+1]=a[e];else break;e--}a[e+1]=f}this._reorderChildDirty=!1}},draw:function(a){},transformAncestors:function(){null!=this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=
!1;this._running=!0;this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnter);this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0;this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1;this.pause();this._arrayMakeObjectsPerformSelector(this._children,
cc.Node.StateCallbackType.onExit);this._componentContainer&&this._componentContainer.removeAll()},runAction:function(a){cc.assert(a,cc._LogInfos.Node_runAction);this.actionManager.addAction(a,this,!this._running);return a},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(a){this.actionManager.removeAction(a)},stopActionByTag:function(a){a===cc.ACTION_TAG_INVALID?cc.log(cc._LogInfos.Node_stopActionByTag):this.actionManager.removeActionByTag(a,
this)},getActionByTag:function(a){return a===cc.ACTION_TAG_INVALID?(cc.log(cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(a,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(a){this.scheduler.scheduleUpdateForTarget(this,a,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdateForTarget(this)},schedule:function(a,
b,d,e){b=b||0;cc.assert(a,cc._LogInfos.Node_schedule);cc.assert(0<=b,cc._LogInfos.Node_schedule_2);d=null==d?cc.REPEAT_FOREVER:d;this.scheduler.scheduleCallbackForTarget(this,a,b,d,e||0,!this._running)},scheduleOnce:function(a,b){this.schedule(a,0,0,b)},unschedule:function(a){a&&this.scheduler.unscheduleCallbackForTarget(this,a)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllCallbacksForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions);
this.resume()},resume:function(){this.scheduler.resumeTarget(this);this.actionManager&&this.actionManager.resumeTarget(this);cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions);this.pause()},pause:function(){this.scheduler.pauseTarget(this);this.actionManager&&this.actionManager.pauseTarget(this);cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(a){this._additionalTransform=a;this._additionalTransformDirty=this._transformDirty=
!0},parentToNodeTransform:function(){this._inverseDirty&&(this._inverse=cc.affineTransformInvert(this.nodeToParentTransform()),this._inverseDirty=!1);return this._inverse},nodeToWorldTransform:function(){for(var a=this.nodeToParentTransform(),b=this._parent;null!=b;b=b.parent)a=cc.affineTransformConcat(a,b.nodeToParentTransform());return a},worldToNodeTransform:function(){return cc.affineTransformInvert(this.nodeToWorldTransform())},convertToNodeSpace:function(a){return cc.pointApplyAffineTransform(a,
this.worldToNodeTransform())},convertToWorldSpace:function(a){a=a||cc.p(0,0);return cc.pointApplyAffineTransform(a,this.nodeToWorldTransform())},convertToNodeSpaceAR:function(a){return cc.pSub(this.convertToNodeSpace(a),this._anchorPointInPoints)},convertToWorldSpaceAR:function(a){a=a||cc.p(0,0);a=cc.pAdd(a,this._anchorPointInPoints);return this.convertToWorldSpace(a)},_convertToWindowSpace:function(a){a=this.convertToWorldSpace(a);return cc.director.convertToUI(a)},convertTouchToNodeSpace:function(a){a=
a.getLocation();return this.convertToNodeSpace(a)},convertTouchToNodeSpaceAR:function(a){a=a.getLocation();a=cc.director.convertToGL(a);return this.convertToNodeSpaceAR(a)},update:function(a){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(a)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform)},retain:function(){},release:function(){},getComponent:function(a){return this._componentContainer.getComponent(a)},
addComponent:function(a){this._componentContainer.add(a)},removeComponent:function(a){return this._componentContainer.remove(a)},removeAllComponents:function(){this._componentContainer.removeAll()},grid:null,ctor:null,visit:null,transform:null,nodeToParentTransform:null,_setNodeDirtyForCache:function(){if(!1===this._cacheDirty){this._cacheDirty=!0;var a=this._cachedParent;a&&a!=this&&a._setNodeDirtyForCache()}},_setCachedParent:function(a){if(this._cachedParent!=a){this._cachedParent=a;for(var b=
this._children,d=0,e=b.length;d<e;d++)b[d]._setCachedParent(a)}},getCamera:function(){this._camera||(this._camera=new cc.Camera);return this._camera},getGrid:function(){return this.grid},setGrid:function(a){this.grid=a},getShaderProgram:function(){return this._shaderProgram},setShaderProgram:function(a){this._shaderProgram=a},getGLServerState:function(){return this._glServerState},setGLServerState:function(a){this._glServerState=a},getBoundingBoxToWorld:function(){var a=cc.rect(0,0,this._contentSize.width,
this._contentSize.height),b=this.nodeToWorldTransform(),a=cc.rectApplyAffineTransform(a,this.nodeToWorldTransform());if(!this._children)return a;for(var d=this._children,e=0;e<d.length;e++){var f=d[e];f&&f._visible&&(f=f._getBoundingBoxToCurrentNode(b))&&(a=cc.rectUnion(a,f))}return a},_getBoundingBoxToCurrentNode:function(a){var b=cc.rect(0,0,this._contentSize.width,this._contentSize.height);a=null==a?this.nodeToParentTransform():cc.affineTransformConcat(this.nodeToParentTransform(),a);b=cc.rectApplyAffineTransform(b,
a);if(!this._children)return b;for(var d=this._children,e=0;e<d.length;e++){var f=d[e];f&&f._visible&&(f=f._getBoundingBoxToCurrentNode(a))&&(b=cc.rectUnion(b,f))}return b},_nodeToParentTransformForWebGL:function(){if(this._transformDirty){var a=this._position.x,b=this._position.y,d=this._anchorPointInPoints.x,e=-d,f=this._anchorPointInPoints.y,g=-f,h=this._scaleX,k=this._scaleY;this._ignoreAnchorPointForPosition&&(a+=d,b+=f);var m=1,n=0,q=1,s=0;if(0!==this._rotationX||0!==this._rotationY)m=Math.cos(-this._rotationRadiansX),
n=Math.sin(-this._rotationRadiansX),q=Math.cos(-this._rotationRadiansY),s=Math.sin(-this._rotationRadiansY);var u=this._skewX||this._skewY;u||0===d&&0===f||(a+=q*e*h+-n*g*k,b+=s*e*h+m*g*k);var t=this._transform;t.a=q*h;t.b=s*h;t.c=-n*k;t.d=m*k;t.tx=a;t.ty=b;u&&(t=cc.affineTransformConcat({a:1,b:Math.tan(cc.degreesToRadians(this._skewY)),c:Math.tan(cc.degreesToRadians(this._skewX)),d:1,tx:0,ty:0},t),0!==d||0!==f)&&(t=cc.affineTransformTranslate(t,e,g));this._additionalTransformDirty&&(t=cc.affineTransformConcat(t,
this._additionalTransform),this._additionalTransformDirty=!1);this._transform=t;this._transformDirty=!1}return this._transform},_updateColor:function(){},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._displayedOpacity},setOpacity:function(a){this._displayedOpacity=this._realOpacity=a;var b=255,d=this._parent;d&&d.cascadeOpacity&&(b=d.getDisplayedOpacity());this.updateDisplayedOpacity(b);this._displayedColor.a=this._realColor.a=a},updateDisplayedOpacity:function(a){this._displayedOpacity=
this._realOpacity*a/255;if(this._cascadeOpacityEnabled){a=this._children;for(var b=0;b<a.length;b++){var d=a[b];d&&d.updateDisplayedOpacity(this._displayedOpacity)}}},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(a){this._cascadeOpacityEnabled!==a&&((this._cascadeOpacityEnabled=a)?this._enableCascadeOpacity():this._disableCascadeOpacity())},_enableCascadeOpacity:function(){var a=255,b=this._parent;b&&b.cascadeOpacity&&(a=b.getDisplayedOpacity());
this.updateDisplayedOpacity(a)},_disableCascadeOpacity:function(){this._displayedOpacity=this._realOpacity;for(var a=this._children,b=0;b<a.length;b++){var d=a[b];d&&d.updateDisplayedOpacity(255)}},getColor:function(){var a=this._realColor;return cc.color(a.r,a.g,a.b,a.a)},getDisplayedColor:function(){var a=this._displayedColor;return cc.color(a.r,a.g,a.b,a.a)},setColor:function(a){var b=this._displayedColor,d=this._realColor;b.r=d.r=a.r;b.g=d.g=a.g;b.b=d.b=a.b;b=(b=this._parent)&&b.cascadeColor?
b.getDisplayedColor():cc.color.WHITE;this.updateDisplayedColor(b);void 0===a.a||a.a_undefined||this.setOpacity(a.a)},updateDisplayedColor:function(a){var b=this._displayedColor,d=this._realColor;b.r=0|d.r*a.r/255;b.g=0|d.g*a.g/255;b.b=0|d.b*a.b/255;if(this._cascadeColorEnabled)for(a=this._children,d=0;d<a.length;d++){var e=a[d];e&&e.updateDisplayedColor(b)}},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(a){this._cascadeColorEnabled!==a&&((this._cascadeColorEnabled=
a)?this._enableCascadeColor():this._disableCascadeColor())},_enableCascadeColor:function(){var a;a=(a=this._parent)&&a.cascadeColor?a.getDisplayedColor():cc.color.WHITE;this.updateDisplayedColor(a)},_disableCascadeColor:function(){var a=this._displayedColor,b=this._realColor;a.r=b.r;a.g=b.g;a.b=b.b;for(var a=this._children,b=cc.color.WHITE,d=0;d<a.length;d++){var e=a[d];e&&e.updateDisplayedColor(b)}},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1}});cc.Node.create=function(){return new cc.Node};
cc.Node.StateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7};
cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.Node.prototype,_p.ctor=function(){this._initNode()},_p.setNodeDirty=function(){this._setNodeDirtyForCache();!1===this._transformDirty&&(this._transformDirty=this._inverseDirty=!0)},_p.visit=function(a){if(this._visible){a=a||cc._renderContext;var b,d=this._children,e;a.save();this.transform(a);var f=d.length;if(0<f){this.sortAllChildren();for(b=0;b<f;b++)if(e=d[b],0>e._localZOrder)e.visit(a);else break;for(this.draw(a);b<f;b++)d[b].visit(a)}else this.draw(a);
this._cacheDirty=!1;this.arrivalOrder=0;a.restore()}},_p.transform=function(a){a=a||cc._renderContext;var b=cc.view,d=this.nodeToParentTransform();a.transform(d.a,d.c,d.b,d.d,d.tx*b.getScaleX(),-d.ty*b.getScaleY())},_p.nodeToParentTransform=function(){if(this._transformDirty){var a=this._transform;a.tx=this._position.x;a.ty=this._position.y;var b=1,d=0;this._rotationX&&(b=Math.cos(this._rotationRadiansX),d=Math.sin(this._rotationRadiansX));a.a=a.d=b;a.b=-d;a.c=d;var e=this._scaleX,f=this._scaleY,
g=this._anchorPointInPoints.x,h=this._anchorPointInPoints.y,k=1E-6>e&&-1E-6<e?1E-6:e,m=1E-6>f&&-1E-6<f?1E-6:f;if(this._skewX||this._skewY){var n=Math.tan(-this._skewX*Math.PI/180),q=Math.tan(-this._skewY*Math.PI/180);Infinity===n&&(n=99999999);Infinity===q&&(q=99999999);var s=h*n*k,u=g*q*m;a.a=b+-d*q;a.b=b*n+-d;a.c=d+b*q;a.d=d*n+b;a.tx+=b*s+-d*u;a.ty+=d*s+b*u}if(1!==e||1!==f)a.a*=k,a.c*=k,a.b*=m,a.d*=m;a.tx+=b*-g*k+-d*h*m;a.ty-=d*-g*k+b*h*m;this._ignoreAnchorPointForPosition&&(a.tx+=g,a.ty+=h);this._additionalTransformDirty&&
(this._transform=cc.AffineTransformConcat(a,this._additionalTransform),this._additionalTransformDirty=!1);this._transformDirty=!1}return this._transform},_p=null):(cc.assert("function"===typeof cc._tmp.WebGLCCNode,cc._LogInfos.MissingFile,"BaseNodesWebGL.js"),cc._tmp.WebGLCCNode(),delete cc._tmp.WebGLCCNode);cc.assert("function"===typeof cc._tmp.PrototypeCCNode,cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js");cc._tmp.PrototypeCCNode();delete cc._tmp.PrototypeCCNode;cc.Node.ON_ENTER=0;
cc.Node.ON_EXIT=1;cc.Node.ON_ENTER_TRANSITION_DID_FINISH=2;cc.Node.ON_EXIT_TRANSITOIN_DID_START=3;cc.Node.ON_CLEAN_UP=4;cc.AtlasNode=cc.Node.extend({textureAtlas:null,quadsToDraw:0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_colorUnmodified:null,_opacityModifyRGB:!1,_blendFunc:null,_ignoreContentScaleFactor:!1,_className:"AtlasNode",ctor:function(a,b,d,e){cc.Node.prototype.ctor.call(this);this._colorUnmodified=cc.color.WHITE;this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._ignoreContentScaleFactor=!1;void 0!==e&&this.initWithTileFile(a,b,d,e)},updateAtlasValues:function(){cc.log(cc._LogInfos.AtlasNode_updateAtlasValues)},
getColor:function(){return this._opacityModifyRGB?this._colorUnmodified:cc.Node.prototype.getColor.call(this)},setOpacityModifyRGB:function(a){var b=this.color;this._opacityModifyRGB=a;this.color=b},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(a,b){this._blendFunc=void 0===b?a:{src:a,dst:b}},setTextureAtlas:function(a){this.textureAtlas=a},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},
setQuadsToDraw:function(a){this.quadsToDraw=a},_textureForCanvas:null,_originalTexture:null,_uniformColor:null,_colorF32Array:null,initWithTileFile:function(a,b,d,e){if(!a)throw"cc.AtlasNode.initWithTileFile(): title should not be null";a=cc.textureCache.addImage(a);return this.initWithTexture(a,b,d,e)},initWithTexture:null,_initWithTextureForCanvas:function(a,b,d,e){this._itemWidth=b;this._itemHeight=d;this._opacityModifyRGB=!0;this._originalTexture=a;if(!this._originalTexture)return cc.log(cc._LogInfos.AtlasNode__initWithTexture),
!1;this._textureForCanvas=this._originalTexture;this._calculateMaxItems();this.quadsToDraw=e;return!0},_initWithTextureForWebGL:function(a,b,d,e){this._itemWidth=b;this._itemHeight=d;this._colorUnmodified=cc.color.WHITE;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;b=this._realColor;this._colorF32Array=new Float32Array([b.r/255,b.g/255,b.b/255,this._realOpacity/255]);this.textureAtlas=new cc.TextureAtlas;this.textureAtlas.initWithTexture(a,e);if(!this.textureAtlas)return cc.log(cc._LogInfos.AtlasNode__initWithTexture),
!1;this._updateBlendFunc();this._updateOpacityModifyRGB();this._calculateMaxItems();this.quadsToDraw=e;this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR);this._uniformColor=cc._renderContext.getUniformLocation(this.shaderProgram.getProgram(),"u_color");return!0},draw:null,_drawForWebGL:function(a){a=a||cc._renderContext;cc.nodeDrawSetup(this);cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst);this._uniformColor&&this._colorF32Array&&(a.uniform4fv(this._uniformColor,
this._colorF32Array),this.textureAtlas.drawNumberOfQuads(this.quadsToDraw,0))},setColor:null,_setColorForCanvas:function(a){var b=this._realColor;if(b.r!=a.r||b.g!=a.g||b.b!=a.b){b=cc.color(a.r,a.g,a.b);this._colorUnmodified=a;if(this._opacityModifyRGB){var d=this._displayedOpacity;b.r=b.r*d/255;b.g=b.g*d/255;b.b=b.b*d/255}cc.Node.prototype.setColor.call(this,a);this._changeTextureColor()}},_changeTextureColor:function(){var a=this.getTexture();if(a&&this._originalTexture){var b=this._originalTexture.getHtmlElementObj();
if(b){var d=a.getHtmlElementObj(),a=cc.rect(0,0,b.width,b.height);d instanceof HTMLCanvasElement?cc.generateTintImageWithMultiply(b,this._displayedColor,a,d):(d=cc.generateTintImageWithMultiply(b,this._displayedColor,a),a=new cc.Texture2D,a.initWithElement(d),a.handleLoadedTexture(),this.setTexture(a))}}},_setColorForWebGL:function(a){var b=cc.color(a.r,a.g,a.b);this._colorUnmodified=a;var d=this._displayedOpacity;this._opacityModifyRGB&&(b.r=b.r*d/255,b.g=b.g*d/255,b.b=b.b*d/255);cc.Node.prototype.setColor.call(this,
a);a=this._displayedColor;this._colorF32Array=new Float32Array([a.r/255,a.g/255,a.b/255,d/255])},setOpacity:function(a){},_setOpacityForCanvas:function(a){cc.Node.prototype.setOpacity.call(this,a);this._opacityModifyRGB&&(this.color=this._colorUnmodified)},_setOpacityForWebGL:function(a){cc.Node.prototype.setOpacity.call(this,a);this._opacityModifyRGB?this.color=this._colorUnmodified:(a=this._displayedColor,this._colorF32Array=new Float32Array([a.r/255,a.g/255,a.b/255,this._displayedOpacity/255]))},
getTexture:null,_getTextureForCanvas:function(){return this._textureForCanvas},_getTextureForWebGL:function(){return this.textureAtlas.texture},setTexture:null,_setTextureForCanvas:function(a){this._textureForCanvas=a},_setTextureForWebGL:function(a){this.textureAtlas.texture=a;this._updateBlendFunc();this._updateOpacityModifyRGB()},_calculateMaxItems:null,_calculateMaxItemsForCanvas:function(){var a=this.texture.getContentSize();this._itemsPerColumn=0|a.height/this._itemHeight;this._itemsPerRow=
0|a.width/this._itemWidth},_calculateMaxItemsForWebGL:function(){var a=this.texture,b=a.getContentSize();this._ignoreContentScaleFactor&&(b=a.getContentSizeInPixels());this._itemsPerColumn=0|b.height/this._itemHeight;this._itemsPerRow=0|b.width/this._itemWidth},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=cc.SRC_ALPHA,this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},_updateOpacityModifyRGB:function(){this._opacityModifyRGB=this.textureAtlas.texture.hasPremultipliedAlpha()},
_setIgnoreContentScaleFactor:function(a){this._ignoreContentScaleFactor=a}});_p=cc.AtlasNode.prototype;
cc._renderType===cc._RENDER_TYPE_WEBGL?(_p.initWithTexture=_p._initWithTextureForWebGL,_p.draw=_p._drawForWebGL,_p.setColor=_p._setColorForWebGL,_p.setOpacity=_p._setOpacityForWebGL,_p.getTexture=_p._getTextureForWebGL,_p.setTexture=_p._setTextureForWebGL,_p._calculateMaxItems=_p._calculateMaxItemsForWebGL):(_p.initWithTexture=_p._initWithTextureForCanvas,_p.draw=cc.Node.prototype.draw,_p.setColor=_p._setColorForCanvas,_p.setOpacity=_p._setOpacityForCanvas,_p.getTexture=_p._getTextureForCanvas,_p.setTexture=
_p._setTextureForCanvas,_p._calculateMaxItems=_p._calculateMaxItemsForCanvas,cc.sys._supportCanvasNewBlendModes||(_p._changeTextureColor=function(){var a,b=this.getTexture();if(b&&this._originalTexture&&(a=b.getHtmlElementObj())){var d=this._originalTexture.getHtmlElementObj();if(b=cc.textureCache.getTextureColors(d))d=cc.rect(0,0,d.width,d.height),a instanceof HTMLCanvasElement?cc.generateTintImage(a,b,this._displayedColor,d,a):(a=cc.generateTintImage(a,b,this._displayedColor,d),b=new cc.Texture2D,
b.initWithElement(a),b.handleLoadedTexture(),this.setTexture(b))}}));cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor);cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.AtlasNode.create=function(a,b,d,e){return new cc.AtlasNode(a,b,d,e)};cc._tmp.WebGLTexture2D=function(){cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:!0,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:!1,_hasMipmaps:!1,shaderProgram:null,_isLoaded:!1,_htmlElementObj:null,_webTextureObj:null,url:null,_loadedEventListeners:null,ctor:function(){this._contentSize=cc.size(0,0);this._pixelFormat=cc.Texture2D.defaultPixelFormat},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj);
cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.contentScaleFactor(),this._contentSize.height/cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},
getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(a){this.maxS=a},getMaxT:function(){return this.maxT},setMaxT:function(a){this.maxT=a},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(a){this.shaderProgram=a},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){return"\x3ccc.Texture2D | Name \x3d "+this._name+" | Dimensions \x3d "+
this._pixelsWide+" x "+this._pixelsHigh+" | Coordinates \x3d ("+this.maxS+", "+this.maxT+")\x3e"},releaseData:function(a){},keepData:function(a,b){return a},initWithData:function(a,b,d,e,f){var g=cc.Texture2D,h=cc._renderContext,k=h.RGBA,m=h.UNSIGNED_BYTE,n=d*cc.Texture2D._B[b]/8;0===n%8?h.pixelStorei(h.UNPACK_ALIGNMENT,8):0===n%4?h.pixelStorei(h.UNPACK_ALIGNMENT,4):0===n%2?h.pixelStorei(h.UNPACK_ALIGNMENT,2):h.pixelStorei(h.UNPACK_ALIGNMENT,1);this._webTextureObj=h.createTexture();cc.glBindTexture2D(this);
h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);switch(b){case g.PIXEL_FORMAT_RGBA8888:k=h.RGBA;break;case g.PIXEL_FORMAT_RGB888:k=h.RGB;break;case g.PIXEL_FORMAT_RGBA4444:m=h.UNSIGNED_SHORT_4_4_4_4;break;case g.PIXEL_FORMAT_RGB5A1:m=h.UNSIGNED_SHORT_5_5_5_1;break;case g.PIXEL_FORMAT_RGB565:m=h.UNSIGNED_SHORT_5_6_5;
break;case g.PIXEL_FORMAT_AI88:k=h.LUMINANCE_ALPHA;break;case g.PIXEL_FORMAT_A8:k=h.ALPHA;break;case g.PIXEL_FORMAT_I8:k=h.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D_initWithData)}h.texImage2D(h.TEXTURE_2D,0,k,d,e,0,k,m,a);this._contentSize.width=f.width;this._contentSize.height=f.height;this._pixelsWide=d;this._pixelsHigh=e;this._pixelFormat=b;this.maxS=f.width/d;this.maxT=f.height/e;this._hasMipmaps=this._hasPremultipliedAlpha=!1;this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE);
return this._isLoaded=!0},drawAtPoint:function(a){var b=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0],d=this._pixelsWide*this.maxS,e=this._pixelsHigh*this.maxT;a=[a.x,a.y,0,d+a.x,a.y,0,a.x,e+a.y,0,d+a.x,e+a.y,0];cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS);this._shaderProgram.use();this._shaderProgram.setUniformsForBuiltins();cc.glBindTexture2D(this);d=cc._renderContext;d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,a);d.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,
2,d.FLOAT,!1,0,b);d.drawArrays(d.TRIANGLE_STRIP,0,4)},drawInRect:function(a){var b=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0];a=[a.x,a.y,a.x+a.width,a.y,a.x,a.y+a.height,a.x+a.width,a.y+a.height];cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS);this._shaderProgram.use();this._shaderProgram.setUniformsForBuiltins();cc.glBindTexture2D(this);var d=cc._renderContext;d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,a);d.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,
2,d.FLOAT,!1,0,b);d.drawArrays(d.TRIANGLE_STRIP,0,4)},initWithImage:function(a){if(null==a)return cc.log(cc._LogInfos.Texture2D_initWithImage),!1;var b=a.getWidth(),d=a.getHeight(),e=cc.configuration.getMaxTextureSize();if(b>e||d>e)return cc.log(cc._LogInfos.Texture2D_initWithImage_2,b,d,e,e),!1;this._isLoaded=!0;return this._initPremultipliedATextureWithImage(a,b,d)},initWithElement:function(a){a&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=a)},getHtmlElementObj:function(){return this._htmlElementObj},
isLoaded:function(){return this._isLoaded},handleLoadedTexture:function(){if(cc._rendererInitialized){if(!this._htmlElementObj){var a=cc.loader.getRes(this.url);if(!a)return;this.initWithElement(a)}this._htmlElementObj.width&&this._htmlElementObj.height&&(this._isLoaded=!0,a=cc._renderContext,cc.glBindTexture2D(this),a.pixelStorei(a.UNPACK_ALIGNMENT,4),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this._htmlElementObj),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),cc.glBindTexture2D(null),a=this._htmlElementObj.height,this._pixelsWide=this._contentSize.width=this._htmlElementObj.width,this._pixelsHigh=this._contentSize.height=a,this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.maxT=this.maxS=1,this._hasMipmaps=this._hasPremultipliedAlpha=
!1,this._callLoadedEventCallbacks())}},initWithString:function(a,b,d,e,f,g){cc.log(cc._LogInfos.Texture2D_initWithString);return null},initWithETCFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithETCFile_2);return!1},initWithPVRFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithPVRFile_2);return!1},initWithPVRTCData:function(a,b,d,e,f,g){cc.log(cc._LogInfos.Texture2D_initWithPVRTCData_2);return!1},setTexParameters:function(a){var b=cc._renderContext;cc.assert(this._pixelsWide==cc.NextPOT(this._pixelsWide)&&
this._pixelsHigh==cc.NextPOT(this._pixelsHigh)||a.wrapS==b.CLAMP_TO_EDGE&&a.wrapT==b.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures");cc.glBindTexture2D(this);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.minFilter);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.magFilter);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,a.wrapS);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,a.wrapT)},setAntiAliasTexParameters:function(){var a=cc._renderContext;cc.glBindTexture2D(this);
this._hasMipmaps?a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST)},setAliasTexParameters:function(){var a=cc._renderContext;cc.glBindTexture2D(this);this._hasMipmaps?a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST_MIPMAP_NEAREST):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST)},
generateMipmap:function(){cc.assert(this._pixelsWide==cc.NextPOT(this._pixelsWide)&&this._pixelsHigh==cc.NextPOT(this._pixelsHigh),"Mimpap texture only works in POT textures");cc.glBindTexture2D(this);cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D);this._hasMipmaps=!0},stringForFormat:function(){return cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(a){a=a||this._pixelFormat;var b=cc.Texture2D._B[a];if(null!=b)return b;cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat,
a);return-1},_initPremultipliedATextureWithImage:function(a,b,d){var e=cc.Texture2D,f=a.getData(),g=null,g=null,h=a.hasAlpha(),k=cc.size(a.getWidth(),a.getHeight()),m=e.defaultPixelFormat,n=a.getBitsPerComponent();h||(8<=n?m=e.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D__initPremultipliedATextureWithImage),m=e.PIXEL_FORMAT_RGB565));var q=b*d;if(m==e.PIXEL_FORMAT_RGB565)if(h)for(f=new Uint16Array(b*d),g=a.getData(),n=0;n<q;++n)f[n]=(g[n]>>0&255)>>3<<11|(g[n]>>8&255)>>2<<5|(g[n]>>16&255)>>3<<
0;else for(f=new Uint16Array(b*d),g=a.getData(),n=0;n<q;++n)f[n]=(g[n]&255)>>3<<11|(g[n]&255)>>2<<5|(g[n]&255)>>3<<0;else if(m==e.PIXEL_FORMAT_RGBA4444)for(f=new Uint16Array(b*d),g=a.getData(),n=0;n<q;++n)f[n]=(g[n]>>0&255)>>4<<12|(g[n]>>8&255)>>4<<8|(g[n]>>16&255)>>4<<4|(g[n]>>24&255)>>4<<0;else if(m==e.PIXEL_FORMAT_RGB5A1)for(f=new Uint16Array(b*d),g=a.getData(),n=0;n<q;++n)f[n]=(g[n]>>0&255)>>3<<11|(g[n]>>8&255)>>3<<6|(g[n]>>16&255)>>3<<1|(g[n]>>24&255)>>7<<0;else if(m==e.PIXEL_FORMAT_A8)for(f=
new Uint8Array(b*d),g=a.getData(),n=0;n<q;++n)f[n]=g>>24&255;if(h&&m==e.PIXEL_FORMAT_RGB888)for(g=a.getData(),f=new Uint8Array(b*d*3),n=0;n<q;++n)f[3*n]=g>>0&255,f[3*n+1]=g>>8&255,f[3*n+2]=g>>16&255;this.initWithData(f,m,b,d,k);a.getData();this._hasPremultipliedAlpha=a.isPremultipliedAlpha();return!0},addLoadedEventListener:function(a,b){this._loadedEventListeners||(this._loadedEventListeners=[]);this._loadedEventListeners.push({eventCallback:a,eventTarget:b})},removeLoadedEventListener:function(a){if(this._loadedEventListeners)for(var b=
this._loadedEventListeners,d=0;d<b.length;d++)b[d].eventTarget==a&&b.splice(d,1)},_callLoadedEventCallbacks:function(){if(this._loadedEventListeners){for(var a=this._loadedEventListeners,b=0,d=a.length;b<d;b++){var e=a[b];e.eventCallback.call(e.eventTarget,this)}a.length=0}}})};
cc._tmp.WebGLTextureAtlas=function(){var a=cc.TextureAtlas.prototype;a._setupVBO=function(){var a=cc._renderContext;this._buffersVBO[0]=a.createBuffer();this._buffersVBO[1]=a.createBuffer();this._quadsWebBuffer=a.createBuffer();this._mapBuffers()};a._mapBuffers=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._quadsWebBuffer);a.bufferData(a.ARRAY_BUFFER,this._quadsArrayBuffer,a.DYNAMIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);a.bufferData(a.ELEMENT_ARRAY_BUFFER,
this._indices,a.STATIC_DRAW)};a.drawNumberOfQuads=function(a,d){d=d||0;if(0!==a&&this.texture&&this.texture.isLoaded()){var e=cc._renderContext;cc.glBindTexture2D(this.texture);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);e.bindBuffer(e.ARRAY_BUFFER,this._quadsWebBuffer);this.dirty&&e.bufferData(e.ARRAY_BUFFER,this._quadsArrayBuffer,e.DYNAMIC_DRAW);e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,e.FLOAT,!1,24,0);e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,
24,12);e.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,e.FLOAT,!1,24,16);this.dirty&&(this.dirty=!1);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?e.drawElements(e.TRIANGLE_STRIP,6*a,e.UNSIGNED_SHORT,6*d*this._indices.BYTES_PER_ELEMENT):e.drawElements(e.TRIANGLES,6*a,e.UNSIGNED_SHORT,6*d*this._indices.BYTES_PER_ELEMENT);cc.g_NumberOfDraws++}}};
cc._tmp.WebGLTextureCache=function(){var a=cc.textureCache;a.handleLoadedTexture=function(a){var d=this._textures;cc._rendererInitialized||(d=this._loadedTexturesBefore);var e=d[a];e||(e=d[a]=new cc.Texture2D,e.url=a);e.handleLoadedTexture()};a.addImage=function(a,d,e){cc.assert(a,cc._LogInfos.Texture2D_addImage_2);var f=this._textures;cc._rendererInitialized||(f=this._loadedTexturesBefore);var g=f[a]||f[cc.loader._aliases[a]];if(g)return d&&d.call(e),g;cc.loader.getRes(a)||(cc.loader._checkIsImageURL(a)?
cc.loader.load(a,function(a){d&&d.call(e)}):cc.loader.cache[a]=cc.loader.loadImg(a,function(e,f){if(e)return d?d(e):e;cc.textureCache.handleLoadedTexture(a);d&&d(null,f)}));g=f[a]=new cc.Texture2D;g.url=a;return g};delete a};cc._tmp.PrototypeTexture2D=function(){var a=cc.Texture2D;a.PVRImagesHavePremultipliedAlpha=function(a){cc.PVRHaveAlphaPremultiplied_=a};a.PIXEL_FORMAT_RGBA8888=2;a.PIXEL_FORMAT_RGB888=3;a.PIXEL_FORMAT_RGB565=4;a.PIXEL_FORMAT_A8=5;a.PIXEL_FORMAT_I8=6;a.PIXEL_FORMAT_AI88=7;a.PIXEL_FORMAT_RGBA4444=8;a.PIXEL_FORMAT_RGB5A1=7;a.PIXEL_FORMAT_PVRTC4=9;a.PIXEL_FORMAT_PVRTC2=10;a.PIXEL_FORMAT_DEFAULT=a.PIXEL_FORMAT_RGBA8888;var b=cc.Texture2D._M={};b[a.PIXEL_FORMAT_RGBA8888]="RGBA8888";b[a.PIXEL_FORMAT_RGB888]=
"RGB888";b[a.PIXEL_FORMAT_RGB565]="RGB565";b[a.PIXEL_FORMAT_A8]="A8";b[a.PIXEL_FORMAT_I8]="I8";b[a.PIXEL_FORMAT_AI88]="AI88";b[a.PIXEL_FORMAT_RGBA4444]="RGBA4444";b[a.PIXEL_FORMAT_RGB5A1]="RGB5A1";b[a.PIXEL_FORMAT_PVRTC4]="PVRTC4";b[a.PIXEL_FORMAT_PVRTC2]="PVRTC2";b=cc.Texture2D._B={};b[a.PIXEL_FORMAT_RGBA8888]=32;b[a.PIXEL_FORMAT_RGB888]=24;b[a.PIXEL_FORMAT_RGB565]=16;b[a.PIXEL_FORMAT_A8]=8;b[a.PIXEL_FORMAT_I8]=8;b[a.PIXEL_FORMAT_AI88]=16;b[a.PIXEL_FORMAT_RGBA4444]=16;b[a.PIXEL_FORMAT_RGB5A1]=16;
b[a.PIXEL_FORMAT_PVRTC4]=4;b[a.PIXEL_FORMAT_PVRTC2]=3;b=cc.Texture2D.prototype;cc.defineGetterSetter(b,"name",b.getName);cc.defineGetterSetter(b,"pixelFormat",b.getPixelFormat);cc.defineGetterSetter(b,"pixelsWidth",b.getPixelsWide);cc.defineGetterSetter(b,"pixelsHeight",b.getPixelsHigh);cc.defineGetterSetter(b,"width",b._getWidth);cc.defineGetterSetter(b,"height",b._getHeight);a.defaultPixelFormat=a.PIXEL_FORMAT_DEFAULT};
cc._tmp.PrototypeTextureAtlas=function(){var a=cc.TextureAtlas.prototype;cc.defineGetterSetter(a,"totalQuads",a.getTotalQuads);cc.defineGetterSetter(a,"capacity",a.getCapacity);cc.defineGetterSetter(a,"quads",a.getQuads,a.setQuads)};cc.ALIGN_CENTER=51;cc.ALIGN_TOP=19;cc.ALIGN_TOP_RIGHT=18;cc.ALIGN_RIGHT=50;cc.ALIGN_BOTTOM_RIGHT=34;cc.ALIGN_BOTTOM=35;cc.ALIGN_BOTTOM_LEFT=33;cc.ALIGN_LEFT=49;cc.ALIGN_TOP_LEFT=17;cc.PVRHaveAlphaPremultiplied_=!1;
cc._renderType===cc._RENDER_TYPE_CANVAS?cc.Texture2D=cc.Class.extend({_contentSize:null,_isLoaded:!1,_htmlElementObj:null,_loadedEventListeners:null,url:null,ctor:function(){this._contentSize=cc.size(0,0);this._isLoaded=!1;this._htmlElementObj=null},getPixelsWide:function(){return this._contentSize.width},getPixelsHigh:function(){return this._contentSize.height},getContentSize:function(){var a=cc.contentScaleFactor();return cc.size(this._contentSize.width/a,this._contentSize.height/a)},_getWidth:function(){return this._contentSize.width/
cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(a){a&&(this._htmlElementObj=a)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._isLoaded},handleLoadedTexture:function(){if(!this._isLoaded){if(!this._htmlElementObj){var a=cc.loader.getRes(this.url);if(!a)return;this.initWithElement(a)}this._isLoaded=!0;a=this._htmlElementObj;
this._contentSize.width=a.width;this._contentSize.height=a.height;this._callLoadedEventCallbacks()}},description:function(){return"\x3ccc.Texture2D | width \x3d "+this._contentSize.width+" height "+this._contentSize.height+"\x3e"},initWithData:function(a,b,d,e,f){return!1},initWithImage:function(a){return!1},initWithString:function(a,b,d,e,f,g){return!1},releaseTexture:function(){},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(a){},getMaxT:function(){return 1},setMaxT:function(a){},
getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(a){},hasPremultipliedAlpha:function(){return!1},hasMipmaps:function(){return!1},releaseData:function(a){},keepData:function(a,b){return a},drawAtPoint:function(a){},drawInRect:function(a){},initWithETCFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithETCFile);return!1},initWithPVRFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithPVRFile);return!1},initWithPVRTCData:function(a,b,d,e,
f,g){cc.log(cc._LogInfos.Texture2D_initWithPVRTCData);return!1},setTexParameters:function(a){},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(a){return-1},addLoadedEventListener:function(a,b){this._loadedEventListeners||(this._loadedEventListeners=[]);this._loadedEventListeners.push({eventCallback:a,eventTarget:b})},removeLoadedEventListener:function(a){if(this._loadedEventListeners)for(var b=
this._loadedEventListeners,d=0;d<b.length;d++)b[d].eventTarget==a&&b.splice(d,1)},_callLoadedEventCallbacks:function(){if(this._loadedEventListeners){for(var a=this._loadedEventListeners,b=0,d=a.length;b<d;b++){var e=a[b];e.eventCallback.call(e.eventTarget,this)}a.length=0}}}):(cc.assert("function"===typeof cc._tmp.WebGLTexture2D,cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTexture2D(),delete cc._tmp.WebGLTexture2D);
cc.assert("function"===typeof cc._tmp.PrototypeTexture2D,cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTexture2D();delete cc._tmp.PrototypeTexture2D;cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1E3*Math.random(),_loadedTexturesBefore:{},_initializingRenderer:function(){var a,b=this._loadedTexturesBefore,d=this._textures;for(a in b){var e=b[a];e.handleLoadedTexture();d[a]=e}this._loadedTexturesBefore={}},addPVRTCImage:function(a){cc.log(cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(a){cc.log(cc._LogInfos.textureCache_addETCImage)},description:function(){return"\x3cTextureCache | Number of textures \x3d "+
this._textures.length+"\x3e"},textureForKey:function(a){return this._textures[a]||this._textures[cc.loader._aliases[a]]},getKeyByTexture:function(a){for(var b in this._textures)if(this._textures[b]==a)return b;return null},_generalTextureKey:function(){this._textureKeySeq++;return"_textureKey_"+this._textureKeySeq},getTextureColors:function(a){var b=this.getKeyByTexture(a);b||(b=a instanceof HTMLImageElement?a.src:this._generalTextureKey());this._textureColorsCache[b]||(this._textureColorsCache[b]=
cc.generateTextureCacheForColor(a));return this._textureColorsCache[b]},addPVRImage:function(a){cc.log(cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var a=this._textures,b;for(b in a)a[b]&&a[b].releaseTexture();this._textures={}},removeTexture:function(a){if(a){var b=this._textures,d;for(d in b)b[d]==a&&(b[d].releaseTexture(),delete b[d])}},removeTextureForKey:function(a){null!=a&&this._textures[a]&&delete this._textures[a]},cacheImage:function(a,b){if(b instanceof cc.Texture2D)this._textures[a]=
b;else{var d=new cc.Texture2D;d.initWithElement(b);d.handleLoadedTexture();this._textures[a]=d}},addUIImage:function(a,b){cc.assert(a,cc._LogInfos.textureCache_addUIImage_2);if(b&&this._textures[b])return this._textures[b];var d=new cc.Texture2D;d.initWithImage(a);null!=b&&null!=d?this._textures[b]=d:cc.log(cc._LogInfos.textureCache_addUIImage);return d},dumpCachedTextureInfo:function(){var a=0,b=0,d=this._textures,e;for(e in d){var f=d[e];a++;f.getHtmlElementObj()instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo,
e,f.getHtmlElementObj().src,f.pixelsWidth,f.pixelsHeight):cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,e,f.pixelsWidth,f.pixelsHeight);b+=f.pixelsWidth*f.pixelsHeight*4}d=this._textureColorsCache;for(e in d){var f=d[e],g;for(g in f){var h=f[g];a++;cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,e,h.width,h.height);b+=h.width*h.height*4}}cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_3,a,b/1024,(b/1048576).toFixed(2))},_clear:function(){this._textures={};this._textureColorsCache=
{};this._textureKeySeq=0|1E3*Math.random();this._loadedTexturesBefore={}}};
cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.textureCache,_p.handleLoadedTexture=function(a){var b=this._textures,d=b[a];d||(d=b[a]=new cc.Texture2D,d.url=a);d.handleLoadedTexture()},_p.addImage=function(a,b,d){cc.assert(a,cc._LogInfos.Texture2D_addImage);var e=this._textures,f=e[a]||e[cc.loader._aliases[a]];if(f)return b&&b.call(d),f;f=e[a]=new cc.Texture2D;f.url=a;cc.loader.getRes(a)?f.handleLoadedTexture():cc.loader._checkIsImageURL(a)?cc.loader.load(a,function(a){b&&b.call(d)}):cc.loader.cache[a]=
cc.loader.loadImg(a,function(d,e){if(d)return b?b(d):d;cc.textureCache.handleLoadedTexture(a);b&&b(null,e)});return f},_p=null):(cc.assert("function"===typeof cc._tmp.WebGLTextureCache,cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureCache(),delete cc._tmp.WebGLTextureCache);cc.TextureAtlas=cc.Class.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(a,b){this._buffersVBO=[];"string"==typeof a?this.initWithFile(a,b):a instanceof cc.Texture2D&&this.initWithTexture(a,b)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(a){this.texture=a},setDirty:function(a){this.dirty=
a},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(a){this._quads=a},_copyQuadsToTextureAtlas:function(a,b){if(a)for(var d=0;d<a.length;d++)this._setQuadToArray(a[d],b+d)},_setQuadToArray:function(a,b){var d=this._quads;d[b]?(d[b].bl=a.bl,d[b].br=a.br,d[b].tl=a.tl,d[b].tr=a.tr):d[b]=new cc.V3F_C4B_T2F_Quad(a.tl,a.bl,a.tr,a.br,this._quadsArrayBuffer,b*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT)},description:function(){return"\x3ccc.TextureAtlas | totalQuads \x3d"+
this._totalQuads+"\x3e"},_setupIndices:function(){if(0!==this._capacity)for(var a=this._indices,b=this._capacity,d=0;d<b;d++)cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(a[6*d+0]=4*d+0,a[6*d+1]=4*d+0,a[6*d+2]=4*d+2,a[6*d+3]=4*d+1,a[6*d+4]=4*d+3,a[6*d+5]=4*d+3):(a[6*d+0]=4*d+0,a[6*d+1]=4*d+1,a[6*d+2]=4*d+2,a[6*d+3]=4*d+3,a[6*d+4]=4*d+2,a[6*d+5]=4*d+1)},_setupVBO:function(){var a=cc._renderContext;this._buffersVBO[0]=a.createBuffer();this._buffersVBO[1]=a.createBuffer();this._quadsWebBuffer=a.createBuffer();
this._mapBuffers()},_mapBuffers:function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._quadsWebBuffer);a.bufferData(a.ARRAY_BUFFER,this._quadsArrayBuffer,a.DYNAMIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indices,a.STATIC_DRAW)},initWithFile:function(a,b){var d=cc.textureCache.addImage(a);if(d)return this.initWithTexture(d,b);cc.log(cc._LogInfos.TextureAtlas_initWithFile,a);return!1},initWithTexture:function(a,b){cc.assert(a,
cc._LogInfos.TextureAtlas_initWithTexture);this._capacity=b|=0;this._totalQuads=0;this.texture=a;this._quads=[];this._indices=new Uint16Array(6*b);var d=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._quadsArrayBuffer=new ArrayBuffer(d*b);this._quadsReader=new Uint8Array(this._quadsArrayBuffer);if((!this._quads||!this._indices)&&0<b)return!1;for(var e=this._quads,f=0;f<b;f++)e[f]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,f*d);this._setupIndices();this._setupVBO();return this.dirty=
!0},updateQuad:function(a,b){cc.assert(a,cc._LogInfos.TextureAtlas_updateQuad);cc.assert(0<=b&&b<this._capacity,cc._LogInfos.TextureAtlas_updateQuad_2);this._totalQuads=Math.max(b+1,this._totalQuads);this._setQuadToArray(a,b);this.dirty=!0},insertQuad:function(a,b){cc.assert(b<this._capacity,cc._LogInfos.TextureAtlas_insertQuad_2);this._totalQuads++;if(this._totalQuads>this._capacity)cc.log(cc._LogInfos.TextureAtlas_insertQuad);else{var d=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,e=b*d,f=(this._totalQuads-
1-b)*d;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*d);this._quadsReader.set(this._quadsReader.subarray(e,e+f),e+d);this._setQuadToArray(a,b);this.dirty=!0}},insertQuads:function(a,b,d){d=d||a.length;cc.assert(b+d<=this._capacity,cc._LogInfos.TextureAtlas_insertQuads);var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads+=d;if(this._totalQuads>this._capacity)cc.log(cc._LogInfos.TextureAtlas_insertQuad);else{var f=b*
e,g=(this._totalQuads-1-b-d)*e,h=this._totalQuads-1-d,k;for(k=0;k<d;k++)this._quads[h+k]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*e);this._quadsReader.set(this._quadsReader.subarray(f,f+g),f+e*d);for(k=0;k<d;k++)this._setQuadToArray(a[k],b+k);this.dirty=!0}},insertQuadFromIndex:function(a,b){if(a!==b){cc.assert(0<=b||b<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex);cc.assert(0<=a||a<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex_2);
var d=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,e=this._quadsReader,f=e.subarray(a*d,d),g;a>b?(g=b*d,e.set(e.subarray(g,g+(a-b)*d),g+d),e.set(f,g)):(g=(a+1)*d,e.set(e.subarray(g,g+(b-a)*d),g-d),e.set(f,b*d));this.dirty=!0}},removeQuadAtIndex:function(a){cc.assert(a<this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadAtIndex);var b=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads--;this._quads.length=this._totalQuads;if(a!==this._totalQuads){var d=(a+1)*b;this._quadsReader.set(this._quadsReader.subarray(d,
d+(this._totalQuads-a)*b),d-b)}this.dirty=!0},removeQuadsAtIndex:function(a,b){cc.assert(a+b<=this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadsAtIndex);this._totalQuads-=b;if(a!==this._totalQuads){var d=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,e=(a+b)*d,f=a*d;this._quadsReader.set(this._quadsReader.subarray(e,e+(this._totalQuads-a)*d),f)}this.dirty=!0},removeAllQuads:function(){this._totalQuads=this._quads.length=0},_setDirty:function(a){this.dirty=a},resizeCapacity:function(a){if(a==this._capacity)return!0;
var b=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,d=this._capacity;this._totalQuads=Math.min(this._totalQuads,a);var e=this._capacity=0|a,f=this._totalQuads;if(null==this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(b*e),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),a=0;a<e;a++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,a*b);else{var g,h,k=this._quads;if(e>d){g=[];h=new ArrayBuffer(b*e);for(a=0;a<f;a++)g[a]=new cc.V3F_C4B_T2F_Quad(k[a].tl,
k[a].bl,k[a].tr,k[a].br,h,a*b);for(;a<e;a++)g[a]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,h,a*b)}else for(f=Math.max(f,e),g=[],h=new ArrayBuffer(b*e),a=0;a<f;a++)g[a]=new cc.V3F_C4B_T2F_Quad(k[a].tl,k[a].bl,k[a].tr,k[a].br,h,a*b);this._quadsReader=new Uint8Array(h);this._quads=g;this._quadsArrayBuffer=h}null==this._indices?this._indices=new Uint16Array(6*e):e>d?(b=new Uint16Array(6*e),b.set(this._indices,0),this._indices=b):this._indices=this._indices.subarray(0,6*e);this._setupIndices();this._mapBuffers();
return this.dirty=!0},increaseTotalQuadsWith:function(a){this._totalQuads+=a},moveQuadsFromIndex:function(a,b,d){if(void 0===d){if(d=b,b=this._totalQuads-a,cc.assert(d+(this._totalQuads-a)<=this._capacity,cc._LogInfos.TextureAtlas_moveQuadsFromIndex),0===b)return}else if(cc.assert(d+b<=this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_2),cc.assert(a<this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_3),a==d)return;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,f=a*e,g=b*e,h=this._quadsReader,
k=h.subarray(f,f+g),m=d*e;d<a?(b=d*e,h.set(h.subarray(b,b+(a-d)*e),b+g)):(b=(a+b)*e,h.set(h.subarray(b,b+(d-a)*e),f));h.set(k,m);this.dirty=!0},fillWithEmptyQuadsFromIndex:function(a,b){for(var d=b*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,e=new Uint8Array(this._quadsArrayBuffer,a*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,d),f=0;f<d;f++)e[f]=0},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var a=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&a.deleteBuffer(this._buffersVBO[0]),
this._buffersVBO[1]&&a.deleteBuffer(this._buffersVBO[1]));this._quadsWebBuffer&&a.deleteBuffer(this._quadsWebBuffer)}});_p=cc.TextureAtlas.prototype;cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads);cc.defineGetterSetter(_p,"capacity",_p.getCapacity);cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads);cc.TextureAtlas.create=function(a,b){return new cc.TextureAtlas(a,b)};
cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc.assert("function"===typeof cc._tmp.WebGLTextureAtlas,cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureAtlas(),delete cc._tmp.WebGLTextureAtlas);cc.assert("function"===typeof cc._tmp.PrototypeTextureAtlas,cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTextureAtlas();delete cc._tmp.PrototypeTextureAtlas;cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this);this._ignoreAnchorPointForPosition=!0;this.setAnchorPoint(0.5,0.5);this.setContentSize(cc.director.getWinSize())}});cc.Scene.create=function(){return new cc.Scene};cc.LoaderScene=cc.Scene.extend({_interval:null,_length:0,_count:0,_label:null,_className:"LoaderScene",init:function(){var a=this,b=200,d=a._bgLayer=cc.LayerColor.create(cc.color(32,32,32,255));d.setPosition(cc.visibleRect.bottomLeft);a.addChild(d,0);var e=24,f=-b/2+100;cc._loaderImage&&(cc.loader.loadImg(cc._loaderImage,{isCrossOrigin:!1},function(d,e){b=e.height;a._initStage(e,cc.visibleRect.center)}),e=14,f=-b/2-10);e=a._label=cc.LabelTTF.create("\u52a0\u8f7d\u4e2d... 0%","Arial",e);e.setPosition(cc.pAdd(cc.visibleRect.center,
cc.p(0,f)));e.setColor(cc.color(180,180,180));d.addChild(this._label,10);return!0},_initStage:function(a,b){var d=this._texture2d=new cc.Texture2D;d.initWithElement(a);d.handleLoadedTexture();d=this._logo=cc.Sprite.create(d);d.setScale(cc.contentScaleFactor());d.x=b.x;d.y=b.y;this._bgLayer.addChild(d,10)},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.schedule(this._startLoading,0.3)},onExit:function(){cc.Node.prototype.onExit.call(this);this._label.setString("\u52a0\u8f7d\u4e2d... 0%")},
initWithResources:function(a,b){"string"==typeof a&&(a=[a]);this.resources=a||[];this.cb=b},_startLoading:function(){var a=this;a.unschedule(a._startLoading);var b=a.resources;a._length=b.length;a._count=0;cc.loader.load(b,function(b,e){a._count=e},function(){a.cb&&a.cb()});a.schedule(a._updatePercent)},_updatePercent:function(){var a=this._count,b=this._length,d;d=Math.min(a/b*100|0,100);this._label.setString("\u52a0\u8f7d\u4e2d... "+d+"%");a>=b&&this.unschedule(this._updatePercent)}});
cc.LoaderScene.preload=function(a,b){var d=cc;d.loaderScene||(d.loaderScene=new cc.LoaderScene,d.loaderScene.init());d.loaderScene.initWithResources(a,b);cc.director.runScene(d.loaderScene);return d.loaderScene};cc._tmp.LayerDefineForWebGL=function(){var a=cc.Layer.prototype;a.bake=function(){};a.unbake=function(){};a.visit=cc.Node.prototype.visit};
cc._tmp.WebGLLayerColor=function(){var a=cc.LayerColor.prototype;a._squareVertices=null;a._squareColors=null;a._verticesFloat32Buffer=null;a._colorsUint8Buffer=null;a._squareVerticesAB=null;a._squareColorsAB=null;a.ctor=function(a,d,e){this._squareVerticesAB=new ArrayBuffer(32);this._squareColorsAB=new ArrayBuffer(16);var f=this._squareVerticesAB,g=this._squareColorsAB,h=cc.Vertex2F.BYTES_PER_ELEMENT,k=cc.Color.BYTES_PER_ELEMENT;this._squareVertices=[new cc.Vertex2F(0,0,f,0),new cc.Vertex2F(0,0,f,
h),new cc.Vertex2F(0,0,f,2*h),new cc.Vertex2F(0,0,f,3*h)];this._squareColors=[cc.color(0,0,0,255,g,0),cc.color(0,0,0,255,g,k),cc.color(0,0,0,255,g,2*k),cc.color(0,0,0,255,g,3*k)];this._verticesFloat32Buffer=cc._renderContext.createBuffer();this._colorsUint8Buffer=cc._renderContext.createBuffer();cc.Layer.prototype.ctor.call(this);this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);cc.LayerColor.prototype.init.call(this,a,d,e)};a.setContentSize=function(a,d){var e=this._squareVertices;void 0===
d?(e[1].x=a.width,e[2].y=a.height,e[3].x=a.width,e[3].y=a.height):(e[1].x=a,e[2].y=d,e[3].x=a,e[3].y=d);this._bindLayerVerticesBufferData();cc.Layer.prototype.setContentSize.call(this,a,d)};a._setWidth=function(a){var d=this._squareVertices;d[1].x=a;d[3].x=a;this._bindLayerVerticesBufferData();cc.Layer.prototype._setWidth.call(this,a)};a._setHeight=function(a){var d=this._squareVertices;d[2].y=a;d[3].y=a;this._bindLayerVerticesBufferData();cc.Layer.prototype._setHeight.call(this,a)};a._updateColor=
function(){for(var a=this._displayedColor,d=this._displayedOpacity,e=this._squareColors,f=0;4>f;f++)e[f].r=a.r,e[f].g=a.g,e[f].b=a.b,e[f].a=d;this._bindLayerColorsBufferData()};a.draw=function(a){a=a||cc._renderContext;cc.nodeDrawSetup(this);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR);a.bindBuffer(a.ARRAY_BUFFER,this._verticesFloat32Buffer);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,this._colorsUint8Buffer);
a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,0,0);cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst);a.drawArrays(a.TRIANGLE_STRIP,0,4)};a._bindLayerVerticesBufferData=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._verticesFloat32Buffer);a.bufferData(a.ARRAY_BUFFER,this._squareVerticesAB,a.STATIC_DRAW)};a._bindLayerColorsBufferData=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._colorsUint8Buffer);a.bufferData(a.ARRAY_BUFFER,this._squareColorsAB,
a.STATIC_DRAW)}};
cc._tmp.WebGLLayerGradient=function(){var a=cc.LayerGradient.prototype;a.draw=cc.LayerColor.prototype.draw;a._updateColor=function(){var a=this._alongVector,d=cc.pLength(a);if(0!==d){var e=Math.sqrt(2),a=cc.p(a.x/d,a.y/d);this._compressedInterpolation&&(d=1/(Math.abs(a.x)+Math.abs(a.y)),a=cc.pMult(a,d*e));var f=this._displayedOpacity/255,d=this._displayedColor,g=this._endColor,d={r:d.r,g:d.g,b:d.b,a:this._startOpacity*f},f={r:g.r,g:g.g,b:g.b,a:this._endOpacity*f},h=this._squareColors,g=h[0],k=h[1],
m=h[2],h=h[3];g.r=f.r+(e+a.x+a.y)/(2*e)*(d.r-f.r);g.g=f.g+(e+a.x+a.y)/(2*e)*(d.g-f.g);g.b=f.b+(e+a.x+a.y)/(2*e)*(d.b-f.b);g.a=f.a+(e+a.x+a.y)/(2*e)*(d.a-f.a);k.r=f.r+(e-a.x+a.y)/(2*e)*(d.r-f.r);k.g=f.g+(e-a.x+a.y)/(2*e)*(d.g-f.g);k.b=f.b+(e-a.x+a.y)/(2*e)*(d.b-f.b);k.a=f.a+(e-a.x+a.y)/(2*e)*(d.a-f.a);m.r=f.r+(e+a.x-a.y)/(2*e)*(d.r-f.r);m.g=f.g+(e+a.x-a.y)/(2*e)*(d.g-f.g);m.b=f.b+(e+a.x-a.y)/(2*e)*(d.b-f.b);m.a=f.a+(e+a.x-a.y)/(2*e)*(d.a-f.a);h.r=f.r+(e-a.x-a.y)/(2*e)*(d.r-f.r);h.g=f.g+(e-a.x-a.y)/
(2*e)*(d.g-f.g);h.b=f.b+(e-a.x-a.y)/(2*e)*(d.b-f.b);h.a=f.a+(e-a.x-a.y)/(2*e)*(d.a-f.a);this._bindLayerColorsBufferData()}}};cc._tmp.PrototypeLayerColor=function(){var a=cc.LayerColor.prototype;cc.defineGetterSetter(a,"width",a._getWidth,a._setWidth);cc.defineGetterSetter(a,"height",a._getHeight,a._setHeight)};
cc._tmp.PrototypeLayerGradient=function(){var a=cc.LayerGradient.prototype;cc.defineGetterSetter(a,"startColor",a.getStartColor,a.setStartColor);cc.defineGetterSetter(a,"endColor",a.getEndColor,a.setEndColor);cc.defineGetterSetter(a,"startOpacity",a.getStartOpacity,a.setStartOpacity);cc.defineGetterSetter(a,"endOpacity",a.getEndOpacity,a.setEndOpacity);cc.defineGetterSetter(a,"vector",a.getVector,a.setVector)};cc.Layer=cc.Node.extend({_isBaked:!1,_bakeSprite:null,_className:"Layer",ctor:function(){var a=cc.Node.prototype;a.ctor.call(this);this._ignoreAnchorPointForPosition=!0;a.setAnchorPoint.call(this,0.5,0.5);a.setContentSize.call(this,cc.winSize)},init:function(){this._ignoreAnchorPointForPosition=!0;this.setAnchorPoint(0.5,0.5);this.setContentSize(cc.winSize);this.cascadeColor=this.cascadeOpacity=!1;return!0},bake:null,unbake:null,isBaked:function(){return this._isBaked},visit:null});
cc.Layer.create=function(){return new cc.Layer};
if(cc._renderType===cc._RENDER_TYPE_CANVAS){var p=cc.Layer.prototype;p.bake=function(){if(!this._isBaked){this._isBaked=this._cacheDirty=!0;this._cachedParent=this;for(var a=this._children,b=0,d=a.length;b<d;b++)a[b]._setCachedParent(this);this._bakeSprite||(this._bakeSprite=new cc.BakeSprite)}};p.unbake=function(){if(this._isBaked){this._isBaked=!1;this._cacheDirty=!0;this._cachedParent=null;for(var a=this._children,b=0,d=a.length;b<d;b++)a[b]._setCachedParent(null)}};p.visit=function(a){if(this._isBaked){a=
a||cc._renderContext;var b,d=this._children,e=d.length;if(this._visible&&0!==e){var f=this._bakeSprite;a.save();this.transform(a);if(this._cacheDirty){b=this._getBoundingBoxForBake();b.width|=0;b.height|=0;var g=f.getCacheContext();f.resetCanvasSize(b.width,b.height);g.translate(0-b.x,b.height+b.y);var h=f.getAnchorPointInPoints();f.setPosition(h.x+b.x,h.y+b.y);this.sortAllChildren();cc.view._setScaleXYForRenderTexture();for(b=0;b<e;b++)d[b].visit(g);cc.view._resetScale();this._cacheDirty=!1}f.visit(a);
this.arrivalOrder=0;a.restore()}}else cc.Node.prototype.visit.call(this,a)};p._getBoundingBoxForBake=function(){var a=null;if(!this._children||0===this._children.length)return cc.rect(0,0,10,10);for(var b=this._children,d=0;d<b.length;d++){var e=b[d];e&&e._visible&&(a?(e=e._getBoundingBoxToCurrentNode())&&(a=cc.rectUnion(a,e)):a=e._getBoundingBoxToCurrentNode())}return a};p=null}else cc.assert("function"===typeof cc._tmp.LayerDefineForWebGL,cc._LogInfos.MissingFile,"CCLayerWebGL.js"),cc._tmp.LayerDefineForWebGL(),
delete cc._tmp.LayerDefineForWebGL;
cc.LayerColor=cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(a,b){this.width=a;this.height=b},changeWidth:function(a){this.width=a},changeHeight:function(a){this.height=a},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1},setColor:function(a){cc.Layer.prototype.setColor.call(this,a);this._updateColor()},setOpacity:function(a){cc.Layer.prototype.setOpacity.call(this,a);this._updateColor()},
_isLighterMode:!1,ctor:null,init:function(a,b,d){cc._renderType!==cc._RENDER_TYPE_CANVAS&&(this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR));var e=cc.director.getWinSize();a=a||cc.color(0,0,0,255);b=void 0===b?e.width:b;d=void 0===d?e.height:d;e=this._displayedColor;e.r=a.r;e.g=a.g;e.b=a.b;e=this._realColor;e.r=a.r;e.g=a.g;e.b=a.b;this._realOpacity=this._displayedOpacity=a.a;a=cc.LayerColor.prototype;a.setContentSize.call(this,b,d);a._updateColor.call(this);return!0},setBlendFunc:function(a,
b){this._blendFunc=void 0===b?a:{src:a,dst:b};cc._renderType===cc._RENDER_TYPE_CANVAS&&(this._isLighterMode=this._blendFunc&&1==this._blendFunc.src&&771==this._blendFunc.dst)},_setWidth:null,_setHeight:null,_updateColor:null,updateDisplayedColor:function(a){cc.Layer.prototype.updateDisplayedColor.call(this,a);this._updateColor()},updateDisplayedOpacity:function(a){cc.Layer.prototype.updateDisplayedOpacity.call(this,a);this._updateColor()},draw:null});
cc.LayerColor.create=function(a,b,d){return new cc.LayerColor(a,b,d)};
cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.LayerColor.prototype,_p.ctor=function(a,b,d){cc.Layer.prototype.ctor.call(this);this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);cc.LayerColor.prototype.init.call(this,a,b,d)},_p._setWidth=cc.Layer.prototype._setWidth,_p._setHeight=cc.Layer.prototype._setHeight,_p._updateColor=function(){},_p.draw=function(a){a=a||cc._renderContext;var b=cc.view,d=this._displayedColor;a.fillStyle="rgba("+(0|d.r)+","+(0|d.g)+","+(0|d.b)+","+this._displayedOpacity/
255+")";a.fillRect(0,0,this.width*b.getScaleX(),-this.height*b.getScaleY());cc.g_NumberOfDraws++},_p.visit=function(a){if(this._isBaked){a=a||cc._renderContext;var b,d=this._children,e=d.length;if(this._visible){var f=this._bakeSprite;a.save();this.transform(a);if(this._cacheDirty){b=this._getBoundingBoxForBake();b.width|=0;b.height|=0;var g=f.getCacheContext();f.resetCanvasSize(b.width,b.height);var h=f.getAnchorPointInPoints(),k=this._position;if(this._ignoreAnchorPointForPosition)g.translate(0-
b.x+k.x,b.height+b.y-k.y),f.setPosition(h.x+b.x-k.x,h.y+b.y-k.y);else{var m=this.getAnchorPointInPoints(),n=k.x-m.x,k=k.y-m.y;g.translate(0-b.x+n,b.height+b.y-k);f.setPosition(h.x+b.x-n,h.y+b.y-k)}cc.view._setScaleXYForRenderTexture();if(0<e){this.sortAllChildren();for(b=0;b<e;b++)if(h=d[b],0>h._localZOrder)h.visit(g);else break;for(this.draw(g);b<e;b++)d[b].visit(g)}else this.draw(g);cc.view._resetScale();this._cacheDirty=!1}f.visit(a);this.arrivalOrder=0;a.restore()}}else cc.Node.prototype.visit.call(this,
a)},_p._getBoundingBoxForBake=function(){var a=cc.rect(0,0,this._contentSize.width,this._contentSize.height),b=this.nodeToWorldTransform(),a=cc.rectApplyAffineTransform(a,this.nodeToWorldTransform());if(!this._children||0===this._children.length)return a;for(var d=this._children,e=0;e<d.length;e++){var f=d[e];f&&f._visible&&(f=f._getBoundingBoxToCurrentNode(b),a=cc.rectUnion(a,f))}return a},_p=null):(cc.assert("function"===typeof cc._tmp.WebGLLayerColor,cc._LogInfos.MissingFile,"CCLayerWebGL.js"),
cc._tmp.WebGLLayerColor(),delete cc._tmp.WebGLLayerColor);cc.assert("function"===typeof cc._tmp.PrototypeLayerColor,cc._LogInfos.MissingFile,"CCLayerPropertyDefine.js");cc._tmp.PrototypeLayerColor();delete cc._tmp.PrototypeLayerColor;
cc.LayerGradient=cc.LayerColor.extend({_startColor:null,_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_gradientStartPoint:null,_gradientEndPoint:null,_className:"LayerGradient",ctor:function(a,b,d){cc.LayerColor.prototype.ctor.call(this);this._startColor=cc.color(0,0,0,255);this._endColor=cc.color(0,0,0,255);this._alongVector=cc.p(0,-1);this._endOpacity=this._startOpacity=255;this._gradientStartPoint=cc.p(0,0);this._gradientEndPoint=cc.p(0,0);cc.LayerGradient.prototype.init.call(this,
a,b,d)},init:function(a,b,d){a=a||cc.color(0,0,0,255);b=b||cc.color(0,0,0,255);d=d||cc.p(0,-1);var e=this._startColor,f=this._endColor;e.r=a.r;e.g=a.g;e.b=a.b;this._startOpacity=a.a;f.r=b.r;f.g=b.g;f.b=b.b;this._endOpacity=b.a;this._alongVector=d;this._compressedInterpolation=!0;this._gradientStartPoint=cc.p(0,0);this._gradientEndPoint=cc.p(0,0);cc.LayerColor.prototype.init.call(this,cc.color(a.r,a.g,a.b,255));cc.LayerGradient.prototype._updateColor.call(this);return!0},setContentSize:function(a,
b){cc.LayerColor.prototype.setContentSize.call(this,a,b);this._updateColor()},_setWidth:function(a){cc.LayerColor.prototype._setWidth.call(this,a);this._updateColor()},_setHeight:function(a){cc.LayerColor.prototype._setHeight.call(this,a);this._updateColor()},getStartColor:function(){return this._realColor},setStartColor:function(a){this.color=a},setEndColor:function(a){this._endColor=a;this._updateColor()},getEndColor:function(){return this._endColor},setStartOpacity:function(a){this._startOpacity=
a;this._updateColor()},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(a){this._endOpacity=a;this._updateColor()},getEndOpacity:function(){return this._endOpacity},setVector:function(a){this._alongVector.x=a.x;this._alongVector.y=a.y;this._updateColor()},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(a){this._compressedInterpolation=
a;this._updateColor()},_draw:null,_updateColor:null});cc.LayerGradient.create=function(a,b,d){return new cc.LayerGradient(a,b,d)};
cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.LayerGradient.prototype,_p.draw=function(a){a=a||cc._renderContext;this._isLighterMode&&(a.globalCompositeOperation="lighter");a.save();var b=this._displayedOpacity/255,d=cc.view.getScaleX(),e=cc.view.getScaleY(),f=this.width*d,g=this.height*e,d=a.createLinearGradient(this._gradientStartPoint.x*d,this._gradientStartPoint.y*e,this._gradientEndPoint.x*d,this._gradientEndPoint.y*e),e=this._displayedColor,h=this._endColor;d.addColorStop(0,"rgba("+Math.round(e.r)+
","+Math.round(e.g)+","+Math.round(e.b)+","+(this._startOpacity/255*b).toFixed(4)+")");d.addColorStop(1,"rgba("+Math.round(h.r)+","+Math.round(h.g)+","+Math.round(h.b)+","+(this._endOpacity/255*b).toFixed(4)+")");a.fillStyle=d;a.fillRect(0,0,f,-g);0!=this._rotation&&a.rotate(this._rotationRadians);a.restore();cc.g_NumberOfDraws++},_p._updateColor=function(){var a=this._alongVector,b=0.5*this.width,d=0.5*this.height;this._gradientStartPoint.x=b*-a.x+b;this._gradientStartPoint.y=d*a.y-d;this._gradientEndPoint.x=
b*a.x+b;this._gradientEndPoint.y=d*-a.y-d},_p=null):(cc.assert("function"===typeof cc._tmp.WebGLLayerGradient,cc._LogInfos.MissingFile,"CCLayerWebGL.js"),cc._tmp.WebGLLayerGradient(),delete cc._tmp.WebGLLayerGradient);cc.assert("function"===typeof cc._tmp.PrototypeLayerGradient,cc._LogInfos.MissingFile,"CCLayerPropertyDefine.js");cc._tmp.PrototypeLayerGradient();delete cc._tmp.PrototypeLayerGradient;
cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(a){cc.Layer.prototype.ctor.call(this);a instanceof Array?cc.LayerMultiplex.prototype.initWithLayers.call(this,a):cc.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(a){0<a.length&&null==a[a.length-1]&&cc.log(cc._LogInfos.LayerMultiplex_initWithLayers);this._layers=a;this._enabledLayer=0;this.addChild(this._layers[this._enabledLayer]);
return!0},switchTo:function(a){a>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=a,this.addChild(this._layers[a]))},switchToAndReleaseMe:function(a){a>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=a,this.addChild(this._layers[a]))},addLayer:function(a){a?this._layers.push(a):
cc.log(cc._LogInfos.LayerMultiplex_addLayer)}});cc.LayerMultiplex.create=function(){return new cc.LayerMultiplex(Array.prototype.slice.call(arguments))};cc._tmp.WebGLSprite=function(){var a=cc.Sprite.prototype;a._spriteFrameLoadedCallback=function(a){this.setNodeDirty(!0);this.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize());this._callLoadedEventCallbacks()};a.setOpacityModifyRGB=function(a){this._opacityModifyRGB!==a&&(this._opacityModifyRGB=a,this.updateColor())};a.updateDisplayedOpacity=function(a){cc.Node.prototype.updateDisplayedOpacity.call(this,a);this.updateColor()};a.ctor=function(a,d,e){cc.Node.prototype.ctor.call(this);this._shouldBeHidden=
!1;this._offsetPosition=cc.p(0,0);this._unflippedOffsetPositionFromCenter=cc.p(0,0);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._rect=cc.rect(0,0,0,0);this._quad=new cc.V3F_C4B_T2F_Quad;this._quadWebBuffer=cc._renderContext.createBuffer();this._textureLoaded=this._quadDirty=!0;this._softInit(a,d,e)};a.setBlendFunc=function(a,d){var e=this._blendFunc;void 0===d?(e.src=a.src,e.dst=a.dst):(e.src=a,e.dst=d)};a.init=function(){if(0<arguments.length)return this.initWithFile(arguments[0],arguments[1]);
cc.Node.prototype.init.call(this);this.dirty=this._recursiveDirty=!1;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this.texture=null;this._textureLoaded=!0;this._flippedX=this._flippedY=!1;this.anchorY=this.anchorX=0.5;this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;var a={r:255,g:255,b:255,a:255};this._quad.bl.colors=a;this._quad.br.colors=a;this._quad.tl.colors=a;this._quad.tr.colors=a;this._quadDirty=!0;this.setTextureRect(cc.rect(0,
0,0,0),!1,cc.size(0,0));return!0};a.initWithTexture=function(a,d,e){cc.assert(0!=arguments.length,cc._LogInfos.Sprite_initWithTexture);e=e||!1;if(!cc.Node.prototype.init.call(this))return!1;this._batchNode=null;this.dirty=this._recursiveDirty=!1;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this._flippedX=this._flippedY=!1;this.anchorY=this.anchorX=0.5;this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;var f=cc.color(255,255,255,255),
g=this._quad;g.bl.colors=f;g.br.colors=f;g.tl.colors=f;g.tr.colors=f;this._textureLoaded=f=a.isLoaded();if(!f)return this._rectRotated=e||!1,d&&(f=this._rect,f.x=d.x,f.y=d.y,f.width=d.width,f.height=d.height),a.addLoadedEventListener(this._textureLoadedCallback,this),!0;d||(d=cc.rect(0,0,a.width,a.height));a&&a.url&&(e?(f=d.x+d.height,g=d.y+d.width):(f=d.x+d.width,g=d.y+d.height),f>a.width&&cc.error(cc._LogInfos.RectWidth,a.url),g>a.height&&cc.error(cc._LogInfos.RectHeight,a.url));this.texture=a;
this.setTextureRect(d,e);this.batchNode=null;return this._quadDirty=!0};a._textureLoadedCallback=function(a){if(!this._textureLoaded){this._textureLoaded=!0;var d=this._rect;d?cc._rectEqualToZero(d)&&(d.width=a.width,d.height=a.height):d=cc.rect(0,0,a.width,a.height);this.texture=a;this.setTextureRect(d,this._rectRotated);this.batchNode=this._batchNode;this._quadDirty=!0;this._callLoadedEventCallbacks()}};a.setTextureRect=function(a,d,e){this._rectRotated=d||!1;this.setContentSize(e||a);this.setVertexRect(a);
this._setTextureCoords(a);a=this._unflippedOffsetPositionFromCenter;this._flippedX&&(a.x=-a.x);this._flippedY&&(a.y=-a.y);var f=this._rect;this._offsetPosition.x=a.x+(this._contentSize.width-f.width)/2;this._offsetPosition.y=a.y+(this._contentSize.height-f.height)/2;if(this._batchNode)this.dirty=!0;else{a=0+this._offsetPosition.x;d=0+this._offsetPosition.y;e=a+f.width;var f=d+f.height,g=this._quad;g.bl.vertices={x:a,y:d,z:0};g.br.vertices={x:e,y:d,z:0};g.tl.vertices={x:a,y:f,z:0};g.tr.vertices={x:e,
y:f,z:0};this._quadDirty=!0}};a.updateTransform=function(){if(this.dirty){var a=this._quad,d=this._parent;if(!this._visible||d&&d!=this._batchNode&&d._shouldBeHidden)a.br.vertices={x:0,y:0,z:0},a.tl.vertices={x:0,y:0,z:0},a.tr.vertices={x:0,y:0,z:0},a.bl.vertices={x:0,y:0,z:0},this._shouldBeHidden=!0;else{this._shouldBeHidden=!1;var e=this._transformToBatch=d&&d!=this._batchNode?cc.affineTransformConcat(this.nodeToParentTransform(),d._transformToBatch):this.nodeToParentTransform(),f=this._rect,d=
this._offsetPosition.x,g=this._offsetPosition.y,h=d+f.width,k=g+f.height,m=e.tx,n=e.ty,q=e.a,s=e.b,u=e.d,t=-e.c,e=d*q-g*t+m,f=d*s+g*u+n,v=h*q-g*t+m,g=h*s+g*u+n,w=h*q-k*t+m,h=h*s+k*u+n,m=d*q-k*t+m,d=d*s+k*u+n,k=this._vertexZ;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL||(e|=0,f|=0,v|=0,g|=0,w|=0,h|=0,m|=0,d|=0);a.bl.vertices={x:e,y:f,z:k};a.br.vertices={x:v,y:g,z:k};a.tl.vertices={x:m,y:d,z:k};a.tr.vertices={x:w,y:h,z:k}}this.textureAtlas.updateQuad(a,this.atlasIndex);this.dirty=this._recursiveDirty=!1}this._hasChildren&&
this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform);cc.SPRITE_DEBUG_DRAW&&(a=[cc.p(this._quad.bl.vertices.x,this._quad.bl.vertices.y),cc.p(this._quad.br.vertices.x,this._quad.br.vertices.y),cc.p(this._quad.tr.vertices.x,this._quad.tr.vertices.y),cc.p(this._quad.tl.vertices.x,this._quad.tl.vertices.y)],cc._drawingUtil.drawPoly(a,4,!0))};a.addChild=function(a,d,e){cc.assert(a,cc._LogInfos.Sprite_addChild_3);null==d&&(d=a._localZOrder);null==e&&(e=a.tag);if(this._batchNode){if(!(a instanceof
cc.Sprite)){cc.log(cc._LogInfos.Sprite_addChild);return}a.texture._webTextureObj!==this.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2);this._batchNode.appendChild(a);this._reorderChildDirty||this._setReorderChildDirtyRecursively()}cc.Node.prototype.addChild.call(this,a,d,e);this._hasChildren=!0};a.setOpacity=function(a){cc.Node.prototype.setOpacity.call(this,a);this.updateColor()};a.setColor=function(a){cc.Node.prototype.setColor.call(this,a);this.updateColor()};a.updateDisplayedColor=
function(a){cc.Node.prototype.updateDisplayedColor.call(this,a);this.updateColor()};a.setSpriteFrame=function(a){var d=this;"string"==typeof a&&(a=cc.spriteFrameCache.getSpriteFrame(a),cc.assert(a,cc._LogInfos.Sprite_setSpriteFrame));d.setNodeDirty(!0);var e=a.getOffset();d._unflippedOffsetPositionFromCenter.x=e.x;d._unflippedOffsetPositionFromCenter.y=e.y;e=a.getTexture();a.textureLoaded()||(d._textureLoaded=!1,a.addLoadedEventListener(function(a){d._textureLoaded=!0;var b=a.getTexture();b!=d._texture&&
(d.texture=b);d.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize());d._callLoadedEventCallbacks()},d));e!=d._texture&&(d.texture=e);d._rectRotated=a.isRotated();d.setTextureRect(a.getRect(),d._rectRotated,a.getOriginalSize())};a.isFrameDisplayed=function(a){return cc.rectEqualToRect(a.getRect(),this._rect)&&a.getTexture().getName()==this._texture.getName()&&cc.pointEqualToPoint(a.getOffset(),this._unflippedOffsetPositionFromCenter)};a.setBatchNode=function(a){if(this._batchNode=a)this._transformToBatch=
cc.affineTransformIdentity(),this.textureAtlas=this._batchNode.textureAtlas;else{this.atlasIndex=cc.Sprite.INDEX_NOT_INITIALIZED;this.textureAtlas=null;this.dirty=this._recursiveDirty=!1;a=this._offsetPosition.x;var d=this._offsetPosition.y,e=a+this._rect.width,f=d+this._rect.height,g=this._quad;g.bl.vertices={x:a,y:d,z:0};g.br.vertices={x:e,y:d,z:0};g.tl.vertices={x:a,y:f,z:0};g.tr.vertices={x:e,y:f,z:0};this._quadDirty=!0}};a.setTexture=function(a){a&&"string"===typeof a?(a=cc.textureCache.addImage(a),
this.setTexture(a),a=a.getContentSize(),this.setTextureRect(cc.rect(0,0,a.width,a.height))):(cc.assert(!a||a instanceof cc.Texture2D,cc._LogInfos.Sprite_setTexture_2),this._batchNode&&this._batchNode.texture!=a?cc.log(cc._LogInfos.Sprite_setTexture):(this.shaderProgram=a?cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR):cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR),this._batchNode||this._texture==a||(this._texture=a,this._updateBlendFunc())))};a.draw=function(){if(this._textureLoaded){var a=
cc._renderContext,d=this._texture;d?d._isLoaded&&(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2DN(0,d),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),a.bindBuffer(a.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(a.bufferData(a.ARRAY_BUFFER,this._quad.arrayBuffer,a.DYNAMIC_DRAW),this._quadDirty=!1),a.vertexAttribPointer(0,3,a.FLOAT,!1,24,0),a.vertexAttribPointer(1,
4,a.UNSIGNED_BYTE,!0,24,12),a.vertexAttribPointer(2,2,a.FLOAT,!1,24,16),a.drawArrays(a.TRIANGLE_STRIP,0,4)):(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2D(null),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR),a.bindBuffer(a.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(cc._renderContext.bufferData(cc._renderContext.ARRAY_BUFFER,this._quad.arrayBuffer,
cc._renderContext.STATIC_DRAW),this._quadDirty=!1),a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,a.FLOAT,!1,24,0),a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,24,12),a.drawArrays(a.TRIANGLE_STRIP,0,4));cc.g_NumberOfDraws++;if(0!==cc.SPRITE_DEBUG_DRAW||this._showNode)1===cc.SPRITE_DEBUG_DRAW||this._showNode?(a=this._quad,a=[cc.p(a.tl.vertices.x,a.tl.vertices.y),cc.p(a.bl.vertices.x,a.bl.vertices.y),cc.p(a.br.vertices.x,a.br.vertices.y),cc.p(a.tr.vertices.x,a.tr.vertices.y)],
cc._drawingUtil.drawPoly(a,4,!0)):2===cc.SPRITE_DEBUG_DRAW&&(a=this.getTextureRect(),d=this.getOffsetPosition(),a=[cc.p(d.x,d.y),cc.p(d.x+a.width,d.y),cc.p(d.x+a.width,d.y+a.height),cc.p(d.x,d.y+a.height)],cc._drawingUtil.drawPoly(a,4,!0))}};delete a};cc._tmp.PrototypeSprite=function(){var a=cc.Sprite.prototype;cc.defineGetterSetter(a,"opacityModifyRGB",a.isOpacityModifyRGB,a.setOpacityModifyRGB);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"flippedX",a.isFlippedX,a.setFlippedX);cc.defineGetterSetter(a,"flippedY",a.isFlippedY,a.setFlippedY);cc.defineGetterSetter(a,"offsetX",a._getOffsetX);cc.defineGetterSetter(a,"offsetY",a._getOffsetY);cc.defineGetterSetter(a,
"texture",a.getTexture,a.setTexture);cc.defineGetterSetter(a,"textureRectRotated",a.isTextureRectRotated);cc.defineGetterSetter(a,"batchNode",a.getBatchNode,a.setBatchNode);cc.defineGetterSetter(a,"quad",a.getQuad)};cc.generateTintImageWithMultiply=function(a,b,d,e){e=e||cc.newElement("canvas");d=d||cc.rect(0,0,a.width,a.height);var f=e.getContext("2d");e.width!=d.width||e.height!=d.height?(e.width=d.width,e.height=d.height):f.globalCompositeOperation="source-over";f.fillStyle="rgb("+b.r+","+b.g+","+b.b+")";f.fillRect(0,0,d.width,d.height);f.globalCompositeOperation="multiply";f.drawImage(a,d.x,d.y,d.width,d.height,0,0,d.width,d.height);f.globalCompositeOperation="destination-atop";f.drawImage(a,d.x,d.y,d.width,
d.height,0,0,d.width,d.height);return e};
cc.generateTintImage=function(a,b,d,e,f){e||(e=cc.rect(0,0,a.width,a.height));a=d.r/255;var g=d.g/255;d=d.b/255;var h=Math.min(e.width,b[0].width),k=Math.min(e.height,b[0].height),m;f?(m=f.getContext("2d"),m.clearRect(0,0,h,k)):(f=cc.newElement("canvas"),f.width=h,f.height=k,m=f.getContext("2d"));m.save();m.globalCompositeOperation="lighter";var n=m.globalAlpha;0<a&&(m.globalAlpha=a*n,m.drawImage(b[0],e.x,e.y,h,k,0,0,h,k));0<g&&(m.globalAlpha=g*n,m.drawImage(b[1],e.x,e.y,h,k,0,0,h,k));0<d&&(m.globalAlpha=
d*n,m.drawImage(b[2],e.x,e.y,h,k,0,0,h,k));1>a+g+d&&(m.globalAlpha=n,m.drawImage(b[3],e.x,e.y,h,k,0,0,h,k));m.restore();return f};
cc.generateTextureCacheForColor=function(a){function b(){var b=cc.generateTextureCacheForColor,e=a.width,h=a.height;d[0].width=e;d[0].height=h;d[1].width=e;d[1].height=h;d[2].width=e;d[2].height=h;d[3].width=e;d[3].height=h;b.canvas.width=e;b.canvas.height=h;var k=b.canvas.getContext("2d");k.drawImage(a,0,0);b.tempCanvas.width=e;b.tempCanvas.height=h;for(var k=k.getImageData(0,0,e,h).data,m=0;4>m;m++){var n=d[m].getContext("2d");n.getImageData(0,0,e,h).data;b.tempCtx.drawImage(a,0,0);for(var q=b.tempCtx.getImageData(0,
0,e,h),s=q.data,u=0;u<k.length;u+=4)s[u]=0===m?k[u]:0,s[u+1]=1===m?k[u+1]:0,s[u+2]=2===m?k[u+2]:0,s[u+3]=k[u+3];n.putImageData(q,0,0)}a.onload=null}if(a.channelCache)return a.channelCache;var d=[cc.newElement("canvas"),cc.newElement("canvas"),cc.newElement("canvas"),cc.newElement("canvas")];try{b()}catch(e){a.onload=b}return a.channelCache=d};cc.generateTextureCacheForColor.canvas=cc.newElement("canvas");cc.generateTextureCacheForColor.tempCanvas=cc.newElement("canvas");
cc.generateTextureCacheForColor.tempCtx=cc.generateTextureCacheForColor.tempCanvas.getContext("2d");cc.cutRotateImageToCanvas=function(a,b){if(!a)return null;if(!b)return a;var d=cc.newElement("canvas");d.width=b.width;d.height=b.height;var e=d.getContext("2d");e.translate(d.width/2,d.height/2);e.rotate(-1.5707963267948966);e.drawImage(a,b.x,b.y,b.height,b.width,-b.height/2,-b.width/2,b.height,b.width);return d};
cc.Sprite=cc.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_loadedEventListeners:null,_newTextureWhenChangeColor:null,_className:"Sprite",textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,
b){this._loadedEventListeners||(this._loadedEventListeners=[]);this._loadedEventListeners.push({eventCallback:a,eventTarget:b})},_callLoadedEventCallbacks:function(){if(this._loadedEventListeners){for(var a=this._loadedEventListeners,b=0,d=a.length;b<d;b++){var e=a[b];e.eventCallback.call(e.eventTarget,this)}a.length=0}},isDirty:function(){return this.dirty},setDirty:function(a){this.dirty=a},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},
setAtlasIndex:function(a){this.atlasIndex=a},getTextureRect:function(){return cc.rect(this._rect.x,this._rect.y,this._rect.width,this._rect.height)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(a){this.textureAtlas=a},getOffsetPosition:function(){return this._offsetPosition},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(a){cc.assert(a,
cc._LogInfos.Sprite_initWithSpriteFrame);a.textureLoaded()||(this._textureLoaded=!1,a.addLoadedEventListener(this._spriteFrameLoadedCallback,this));var b=cc._renderType===cc._RENDER_TYPE_CANVAS?!1:a._rotated,b=this.initWithTexture(a.getTexture(),a.getRect(),b);this.setSpriteFrame(a);return b},_spriteFrameLoadedCallback:null,initWithSpriteFrameName:function(a){cc.assert(a,cc._LogInfos.Sprite_initWithSpriteFrameName);var b=cc.spriteFrameCache.getSpriteFrame(a);cc.assert(b,a+cc._LogInfos.Sprite_initWithSpriteFrameName1);
return this.initWithSpriteFrame(b)},useBatchNode:function(a){this.textureAtlas=a.textureAtlas;this._batchNode=a},setVertexRect:function(a){this._rect.x=a.x;this._rect.y=a.y;this._rect.width=a.width;this._rect.height=a.height},sortAllChildren:function(){if(this._reorderChildDirty){var a=this._children,b=a.length,d,e,f;for(d=1;d<b;d++){f=a[d];for(e=d-1;0<=e;){if(f._localZOrder<a[e]._localZOrder)a[e+1]=a[e];else if(f._localZOrder===a[e]._localZOrder&&f.arrivalOrder<a[e].arrivalOrder)a[e+1]=a[e];else break;
e--}a[e+1]=f}this._batchNode&&this._arrayMakeObjectsPerformSelector(a,cc.Node.StateCallbackType.sortAllChildren);this._reorderChildDirty=!1}},reorderChild:function(a,b){cc.assert(a,cc._LogInfos.Sprite_reorderChild_2);-1===this._children.indexOf(a)?cc.log(cc._LogInfos.Sprite_reorderChild):b!==a.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),cc.Node.prototype.reorderChild.call(this,a,b))},removeChild:function(a,b){this._batchNode&&
this._batchNode.removeSpriteFromAtlas(a);cc.Node.prototype.removeChild.call(this,a,b)},removeAllChildren:function(a){var b=this._children,d=this._batchNode;if(d&&null!=b)for(var e=0,f=b.length;e<f;e++)d.removeSpriteFromAtlas(b[e]);cc.Node.prototype.removeAllChildren.call(this,a);this._hasChildren=!1},setDirtyRecursively:function(a){this.dirty=this._recursiveDirty=a;a=this._children;for(var b,d=a?a.length:0,e=0;e<d;e++)b=a[e],b instanceof cc.Sprite&&b.setDirtyRecursively(!0)},setNodeDirty:function(a){cc.Node.prototype.setNodeDirty.call(this);
a||!this._batchNode||this._recursiveDirty||(this._hasChildren?this.setDirtyRecursively(!0):this.dirty=this._recursiveDirty=!0)},ignoreAnchorPointForPosition:function(a){this._batchNode?cc.log(cc._LogInfos.Sprite_ignoreAnchorPointForPosition):cc.Node.prototype.ignoreAnchorPointForPosition.call(this,a)},setFlippedX:function(a){this._flippedX!=a&&(this._flippedX=a,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(a){this._flippedY!=a&&(this._flippedY=
a,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:null,isOpacityModifyRGB:function(){return this._opacityModifyRGB},updateDisplayedOpacity:null,setDisplayFrameWithAnimationName:function(a,b){cc.assert(a,cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var d=cc.animationCache.getAnimation(a);d?(d=d.getFrames()[b])?this.setSpriteFrame(d.getSpriteFrame()):
cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName)},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var a=this._parent;a&&a!=this._batchNode;)a._setReorderChildDirtyRecursively(),a=a.parent}},getTexture:function(){return this._texture},_quad:null,_quadWebBuffer:null,_quadDirty:!1,_colorized:!1,_isLighterMode:!1,_originalTexture:null,
_textureRect_Canvas:null,_drawSize_Canvas:null,ctor:null,_softInit:function(a,b,d){if(void 0===a)cc.Sprite.prototype.init.call(this);else if("string"===typeof a)"#"===a[0]?(a=a.substr(1,a.length-1),a=cc.spriteFrameCache.getSpriteFrame(a),this.initWithSpriteFrame(a)):cc.Sprite.prototype.init.call(this,a,b);else if("object"===typeof a)if(a instanceof cc.Texture2D)this.initWithTexture(a,b,d);else if(a instanceof cc.SpriteFrame)this.initWithSpriteFrame(a);else if(a instanceof HTMLImageElement||a instanceof
HTMLCanvasElement)b=new cc.Texture2D,b.initWithElement(a),b.handleLoadedTexture(),this.initWithTexture(b)},getQuad:function(){return this._quad},setBlendFunc:null,init:null,initWithFile:function(a,b){cc.assert(a,cc._LogInfos.Sprite_initWithFile);var d=cc.textureCache.textureForKey(a);if(d){if(!b){var e=d.getContentSize();b=cc.rect(0,0,e.width,e.height)}return this.initWithTexture(d,b)}d=cc.textureCache.addImage(a);return this.initWithTexture(d,b||cc.rect(0,0,d._contentSize.width,d._contentSize.height))},
initWithTexture:null,_textureLoadedCallback:null,setTextureRect:null,updateTransform:null,addChild:null,updateColor:function(){var a=this._displayedColor,b=this._displayedOpacity,a={r:a.r,g:a.g,b:a.b,a:b};this._opacityModifyRGB&&(a.r*=b/255,a.g*=b/255,a.b*=b/255);b=this._quad;b.bl.colors=a;b.br.colors=a;b.tl.colors=a;b.tr.colors=a;this._batchNode&&(this.atlasIndex!=cc.Sprite.INDEX_NOT_INITIALIZED?this.textureAtlas.updateQuad(b,this.atlasIndex):this.dirty=!0);this._quadDirty=!0},setOpacity:null,setColor:null,
updateDisplayedColor:null,setSpriteFrame:null,setDisplayFrame:function(a){cc.log(cc._LogInfos.Sprite_setDisplayFrame);this.setSpriteFrame(a)},isFrameDisplayed:null,displayFrame:function(){return cc.SpriteFrame.create(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),cc.sizePointsToPixels(this._contentSize))},setBatchNode:null,setTexture:null,_updateBlendFunc:function(){this._batchNode?cc.log(cc._LogInfos.Sprite__updateBlendFunc):
this._texture&&this._texture.hasPremultipliedAlpha()?(this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.opacityModifyRGB=!0):(this._blendFunc.src=cc.SRC_ALPHA,this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA,this.opacityModifyRGB=!1)},_changeTextureColor:function(){var a,b=this._texture,d=this._textureRect_Canvas;b&&d.validRect&&this._originalTexture&&(a=b.getHtmlElementObj())&&(this._colorized=!0,a instanceof HTMLCanvasElement&&!this._rectRotated&&!this._newTextureWhenChangeColor?
cc.generateTintImageWithMultiply(this._originalTexture._htmlElementObj,this._displayedColor,d,a):(a=cc.generateTintImageWithMultiply(this._originalTexture._htmlElementObj,this._displayedColor,d),b=new cc.Texture2D,b.initWithElement(a),b.handleLoadedTexture(),this.texture=b))},_setTextureCoords:function(a){a=cc.rectPointsToPixels(a);var b=this._batchNode?this.textureAtlas.texture:this._texture;if(b){var d=b.pixelsWidth,e=b.pixelsHeight,f,g=this._quad;this._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?
(b=(2*a.x+1)/(2*d),d=b+(2*a.height-2)/(2*d),f=(2*a.y+1)/(2*e),a=f+(2*a.width-2)/(2*e)):(b=a.x/d,d=(a.x+a.height)/d,f=a.y/e,a=(a.y+a.width)/e),this._flippedX&&(e=f,f=a,a=e),this._flippedY&&(e=b,b=d,d=e),g.bl.texCoords.u=b,g.bl.texCoords.v=f,g.br.texCoords.u=b,g.br.texCoords.v=a,g.tl.texCoords.u=d,g.tl.texCoords.v=f,g.tr.texCoords.u=d,g.tr.texCoords.v=a):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(b=(2*a.x+1)/(2*d),d=b+(2*a.width-2)/(2*d),f=(2*a.y+1)/(2*e),a=f+(2*a.height-2)/(2*e)):(b=a.x/d,d=(a.x+a.width)/
d,f=a.y/e,a=(a.y+a.height)/e),this._flippedX&&(e=b,b=d,d=e),this._flippedY&&(e=f,f=a,a=e),g.bl.texCoords.u=b,g.bl.texCoords.v=a,g.br.texCoords.u=d,g.br.texCoords.v=a,g.tl.texCoords.u=b,g.tl.texCoords.v=f,g.tr.texCoords.u=d,g.tr.texCoords.v=f);this._quadDirty=!0}},draw:null});cc.Sprite.create=function(a,b,d){return new cc.Sprite(a,b,d)};cc.Sprite.INDEX_NOT_INITIALIZED=-1;
cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.Sprite.prototype,_p._spriteFrameLoadedCallback=function(a){this.setNodeDirty(!0);this.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize());a=this.color;255===a.r&&255===a.g&&255===a.b||this._changeTextureColor();this._callLoadedEventCallbacks()},_p.setOpacityModifyRGB=function(a){this._opacityModifyRGB!==a&&(this._opacityModifyRGB=a,this.setNodeDirty(!0))},_p.updateDisplayedOpacity=function(a){cc.Node.prototype.updateDisplayedOpacity.call(this,
a);this._setNodeDirtyForCache()},_p.ctor=function(a,b,d){cc.Node.prototype.ctor.call(this);this._shouldBeHidden=!1;this._offsetPosition=cc.p(0,0);this._unflippedOffsetPositionFromCenter=cc.p(0,0);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._rect=cc.rect(0,0,0,0);this._newTextureWhenChangeColor=!1;this._textureLoaded=!0;this._textureRect_Canvas={x:0,y:0,width:0,height:0,validRect:!1};this._drawSize_Canvas=cc.size(0,0);this._softInit(a,b,d)},_p.setBlendFunc=function(a,b){var d=this._blendFunc;
void 0===b?(d.src=a.src,d.dst=a.dst):(d.src=a,d.dst=b);this._isLighterMode=d&&(d.src==cc.SRC_ALPHA&&d.dst==cc.ONE||d.src==cc.ONE&&d.dst==cc.ONE)},_p.init=function(){if(0<arguments.length)return this.initWithFile(arguments[0],arguments[1]);cc.Node.prototype.init.call(this);this.dirty=this._recursiveDirty=!1;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this.texture=null;this._textureLoaded=!0;this._flippedX=this._flippedY=!1;this.anchorY=this.anchorX=0.5;
this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;this.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0));return!0},_p.initWithTexture=function(a,b,d){cc.assert(0!=arguments.length,cc._LogInfos.CCSpriteBatchNode_initWithTexture);if((d=d||!1)&&a.isLoaded()){var e=a.getHtmlElementObj(),e=cc.cutRotateImageToCanvas(e,b),f=new cc.Texture2D;f.initWithElement(e);f.handleLoadedTexture();a=f;this._rect=cc.rect(0,0,b.width,b.height)}if(!cc.Node.prototype.init.call(this))return!1;this._batchNode=
null;this.dirty=this._recursiveDirty=!1;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this._flippedX=this._flippedY=!1;this.anchorY=this.anchorX=0.5;this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;this._textureLoaded=e=a.isLoaded();if(!e)return this._rectRotated=d,b&&(this._rect.x=b.x,this._rect.y=b.y,this._rect.width=b.width,this._rect.height=b.height),a.addLoadedEventListener(this._textureLoadedCallback,this),!0;b||(b=cc.rect(0,
0,a.width,a.height));a&&a.url&&(e=b.y+b.height,b.x+b.width>a.width&&cc.error(cc._LogInfos.RectWidth,a.url),e>a.height&&cc.error(cc._LogInfos.RectHeight,a.url));this.texture=this._originalTexture=a;this.setTextureRect(b,d);this.batchNode=null;return!0},_p._textureLoadedCallback=function(a){if(!this._textureLoaded){this._textureLoaded=!0;var b=this._rect;b?cc._rectEqualToZero(b)&&(b.width=a.width,b.height=a.height):b=cc.rect(0,0,a.width,a.height);this.texture=this._originalTexture=a;this.setTextureRect(b,
this._rectRotated);this.batchNode=this._batchNode;this._callLoadedEventCallbacks()}},_p.setTextureRect=function(a,b,d){this._rectRotated=b||!1;this.setContentSize(d||a);this.setVertexRect(a);b=this._textureRect_Canvas;d=cc.contentScaleFactor();b.x=0|a.x*d;b.y=0|a.y*d;b.width=0|a.width*d;b.height=0|a.height*d;b.validRect=!(0===b.width||0===b.height||0>b.x||0>b.y);a=this._unflippedOffsetPositionFromCenter;this._flippedX&&(a.x=-a.x);this._flippedY&&(a.y=-a.y);this._offsetPosition.x=a.x+(this._contentSize.width-
this._rect.width)/2;this._offsetPosition.y=a.y+(this._contentSize.height-this._rect.height)/2;this._batchNode&&(this.dirty=!0)},_p.updateTransform=function(){if(this.dirty){var a=this._parent;!this._visible||a&&a!=this._batchNode&&a._shouldBeHidden?this._shouldBeHidden=!0:(this._shouldBeHidden=!1,this._transformToBatch=a&&a!=this._batchNode?cc.affineTransformConcat(this.nodeToParentTransform(),a._transformToBatch):this.nodeToParentTransform());this.dirty=this._recursiveDirty=!1}this._hasChildren&&
this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform)},_p.addChild=function(a,b,d){cc.assert(a,cc._LogInfos.CCSpriteBatchNode_addChild_2);null==b&&(b=a._localZOrder);null==d&&(d=a.tag);cc.Node.prototype.addChild.call(this,a,b,d);this._hasChildren=!0},_p.setOpacity=function(a){cc.Node.prototype.setOpacity.call(this,a);this._setNodeDirtyForCache()},_p.setColor=function(a){var b=this.color;b.r===a.r&&b.g===a.g&&b.b===a.b||cc.Node.prototype.setColor.call(this,
a)},_p.updateDisplayedColor=function(a){cc.Node.prototype.updateDisplayedColor.call(this,a);this._changeTextureColor();this._setNodeDirtyForCache()},_p.setSpriteFrame=function(a){var b=this;"string"==typeof a&&(a=cc.spriteFrameCache.getSpriteFrame(a),cc.assert(a,cc._LogInfos.CCSpriteBatchNode_setSpriteFrame));b.setNodeDirty(!0);var d=a.getOffset();b._unflippedOffsetPositionFromCenter.x=d.x;b._unflippedOffsetPositionFromCenter.y=d.y;b._rectRotated=a.isRotated();var d=a.getTexture(),e=a.textureLoaded();
e||(b._textureLoaded=!1,a.addLoadedEventListener(function(a){b._textureLoaded=!0;var d=a.getTexture();d!=b._texture&&(b.texture=d);b.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize());b._callLoadedEventCallbacks()},b));d!=b._texture&&(b.texture=d);b._rectRotated&&(b._originalTexture=d);b.setTextureRect(a.getRect(),b._rectRotated,a.getOriginalSize());b._colorized=!1;e&&(a=b.color,255===a.r&&255===a.g&&255===a.b||b._changeTextureColor())},_p.isFrameDisplayed=function(a){return a.getTexture()!=
this._texture?!1:cc.rectEqualToRect(a.getRect(),this._rect)},_p.setBatchNode=function(a){(this._batchNode=a)?(this._transformToBatch=cc.affineTransformIdentity(),this.textureAtlas=this._batchNode.textureAtlas):(this.atlasIndex=cc.Sprite.INDEX_NOT_INITIALIZED,this.textureAtlas=null,this.dirty=this._recursiveDirty=!1)},_p.setTexture=function(a){a&&"string"===typeof a?(a=cc.textureCache.addImage(a),this.setTexture(a),a=a.getContentSize(),this.setTextureRect(cc.rect(0,0,a.width,a.height))):(cc.assert(!a||
a instanceof cc.Texture2D,cc._LogInfos.CCSpriteBatchNode_setTexture),this._texture!=a&&(a&&a.getHtmlElementObj()instanceof HTMLImageElement&&(this._originalTexture=a),this._texture=a))},_p.draw=function(a){if(this._textureLoaded){a=a||cc._renderContext;this._isLighterMode&&(a.globalCompositeOperation="lighter");var b=cc.view.getScaleX(),d=cc.view.getScaleY();a.globalAlpha=this._displayedOpacity/255;var e=this._rect,f=this._contentSize,g=this._offsetPosition,h=this._drawSize_Canvas,k=0|g.x,m=-g.y-
e.height,n=this._textureRect_Canvas;h.width=e.width*b;h.height=e.height*d;if(this._flippedX||this._flippedY)a.save(),this._flippedX&&(k=-g.x-e.width,a.scale(-1,1)),this._flippedY&&(m=g.y,a.scale(1,-1));k*=b;m*=d;this._texture&&n.validRect?(f=this._texture.getHtmlElementObj(),this._colorized?a.drawImage(f,0,0,n.width,n.height,k,m,h.width,h.height):a.drawImage(f,n.x,n.y,n.width,n.height,k,m,h.width,h.height)):!this._texture&&n.validRect&&(h=this.color,a.fillStyle="rgba("+h.r+","+h.g+","+h.b+",1)",a.fillRect(k,
m,f.width*b,f.height*d));1===cc.SPRITE_DEBUG_DRAW||this._showNode?(a.strokeStyle="rgba(0,255,0,1)",k/=b,m=-(m/d),k=[cc.p(k,m),cc.p(k+e.width,m),cc.p(k+e.width,m-e.height),cc.p(k,m-e.height)],cc._drawingUtil.drawPoly(k,4,!0)):2===cc.SPRITE_DEBUG_DRAW&&(a.strokeStyle="rgba(0,255,0,1)",b=this._rect,m=-m,k=[cc.p(k,m),cc.p(k+b.width,m),cc.p(k+b.width,m-b.height),cc.p(k,m-b.height)],cc._drawingUtil.drawPoly(k,4,!0));(this._flippedX||this._flippedY)&&a.restore();cc.g_NumberOfDraws++}},cc.sys._supportCanvasNewBlendModes||
(_p._changeTextureColor=function(){var a,b=this._texture,d=this._textureRect_Canvas;b&&d.validRect&&this._originalTexture&&(a=b.getHtmlElementObj())&&(b=cc.textureCache.getTextureColors(this._originalTexture.getHtmlElementObj()))&&(this._colorized=!0,a instanceof HTMLCanvasElement&&!this._rectRotated&&!this._newTextureWhenChangeColor?cc.generateTintImage(a,b,this._displayedColor,d,a):(a=cc.generateTintImage(a,b,this._displayedColor,d),b=new cc.Texture2D,b.initWithElement(a),b.handleLoadedTexture(),
this.texture=b))}),delete _p):(cc.assert("function"===typeof cc._tmp.WebGLSprite,cc._LogInfos.MissingFile,"SpritesWebGL.js"),cc._tmp.WebGLSprite(),delete cc._tmp.WebGLSprite);cc.assert("function"===typeof cc._tmp.PrototypeSprite,cc._LogInfos.MissingFile,"SpritesPropertyDefine.js");cc._tmp.PrototypeSprite();delete cc._tmp.PrototypeSprite;cc.DEFAULT_SPRITE_BATCH_CAPACITY=29;
cc.SpriteBatchNode=cc.Node.extend({textureAtlas:null,_blendFunc:null,_descendants:null,_className:"SpriteBatchNode",addSpriteWithoutQuad:function(a,b,d){cc.assert(a,cc._LogInfos.SpriteBatchNode_addSpriteWithoutQuad_2);if(!(a instanceof cc.Sprite))return cc.log(cc._LogInfos.SpriteBatchNode_addSpriteWithoutQuad),null;a.atlasIndex=b;var e=0,f=this._descendants;if(f&&0<f.length)for(var g=0;g<f.length;g++){var h=f[g];h&&h.atlasIndex>=b&&++e}f.splice(e,0,a);cc.Node.prototype.addChild.call(this,a,b,d);this.reorderBatch(!1);
return this},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(a){a!=this.textureAtlas&&(this.textureAtlas=a)},getDescendants:function(){return this._descendants},initWithFile:function(a,b){var d=cc.textureCache.textureForKey(a);d||(d=cc.textureCache.addImage(a));return this.initWithTexture(d,b)},_setNodeDirtyForCache:function(){this._cacheDirty=!0},init:function(a,b){var d=cc.textureCache.textureForKey(a);d||(d=cc.textureCache.addImage(a));return this.initWithTexture(d,
b)},increaseAtlasCapacity:function(){var a=this.textureAtlas.capacity,b=Math.floor(4*(a+1)/3);cc.log(cc._LogInfos.SpriteBatchNode_increaseAtlasCapacity,a,b);this.textureAtlas.resizeCapacity(b)||cc.log(cc._LogInfos.SpriteBatchNode_increaseAtlasCapacity_2)},removeChildAtIndex:function(a,b){this.removeChild(this._children[a],b)},rebuildIndexInOrder:function(a,b){var d=a.children;if(d&&0<d.length)for(var e=0;e<d.length;e++){var f=d[e];f&&0>f.zIndex&&(b=this.rebuildIndexInOrder(f,b))}!a==this&&(a.atlasIndex=
b,b++);if(d&&0<d.length)for(e=0;e<d.length;e++)(f=d[e])&&0<=f.zIndex&&(b=this.rebuildIndexInOrder(f,b));return b},highestAtlasIndexInChild:function(a){var b=a.children;return b&&0!=b.length?this.highestAtlasIndexInChild(b[b.length-1]):a.atlasIndex},lowestAtlasIndexInChild:function(a){var b=a.children;return b&&0!=b.length?this.lowestAtlasIndexInChild(b[b.length-1]):a.atlasIndex},atlasIndexForChild:function(a,b){var d=a.parent,e=d.children,f=e.indexOf(a),g=null;0<f&&f<cc.UINT_MAX&&(g=e[f-1]);return d==
this?0==f?0:this.highestAtlasIndexInChild(g)+1:0==f?0>b?d.atlasIndex:d.atlasIndex+1:0>g.zIndex&&0>b||0<=g.zIndex&&0<=b?this.highestAtlasIndexInChild(g)+1:d.atlasIndex+1},reorderBatch:function(a){this._reorderChildDirty=a},setBlendFunc:function(a,b){this._blendFunc=void 0===b?a:{src:a,dst:b}},getBlendFunc:function(){return this._blendFunc},reorderChild:function(a,b){cc.assert(a,cc._LogInfos.SpriteBatchNode_reorderChild_2);-1===this._children.indexOf(a)?cc.log(cc._LogInfos.SpriteBatchNode_reorderChild):
b!==a.zIndex&&(cc.Node.prototype.reorderChild.call(this,a,b),this.setNodeDirty())},removeChild:function(a,b){null!=a&&(-1===this._children.indexOf(a)?cc.log(cc._LogInfos.SpriteBatchNode_removeChild):(this.removeSpriteFromAtlas(a),cc.Node.prototype.removeChild.call(this,a,b)))},_mvpMatrix:null,_textureForCanvas:null,_useCache:!1,_originalTexture:null,ctor:null,_ctorForCanvas:function(a,b){cc.Node.prototype.ctor.call(this);var d;b=b||cc.DEFAULT_SPRITE_BATCH_CAPACITY;"string"==typeof a?(d=cc.textureCache.textureForKey(a))||
(d=cc.textureCache.addImage(a)):a instanceof cc.Texture2D&&(d=a);d&&this.initWithTexture(d,b)},_ctorForWebGL:function(a,b){cc.Node.prototype.ctor.call(this);this._mvpMatrix=new cc.kmMat4;var d;b=b||cc.DEFAULT_SPRITE_BATCH_CAPACITY;"string"==typeof a?(d=cc.textureCache.textureForKey(a))||(d=cc.textureCache.addImage(a)):a instanceof cc.Texture2D&&(d=a);d&&this.initWithTexture(d,b)},updateQuadFromSprite:null,_updateQuadFromSpriteForCanvas:function(a,b){cc.assert(a,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2);
a instanceof cc.Sprite?(a.batchNode=this,a.atlasIndex=b,a.dirty=!0,a.updateTransform()):cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)},_updateQuadFromSpriteForWebGL:function(a,b){cc.assert(a,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite);if(a instanceof cc.Sprite){for(var d=this.textureAtlas.capacity;b>=d||d==this.textureAtlas.totalQuads;)this.increaseAtlasCapacity();a.batchNode=this;a.atlasIndex=b;a.dirty=!0;a.updateTransform()}else cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)},
_swap:function(a,b){var d=this._descendants,e=this.textureAtlas,f=e.quads,g=d[a],h=cc.V3F_C4B_T2F_QuadCopy(f[a]);d[b].atlasIndex=a;d[a]=d[b];e.updateQuad(f[b],a);d[b]=g;e.updateQuad(h,b)},insertQuadFromSprite:null,_insertQuadFromSpriteForCanvas:function(a,b){cc.assert(a,cc._LogInfos.CCSpriteBatchNode_insertQuadFromSprite_2);a instanceof cc.Sprite?(a.batchNode=this,a.atlasIndex=b,a.dirty=!0,a.updateTransform(),this._children.splice(b,0,a)):cc.log(cc._LogInfos.CCSpriteBatchNode_insertQuadFromSprite)},
_insertQuadFromSpriteForWebGL:function(a,b){cc.assert(a,cc._LogInfos.Sprite_insertQuadFromSprite_2);if(a instanceof cc.Sprite){for(var d=this.textureAtlas;b>=d.capacity||d.capacity===d.totalQuads;)this.increaseAtlasCapacity();a.batchNode=this;a.atlasIndex=b;d.insertQuad(a.quad,b);a.dirty=!0;a.updateTransform()}else cc.log(cc._LogInfos.Sprite_insertQuadFromSprite)},_updateAtlasIndex:function(a,b){var d=0,e=a.children;e&&(d=e.length);var f=0;if(0===d)f=a.atlasIndex,a.atlasIndex=b,a.arrivalOrder=0,f!=
b&&this._swap(f,b),b++;else{f=!0;0<=e[0].zIndex&&(f=a.atlasIndex,a.atlasIndex=b,a.arrivalOrder=0,f!=b&&this._swap(f,b),b++,f=!1);for(d=0;d<e.length;d++){var g=e[d];f&&0<=g.zIndex&&(f=a.atlasIndex,a.atlasIndex=b,a.arrivalOrder=0,f!=b&&this._swap(f,b),b++,f=!1);b=this._updateAtlasIndex(g,b)}f&&(f=a.atlasIndex,a.atlasIndex=b,a.arrivalOrder=0,f!=b&&this._swap(f,b),b++)}return b},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=cc.SRC_ALPHA,this._blendFunc.dst=
cc.ONE_MINUS_SRC_ALPHA)},initWithTexture:null,_initWithTextureForCanvas:function(a,b){this._children=[];this._descendants=[];this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);this._textureForCanvas=this._originalTexture=a;return!0},_initWithTextureForWebGL:function(a,b){this._children=[];this._descendants=[];this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);b=b||cc.DEFAULT_SPRITE_BATCH_CAPACITY;this.textureAtlas=new cc.TextureAtlas;this.textureAtlas.initWithTexture(a,b);this._updateBlendFunc();
this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);return!0},insertChild:function(a,b){a.batchNode=this;a.atlasIndex=b;a.dirty=!0;var d=this.textureAtlas;d.totalQuads>=d.capacity&&this.increaseAtlasCapacity();d.insertQuad(a.quad,b);this._descendants.splice(b,0,a);var d=b+1,e=this._descendants;if(e&&0<e.length)for(;d<e.length;d++)e[d].atlasIndex++;var e=a.children,f;if(e)for(d=0,l=e.length||0;d<l;d++)if(f=e[d]){var g=this.atlasIndexForChild(f,f.zIndex);this.insertChild(f,
g)}},appendChild:null,_appendChildForCanvas:function(a){this._reorderChildDirty=!0;a.batchNode=this;a.dirty=!0;this._descendants.push(a);a.atlasIndex=this._descendants.length-1;a=a.children;for(var b=0,d=a.length||0;b<d;b++)this.appendChild(a[b])},_appendChildForWebGL:function(a){this._reorderChildDirty=!0;a.batchNode=this;a.dirty=!0;this._descendants.push(a);var b=this._descendants.length-1;a.atlasIndex=b;var d=this.textureAtlas;d.totalQuads==d.capacity&&this.increaseAtlasCapacity();d.insertQuad(a.quad,
b);a=a.children;b=0;for(d=a.length||0;b<d;b++)this.appendChild(a[b])},removeSpriteFromAtlas:null,_removeSpriteFromAtlasForCanvas:function(a){a.batchNode=null;var b=this._descendants,d=b.indexOf(a);if(-1!=d){b.splice(d,1);for(var e=b.length;d<e;++d)b[d].atlasIndex--}if(a=a.children)for(b=0,d=a.length||0;b<d;b++)a[b]&&this.removeSpriteFromAtlas(a[b])},_removeSpriteFromAtlasForWebGL:function(a){this.textureAtlas.removeQuadAtIndex(a.atlasIndex);a.batchNode=null;var b=this._descendants,d=b.indexOf(a);
if(-1!=d){b.splice(d,1);for(var e=b.length;d<e;++d)b[d].atlasIndex--}if(a=a.children)for(b=0,d=a.length||0;b<d;b++)a[b]&&this.removeSpriteFromAtlas(a[b])},getTexture:null,_getTextureForCanvas:function(){return this._textureForCanvas},_getTextureForWebGL:function(){return this.textureAtlas.texture},setTexture:null,_setTextureForCanvas:function(a){this._textureForCanvas=a;for(var b=this._children,d=0;d<b.length;d++)b[d].texture=a},_setTextureForWebGL:function(a){this.textureAtlas.texture=a;this._updateBlendFunc()},
visit:null,_visitForCanvas:function(a){var b=a||cc._renderContext;if(this._visible){b.save();this.transform(a);var d=this._children;if(d)for(this.sortAllChildren(),a=0;a<d.length;a++)d[a]&&d[a].visit(b);b.restore()}},_visitForWebGL:function(a){a=a||cc._renderContext;if(this._visible){cc.kmGLPushMatrix();var b=this.grid;b&&b.isActive()&&(b.beforeDraw(),this.transformAncestors());this.sortAllChildren();this.transform(a);this.draw(a);b&&b.isActive()&&b.afterDraw(this);cc.kmGLPopMatrix();this.arrivalOrder=
0}},addChild:null,_addChildForCanvas:function(a,b,d){cc.assert(null!=a,cc._LogInfos.CCSpriteBatchNode_addChild_3);a instanceof cc.Sprite?(b=null==b?a.zIndex:b,d=null==d?a.tag:d,cc.Node.prototype.addChild.call(this,a,b,d),this.appendChild(a),this.setNodeDirty()):cc.log(cc._LogInfos.CCSpriteBatchNode_addChild)},_addChildForWebGL:function(a,b,d){cc.assert(null!=a,cc._LogInfos.Sprite_addChild_6);a instanceof cc.Sprite?a.texture!=this.textureAtlas.texture?cc.log(cc._LogInfos.Sprite_addChild_5):(b=null==
b?a.zIndex:b,d=null==d?a.tag:d,cc.Node.prototype.addChild.call(this,a,b,d),this.appendChild(a),this.setNodeDirty()):cc.log(cc._LogInfos.Sprite_addChild_4)},removeAllChildren:null,_removeAllChildrenForCanvas:function(a){var b=this._descendants;if(b&&0<b.length)for(var d=0,e=b.length;d<e;d++)b[d]&&(b[d].batchNode=null);cc.Node.prototype.removeAllChildren.call(this,a);this._descendants.length=0},_removeAllChildrenForWebGL:function(a){var b=this._descendants;if(b&&0<b.length)for(var d=0,e=b.length;d<
e;d++)b[d]&&(b[d].batchNode=null);cc.Node.prototype.removeAllChildren.call(this,a);this._descendants.length=0;this.textureAtlas.removeAllQuads()},sortAllChildren:null,_sortAllChildrenForCanvas:function(){if(this._reorderChildDirty){var a,b=0,d=this._children,e=d.length,f;for(a=1;a<e;a++){var g=d[a],b=a-1;for(f=d[b];0<=b&&(g._localZOrder<f._localZOrder||g._localZOrder==f._localZOrder&&g.arrivalOrder<f.arrivalOrder);)d[b+1]=f,b-=1,f=d[b];d[b+1]=g}0<d.length&&this._arrayMakeObjectsPerformSelector(d,
cc.Node.StateCallbackType.sortAllChildren);this._reorderChildDirty=!1}},_sortAllChildrenForWebGL:function(){if(this._reorderChildDirty){var a=this._children,b,d=0,e=a.length,f;for(b=1;b<e;b++){var g=a[b],d=b-1;for(f=a[d];0<=d&&(g._localZOrder<f._localZOrder||g._localZOrder==f._localZOrder&&g.arrivalOrder<f.arrivalOrder);)a[d+1]=f,d-=1,f=a[d];a[d+1]=g}if(0<a.length)for(this._arrayMakeObjectsPerformSelector(a,cc.Node.StateCallbackType.sortAllChildren),b=d=0;b<a.length;b++)d=this._updateAtlasIndex(a[b],
d);this._reorderChildDirty=!1}},draw:null,_drawForWebGL:function(){0!==this.textureAtlas.totalQuads&&(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),this.textureAtlas.drawQuads())}});_p=cc.SpriteBatchNode.prototype;
cc._renderType===cc._RENDER_TYPE_WEBGL?(_p.ctor=_p._ctorForWebGL,_p.updateQuadFromSprite=_p._updateQuadFromSpriteForWebGL,_p.insertQuadFromSprite=_p._insertQuadFromSpriteForWebGL,_p.initWithTexture=_p._initWithTextureForWebGL,_p.appendChild=_p._appendChildForWebGL,_p.removeSpriteFromAtlas=_p._removeSpriteFromAtlasForWebGL,_p.getTexture=_p._getTextureForWebGL,_p.setTexture=_p._setTextureForWebGL,_p.visit=_p._visitForWebGL,_p.addChild=_p._addChildForWebGL,_p.removeAllChildren=_p._removeAllChildrenForWebGL,
_p.sortAllChildren=_p._sortAllChildrenForWebGL,_p.draw=_p._drawForWebGL):(_p.ctor=_p._ctorForCanvas,_p.updateQuadFromSprite=_p._updateQuadFromSpriteForCanvas,_p.insertQuadFromSprite=_p._insertQuadFromSpriteForCanvas,_p.initWithTexture=_p._initWithTextureForCanvas,_p.appendChild=_p._appendChildForCanvas,_p.removeSpriteFromAtlas=_p._removeSpriteFromAtlasForCanvas,_p.getTexture=_p._getTextureForCanvas,_p.setTexture=_p._setTextureForCanvas,_p.visit=_p._visitForCanvas,_p.removeAllChildren=_p._removeAllChildrenForCanvas,
_p.addChild=_p._addChildForCanvas,_p.sortAllChildren=_p._sortAllChildrenForCanvas,_p.draw=cc.Node.prototype.draw);cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.defineGetterSetter(_p,"descendants",_p.getDescendants);cc.SpriteBatchNode.create=function(a,b){return new cc.SpriteBatchNode(a,b)};cc.BakeSprite=cc.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){cc.Sprite.prototype.ctor.call(this);var a=document.createElement("canvas");a.width=a.height=10;this._cacheCanvas=a;this._cacheContext=a.getContext("2d");var b=new cc.Texture2D;b.initWithElement(a);b.handleLoadedTexture();this.setTexture(b)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(a,b){void 0===b&&(b=a.height,a=a.width);var d=
this._cacheCanvas;d.width=a;d.height=b;this.getTexture().handleLoadedTexture();this.setTextureRect(cc.rect(0,0,a,b),!1)}});cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(a,b,d){this._spriteFrame=a||null;this._delayPerUnit=b||0;this._userInfo=d||null},clone:function(){var a=new cc.AnimationFrame;a.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return a},copyWithZone:function(a){return cc.clone(this)},copy:function(a){a=new cc.AnimationFrame;a.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return a},initWithSpriteFrame:function(a,
b,d){this._spriteFrame=a;this._delayPerUnit=b;this._userInfo=d;return!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(a){this._spriteFrame=a},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(a){this._delayPerUnit=a},getUserInfo:function(){return this._userInfo},setUserInfo:function(a){this._userInfo=a}});cc.AnimationFrame.create=function(a,b,d){return new cc.AnimationFrame(a,b,d)};
cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(a,b,d){this._frames=[];if(void 0===a)this.initWithSpriteFrames(null,0);else{var e=a[0];e&&(e instanceof cc.SpriteFrame?this.initWithSpriteFrames(a,b,d):e instanceof cc.AnimationFrame&&this.initWithAnimationFrames(a,b,d))}},getFrames:function(){return this._frames},setFrames:function(a){this._frames=a},addSpriteFrame:function(a){var b=new cc.AnimationFrame;b.initWithSpriteFrame(a,
1,null);this._frames.push(b);this._totalDelayUnits++},addSpriteFrameWithFile:function(a){a=cc.textureCache.addImage(a);var b=cc.rect(0,0,0,0);b.width=a.width;b.height=a.height;a=cc.SpriteFrame.create(a,b);this.addSpriteFrame(a)},addSpriteFrameWithTexture:function(a,b){var d=cc.SpriteFrame.create(a,b);this.addSpriteFrame(d)},initWithAnimationFrames:function(a,b,d){cc.arrayVerifyType(a,cc.AnimationFrame);this._delayPerUnit=b;this._loops=void 0===d?1:d;this._totalDelayUnits=0;b=this._frames;for(d=b.length=
0;d<a.length;d++){var e=a[d];b.push(e);this._totalDelayUnits+=e.getDelayUnits()}return!0},clone:function(){var a=new cc.Animation;a.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);a.setRestoreOriginalFrame(this._restoreOriginalFrame);return a},copyWithZone:function(a){a=new cc.Animation;a.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);a.setRestoreOriginalFrame(this._restoreOriginalFrame);return a},_copyFrames:function(){for(var a=[],b=0;b<this._frames.length;b++)a.push(this._frames[b].clone());
return a},copy:function(a){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(a){this._loops=a},setRestoreOriginalFrame:function(a){this._restoreOriginalFrame=a},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(a){this._delayPerUnit=a},getTotalDelayUnits:function(){return this._totalDelayUnits},
initWithSpriteFrames:function(a,b,d){cc.arrayVerifyType(a,cc.SpriteFrame);this._loops=void 0===d?1:d;this._delayPerUnit=b||0;this._totalDelayUnits=0;b=this._frames;b.length=0;if(a){for(d=0;d<a.length;d++){var e=a[d],f=new cc.AnimationFrame;f.initWithSpriteFrame(e,1,null);b.push(f)}this._totalDelayUnits+=a.length}return!0},retain:function(){},release:function(){}});cc.Animation.create=function(a,b,d){return new cc.Animation(a,b,d)};cc.animationCache={_animations:{},addAnimation:function(a,b){this._animations[b]=a},removeAnimation:function(a){a&&this._animations[a]&&delete this._animations[a]},getAnimation:function(a){return this._animations[a]?this._animations[a]:null},_addAnimationsWithDictionary:function(a,b){var d=a.animations;if(d){var e=1,f=a.properties;if(f)for(var e=null!=f.format?parseInt(f.format):e,f=f.spritesheets,g=cc.spriteFrameCache,h=cc.path,k=0;k<f.length;k++)g.addSpriteFrames(h.changeBasename(b,f[k]));switch(e){case 1:this._parseVersion1(d);
break;case 2:this._parseVersion2(d);break;default:cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary_2)}}else cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary)},addAnimations:function(a){cc.assert(a,cc._LogInfos.animationCache_addAnimations_2);var b=cc.loader.getRes(a);b?this._addAnimationsWithDictionary(b,a):cc.log(cc._LogInfos.animationCache_addAnimations)},_parseVersion1:function(a){var b=cc.spriteFrameCache,d;for(d in a){var e=a[d],f=e.frames,e=parseFloat(e.delay)||
0,g=null;if(f){for(var g=[],h=0;h<f.length;h++){var k=b.getSpriteFrame(f[h]);if(k){var m=new cc.AnimationFrame;m.initWithSpriteFrame(k,1,null);g.push(m)}else cc.log(cc._LogInfos.animationCache__parseVersion1_2,d,f[h])}0===g.length?cc.log(cc._LogInfos.animationCache__parseVersion1_3,d):(g.length!=f.length&&cc.log(cc._LogInfos.animationCache__parseVersion1_4,d),g=cc.Animation.create(g,e,1),cc.animationCache.addAnimation(g,d))}else cc.log(cc._LogInfos.animationCache__parseVersion1,d)}},_parseVersion2:function(a){var b=
cc.spriteFrameCache,d;for(d in a){var e=a[d],f=e.loop,g=parseInt(e.loops),f=f?cc.REPEAT_FOREVER:isNaN(g)?1:g,g=e.restoreOriginalFrame&&!0==e.restoreOriginalFrame?!0:!1,h=e.frames;if(h){for(var k=[],m=0;m<h.length;m++){var n=h[m],q=n.spriteframe,s=b.getSpriteFrame(q);if(s){var q=parseFloat(n.delayUnits)||0,n=n.notification,u=new cc.AnimationFrame;u.initWithSpriteFrame(s,q,n);k.push(u)}else cc.log(cc._LogInfos.animationCache__parseVersion2_2,d,q)}e=parseFloat(e.delayPerUnit)||0;h=new cc.Animation;h.initWithAnimationFrames(k,
e,f);h.setRestoreOriginalFrame(g);cc.animationCache.addAnimation(h,d)}else cc.log(cc._LogInfos.animationCache__parseVersion2,d)}},_clear:function(){this._animations={}}};cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,_eventListeners:null,ctor:function(a,b,d,e,f){this._offset=cc.p(0,0);this._offsetInPixels=cc.p(0,0);this._originalSize=cc.size(0,0);this._rotated=!1;this._originalSizeInPixels=cc.size(0,0);this._textureFilename="";this._texture=null;this._textureLoaded=!1;void 0!==a&&void 0!==b&&(void 0===d||void 0===
e||void 0===f?this.initWithTexture(a,b):this.initWithTexture(a,b,d,e,f))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,b){null==this._eventListeners&&(this._eventListeners=[]);this._eventListeners.push({eventCallback:a,eventTarget:b})},_callLoadedEventCallbacks:function(){var a=this._eventListeners;if(a){for(var b=0,d=a.length;b<d;b++){var e=a[b];e.eventCallback.call(e.eventTarget,this)}a.length=0}},getRectInPixels:function(){var a=this._rectInPixels;return cc.rect(a.x,
a.y,a.width,a.height)},setRectInPixels:function(a){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0));this._rectInPixels.x=a.x;this._rectInPixels.y=a.y;this._rectInPixels.width=a.width;this._rectInPixels.height=a.height;this._rect=cc.rectPixelsToPoints(a)},isRotated:function(){return this._rotated},setRotated:function(a){this._rotated=a},getRect:function(){var a=this._rect;return cc.rect(a.x,a.y,a.width,a.height)},setRect:function(a){this._rect||(this._rect=cc.rect(0,0,0,0));this._rect.x=a.x;
this._rect.y=a.y;this._rect.width=a.width;this._rect.height=a.height;this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return this._offsetInPixels},setOffsetInPixels:function(a){this._offsetInPixels.x=a.x;this._offsetInPixels.y=a.y;cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return this._originalSizeInPixels},setOriginalSizeInPixels:function(a){this._originalSizeInPixels.width=a.width;this._originalSizeInPixels.height=
a.height},getOriginalSize:function(){return this._originalSize},setOriginalSize:function(a){this._originalSize.width=a.width;this._originalSize.height=a.height},getTexture:function(){if(this._texture)return this._texture;if(""!==this._textureFilename){var a=cc.textureCache.addImage(this._textureFilename);a&&(this._textureLoaded=a.isLoaded());return a}return null},setTexture:function(a){if(this._texture!=a){var b=a.isLoaded();this._textureLoaded=b;this._texture=a;b||a.addLoadedEventListener(function(a){this._textureLoaded=
!0;if(this._rotated&&cc._renderType===cc._RENDER_TYPE_CANVAS){var b=a.getHtmlElementObj(),b=cc.cutRotateImageToCanvas(b,this.getRect()),f=new cc.Texture2D;f.initWithElement(b);f.handleLoadedTexture();this.setTexture(f);b=this.getRect();this.setRect(cc.rect(0,0,b.width,b.height))}b=this._rect;0===b.width&&0===b.height&&(b=a.width,a=a.height,this._rect.width=b,this._rect.height=a,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=
this._rectInPixels.height,this._originalSize.width=b,this._originalSize.height=a);this._callLoadedEventCallbacks()},this)}},getOffset:function(){return this._offset},setOffset:function(a){this._offset.x=a.x;this._offset.y=a.y},clone:function(){var a=new cc.SpriteFrame;a.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);a.setTexture(this._texture);return a},copyWithZone:function(){var a=new cc.SpriteFrame;a.initWithTexture(this._textureFilename,
this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);a.setTexture(this._texture);return a},copy:function(){return this.copyWithZone()},initWithTexture:function(a,b,d,e,f){2===arguments.length&&(b=cc.rectPointsToPixels(b));e=e||cc.p(0,0);f=f||b;d=d||!1;"string"==typeof a?(this._texture=null,this._textureFilename=a):a instanceof cc.Texture2D&&this.setTexture(a);if((a=this.getTexture())&&a.url){var g,h;d?(g=b.x+b.height,h=b.y+b.width):(g=b.x+b.width,h=b.y+b.height);g>a.width&&
cc.error(cc._LogInfos.RectWidth,a.url);h>a.height&&cc.error(cc._LogInfos.RectHeight,a.url)}this._rectInPixels=b;this._rect=cc.rectPixelsToPoints(b);this._offsetInPixels.x=e.x;this._offsetInPixels.y=e.y;cc._pointPixelsToPointsOut(e,this._offset);this._originalSizeInPixels.width=f.width;this._originalSizeInPixels.height=f.height;cc._sizePixelsToPointsOut(f,this._originalSize);this._rotated=d;return!0}});cc.SpriteFrame.create=function(a,b,d,e,f){return new cc.SpriteFrame(a,b,d,e,f)};
cc.SpriteFrame._frameWithTextureForCanvas=function(a,b,d,e,f){var g=new cc.SpriteFrame;g._texture=a;g._rectInPixels=b;g._rect=cc.rectPixelsToPoints(b);g._offsetInPixels.x=e.x;g._offsetInPixels.y=e.y;cc._pointPixelsToPointsOut(g._offsetInPixels,g._offset);g._originalSizeInPixels.width=f.width;g._originalSizeInPixels.height=f.height;cc._sizePixelsToPointsOut(g._originalSizeInPixels,g._originalSize);g._rotated=d;return g};cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(a){return(a=this._CCNS_REG2.exec(a))?cc.rect(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4])):cc.rect(0,0,0,0)},_pointFromString:function(a){return(a=this._CCNS_REG1.exec(a))?
cc.p(parseFloat(a[1]),parseFloat(a[2])):cc.p(0,0)},_sizeFromString:function(a){return(a=this._CCNS_REG1.exec(a))?cc.size(parseFloat(a[1]),parseFloat(a[2])):cc.size(0,0)},_getFrameConfig:function(a){var b=cc.loader.getRes(a);cc.assert(b,cc._LogInfos.spriteFrameCache__getFrameConfig_2,a);cc.loader.release(a);if(b._inited)return this._frameConfigCache[a]=b;var d=b.frames,e=b.metadata||b.meta,b={},f={},g=0;e&&(g=e.format,g=1>=g.length?parseInt(g):g,f.image=e.textureFileName||e.textureFileName||e.image);
for(var h in d){var k=d[h];if(k){e={};if(0==g){e.rect=cc.rect(k.x,k.y,k.width,k.height);e.rotated=!1;e.offset=cc.p(k.offsetX,k.offsetY);var m=k.originalWidth,k=k.originalHeight;m&&k||cc.log(cc._LogInfos.spriteFrameCache__getFrameConfig);m=Math.abs(m);k=Math.abs(k);e.size=cc.size(m,k)}else if(1==g||2==g)e.rect=this._rectFromString(k.frame),e.rotated=k.rotated||!1,e.offset=this._pointFromString(k.offset),e.size=this._sizeFromString(k.sourceSize);else if(3==g){var m=this._sizeFromString(k.spriteSize),
n=this._rectFromString(k.textureRect);m&&(n=cc.rect(n.x,n.y,m.width,m.height));e.rect=n;e.rotated=k.textureRotated||!1;e.offset=this._pointFromString(k.spriteOffset);e.size=this._sizeFromString(k.spriteSourceSize);e.aliases=k.aliases}else m=k.frame,n=k.sourceSize,h=k.filename||h,e.rect=cc.rect(m.x,m.y,m.w,m.h),e.rotated=k.rotated||!1,e.offset=cc.p(0,0),e.size=cc.size(n.w,n.h);b[h]=e}}return this._frameConfigCache[a]={_inited:!0,frames:b,meta:f}},addSpriteFrames:function(a,b){cc.assert(a,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);
var d=this._frameConfigCache[a]||cc.loader.getRes(a);if(d&&d.frames){var e=this._frameConfigCache[a]||this._getFrameConfig(a),d=e.frames,e=e.meta;b?b instanceof cc.Texture2D||("string"==typeof b?b=cc.textureCache.addImage(b):cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3)):(e=cc.path.changeBasename(a,e.image||".png"),b=cc.textureCache.addImage(e));var e=this._spriteFramesAliases,f=this._spriteFrames,g;for(g in d){var h=d[g],k=f[g];if(!k){k=cc.SpriteFrame.create(b,h.rect,h.rotated,h.offset,
h.size);if(h=h.aliases)for(var m=0,n=h.length;m<n;m++){var q=h[m];e[q]&&cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,q);e[q]=g}cc._renderType===cc._RENDER_TYPE_CANVAS&&k.isRotated()&&k.getTexture().isLoaded()&&(h=k.getTexture().getHtmlElementObj(),h=cc.cutRotateImageToCanvas(h,k.getRectInPixels()),m=new cc.Texture2D,m.initWithElement(h),m.handleLoadedTexture(),k.setTexture(m),h=k._rect,k.setRect(cc.rect(0,0,h.width,h.height)));f[g]=k}}}},_checkConflict:function(a){a=a.frames;for(var b in a)this._spriteFrames[b]&&
cc.log(cc._LogInfos.spriteFrameCache__checkConflict,b)},addSpriteFrame:function(a,b){this._spriteFrames[b]=a},removeSpriteFrames:function(){this._spriteFrames={};this._spriteFramesAliases={}},removeSpriteFrameByName:function(a){a&&(this._spriteFramesAliases[a]&&delete this._spriteFramesAliases[a],this._spriteFrames[a]&&delete this._spriteFrames[a])},removeSpriteFramesFromFile:function(a){var b=this._spriteFrames,d=this._spriteFramesAliases;if(a=this._frameConfigCache[a]){a=a.frames;for(var e in a)if(b[e]){delete b[e];
for(var f in d)d[f]==e&&delete d[f]}}},removeSpriteFramesFromTexture:function(a){var b=this._spriteFrames,d=this._spriteFramesAliases,e;for(e in b){var f=b[e];if(f&&f.getTexture()==a){delete b[e];for(var g in d)d[g]==e&&delete d[g]}}},getSpriteFrame:function(a){var b=this._spriteFrames[a];if(!b){var d=this._spriteFramesAliases[a];d&&((b=this._spriteFrames[d.toString()])||delete this._spriteFramesAliases[a])}b||cc.log(cc._LogInfos.spriteFrameCache_getSpriteFrame,a);return b},_clear:function(){this._spriteFrames=
{};this._spriteFramesAliases={};this._frameConfigCache={}}};cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var a=this._valueDict;a["cocos2d.x.version"]=cc.ENGINE_VERSION;a["cocos2d.x.compiled_with_profiler"]=!1;a["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE;this._inited=
!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},
supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(a){return-1<this._GlExtensions.indexOf(a)},getValue:function(a,b){this._inited||this._init();var d=this._valueDict;return d[a]?d[a]:b},setValue:function(a,b){this._valueDict[a]=b},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc._RENDER_TYPE_CANVAS){this._inited||this._init();var a=cc._renderContext,
b=this._valueDict;b["gl.vendor"]=a.getParameter(a.VENDOR);b["gl.renderer"]=a.getParameter(a.RENDERER);b["gl.version"]=a.getParameter(a.VERSION);this._GlExtensions="";for(var d=a.getSupportedExtensions(),e=0;e<d.length;e++)this._GlExtensions+=d[e]+" ";this._maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);b["gl.max_texture_size"]=this._maxTextureSize;this._maxTextureUnits=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS);b["gl.max_texture_units"]=this._maxTextureUnits;this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc");
b["gl.supports_PVRTC"]=this._supportsPVRTC;this._supportsNPOT=!1;b["gl.supports_NPOT"]=this._supportsNPOT;this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888");b["gl.supports_BGRA8888"]=this._supportsBGRA8888;this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer");b["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer;this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object");b["gl.supports_vertex_array_object"]=
this._supportsShareableVAO;cc.checkGLErrorDebug()}},loadConfigFile:function(a){this._inited||this._init();var b=cc.loader.getRes(a);if(!b)throw"Please load the resource first : "+a;cc.assert(b,cc._LogInfos.configuration_loadConfigFile_2,a);if(b=b.data)for(var d in b)this._valueDict[d]=b[d];else cc.log(cc._LogInfos.configuration_loadConfigFile,a)}};cc._tmp.DirectorWebGL=function(){cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var a=cc.Director.prototype;a.setProjection=function(a){var d=this._winSizeInPoints;this.setViewport();var e=this._openGLView,f=e._viewPortRect.x/e._scaleX,g=e._viewPortRect.y/e._scaleY;switch(a){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLLoadIdentity();e=new cc.kmMat4;cc.kmMat4OrthographicProjection(e,0,d.width,0,d.height,-1024,1024);cc.kmGLMultMatrix(e);cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);
cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var h=this.getZEye(),k=new cc.kmMat4,e=new cc.kmMat4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLLoadIdentity();cc.kmMat4PerspectiveProjection(k,60,d.width/d.height,0.1,2*h);cc.kmGLMultMatrix(k);cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLLoadIdentity();h=cc.kmVec3Fill(null,-f+d.width/2,-g+d.height/2,h);d=cc.kmVec3Fill(null,-f+d.width/2,-g+d.height/2,0);f=cc.kmVec3Fill(null,0,1,0);cc.kmMat4LookAt(e,h,d,f);cc.kmGLMultMatrix(e);break;case cc.Director.PROJECTION_CUSTOM:this._projectionDelegate&&
this._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director_setProjection)}this._projection=a;cc.eventManager.dispatchEvent(this._eventProjectionChanged);cc.setProjectionMatrixDirty()};a.setDepthTest=function(a){var d=cc._renderContext;a?(d.clearDepth(1),d.enable(d.DEPTH_TEST),d.depthFunc(d.LEQUAL)):d.disable(d.DEPTH_TEST)};a.setOpenGLView=function(a){this._winSizeInPoints.width=cc._canvas.width;this._winSizeInPoints.height=cc._canvas.height;this._openGLView=a||cc.view;
a=cc.configuration;a.gatherGPUInfo();a.dumpInfo();this._createStatsLabel();this.setGLDefaultValues();cc.eventManager&&cc.eventManager.setEnabled(!0)};a._clear=function(){var a=cc._renderContext;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)};a._beforeVisitScene=function(){cc.kmGLPushMatrix()};a._afterVisitScene=function(){cc.kmGLPopMatrix()};a._createStatsLabel=function(){if(!cc.LabelAtlas)this._createStatsLabelForCanvas();else if(null!=cc.Director._fpsImageLoaded&&!1!=cc.Director._fpsImageLoaded){var a=
new cc.Texture2D;a.initWithElement(cc.Director._fpsImage);a.handleLoadedTexture();var d=cc.view.getDesignResolutionSize().height/320;0===d&&(d=this._winSizeInPoints.height/320);var e=new cc.LabelAtlas;e._setIgnoreContentScaleFactor(!0);e.initWithString("00.0",a,12,32,".");e.scale=d;this._FPSLabel=e;e=new cc.LabelAtlas;e._setIgnoreContentScaleFactor(!0);e.initWithString("0.000",a,12,32,".");e.scale=d;this._SPFLabel=e;e=new cc.LabelAtlas;e._setIgnoreContentScaleFactor(!0);e.initWithString("000",a,12,
32,".");e.scale=d;this._drawsLabel=e;a=cc.DIRECTOR_STATS_POSITION;this._drawsLabel.setPosition(a.x,34*d+a.y);this._SPFLabel.setPosition(a.x,17*d+a.y);this._FPSLabel.setPosition(a)}};a._createStatsLabelForCanvas=function(){var a=0,a=this._winSizeInPoints.width>this._winSizeInPoints.height?0|this._winSizeInPoints.height/320*24:0|this._winSizeInPoints.width/320*24;this._FPSLabel=cc.LabelTTF.create("000.0","Arial",a);this._SPFLabel=cc.LabelTTF.create("0.000","Arial",a);this._drawsLabel=cc.LabelTTF.create("0000",
"Arial",a);a=cc.DIRECTOR_STATS_POSITION;this._drawsLabel.setPosition(this._drawsLabel.width/2+a.x,5*this._drawsLabel.height/2+a.y);this._SPFLabel.setPosition(this._SPFLabel.width/2+a.x,3*this._SPFLabel.height/2+a.y);this._FPSLabel.setPosition(this._FPSLabel.width/2+a.x,this._FPSLabel.height/2+a.y)};a.convertToGL=function(a){var d=new cc.kmMat4;cc.GLToClipTransform(d);var e=new cc.kmMat4;cc.kmMat4Inverse(e,d);var d=d.mat[14]/d.mat[15],f=this._openGLView.getDesignResolutionSize();a=new cc.kmVec3(2*
a.x/f.width-1,1-2*a.y/f.height,d);d=new cc.kmVec3;cc.kmVec3TransformCoord(d,a,e);return cc.p(d.x,d.y)};a.convertToUI=function(a){var d=new cc.kmMat4;cc.GLToClipTransform(d);var e=new cc.kmVec3;a=new cc.kmVec3(a.x,a.y,0);cc.kmVec3TransformCoord(e,a,d);d=this._openGLView.getDesignResolutionSize();return cc.p(d.width*(0.5*e.x+0.5),d.height*(0.5*-e.y+0.5))};a.getVisibleSize=function(){return this._openGLView.getVisibleSize()};a.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()};a.getZEye=
function(){return this._winSizeInPoints.height/1.1566};a.setViewport=function(){var a=this._openGLView;if(a){var d=this._winSizeInPoints;a.setViewPortInPoints(-a._viewPortRect.x/a._scaleX,-a._viewPortRect.y/a._scaleY,d.width,d.height)}};a.getOpenGLView=function(){return this._openGLView};a.getProjection=function(){return this._projection};a.setAlphaBlending=function(a){a?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)};a.setGLDefaultValues=function(){this.setAlphaBlending(!0);
this.setDepthTest(!1);this.setProjection(this._projection);cc._renderContext.clearColor(0,0,0,1)}};cc.g_NumberOfDraws=0;cc.GLToClipTransform=function(a){var b=new cc.kmMat4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,b);var d=new cc.kmMat4;cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,d);cc.kmMat4Multiply(a,b,d)};
cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_accumDt:0,_contentScaleFactor:1,_displayStats:!1,_deltaTime:0,_frameRate:0,_FPSLabel:null,_SPFLabel:null,_drawsLabel:null,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_frames:0,_totalFrames:0,_secondsPerFrame:0,
_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterDraw:null,_eventAfterVisit:null,_eventAfterUpdate:null,ctor:function(){var a=this;a._lastUpdate=Date.now();cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){a._lastUpdate=Date.now()})},init:function(){this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS;this._scenesStack=[];this._projection=cc.Director.PROJECTION_DEFAULT;this._projectionDelegate=null;this._frameRate=this._accumDt=
0;this._displayStats=!1;this._totalFrames=this._frames=0;this._lastUpdate=Date.now();this._purgeDirectorInNextLoop=this._paused=!1;this._winSizeInPoints=cc.size(0,0);this._openGLView=null;this._contentScaleFactor=1;this._scheduler=new cc.Scheduler;this._actionManager=cc.ActionManager?new cc.ActionManager:null;this._scheduler.scheduleUpdateForTarget(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1);this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW);this._eventAfterDraw.setUserData(this);
this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT);this._eventAfterVisit.setUserData(this);this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE);this._eventAfterUpdate.setUserData(this);this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED);this._eventProjectionChanged.setUserData(this);return!0},calculateDeltaTime:function(){var a=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=
(a-this._lastUpdate)/1E3;0<cc.game.config[cc.game.CONFIG_KEY.debugMode]&&0.2<this._deltaTime&&(this._deltaTime=1/60);this._lastUpdate=a},drawScene:function(){this.calculateDeltaTime();this._paused||(this._scheduler.update(this._deltaTime),cc.eventManager.dispatchEvent(this._eventAfterUpdate));this._clear();this._nextScene&&this.setNextScene();this._beforeVisitScene&&this._beforeVisitScene();this._runningScene&&(this._runningScene.visit(),cc.eventManager.dispatchEvent(this._eventAfterVisit));this._notificationNode&&
this._notificationNode.visit();this._displayStats&&this._showStats();this._afterVisitScene&&this._afterVisitScene();cc.eventManager.dispatchEvent(this._eventAfterDraw);this._totalFrames++;this._displayStats&&this._calculateMPF()},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return this._winSizeInPoints},
getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(0.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene);this._scenesStack.pop();var a=this._scenesStack.length;0==a?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[a-
1])},purgeCachedData:function(){cc.animationCache._clear();cc.spriteFrameCache._clear();cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAllCallbacks();cc.eventManager&&cc.eventManager.setEnabled(!1);this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup());this._nextScene=this._runningScene=null;this._scenesStack.length=0;this.stopAnimation();this.purgeCachedData();cc.checkGLErrorDebug()},pushScene:function(a){cc.assert(a,
cc._LogInfos.Director_pushScene);this._sendCleanupToScene=!1;this._scenesStack.push(a);this._nextScene=a},runScene:function(a){cc.assert(a,cc._LogInfos.Director_pushScene);if(this._runningScene){var b=this._scenesStack.length;0===b?(this._sendCleanupToScene=!0,this._scenesStack[b]=a):(this._sendCleanupToScene=!0,this._scenesStack[b-1]=a);this._nextScene=a}else this.pushScene(a),this.startAnimation()},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),(this._lastUpdate=
Date.now())||cc.log(cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(a){a!=this._contentScaleFactor&&(this._contentScaleFactor=a,this._createStatsLabel())},setDefaultValues:function(){},setNextDeltaTimeZero:function(a){this._nextDeltaTimeZero=a},setNextScene:function(){var a=!1,b=!1;cc.TransitionScene&&(a=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,b=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1);if(!b){if(b=
this._runningScene)b.onExitTransitionDidStart(),b.onExit();this._sendCleanupToScene&&b&&b.cleanup()}this._runningScene=this._nextScene;this._nextScene=null;a||null==this._runningScene||(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(a){this._notificationNode=a},getDelegate:function(){return this._projectionDelegate},setDelegate:function(a){this._projectionDelegate=a},_showStats:function(){this._frames++;this._accumDt+=this._deltaTime;this._FPSLabel&&
this._SPFLabel&&this._drawsLabel?(this._accumDt>cc.DIRECTOR_FPS_INTERVAL&&(this._SPFLabel.string=this._secondsPerFrame.toFixed(3),this._frameRate=this._frames/this._accumDt,this._accumDt=this._frames=0,this._FPSLabel.string=this._frameRate.toFixed(1),this._drawsLabel.string=(0|cc.g_NumberOfDraws).toString()),this._FPSLabel.visit(),this._SPFLabel.visit(),this._drawsLabel.visit()):this._createStatsLabel();cc.g_NumberOfDraws=0},isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},
getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return this._displayStats},setDisplayStats:function(a){this._displayStats=a},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(a){cc.assert(this._runningScene,
cc._LogInfos.Director_popToSceneStackLevel_2);var b=this._scenesStack,d=b.length;if(0==d)this.end();else if(!(a>d)){for(;d>a;){var e=b.pop();e.running&&(e.onExitTransitionDidStart(),e.onExit());e.cleanup();d--}this._nextScene=b[b.length-1];this._sendCleanupToScene=!1}},getScheduler:function(){return this._scheduler},setScheduler:function(a){this._scheduler!=a&&(this._scheduler=a)},getActionManager:function(){return this._actionManager},setActionManager:function(a){this._actionManager!=a&&(this._actionManager=
a)},getDeltaTime:function(){return this._deltaTime},_createStatsLabel:null,_calculateMPF:function(){this._secondsPerFrame=(Date.now()-this._lastUpdate)/1E3}});cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed";cc.Director.EVENT_AFTER_DRAW="director_after_draw";cc.Director.EVENT_AFTER_VISIT="director_after_visit";cc.Director.EVENT_AFTER_UPDATE="director_after_update";
cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0;this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(a){this._animationInterval=a;this.invalid||(this.stopAnimation(),this.startAnimation())}});cc.Director.sharedDirector=null;cc.Director.firstUseDirector=!0;
cc.Director._getInstance=function(){cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init());return cc.Director.sharedDirector};cc.defaultFPS=60;cc.Director.PROJECTION_2D=0;cc.Director.PROJECTION_3D=1;cc.Director.PROJECTION_CUSTOM=3;cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_3D;
cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.Director.prototype,_p.setProjection=function(a){this._projection=a;cc.eventManager.dispatchEvent(this._eventProjectionChanged)},_p.setDepthTest=function(){},_p.setOpenGLView=function(a){this._winSizeInPoints.width=cc._canvas.width;this._winSizeInPoints.height=cc._canvas.height;this._openGLView=a||cc.view;cc.eventManager&&cc.eventManager.setEnabled(!0)},_p._clear=function(){},_p._createStatsLabel=function(){var a=0,a=this._winSizeInPoints.width>this._winSizeInPoints.height?
0|this._winSizeInPoints.height/320*24:0|this._winSizeInPoints.width/320*24;this._FPSLabel=cc.LabelTTF.create("000.0","Arial",a);this._SPFLabel=cc.LabelTTF.create("0.000","Arial",a);this._drawsLabel=cc.LabelTTF.create("0000","Arial",a);a=cc.DIRECTOR_STATS_POSITION;this._drawsLabel.setPosition(this._drawsLabel.width/2+a.x,5*this._drawsLabel.height/2+a.y);this._SPFLabel.setPosition(this._SPFLabel.width/2+a.x,3*this._SPFLabel.height/2+a.y);this._FPSLabel.setPosition(this._FPSLabel.width/2+a.x,this._FPSLabel.height/
2+a.y)},_p.getVisibleSize=function(){return this.getWinSize()},_p.getVisibleOrigin=function(){return cc.p(0,0)}):(cc.Director._fpsImage=new Image,cc._addEventListener(cc.Director._fpsImage,"load",function(){cc.Director._fpsImageLoaded=!0}),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage),cc.assert("function"===typeof cc._tmp.DirectorWebGL,cc._LogInfos.MissingFile,"CCDirectorWebGL.js"),cc._tmp.DirectorWebGL(),delete cc._tmp.DirectorWebGL);cc.Camera=cc.Class.extend({_eyeX:null,_eyeY:null,_eyeZ:null,_centerX:null,_centerY:null,_centerZ:null,_upX:null,_upY:null,_upZ:null,_dirty:null,_lookupMatrix:null,ctor:function(){this._lookupMatrix=new cc.kmMat4;this.restore()},description:function(){return"\x3cCCCamera | center \x3d("+this._centerX+","+this._centerY+","+this._centerZ+")\x3e"},setDirty:function(a){this._dirty=a},isDirty:function(){return this._dirty},restore:function(){this._eyeX=this._eyeY=0;this._eyeZ=cc.Camera.getZEye();this._upX=
this._centerX=this._centerY=this._centerZ=0;this._upY=1;this._upZ=0;cc.kmMat4Identity(this._lookupMatrix);this._dirty=!1},locate:function(){if(this._dirty){var a=new cc.kmVec3,b=new cc.kmVec3,d=new cc.kmVec3;cc.kmVec3Fill(a,this._eyeX,this._eyeY,this._eyeZ);cc.kmVec3Fill(b,this._centerX,this._centerY,this._centerZ);cc.kmVec3Fill(d,this._upX,this._upY,this._upZ);cc.kmMat4LookAt(this._lookupMatrix,a,b,d);this._dirty=!1}cc.kmGLMultMatrix(this._lookupMatrix)},setEyeXYZ:function(a,b,d){this.setEye(a,b,
d)},setEye:function(a,b,d){this._eyeX=a;this._eyeY=b;this._eyeZ=d;this._dirty=!0},setCenterXYZ:function(a,b,d){this.setCenter(a,b,d)},setCenter:function(a,b,d){this._centerX=a;this._centerY=b;this._centerZ=d;this._dirty=!0},setUpXYZ:function(a,b,d){this.setUp(a,b,d)},setUp:function(a,b,d){this._upX=a;this._upY=b;this._upZ=d;this._dirty=!0},getEyeXYZ:function(a,b,d){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getEye:function(){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getCenterXYZ:function(a,
b,d){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getCenter:function(){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getUpXYZ:function(a,b,d){return{x:this._upX,y:this._upY,z:this._upZ}},getUp:function(){return{x:this._upX,y:this._upY,z:this._upZ}},_DISALLOW_COPY_AND_ASSIGN:function(a){}});cc.Camera.getZEye=function(){return cc.FLT_EPSILON};cc.PRIORITY_NON_SYSTEM=cc.PRIORITY_SYSTEM+1;cc.arrayVerifyType=function(a,b){if(a&&0<a.length)for(var d=0;d<a.length;d++)if(!(a[d]instanceof b))return cc.log(cc._LogInfos.arrayVerifyType),!1;return!0};cc.arrayRemoveObject=function(a,b){for(var d=0,e=a.length;d<e;d++)if(a[d]==b){a.splice(d,1);break}};cc.arrayRemoveArray=function(a,b){for(var d=0,e=b.length;d<e;d++)cc.arrayRemoveObject(a,b[d])};cc.arrayAppendObjectsToIndex=function(a,b,d){a.splice.apply(a,[d,0].concat(b));return a};
cc.ListEntry=function(a,b,d,e,f,g){this.prev=a;this.next=b;this.target=d;this.priority=e;this.paused=f;this.markedForDeletion=g};cc.HashUpdateEntry=function(a,b,d,e){this.list=a;this.entry=b;this.target=d;this.hh=e};cc.HashTimerEntry=function(a,b,d,e,f,g,h){this.timers=a;this.target=b;this.timerIndex=d;this.currentTimer=e;this.currentTimerSalvaged=f;this.paused=g;this.hh=h};
cc.Timer=cc.Class.extend({_interval:0,_callback:null,_target:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,getInterval:function(){return this._interval},setInterval:function(a){this._interval=a},getCallback:function(){return this._callback},ctor:function(a,b,d,e,f){this._target=a;this._callback=b;this._elapsed=-1;this._interval=d||0;this._delay=f||0;this._useDelay=0<this._delay;this._repeat=null==e?cc.REPEAT_FOREVER:e;this._runForever=this._repeat==cc.REPEAT_FOREVER},
_doCallback:function(){if("string"==typeof this._callback)this._target[this._callback](this._elapsed);else this._callback.call(this._target,this._elapsed)},update:function(a){if(-1==this._elapsed)this._timesExecuted=this._elapsed=0;else{var b=this._target,d=this._callback;this._elapsed+=a;this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(b&&d&&this._doCallback(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(b&&d&&this._doCallback(),this._elapsed-=this._delay,this._timesExecuted+=
1,this._useDelay=!1):this._elapsed>=this._interval&&(b&&d&&this._doCallback(),this._elapsed=0,this._timesExecuted+=1),this._timesExecuted>this._repeat&&cc.director.getScheduler().unscheduleCallbackForTarget(b,d))}}});
cc.Scheduler=cc.Class.extend({_timeScale:1,_updates:null,_hashForUpdates:null,_arrayForUpdates:null,_hashForTimers:null,_arrayForTimes:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1;this._updates=[[],[],[]];this._hashForUpdates={};this._arrayForUpdates=[];this._hashForTimers={};this._arrayForTimers=[];this._currentTarget=null;this._updateHashLocked=this._currentTargetSalvaged=!1},_removeHashElement:function(a){delete this._hashForTimers[a.target.__instanceId];
cc.arrayRemoveObject(this._arrayForTimers,a);a.Timer=null;a.target=null},_removeUpdateFromHash:function(a){if(a=this._hashForUpdates[a.target.__instanceId])cc.arrayRemoveObject(a.list,a.entry),delete this._hashForUpdates[a.target.__instanceId],cc.arrayRemoveObject(this._arrayForUpdates,a),a.entry=null,a.target=null},_priorityIn:function(a,b,d,e){e=new cc.ListEntry(null,null,b,d,e,!1);if(a){for(var f=a.length-1,g=0;g<=f&&!(d<a[g].priority);g++);a.splice(g,0,e)}else a=[],a.push(e);d=new cc.HashUpdateEntry(a,
e,b,null);this._arrayForUpdates.push(d);this._hashForUpdates[b.__instanceId]=d;return a},_appendIn:function(a,b,d){d=new cc.ListEntry(null,null,b,0,d,!1);a.push(d);a=new cc.HashUpdateEntry(a,d,b,null);this._arrayForUpdates.push(a);this._hashForUpdates[b.__instanceId]=a},setTimeScale:function(a){this._timeScale=a},getTimeScale:function(){return this._timeScale},update:function(a){var b=this._updates,d=this._arrayForTimers,e,f,g;this._updateHashLocked=!0;1!=this._timeScale&&(a*=this._timeScale);f=0;
for(g=b.length;f<g&&0<=f;f++)for(var h=this._updates[f],k=0,m=h.length;k<m;k++)e=h[k],e.paused||e.markedForDeletion||e.target.update(a);f=0;for(g=d.length;f<g;f++){e=d[f];if(!e)break;this._currentTarget=e;this._currentTargetSalvaged=!1;if(!e.paused)for(e.timerIndex=0;e.timerIndex<e.timers.length;e.timerIndex++)e.currentTimer=e.timers[e.timerIndex],e.currentTimerSalvaged=!1,e.currentTimer.update(a),e.currentTimer=null;this._currentTargetSalvaged&&0==e.timers.length&&(this._removeHashElement(e),f--)}f=
0;for(g=b.length;f<g;f++)for(h=this._updates[f],k=0,m=h.length;k<m;){e=h[k];if(!e)break;e.markedForDeletion?this._removeUpdateFromHash(e):k++}this._updateHashLocked=!1;this._currentTarget=null},scheduleCallbackForTarget:function(a,b,d,e,f,g){cc.assert(b,cc._LogInfos.Scheduler_scheduleCallbackForTarget_2);cc.assert(a,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);d=d||0;e=null==e?cc.REPEAT_FOREVER:e;f=f||0;g=g||!1;var h=this._hashForTimers[a.__instanceId];h||(h=new cc.HashTimerEntry(null,a,0,
null,null,g,null),this._arrayForTimers.push(h),this._hashForTimers[a.__instanceId]=h);if(null==h.timers)h.timers=[];else for(var k=0;k<h.timers.length;k++)if(g=h.timers[k],b==g._callback){cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,g.getInterval().toFixed(4),d.toFixed(4));g._interval=d;return}g=new cc.Timer(a,b,d,e,f);h.timers.push(g)},scheduleUpdateForTarget:function(a,b,d){if(null!==a){var e=this._updates,f=this._hashForUpdates[a.__instanceId];f?f.entry.markedForDeletion=!1:0==b?this._appendIn(e[1],
a,d):0>b?e[0]=this._priorityIn(e[0],a,b,d):e[2]=this._priorityIn(e[2],a,b,d)}},unscheduleCallbackForTarget:function(a,b){if(null!=a&&null!=b){var d=this._hashForTimers[a.__instanceId];if(d)for(var e=d.timers,f=0,g=e.length;f<g;f++){var h=e[f];if(b==h._callback){h!=d.currentTimer||d.currentTimerSalvaged||(d.currentTimerSalvaged=!0);e.splice(f,1);d.timerIndex>=f&&d.timerIndex--;0==e.length&&(this._currentTarget==d?this._currentTargetSalvaged=!0:this._removeHashElement(d));break}}}},unscheduleUpdateForTarget:function(a){null!=
a&&(a=this._hashForUpdates[a.__instanceId],null!=a&&(this._updateHashLocked?a.entry.markedForDeletion=!0:this._removeUpdateFromHash(a.entry)))},unscheduleAllCallbacksForTarget:function(a){if(null!=a){var b=this._hashForTimers[a.__instanceId];if(b){var d=b.timers;!b.currentTimerSalvaged&&0<=d.indexOf(b.currentTimer)&&(b.currentTimerSalvaged=!0);d.length=0;this._currentTarget==b?this._currentTargetSalvaged=!0:this._removeHashElement(b)}this.unscheduleUpdateForTarget(a)}},unscheduleAllCallbacks:function(){this.unscheduleAllCallbacksWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},
unscheduleAllCallbacksWithMinPriority:function(a){for(var b=this._arrayForTimers,d=this._updates,e=0,f=b.length;e<f;e++)this.unscheduleAllCallbacksForTarget(b[e].target);for(e=2;0<=e;e--)if(!(1==e&&0<a||0==e&&0<=a))for(var b=d[e],f=0,g=b.length;f<g;f++)this.unscheduleUpdateForTarget(b[f].target)},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(a){a=[];for(var b,d=this._arrayForTimers,e=this._updates,f=0,g=
d.length;f<g;f++)if(b=d[f])b.paused=!0,a.push(b.target);f=0;for(g=e.length;f<g;f++)for(var d=e[f],h=0,k=d.length;h<k;h++)if(b=d[h])b.paused=!0,a.push(b.target);return a},resumeTargets:function(a){if(a)for(var b=0;b<a.length;b++)this.resumeTarget(a[b])},pauseTarget:function(a){cc.assert(a,cc._LogInfos.Scheduler_pauseTarget);var b=this._hashForTimers[a.__instanceId];b&&(b.paused=!0);if(a=this._hashForUpdates[a.__instanceId])a.entry.paused=!0},resumeTarget:function(a){cc.assert(a,cc._LogInfos.Scheduler_resumeTarget);
var b=this._hashForTimers[a.__instanceId];b&&(b.paused=!1);if(a=this._hashForUpdates[a.__instanceId])a.entry.paused=!1},isTargetPaused:function(a){cc.assert(a,cc._LogInfos.Scheduler_isTargetPaused);return(a=this._hashForTimers[a.__instanceId])?a.paused:!1}});cc.Scheduler.PRIORITY_SYSTEM=-2147483648;cc.PI2=2*Math.PI;
cc.DrawingPrimitiveCanvas=cc.Class.extend({_cacheArray:[],_renderContext:null,ctor:function(a){this._renderContext=a},drawPoint:function(a,b){b||(b=1);var d=cc.view.getScaleX(),e=cc.view.getScaleY(),e=cc.p(a.x*d,a.y*e);this._renderContext.beginPath();this._renderContext.arc(e.x,-e.y,b*d,0,2*Math.PI,!1);this._renderContext.closePath();this._renderContext.fill()},drawPoints:function(a,b,d){if(null!=a){d||(d=1);b=this._renderContext;var e=cc.view.getScaleX(),f=cc.view.getScaleY();b.beginPath();for(var g=
0,h=a.length;g<h;g++)b.arc(a[g].x*e,-a[g].y*f,d*e,0,2*Math.PI,!1);b.closePath();b.fill()}},drawLine:function(a,b){var d=this._renderContext,e=cc.view.getScaleX(),f=cc.view.getScaleY();d.beginPath();d.moveTo(a.x*e,-a.y*f);d.lineTo(b.x*e,-b.y*f);d.closePath();d.stroke()},drawRect:function(a,b){this.drawLine(cc.p(a.x,a.y),cc.p(b.x,a.y));this.drawLine(cc.p(b.x,a.y),cc.p(b.x,b.y));this.drawLine(cc.p(b.x,b.y),cc.p(a.x,b.y));this.drawLine(cc.p(a.x,b.y),cc.p(a.x,a.y))},drawSolidRect:function(a,b,d){a=[a,
cc.p(b.x,a.y),b,cc.p(a.x,b.y)];this.drawSolidPoly(a,4,d)},drawPoly:function(a,b,d,e){e=e||!1;if(null!=a){if(3>a.length)throw Error("Polygon's point must greater than 2");var f=a[0];b=this._renderContext;var g=cc.view.getScaleX(),h=cc.view.getScaleY();b.beginPath();b.moveTo(f.x*g,-f.y*h);for(var f=1,k=a.length;f<k;f++)b.lineTo(a[f].x*g,-a[f].y*h);d&&b.closePath();e?b.fill():b.stroke()}},drawSolidPoly:function(a,b,d){this.setDrawColor(d.r,d.g,d.b,d.a);this.drawPoly(a,b,!0,!0)},drawCircle:function(a,
b,d,e,f){f=f||!1;e=this._renderContext;var g=cc.view.getScaleX(),h=cc.view.getScaleY();e.beginPath();e.arc(0|a.x*g,0|-(a.y*h),b*g,-d,-(d-2*Math.PI),!1);f&&e.lineTo(0|a.x*g,0|-(a.y*h));e.stroke()},drawQuadBezier:function(a,b,d,e){for(var f=this._cacheArray,g=f.length=0,h=0;h<e;h++){var k=Math.pow(1-g,2)*a.x+2*(1-g)*g*b.x+g*g*d.x,m=Math.pow(1-g,2)*a.y+2*(1-g)*g*b.y+g*g*d.y;f.push(cc.p(k,m));g+=1/e}f.push(cc.p(d.x,d.y));this.drawPoly(f,e+1,!1,!1)},drawCubicBezier:function(a,b,d,e,f){for(var g=this._cacheArray,
h=g.length=0,k=0;k<f;k++){var m=Math.pow(1-h,3)*a.x+3*Math.pow(1-h,2)*h*b.x+3*(1-h)*h*h*d.x+h*h*h*e.x,n=Math.pow(1-h,3)*a.y+3*Math.pow(1-h,2)*h*b.y+3*(1-h)*h*h*d.y+h*h*h*e.y;g.push(cc.p(m,n));h+=1/f}g.push(cc.p(e.x,e.y));this.drawPoly(g,f+1,!1,!1)},drawCatmullRom:function(a,b){this.drawCardinalSpline(a,0.5,b)},drawCardinalSpline:function(a,b,d){cc._renderContext.strokeStyle="rgba(255,255,255,1)";var e=this._cacheArray;e.length=0;for(var f,g,h=1/a.length,k=0;k<d+1;k++)g=k/d,1==g?(f=a.length-1,g=1):
(f=0|g/h,g=(g-h*f)/h),f=cc.CardinalSplineAt(cc.getControlPointAt(a,f-1),cc.getControlPointAt(a,f-0),cc.getControlPointAt(a,f+1),cc.getControlPointAt(a,f+2),b,g),e.push(f);this.drawPoly(e,d+1,!1,!1)},drawImage:function(a,b,d,e,f){switch(arguments.length){case 2:this._renderContext.drawImage(a,b.x,-(b.y+a.height));break;case 3:this._renderContext.drawImage(a,b.x,-(b.y+d.height),d.width,d.height);break;case 5:this._renderContext.drawImage(a,b.x,b.y,d.width,d.height,e.x,-(e.y+f.height),f.width,f.height);
break;default:throw Error("Argument must be non-nil");}},drawStar:function(a,b,d){a=a||this._renderContext;b*=cc.view.getScaleX();d="rgba("+(0|d.r)+","+(0|d.g)+","+(0|d.b);a.fillStyle=d+",1)";var e=b/10;a.beginPath();a.moveTo(-b,b);a.lineTo(0,e);a.lineTo(b,b);a.lineTo(e,0);a.lineTo(b,-b);a.lineTo(0,-e);a.lineTo(-b,-b);a.lineTo(-e,0);a.lineTo(-b,b);a.closePath();a.fill();var f=a.createRadialGradient(0,0,e,0,0,b);f.addColorStop(0,d+", 1)");f.addColorStop(0.3,d+", 0.8)");f.addColorStop(1,d+", 0.0)");
a.fillStyle=f;a.beginPath();a.arc(0,0,b-e,0,cc.PI2,!1);a.closePath();a.fill()},drawColorBall:function(a,b,d){a=a||this._renderContext;b*=cc.view.getScaleX();d="rgba("+(0|d.r)+","+(0|d.g)+","+(0|d.b);var e=a.createRadialGradient(0,0,b/10,0,0,b);e.addColorStop(0,d+", 1)");e.addColorStop(0.3,d+", 0.8)");e.addColorStop(0.6,d+", 0.4)");e.addColorStop(1,d+", 0.0)");a.fillStyle=e;a.beginPath();a.arc(0,0,b,0,cc.PI2,!1);a.closePath();a.fill()},fillText:function(a,b,d){this._renderContext.fillText(a,b,-d)},
setDrawColor:function(a,b,d,e){this._renderContext.fillStyle="rgba("+a+","+b+","+d+","+e/255+")";this._renderContext.strokeStyle="rgba("+a+","+b+","+d+","+e/255+")"},setPointSize:function(a){},setLineWidth:function(a){this._renderContext.lineWidth=a*cc.view.getScaleX()}});cc.DrawingPrimitiveWebGL=cc.Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:-1,_colorArray:null,_pointSizeLocation:-1,_pointSize:-1,ctor:function(a){null==a&&(a=cc._renderContext);if(!a instanceof WebGLRenderingContext)throw"Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext";this._renderContext=a;this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){this._initialized||(this._shader=cc.shaderCache.programForKey(cc.SHADER_POSITION_UCOLOR),
this._colorLocation=this._renderContext.getUniformLocation(this._shader.getProgram(),"u_color"),this._pointSizeLocation=this._renderContext.getUniformLocation(this._shader.getProgram(),"u_pointSize"),this._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(a){this.lazy_init();var b=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);b.uniform4fv(this._colorLocation,
this._colorArray);this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var d=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,d);b.bufferData(b.ARRAY_BUFFER,new Float32Array([a.x,a.y]),b.STATIC_DRAW);b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,0,0);b.drawArrays(b.POINTS,0,1);b.deleteBuffer(d);cc.incrementGLDraws(1)},drawPoints:function(a,b){if(a&&0!=a.length){this.lazy_init();var d=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();
cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);d.uniform4fv(this._colorLocation,this._colorArray);this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var e=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,e);d.bufferData(d.ARRAY_BUFFER,this._pointsToTypeArray(a),d.STATIC_DRAW);d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,0);d.drawArrays(d.POINTS,0,a.length);d.deleteBuffer(e);cc.incrementGLDraws(1)}},_pointsToTypeArray:function(a){for(var b=new Float32Array(2*
a.length),d=0;d<a.length;d++)b[2*d]=a[d].x,b[2*d+1]=a[d].y;return b},drawLine:function(a,b){this.lazy_init();var d=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);d.uniform4fv(this._colorLocation,this._colorArray);var e=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,e);d.bufferData(d.ARRAY_BUFFER,this._pointsToTypeArray([a,b]),d.STATIC_DRAW);d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,
2,d.FLOAT,!1,0,0);d.drawArrays(d.LINES,0,2);d.deleteBuffer(e);cc.incrementGLDraws(1)},drawRect:function(a,b){this.drawLine(cc.p(a.x,a.y),cc.p(b.x,a.y));this.drawLine(cc.p(b.x,a.y),cc.p(b.x,b.y));this.drawLine(cc.p(b.x,b.y),cc.p(a.x,b.y));this.drawLine(cc.p(a.x,b.y),cc.p(a.x,a.y))},drawSolidRect:function(a,b,d){a=[a,cc.p(b.x,a.y),b,cc.p(a.x,b.y)];this.drawSolidPoly(a,4,d)},drawPoly:function(a,b,d){this.lazy_init();b=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();
cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);b.uniform4fv(this._colorLocation,this._colorArray);var e=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,e);b.bufferData(b.ARRAY_BUFFER,this._pointsToTypeArray(a),b.STATIC_DRAW);b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,0,0);d?b.drawArrays(b.LINE_LOOP,0,a.length):b.drawArrays(b.LINE_STRIP,0,a.length);b.deleteBuffer(e);cc.incrementGLDraws(1)},drawSolidPoly:function(a,b,d){this.lazy_init();d&&this.setDrawColor(d.r,d.g,d.b,d.a);
b=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);b.uniform4fv(this._colorLocation,this._colorArray);d=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,d);b.bufferData(b.ARRAY_BUFFER,this._pointsToTypeArray(a),b.STATIC_DRAW);b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,0,0);b.drawArrays(b.TRIANGLE_FAN,0,a.length);b.deleteBuffer(d);cc.incrementGLDraws(1)},drawCircle:function(a,
b,d,e,f){this.lazy_init();var g=1;f&&g++;var h=2*Math.PI/e;if(f=new Float32Array(2*(e+2))){for(var k=0;k<=e;k++){var m=k*h,n=b*Math.cos(m+d)+a.x,m=b*Math.sin(m+d)+a.y;f[2*k]=n;f[2*k+1]=m}f[2*(e+1)]=a.x;f[2*(e+1)+1]=a.y;a=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);a.uniform4fv(this._colorLocation,this._colorArray);b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,
f,a.STATIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0);a.drawArrays(a.LINE_STRIP,0,e+g);a.deleteBuffer(b);cc.incrementGLDraws(1)}},drawQuadBezier:function(a,b,d,e){this.lazy_init();for(var f=new Float32Array(2*(e+1)),g=0,h=0;h<e;h++)f[2*h]=Math.pow(1-g,2)*a.x+2*(1-g)*g*b.x+g*g*d.x,f[2*h+1]=Math.pow(1-g,2)*a.y+2*(1-g)*g*b.y+g*g*d.y,g+=1/e;f[2*e]=d.x;f[2*e+1]=d.y;a=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);
a.uniform4fv(this._colorLocation,this._colorArray);b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,f,a.STATIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0);a.drawArrays(a.LINE_STRIP,0,e+1);a.deleteBuffer(b);cc.incrementGLDraws(1)},drawCubicBezier:function(a,b,d,e,f){this.lazy_init();for(var g=new Float32Array(2*(f+1)),h=0,k=0;k<f;k++)g[2*k]=Math.pow(1-h,3)*a.x+3*Math.pow(1-h,2)*h*b.x+3*(1-h)*h*h*d.x+h*h*h*e.x,g[2*k+1]=Math.pow(1-h,3)*a.y+3*Math.pow(1-
h,2)*h*b.y+3*(1-h)*h*h*d.y+h*h*h*e.y,h+=1/f;g[2*f]=e.x;g[2*f+1]=e.y;a=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);a.uniform4fv(this._colorLocation,this._colorArray);b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,g,a.STATIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0);a.drawArrays(a.LINE_STRIP,0,f+1);a.deleteBuffer(b);cc.incrementGLDraws(1)},
drawCatmullRom:function(a,b){this.drawCardinalSpline(a,0.5,b)},drawCardinalSpline:function(a,b,d){this.lazy_init();for(var e=new Float32Array(2*(d+1)),f,g,h=1/a.length,k=0;k<d+1;k++)g=k/d,1==g?(f=a.length-1,g=1):(f=0|g/h,g=(g-h*f)/h),f=cc.CardinalSplineAt(cc.getControlPointAt(a,f-1),cc.getControlPointAt(a,f),cc.getControlPointAt(a,f+1),cc.getControlPointAt(a,f+2),b,g),e[2*k]=f.x,e[2*k+1]=f.y;a=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();
cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION);a.uniform4fv(this._colorLocation,this._colorArray);b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0);a.drawArrays(a.LINE_STRIP,0,d+1);a.deleteBuffer(b);cc.incrementGLDraws(1)},setDrawColor:function(a,b,d,e){this._colorArray[0]=a/255;this._colorArray[1]=b/255;this._colorArray[2]=d/255;this._colorArray[3]=e/255},setPointSize:function(a){this._pointSize=
a*cc.contentScaleFactor()},setLineWidth:function(a){this._renderContext.lineWidth&&this._renderContext.lineWidth(a)}});cc._tmp.WebGLLabelTTF=function(){var a=cc.LabelTTF.prototype;a.setColor=cc.Sprite.prototype.setColor;a._setColorsString=function(){this._needUpdateTexture=!0;var a=this._strokeColor,d=this._textFillColor;this._shadowColorStr="rgba(128,128,128,"+this._shadowOpacity+")";this._fillColorStr="rgba("+(0|d.r)+","+(0|d.g)+","+(0|d.b)+", 1)";this._strokeColorStr="rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+", 1)"};a.updateDisplayedColor=cc.Sprite.prototype.updateDisplayedColor;a.setOpacity=cc.Sprite.prototype.setOpacity;
a.updateDisplayedOpacity=cc.Sprite.prototype.updateDisplayedOpacity;a.initWithStringAndTextDefinition=function(a,d){if(!cc.Sprite.prototype.init.call(this))return!1;this.shaderProgram=cc.shaderCache.programForKey(cc.LabelTTF._SHADER_PROGRAM);this._updateWithTextDefinition(d,!1);this.string=a;return!0};a.setFontFillColor=function(a){var d=this._textFillColor;if(d.r!=a.r||d.g!=a.g||d.b!=a.b)d.r=a.r,d.g=a.g,d.b=a.b,this._setColorsString(),this._needUpdateTexture=!0};a.draw=function(a){if(this._string&&
""!=this._string){a=a||cc._renderContext;var d=this._texture;d&&d._isLoaded&&(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2D(d),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),a.bindBuffer(a.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(a.bufferData(a.ARRAY_BUFFER,this._quad.arrayBuffer,a.STATIC_DRAW),this._quadDirty=!1),a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,
3,a.FLOAT,!1,24,0),a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,24,16),a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,24,12),a.drawArrays(a.TRIANGLE_STRIP,0,4));if(1===cc.SPRITE_DEBUG_DRAW)a=this._quad,a=[cc.p(a.tl.vertices.x,a.tl.vertices.y),cc.p(a.bl.vertices.x,a.bl.vertices.y),cc.p(a.br.vertices.x,a.br.vertices.y),cc.p(a.tr.vertices.x,a.tr.vertices.y)],cc._drawingUtil.drawPoly(a,4,!0);else if(2===cc.SPRITE_DEBUG_DRAW){a=this.getTextureRect()._size;var d=this.offsetX,
e=this.offsetY;a=[cc.p(d,e),cc.p(d+a.width,e),cc.p(d+a.width,e+a.height),cc.p(d,e+a.height)];cc._drawingUtil.drawPoly(a,4,!0)}cc.g_NumberOfDraws++}};a.setTextureRect=cc.Sprite.prototype.setTextureRect};cc._tmp.PrototypeLabelTTF=function(){var a=cc.LabelTTF.prototype;cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"string",a.getString,a.setString);cc.defineGetterSetter(a,"textAlign",a.getHorizontalAlignment,a.setHorizontalAlignment);cc.defineGetterSetter(a,"verticalAlign",a.getVerticalAlignment,a.setVerticalAlignment);cc.defineGetterSetter(a,"fontSize",a.getFontSize,a.setFontSize);cc.defineGetterSetter(a,
"fontName",a.getFontName,a.setFontName);cc.defineGetterSetter(a,"font",a._getFont,a._setFont);cc.defineGetterSetter(a,"boundingWidth",a._getBoundingWidth,a._setBoundingWidth);cc.defineGetterSetter(a,"boundingHeight",a._getBoundingHeight,a._setBoundingHeight);cc.defineGetterSetter(a,"fillStyle",a._getFillStyle,a.setFontFillColor);cc.defineGetterSetter(a,"strokeStyle",a._getStrokeStyle,a._setStrokeStyle);cc.defineGetterSetter(a,"lineWidth",a._getLineWidth,a._setLineWidth);cc.defineGetterSetter(a,"shadowOffsetX",
a._getShadowOffsetX,a._setShadowOffsetX);cc.defineGetterSetter(a,"shadowOffsetY",a._getShadowOffsetY,a._setShadowOffsetY);cc.defineGetterSetter(a,"shadowOpacity",a._getShadowOpacity,a._setShadowOpacity);cc.defineGetterSetter(a,"shadowBlur",a._getShadowBlur,a._setShadowBlur)};cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_isMultiLine:!1,_fontStyleStr:null,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColorStr:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_strokeColorStr:null,_textFillColor:null,_fillColorStr:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_labelCanvas:null,
_labelContext:null,_lineWidths:null,_className:"LabelTTF",ctor:function(a,b,d,e,f,g){cc.Sprite.prototype.ctor.call(this);this._dimensions=cc.size(0,0);this._hAlignment=cc.TEXT_ALIGNMENT_LEFT;this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=!1;this._fontStyleStr="";this._fontName="Arial";this._shadowEnabled=this._isMultiLine=!1;this._shadowOffset=cc.p(0,0);this._shadowBlur=this._shadowOpacity=0;this._shadowColorStr="rgba(128, 128, 128, 0.5)";this._strokeEnabled=!1;this._strokeColor=
cc.color(255,255,255,255);this._strokeSize=0;this._strokeColorStr="";this._textFillColor=cc.color(255,255,255,255);this._fillColorStr="rgba(255,255,255,1)";this._strokeShadowOffsetY=this._strokeShadowOffsetX=0;this._needUpdateTexture=!1;this._lineWidths=[];this._setColorsString();b&&b instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(a,b):cc.LabelTTF.prototype.initWithString.call(this,a,b,d,e,f,g)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},_measureConfig:function(){this._getLabelContext().font=
this._fontStyleStr},_measure:function(a){return this._getLabelContext().measureText(a).width},_checkNextline:function(a,b){var d=this._measure(a),e=Math.floor(a.length*b/d),f=a.indexOf("\n");if(0.8*e>=f&&0<f)return f+1;if(d<b)return a.length;for(var d=!1,g=b+1,f=-1,h=e,k,m=cc.LabelTTF._checkRegEx,n=cc.LabelTTF._reverseCheckRegEx,q=cc.LabelTTF._checkEnRegEx,s=a.substr(e);k=m.exec(s);){h+=k[0].length;g=a.substr(0,h);g=this._measure(g);if("\n"==k[2]&&g<b){d=!0;f=h;break}if(g>b){-1!=f&&(d=!0);break}f=
h;s=a.substr(h)}if(d)return f;s=a.substr(0,e);for(f=e;k=n.exec(s);)if(f=k[1].length,s=k[1],g=this._measure(s),g<b){q.test(k[2])&&f++;break}return f||1},description:function(){return"\x3ccc.LabelTTF | FontName \x3d"+this._fontName+" FontSize \x3d "+this._fontSize.toFixed(1)+"\x3e"},setColor:null,_setColorsString:null,updateDisplayedColor:null,setOpacity:null,updateDisplayedOpacity:null,updateDisplayedOpacityForCanvas:function(a){cc.Node.prototype.updateDisplayedOpacity.call(this,a);this._setColorsString()},
getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions.width,this._dimensions.height)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithString:function(a,b,d,e,f,g){a=a?a+"":"";d=d||16;e=e||cc.size(0,d);f=f||cc.TEXT_ALIGNMENT_LEFT;g=g||cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=
!1;this._dimensions=cc.size(e.width,e.height);this._fontName=b||"Arial";this._hAlignment=f;this._vAlignment=g;this._fontSize=d;this._fontStyleStr=this._fontSize+"px '"+b+"'";this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(b,this._fontSize);this.string=a;this._setColorsString();this._updateTexture();this._needUpdateTexture=!1;return!0},initWithStringAndTextDefinition:null,setTextDefinition:function(a){a&&this._updateWithTextDefinition(a,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},
enableShadow:function(a,b,d,e){d=d||0.5;!1===this._shadowEnabled&&(this._shadowEnabled=!0);var f=this._shadowOffset;if(f&&f.x!=a||f._y!=b)f.x=a,f.y=b;this._shadowOpacity!=d&&(this._shadowOpacity=d);this._setColorsString();this._shadowBlur!=e&&(this._shadowBlur=e);this._needUpdateTexture=!0},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOffset.x!=a&&(this._shadowOffset.x=a,this._needUpdateTexture=
!0)},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOffset._y!=a&&(this._shadowOffset._y=a,this._needUpdateTexture=!0)},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);if(this._shadowOffset.x!=a.x||this._shadowOffset.y!=a.y)this._shadowOffset.x=a.x,this._shadowOffset.y=a.y,this._needUpdateTexture=
!0},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOpacity!=a&&(this._shadowOpacity=a,this._setColorsString(),this._needUpdateTexture=!0)},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowBlur!=a&&(this._shadowBlur=a,this._needUpdateTexture=!0)},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=
!1,this._needUpdateTexture=!0)},enableStroke:function(a,b){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var d=this._strokeColor;if(d.r!==a.r||d.g!==a.g||d.b!==a.b)d.r=a.r,d.g=a.g,d.b=a.b,this._setColorsString();this._strokeSize!==b&&(this._strokeSize=b||0);this._needUpdateTexture=!0},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(a){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var b=this._strokeColor;if(b.r!==a.r||b.g!==a.g||b.b!==a.b)b.r=a.r,b.g=a.g,b.b=
a.b,this._setColorsString(),this._needUpdateTexture=!0},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(a){!1===this._strokeEnabled&&(this._strokeEnabled=!0);this._strokeSize!==a&&(this._strokeSize=a||0,this._needUpdateTexture=!0)},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,this._needUpdateTexture=!0)},setFontFillColor:null,_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(a,b){a.fontDimensions?(this._dimensions.width=
a.boundingWidth,this._dimensions.height=a.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0);this._hAlignment=a.textAlign;this._vAlignment=a.verticalAlign;this._fontName=a.fontName;this._fontSize=a.fontSize||12;this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'";this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize);a.shadowEnabled&&this.enableShadow(a.shadowOffsetX,a.shadowOffsetY,a.shadowOpacity,a.shadowBlur);a.strokeEnabled&&this.enableStroke(a.strokeStyle,
a.lineWidth);this.setFontFillColor(a.fillStyle);b&&this._updateTexture()},_prepareTextDefinition:function(a){var b=new cc.FontDefinition;a?(b.fontSize=this._fontSize,b.boundingWidth=cc.contentScaleFactor()*this._dimensions.width,b.boundingHeight=cc.contentScaleFactor()*this._dimensions.height):(b.fontSize=this._fontSize,b.boundingWidth=this._dimensions.width,b.boundingHeight=this._dimensions.height);b.fontName=this._fontName;b.textAlign=this._hAlignment;b.verticalAlign=this._vAlignment;if(this._strokeEnabled){b.strokeEnabled=
!0;var d=this._strokeColor;b.strokeStyle=cc.color(d.r,d.g,d.b);b.lineWidth=this._strokeSize}else b.strokeEnabled=!1;this._shadowEnabled?(b.shadowEnabled=!0,b.shadowBlur=this._shadowBlur,b.shadowOpacity=this._shadowOpacity,b.shadowOffsetX=(a?cc.contentScaleFactor():1)*this._shadowOffset.x,b.shadowOffsetY=(a?cc.contentScaleFactor():1)*this._shadowOffset.y):b._shadowEnabled=!1;a=this._textFillColor;b.fillStyle=cc.color(a.r,a.g,a.b);return b},_fontClientHeight:18,setString:function(a){a=String(a);this._originalText!=
a&&(this._originalText=a+"",this._updateString(),this._needUpdateTexture=!0)},_updateString:function(){this._string=this._originalText},setHorizontalAlignment:function(a){a!==this._hAlignment&&(this._hAlignment=a,this._needUpdateTexture=!0)},setVerticalAlignment:function(a){a!=this._vAlignment&&(this._vAlignment=a,this._needUpdateTexture=!0)},setDimensions:function(a){if(a.width!=this._dimensions.width||a.height!=this._dimensions.height)this._dimensions=a,this._updateString(),this._needUpdateTexture=
!0},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(a){a!=this._dimensions.width&&(this._dimensions.width=a,this._updateString(),this._needUpdateTexture=!0)},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(a){a!=this._dimensions.height&&(this._dimensions.height=a,this._updateString(),this._needUpdateTexture=!0)},setFontSize:function(a){this._fontSize!==a&&(this._fontSize=a,this._fontStyleStr=a+"px '"+this._fontName+"'",
this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,a),this._needUpdateTexture=!0)},setFontName:function(a){this._fontName&&this._fontName!=a&&(this._fontName=a,this._fontStyleStr=this._fontSize+"px '"+a+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(a,this._fontSize),this._needUpdateTexture=!0)},_getFont:function(){return this._fontStyleStr},_setFont:function(a){var b=cc.LabelTTF._fontStyleRE.exec(a);b&&(this._fontSize=parseInt(b[1]),this._fontName=b[2],this._fontStyleStr=
a,this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize),this._needUpdateTexture=!0)},_drawTTFInCanvas:function(a){if(a){var b=this._strokeShadowOffsetX,d=this._strokeShadowOffsetY,e=this._contentSize.height-d,f=this._vAlignment,g=this._hAlignment,h=this._fontClientHeight,k=this._strokeSize;a.setTransform(1,0,0,1,0+0.5*b,e+0.5*d);a.font!=this._fontStyleStr&&(a.font=this._fontStyleStr);a.fillStyle=this._fillColorStr;var m=d=0,n=this._strokeEnabled;n&&(a.lineWidth=2*
k,a.strokeStyle=this._strokeColorStr);this._shadowEnabled&&(k=this._shadowOffset,a.shadowColor=this._shadowColorStr,a.shadowOffsetX=k.x,a.shadowOffsetY=-k.y,a.shadowBlur=this._shadowBlur);a.textBaseline=cc.LabelTTF._textBaseline[f];a.textAlign=cc.LabelTTF._textAlign[g];b=this._contentSize.width-b;d=g===cc.TEXT_ALIGNMENT_RIGHT?d+b:g===cc.TEXT_ALIGNMENT_CENTER?d+b/2:d+0;if(this._isMultiLine)for(g=this._strings.length,f===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?m=h+e-h*g:f===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&
(m=h/2+(e-h*g)/2),f=0;f<g;f++)b=this._strings[f],k=-e+h*f+m,n&&a.strokeText(b,d,k),a.fillText(b,d,k);else f!==cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM&&(m=f===cc.VERTICAL_TEXT_ALIGNMENT_TOP?m-e:m-0.5*e),n&&a.strokeText(this._string,d,m),a.fillText(this._string,d,m)}},_getLabelContext:function(){if(this._labelContext)return this._labelContext;if(!this._labelCanvas){var a=cc.newElement("canvas"),b=new cc.Texture2D;b.initWithElement(a);this.texture=b;this._labelCanvas=a}return this._labelContext=this._labelCanvas.getContext("2d")},
_updateTTF:function(){var a=this._dimensions.width,b,d,e=this._lineWidths;e.length=0;this._isMultiLine=!1;this._measureConfig();if(0!==a){var f=this._string;this._strings=[];b=0;for(d=this._string.length;b<d;){var g=this._checkNextline(f.substr(b),a),h=f.substr(b,g);this._strings.push(h);b+=g}}else for(this._strings=this._string.split("\n"),b=0,d=this._strings.length;b<d;b++)e.push(this._measure(this._strings[b]));0<this._strings.length&&(this._isMultiLine=!0);d=b=0;this._strokeEnabled&&(b=d=2*this._strokeSize);
this._shadowEnabled&&(f=this._shadowOffset,b+=2*Math.abs(f.x),d+=2*Math.abs(f.y));a=0===a?this._isMultiLine?cc.size(0|Math.max.apply(Math,e)+b,0|this._fontClientHeight*this._strings.length+d):cc.size(0|this._measure(this._string)+b,0|this._fontClientHeight+d):0===this._dimensions.height?this._isMultiLine?cc.size(0|a+b,0|this._fontClientHeight*this._strings.length+d):cc.size(0|a+b,0|this._fontClientHeight+d):cc.size(0|a+b,0|this._dimensions.height+d);this.setContentSize(a);this._strokeShadowOffsetX=
b;this._strokeShadowOffsetY=d;e=this._anchorPoint;this._anchorPointInPoints.x=0.5*b+(a.width-b)*e.x;this._anchorPointInPoints.y=0.5*d+(a.height-d)*e.y},getContentSize:function(){this._needUpdateTexture&&this._updateTTF();return cc.Sprite.prototype.getContentSize.call(this)},_getWidth:function(){this._needUpdateTexture&&this._updateTTF();return cc.Sprite.prototype._getWidth.call(this)},_getHeight:function(){this._needUpdateTexture&&this._updateTTF();return cc.Sprite.prototype._getHeight.call(this)},
_updateTexture:function(){var a=this._getLabelContext(),b=this._labelCanvas,d=this._contentSize;if(0===this._string.length)return b.width=1,b.height=d.height,this.setTextureRect(cc.rect(0,0,1,d.height)),!0;a.font=this._fontStyleStr;this._updateTTF();var e=d.width,d=d.height,f=b.width==e&&b.height==d;b.width=e;b.height=d;f&&a.clearRect(0,0,e,d);this._drawTTFInCanvas(a);this._texture&&this._texture.handleLoadedTexture();this.setTextureRect(cc.rect(0,0,e,d));return!0},visit:function(a){this._string&&
""!=this._string&&(this._needUpdateTexture&&(this._needUpdateTexture=!1,this._updateTexture()),cc.Sprite.prototype.visit.call(this,a||cc._renderContext))},draw:null,_setTextureCoords:function(a){var b=this._batchNode?this.textureAtlas.texture:this._texture;if(b){var d=b.pixelsWidth,e=b.pixelsHeight,f,g=this._quad;this._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(b=(2*a.x+1)/(2*d),d=b+(2*a.height-2)/(2*d),f=(2*a.y+1)/(2*e),a=f+(2*a.width-2)/(2*e)):(b=a.x/d,d=(a.x+a.height)/d,f=a.y/e,a=(a.y+a.width)/
e),this._flippedX&&(e=f,f=a,a=e),this._flippedY&&(e=b,b=d,d=e),g.bl.texCoords.u=b,g.bl.texCoords.v=f,g.br.texCoords.u=b,g.br.texCoords.v=a,g.tl.texCoords.u=d,g.tl.texCoords.v=f,g.tr.texCoords.u=d,g.tr.texCoords.v=a):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(b=(2*a.x+1)/(2*d),d=b+(2*a.width-2)/(2*d),f=(2*a.y+1)/(2*e),a=f+(2*a.height-2)/(2*e)):(b=a.x/d,d=(a.x+a.width)/d,f=a.y/e,a=(a.y+a.height)/e),this._flippedX&&(e=b,b=d,d=e),this._flippedY&&(e=f,f=a,a=e),g.bl.texCoords.u=b,g.bl.texCoords.v=a,g.br.texCoords.u=
d,g.br.texCoords.v=a,g.tl.texCoords.u=b,g.tl.texCoords.v=f,g.tr.texCoords.u=d,g.tr.texCoords.v=f);this._quadDirty=!0}}});
cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.LabelTTF.prototype,_p.setColor=function(a){cc.Node.prototype.setColor.call(this,a);this._setColorsString()},_p._setColorsString=function(){this._needUpdateTexture=!0;var a=this._displayedColor,b=this._displayedOpacity,d=this._strokeColor,e=this._textFillColor;this._shadowColorStr="rgba("+(0|0.5*a.r)+","+(0|0.5*a.g)+","+(0|0.5*a.b)+","+this._shadowOpacity+")";this._fillColorStr="rgba("+(0|a.r/255*e.r)+","+(0|a.g/255*e.g)+","+(0|a.b/255*e.b)+", "+b/255+
")";this._strokeColorStr="rgba("+(0|a.r/255*d.r)+","+(0|a.g/255*d.g)+","+(0|a.b/255*d.b)+", "+b/255+")"},_p.updateDisplayedColor=function(a){cc.Node.prototype.updateDisplayedColor.call(this,a);this._setColorsString()},_p.setOpacity=function(a){this._opacity!==a&&(cc.Sprite.prototype.setOpacity.call(this,a),this._setColorsString(),this._needUpdateTexture=!0)},_p.updateDisplayedOpacity=cc.Sprite.prototype.updateDisplayedOpacity,_p.initWithStringAndTextDefinition=function(a,b){this._updateWithTextDefinition(b,
!1);this.string=a;return!0},_p.setFontFillColor=function(a){var b=this._textFillColor;if(b.r!=a.r||b.g!=a.g||b.b!=a.b)b.r=a.r,b.g=a.g,b.b=a.b,this._setColorsString(),this._needUpdateTexture=!0},_p.draw=cc.Sprite.prototype.draw,_p.setTextureRect=function(a,b,d){this._rectRotated=b||!1;this.setContentSize(d||a);this.setVertexRect(a);b=this._textureRect_Canvas;b.x=a.x;b.y=a.y;b.width=a.width;b.height=a.height;b.validRect=!(0===b.width||0===b.height||0>b.x||0>b.y);a=this._unflippedOffsetPositionFromCenter;
this._flippedX&&(a.x=-a.x);this._flippedY&&(a.y=-a.y);this._offsetPosition.x=a.x+(this._contentSize.width-this._rect.width)/2;this._offsetPosition.y=a.y+(this._contentSize.height-this._rect.height)/2;this._batchNode&&(this.dirty=!0)},_p=null):(cc.assert("function"===typeof cc._tmp.WebGLLabelTTF,cc._LogInfos.MissingFile,"LabelTTFWebGL.js"),cc._tmp.WebGLLabelTTF(),delete cc._tmp.WebGLLabelTTF);cc.assert("function"===typeof cc._tmp.PrototypeLabelTTF,cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js");
cc._tmp.PrototypeLabelTTF();delete cc._tmp.PrototypeLabelTTF;cc.LabelTTF._textAlign=["left","center","right"];cc.LabelTTF._textBaseline=["top","middle","bottom"];cc.LabelTTF._checkRegEx=/(.+?)([\s\n\r\-\/\\\:]|[\u4E00-\u9FA5]|[\uFE30-\uFFA0])/;cc.LabelTTF._reverseCheckRegEx=/(.*)([\s\n\r\-\/\\\:]|[\u4E00-\u9FA5]|[\uFE30-\uFFA0])/;cc.LabelTTF._checkEnRegEx=/[\s\-\/\\\:]/;cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/;
cc.LabelTTF.create=function(a,b,d,e,f,g){return new cc.LabelTTF(a,b,d,e,f,g)};cc.LabelTTF._SHADER_PROGRAM=cc.USE_LA88_LABELS?cc.SHADER_POSITION_TEXTURECOLOR:cc.SHADER_POSITION_TEXTUREA8COLOR;cc.LabelTTF.__labelHeightDiv=cc.newElement("div");cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial";cc.LabelTTF.__labelHeightDiv.style.position="absolute";cc.LabelTTF.__labelHeightDiv.style.left="-100px";cc.LabelTTF.__labelHeightDiv.style.top="-100px";cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal";
document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):cc._addEventListener(window,"load",function(){this.removeEventListener("load",arguments.callee,!1);document.body.appendChild(cc.LabelTTF.__labelHeightDiv)},!1);
cc.LabelTTF.__getFontHeightByDiv=function(a,b){var d=cc.LabelTTF.__fontHeightCache[a+"."+b];if(0<d)return d;var e=cc.LabelTTF.__labelHeightDiv;e.innerHTML="ajghl~!";e.style.fontFamily=a;e.style.fontSize=b+"px";d=e.clientHeight;cc.LabelTTF.__fontHeightCache[a+"."+b]=d;e.innerHTML="";return d};cc.LabelTTF.__fontHeightCache={};cc.HashElement=cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[];this.target=null;this.actionIndex=0;this.currentAction=null;this.paused=this.currentActionSalvaged=!1;this.hh=null}});
cc.ActionManager=cc.Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(a,b){for(var d=0;d<a.length;d++)if(b==a[d].target)return a[d];return null},ctor:function(){this._hashTargets={};this._arrayTargets=[];this._currentTarget=null;this._currentTargetSalvaged=!1},addAction:function(a,b,d){if(!a)throw"cc.ActionManager.addAction(): action must be non-null";if(!b)throw"cc.ActionManager.addAction(): action must be non-null";var e=
this._hashTargets[b.__instanceId];e||(e=new cc.HashElement,e.paused=d,e.target=b,this._hashTargets[b.__instanceId]=e,this._arrayTargets.push(e));this._actionAllocWithHashElement(e);e.actions.push(a);a.startWithTarget(b)},removeAllActions:function(){for(var a=this._arrayTargets,b=0;b<a.length;b++){var d=a[b];d&&this.removeAllActionsFromTarget(d.target,!0)}},removeAllActionsFromTarget:function(a,b){if(null!=a){var d=this._hashTargets[a.__instanceId];d&&(-1===d.actions.indexOf(d.currentAction)||d.currentActionSalvaged||
(d.currentActionSalvaged=!0),d.actions.length=0,this._currentTarget!=d||b?this._deleteHashElement(d):this._currentTargetSalvaged=!0)}},removeAction:function(a){if(null!=a){var b=a.getOriginalTarget();if(b=this._hashTargets[b.__instanceId])for(var d=0;d<b.actions.length;d++){if(b.actions[d]==a){b.actions.splice(d,1);break}}else cc.log(cc._LogInfos.ActionManager_removeAction)}},removeActionByTag:function(a,b){a==cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_addAction);cc.assert(b,cc._LogInfos.ActionManager_addAction);
var d=this._hashTargets[b.__instanceId];if(d)for(var e=d.actions.length,f=0;f<e;++f){var g=d.actions[f];if(g&&g.getTag()===a&&g.getOriginalTarget()==b){this._removeActionAtIndex(f,d);break}}},getActionByTag:function(a,b){a==cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_getActionByTag);var d=this._hashTargets[b.__instanceId];if(d){if(null!=d.actions)for(var e=0;e<d.actions.length;++e){var f=d.actions[e];if(f&&f.getTag()===a)return f}cc.log(cc._LogInfos.ActionManager_getActionByTag_2,a)}return null},
numberOfRunningActionsInTarget:function(a){return(a=this._hashTargets[a.__instanceId])?a.actions?a.actions.length:0:0},pauseTarget:function(a){if(a=this._hashTargets[a.__instanceId])a.paused=!0},resumeTarget:function(a){if(a=this._hashTargets[a.__instanceId])a.paused=!1},pauseAllRunningActions:function(){for(var a=[],b=this._arrayTargets,d=0;d<b.length;d++){var e=b[d];e&&!e.paused&&(e.paused=!0,a.push(e.target))}return a},resumeTargets:function(a){if(a)for(var b=0;b<a.length;b++)a[b]&&this.resumeTarget(a[b])},
purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdateForTarget(this)},_removeActionAtIndex:function(a,b){b.actions[a]!=b.currentAction||b.currentActionSalvaged||(b.currentActionSalvaged=!0);b.actions.splice(a,1);b.actionIndex>=a&&b.actionIndex--;0==b.actions.length&&(this._currentTarget==b?this._currentTargetSalvaged=!0:this._deleteHashElement(b))},_deleteHashElement:function(a){a&&(delete this._hashTargets[a.target.__instanceId],cc.arrayRemoveObject(this._arrayTargets,a),a.actions=
null,a.target=null)},_actionAllocWithHashElement:function(a){null==a.actions&&(a.actions=[])},update:function(a){for(var b=this._arrayTargets,d,e=0;e<b.length;e++){d=this._currentTarget=b[e];if(!d.paused)for(d.actionIndex=0;d.actionIndex<d.actions.length;d.actionIndex++)if(d.currentAction=d.actions[d.actionIndex],d.currentAction){d.currentActionSalvaged=!1;d.currentAction.step(a*(d.currentAction._speedMethod?d.currentAction._speed:1));if(d.currentActionSalvaged)d.currentAction=null;else if(d.currentAction.isDone()){d.currentAction.stop();
var f=d.currentAction;d.currentAction=null;this.removeAction(f)}d.currentAction=null}this._currentTargetSalvaged&&0===d.actions.length&&this._deleteHashElement(d)}}});cc.ACTION_TAG_INVALID=-1;
cc.Action=cc.Class.extend({originalTarget:null,target:null,tag:cc.ACTION_TAG_INVALID,ctor:function(){this.target=this.originalTarget=null;this.tag=cc.ACTION_TAG_INVALID},copy:function(){cc.log("copy is deprecated. Please use clone instead.");return this.clone()},clone:function(){var a=new cc.Action;a.originalTarget=null;a.target=null;a.tag=this.tag;return a},isDone:function(){return!0},startWithTarget:function(a){this.target=this.originalTarget=a},stop:function(){this.target=null},step:function(a){cc.log("[Action step]. override me")},
update:function(a){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(a){this.target=a},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(a){this.originalTarget=a},getTag:function(){return this.tag},setTag:function(a){this.tag=a},retain:function(){},release:function(){}});cc.Action.create=function(){return new cc.Action};
cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this);this._duration=0},getDuration:function(){return this._duration*(this._times||1)},setDuration:function(a){this._duration=a},reverse:function(){cc.log("cocos2d: FiniteTimeAction#reverse: Implement me");return null},clone:function(){return new cc.FiniteTimeAction}});
cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(a,b){cc.Action.prototype.ctor.call(this);this._speed=0;this._innerAction=null;a&&this.initWithAction(a,b)},getSpeed:function(){return this._speed},setSpeed:function(a){this._speed=a},initWithAction:function(a,b){if(!a)throw"cc.Speed.initWithAction(): action must be non nil";this._innerAction=a;this._speed=b;return!0},clone:function(){var a=new cc.Speed;a.initWithAction(this._innerAction.clone(),this._speed);return a},startWithTarget:function(a){cc.Action.prototype.startWithTarget.call(this,
a);this._innerAction.startWithTarget(a)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},step:function(a){this._innerAction.step(a*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return cc.Speed.create(this._innerAction.reverse(),this._speed)},setInnerAction:function(a){this._innerAction!=a&&(this._innerAction=a)},getInnerAction:function(){return this._innerAction}});cc.Speed.create=function(a,b){return new cc.Speed(a,b)};
cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,_worldRect:null,ctor:function(a,b){cc.Action.prototype.ctor.call(this);this._followedNode=null;this._boundaryFullyCovered=this._boundarySet=!1;this._fullScreenSize=this._halfScreenSize=null;this.bottomBoundary=this.topBoundary=this.rightBoundary=this.leftBoundary=0;this._worldRect=cc.rect(0,0,0,0);a&&(b?this.initWithTarget(a,
b):this.initWithTarget(a))},clone:function(){var a=new cc.Follow,b=this._worldRect,b=new cc.Rect(b.x,b.y,b.width,b.height);a.initWithTarget(this._followedNode,b);return a},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(a){this._boundarySet=a},initWithTarget:function(a,b){if(!a)throw"cc.Follow.initWithAction(): followedNode must be non nil";b=b||cc.rect(0,0,0,0);this._followedNode=a;this._worldRect=b;this._boundarySet=!cc._rectEqualToZero(b);this._boundaryFullyCovered=!1;
var d=cc.director.getWinSize();this._fullScreenSize=cc.p(d.width,d.height);this._halfScreenSize=cc.pMult(this._fullScreenSize,0.5);this._boundarySet&&(this.leftBoundary=-(b.x+b.width-this._fullScreenSize.x),this.rightBoundary=-b.x,this.topBoundary=-b.y,this.bottomBoundary=-(b.y+b.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=
(this.topBoundary+this.bottomBoundary)/2),this.topBoundary==this.bottomBoundary&&this.leftBoundary==this.rightBoundary&&(this._boundaryFullyCovered=!0));return!0},step:function(a){a=this._followedNode.x;var b=this._followedNode.y;a=this._halfScreenSize.x-a;b=this._halfScreenSize.y-b;this._boundarySet?this._boundaryFullyCovered||this.target.setPosition(cc.clampf(a,this.leftBoundary,this.rightBoundary),cc.clampf(b,this.bottomBoundary,this.topBoundary)):this.target.setPosition(a,b)},isDone:function(){return!this._followedNode.running},
stop:function(){this.target=null;cc.Action.prototype.stop.call(this)}});cc.Follow.create=function(a,b){return new cc.Follow(a,b)};cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_times:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(a){this._times=this._speed=1;this._repeatForever=!1;this.MAX_VALUE=2;this._speedMethod=this._repeatMethod=!1;cc.FiniteTimeAction.prototype.ctor.call(this);void 0!==a&&this.initWithDuration(a)},getElapsed:function(){return this._elapsed},initWithDuration:function(a){this._duration=0===a?cc.FLT_EPSILON:a;this._elapsed=0;return this._firstTick=
!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(a){a._repeatForever=this._repeatForever;a._speed=this._speed;a._times=this._times;a._easeList=this._easeList;a._speedMethod=this._speedMethod;a._repeatMethod=this._repeatMethod},_reverseEaseList:function(a){if(this._easeList){a._easeList=[];for(var b=0;b<this._easeList.length;b++)a._easeList.push(this._easeList[b].reverse())}},clone:function(){var a=new cc.ActionInterval(this._duration);this._cloneDecoration(a);
return a},easing:function(a){this._easeList?this._easeList.length=0:this._easeList=[];for(var b=0;b<arguments.length;b++)this._easeList.push(arguments[b]);return this},_computeEaseTime:function(a){var b=this._easeList;if(!b||0===b.length)return a;for(var d=0,e=b.length;d<e;d++)a=b[d].easing(a);return a},step:function(a){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=a;a=this._elapsed/(1.192092896E-7<this._duration?this._duration:1.192092896E-7);a=1>a?a:1;this.update(0<a?a:0);
this._repeatMethod&&1<this._times&&this.isDone()&&(this._repeatForever||this._times--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(a){cc.Action.prototype.startWithTarget.call(this,a);this._elapsed=0;this._firstTick=!0},reverse:function(){cc.log("cc.IntervalAction: reverse not implemented.");return null},setAmplitudeRate:function(a){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass.");
return 0},speed:function(a){if(0>=a)return cc.log("The speed parameter error"),this;this._speedMethod=!0;this._speed*=a;return this},getSpeed:function(){return this._speed},setSpeed:function(a){this._speed=a;return this},repeat:function(a){a=Math.round(a);if(isNaN(a)||1>a)return cc.log("The repeat parameter error"),this;this._repeatMethod=!0;this._times*=a;return this},repeatForever:function(){this._repeatMethod=!0;this._times=this.MAX_VALUE;this._repeatForever=!0;return this}});
cc.ActionInterval.create=function(a){return new cc.ActionInterval(a)};
cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._actions=[];var b=a instanceof Array?a:arguments,d=b.length-1;0<=d&&null==b[d]&&cc.log("parameters should not be ending with null in Javascript");if(0<=d){for(var e=b[0],f=1;f<d;f++)b[f]&&(e=cc.Sequence._actionOneTwo(e,b[f]));this.initWithTwoActions(e,b[d])}},initWithTwoActions:function(a,b){if(!a||!b)throw"cc.Sequence.initWithTwoActions(): arguments must all be non nil";
this.initWithDuration(a._duration+b._duration);this._actions[0]=a;this._actions[1]=b;return!0},clone:function(){var a=new cc.Sequence;this._cloneDecoration(a);a.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._split=this._actions[0]._duration/this._duration;this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop();cc.Action.prototype.stop.call(this)},update:function(a){a=
this._computeEaseTime(a);var b=0,d=this._split,e=this._actions,f=this._last;a<d?(a=0!==d?a/d:1,0===b&&1===f&&(e[1].update(0),e[1].stop())):(b=1,a=1===d?1:(a-d)/(1-d),-1===f&&(e[0].startWithTarget(this.target),e[0].update(1),e[0].stop()),f||(e[0].update(1),e[0].stop()));f===b&&e[b].isDone()||(f!==b&&e[b].startWithTarget(this.target),e[b].update(a),this._last=b)},reverse:function(){var a=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());this._cloneDecoration(a);this._reverseEaseList(a);
return a}});cc.Sequence.create=function(a){var b=a instanceof Array?a:arguments;0<b.length&&null==b[b.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var d=b[0],e=1;e<b.length;e++)b[e]&&(d=cc.Sequence._actionOneTwo(d,b[e]));return d};cc.Sequence._actionOneTwo=function(a,b){var d=new cc.Sequence;d.initWithTwoActions(a,b);return d};
cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithAction(a,b)},initWithAction:function(a,b){return this.initWithDuration(a._duration*b)?(this._times=b,this._innerAction=a,a instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0):!1},clone:function(){var a=new cc.Repeat;this._cloneDecoration(a);a.initWithAction(this._innerAction.clone(),
this._times);return a},startWithTarget:function(a){this._total=0;this._nextDt=this._innerAction._duration/this._duration;cc.ActionInterval.prototype.startWithTarget.call(this,a);this._innerAction.startWithTarget(a)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},update:function(a){a=this._computeEaseTime(a);var b=this._innerAction,d=this._duration,e=this._times,f=this._nextDt;if(a>=f){for(;a>f&&this._total<e;)b.update(1),this._total++,b.stop(),b.startWithTarget(this.target),
this._nextDt=f+=b._duration/d;1<=a&&this._total<e&&this._total++;this._actionInstant||(this._total===e?(b.update(1),b.stop()):b.update(a-(f-b._duration/d)))}else b.update(a*e%1)},isDone:function(){return this._total==this._times},reverse:function(){var a=cc.Repeat.create(this._innerAction.reverse(),this._times);this._cloneDecoration(a);this._reverseEaseList(a);return a},setInnerAction:function(a){this._innerAction!=a&&(this._innerAction=a)},getInnerAction:function(){return this._innerAction}});
cc.Repeat.create=function(a,b){return new cc.Repeat(a,b)};
cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._innerAction=null;a&&this.initWithAction(a)},initWithAction:function(a){if(!a)throw"cc.RepeatForever.initWithAction(): action must be non null";this._innerAction=a;return!0},clone:function(){var a=new cc.RepeatForever;this._cloneDecoration(a);a.initWithAction(this._innerAction.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);
this._innerAction.startWithTarget(a)},step:function(a){var b=this._innerAction;b.step(a);b.isDone()&&(b.startWithTarget(this.target),b.step(b.getElapsed()-b._duration))},isDone:function(){return!1},reverse:function(){var a=cc.RepeatForever.create(this._innerAction.reverse());this._cloneDecoration(a);this._reverseEaseList(a);return a},setInnerAction:function(a){this._innerAction!=a&&(this._innerAction=a)},getInnerAction:function(){return this._innerAction}});cc.RepeatForever.create=function(a){return new cc.RepeatForever(a)};
cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._two=this._one=null;var b=a instanceof Array?a:arguments,d=b.length-1;0<=d&&null==b[d]&&cc.log("parameters should not be ending with null in Javascript");if(0<=d){for(var e=b[0],f=1;f<d;f++)b[f]&&(e=cc.Spawn._actionOneTwo(e,b[f]));this.initWithTwoActions(e,b[d])}},initWithTwoActions:function(a,b){if(!a||!b)throw"cc.Spawn.initWithTwoActions(): arguments must all be non null";var d=
!1,e=a._duration,f=b._duration;this.initWithDuration(Math.max(e,f))&&(this._one=a,this._two=b,e>f?this._two=cc.Sequence._actionOneTwo(b,cc.DelayTime.create(e-f)):e<f&&(this._one=cc.Sequence._actionOneTwo(a,cc.DelayTime.create(f-e))),d=!0);return d},clone:function(){var a=new cc.Spawn;this._cloneDecoration(a);a.initWithTwoActions(this._one.clone(),this._two.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._one.startWithTarget(a);this._two.startWithTarget(a)},
stop:function(){this._one.stop();this._two.stop();cc.Action.prototype.stop.call(this)},update:function(a){a=this._computeEaseTime(a);this._one&&this._one.update(a);this._two&&this._two.update(a)},reverse:function(){var a=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());this._cloneDecoration(a);this._reverseEaseList(a);return a}});
cc.Spawn.create=function(a){var b=a instanceof Array?a:arguments;0<b.length&&null==b[b.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var d=b[0],e=1;e<b.length;e++)null!=b[e]&&(d=cc.Spawn._actionOneTwo(d,b[e]));return d};cc.Spawn._actionOneTwo=function(a,b){var d=new cc.Spawn;d.initWithTwoActions(a,b);return d};
cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(a,b,d){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b,d)},initWithDuration:function(a,b,d){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._dstAngleX=b||0,this._dstAngleY=d||this._dstAngleX,!0):!1},clone:function(){var a=new cc.RotateTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._dstAngleX,
this._dstAngleY);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.rotationX%360,d=this._dstAngleX-b;180<d&&(d-=360);-180>d&&(d+=360);this._startAngleX=b;this._diffAngleX=d;this._startAngleY=a.rotationY%360;a=this._dstAngleY-this._startAngleY;180<a&&(a-=360);-180>a&&(a+=360);this._diffAngleY=a},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(a){a=this._computeEaseTime(a);this.target&&(this.target.rotationX=
this._startAngleX+this._diffAngleX*a,this.target.rotationY=this._startAngleY+this._diffAngleY*a)}});cc.RotateTo.create=function(a,b,d){return new cc.RotateTo(a,b,d)};
cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(a,b,d){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b,d)},initWithDuration:function(a,b,d){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._angleX=b||0,this._angleY=d||this._angleX,!0):!1},clone:function(){var a=new cc.RotateBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._angleX,this._angleY);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,
a);this._startAngleX=a.rotationX;this._startAngleY=a.rotationY},update:function(a){a=this._computeEaseTime(a);this.target&&(this.target.rotationX=this._startAngleX+this._angleX*a,this.target.rotationY=this._startAngleY+this._angleY*a)},reverse:function(){var a=cc.RotateBy.create(this._duration,-this._angleX,-this._angleY);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.RotateBy.create=function(a,b,d){return new cc.RotateBy(a,b,d)};
cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(a,b,d){cc.ActionInterval.prototype.ctor.call(this);this._positionDelta=cc.p(0,0);this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);void 0!==b&&this.initWithDuration(a,b,d)},initWithDuration:function(a,b,d){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(void 0!==b.x&&(d=b.y,b=b.x),this._positionDelta.x=b,this._positionDelta.y=d,!0):!1},clone:function(){var a=
new cc.MoveBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._positionDelta);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.getPositionX();a=a.getPositionY();this._previousPosition.x=b;this._previousPosition.y=a;this._startPosition.x=b;this._startPosition.y=a},update:function(a){a=this._computeEaseTime(a);if(this.target){var b=this._positionDelta.x*a;a*=this._positionDelta.y;var d=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var e=
this.target.getPositionX(),f=this.target.getPositionY(),g=this._previousPosition;d.x=d.x+e-g.x;d.y=d.y+f-g.y;b+=d.x;a+=d.y;g.x=b;g.y=a;this.target.setPosition(b,a)}else this.target.setPosition(d.x+b,d.y+a)}},reverse:function(){var a=cc.MoveBy.create(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.MoveBy.create=function(a,b,d){return new cc.MoveBy(a,b,d)};
cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(a,b,d){cc.MoveBy.prototype.ctor.call(this);this._endPosition=cc.p(0,0);void 0!==b&&this.initWithDuration(a,b,d)},initWithDuration:function(a,b,d){return cc.MoveBy.prototype.initWithDuration.call(this,a,b,d)?(void 0!==b.x&&(d=b.y,b=b.x),this._endPosition.x=b,this._endPosition.y=d,!0):!1},clone:function(){var a=new cc.MoveTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endPosition);return a},startWithTarget:function(a){cc.MoveBy.prototype.startWithTarget.call(this,
a);this._positionDelta.x=this._endPosition.x-a.getPositionX();this._positionDelta.y=this._endPosition.y-a.getPositionY()}});cc.MoveTo.create=function(a,b,d){return new cc.MoveTo(a,b,d)};
cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(a,b,d){cc.ActionInterval.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(a,b,d)},initWithDuration:function(a,b,d){var e=!1;cc.ActionInterval.prototype.initWithDuration.call(this,a)&&(this._endSkewX=b,this._endSkewY=d,e=!0);return e},clone:function(){var a=new cc.SkewTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endSkewX,this._endSkewY);
return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._startSkewX=a.skewX%180;this._deltaX=this._endSkewX-this._startSkewX;180<this._deltaX&&(this._deltaX-=360);-180>this._deltaX&&(this._deltaX+=360);this._startSkewY=a.skewY%360;this._deltaY=this._endSkewY-this._startSkewY;180<this._deltaY&&(this._deltaY-=360);-180>this._deltaY&&(this._deltaY+=360)},update:function(a){a=this._computeEaseTime(a);this.target.skewX=this._startSkewX+this._deltaX*a;this.target.skewY=
this._startSkewY+this._deltaY*a}});cc.SkewTo.create=function(a,b,d){return new cc.SkewTo(a,b,d)};
cc.SkewBy=cc.SkewTo.extend({ctor:function(a,b,d){cc.SkewTo.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(a,b,d)},initWithDuration:function(a,b,d){var e=!1;cc.SkewTo.prototype.initWithDuration.call(this,a,b,d)&&(this._skewX=b,this._skewY=d,e=!0);return e},clone:function(){var a=new cc.SkewBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._skewX,this._skewY);return a},startWithTarget:function(a){cc.SkewTo.prototype.startWithTarget.call(this,a);this._deltaX=this._skewX;
this._deltaY=this._skewY;this._endSkewX=this._startSkewX+this._deltaX;this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var a=cc.SkewBy.create(this._duration,-this._skewX,-this._skewY);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.SkewBy.create=function(a,b,d){return new cc.SkewBy(a,b,d)};
cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(a,b,d,e,f){cc.ActionInterval.prototype.ctor.call(this);this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);this._delta=cc.p(0,0);void 0!==e&&this.initWithDuration(a,b,d,e,f)},initWithDuration:function(a,b,d,e,f){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(void 0===f&&(f=e,e=d,d=b.y,b=b.x),this._delta.x=b,this._delta.y=d,this._height=e,this._jumps=
f,!0):!1},clone:function(){var a=new cc.JumpBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._delta,this._height,this._jumps);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.getPositionX();a=a.getPositionY();this._previousPosition.x=b;this._previousPosition.y=a;this._startPosition.x=b;this._startPosition.y=a},update:function(a){a=this._computeEaseTime(a);if(this.target){var b=a*this._jumps%1,b=4*this._height*b*(1-b),b=b+this._delta.y*
a;a*=this._delta.x;var d=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var e=this.target.getPositionX(),f=this.target.getPositionY(),g=this._previousPosition;d.x=d.x+e-g.x;d.y=d.y+f-g.y;a+=d.x;b+=d.y;g.x=a;g.y=b;this.target.setPosition(a,b)}else this.target.setPosition(d.x+a,d.y+b)}},reverse:function(){var a=cc.JumpBy.create(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);this._cloneDecoration(a);this._reverseEaseList(a);return a}});
cc.JumpBy.create=function(a,b,d,e,f){return new cc.JumpBy(a,b,d,e,f)};
cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(a,b,d,e,f){cc.JumpBy.prototype.ctor.call(this);this._endPosition=cc.p(0,0);void 0!==e&&this.initWithDuration(a,b,d,e,f)},initWithDuration:function(a,b,d,e,f){return cc.JumpBy.prototype.initWithDuration.call(this,a,b,d,e,f)?(void 0===f&&(d=b.y,b=b.x),this._endPosition.x=b,this._endPosition.y=d,!0):!1},startWithTarget:function(a){cc.JumpBy.prototype.startWithTarget.call(this,a);this._delta.x=this._endPosition.x-this._startPosition.x;this._delta.y=
this._endPosition.y-this._startPosition.y},clone:function(){var a=new cc.JumpTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endPosition,this._height,this._jumps);return a}});cc.JumpTo.create=function(a,b,d,e,f){return new cc.JumpTo(a,b,d,e,f)};cc.bezierAt=function(a,b,d,e,f){return Math.pow(1-f,3)*a+3*f*Math.pow(1-f,2)*b+3*Math.pow(f,2)*(1-f)*d+Math.pow(f,3)*e};
cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);this._config=[];this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._config=b,!0):!1},clone:function(){var a=new cc.BezierBy;this._cloneDecoration(a);for(var b=[],d=0;d<this._config.length;d++){var e=
this._config[d];b.push(cc.p(e.x,e.y))}a.initWithDuration(this._duration,b);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.getPositionX();a=a.getPositionY();this._previousPosition.x=b;this._previousPosition.y=a;this._startPosition.x=b;this._startPosition.y=a},update:function(a){a=this._computeEaseTime(a);if(this.target){var b=this._config,d=b[0].y,e=b[1].y,f=b[2].y,b=cc.bezierAt(0,b[0].x,b[1].x,b[2].x,a);a=cc.bezierAt(0,d,e,f,a);d=this._startPosition;
if(cc.ENABLE_STACKABLE_ACTIONS){var e=this.target.getPositionX(),f=this.target.getPositionY(),g=this._previousPosition;d.x=d.x+e-g.x;d.y=d.y+f-g.y;b+=d.x;a+=d.y;g.x=b;g.y=a;this.target.setPosition(b,a)}else this.target.setPosition(d.x+b,d.y+a)}},reverse:function(){var a=this._config,a=[cc.pAdd(a[1],cc.pNeg(a[2])),cc.pAdd(a[0],cc.pNeg(a[2])),cc.pNeg(a[2])],a=cc.BezierBy.create(this._duration,a);this._cloneDecoration(a);this._reverseEaseList(a);return a}});
cc.BezierBy.create=function(a,b){return new cc.BezierBy(a,b)};
cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(a,b){cc.BezierBy.prototype.ctor.call(this);this._toConfig=[];b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._toConfig=b,!0):!1},clone:function(){var a=new cc.BezierTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toConfig);return a},startWithTarget:function(a){cc.BezierBy.prototype.startWithTarget.call(this,a);a=this._startPosition;var b=
this._toConfig,d=this._config;d[0]=cc.pSub(b[0],a);d[1]=cc.pSub(b[1],a);d[2]=cc.pSub(b[2],a)}});cc.BezierTo.create=function(a,b){return new cc.BezierTo(a,b)};
cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(a,b,d){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b,d)},initWithDuration:function(a,b,d){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._endScaleX=b,this._endScaleY=null!=d?d:b,!0):!1},clone:function(){var a=new cc.ScaleTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endScaleX,
this._endScaleY);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._startScaleX=a.scaleX;this._startScaleY=a.scaleY;this._deltaX=this._endScaleX-this._startScaleX;this._deltaY=this._endScaleY-this._startScaleY},update:function(a){a=this._computeEaseTime(a);this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*a,this.target.scaleY=this._startScaleY+this._deltaY*a)}});cc.ScaleTo.create=function(a,b,d){return new cc.ScaleTo(a,b,d)};
cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(a){cc.ScaleTo.prototype.startWithTarget.call(this,a);this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX;this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var a=cc.ScaleBy.create(this._duration,1/this._endScaleX,1/this._endScaleY);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.ScaleBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endScaleX,
this._endScaleY);return a}});cc.ScaleBy.create=function(a,b,d){return new cc.ScaleBy(a,b,d)};
cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._times=b,!0):!1},clone:function(){var a=new cc.Blink;this._cloneDecoration(a);a.initWithDuration(this._duration,this._times);return a},update:function(a){a=this._computeEaseTime(a);if(this.target&&!this.isDone()){var b=1/this._times;this.target.visible=
a%b>b/2}},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._originalState=a.visible},stop:function(){this.target.visible=this._originalState;cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var a=cc.Blink.create(this._duration,this._times);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.Blink.create=function(a,b){return new cc.Blink(a,b)};
cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._toOpacity=b,!0):!1},clone:function(){var a=new cc.FadeTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toOpacity);return a},update:function(a){a=this._computeEaseTime(a);var b=void 0!==this._fromOpacity?this._fromOpacity:
255;this.target.opacity=b+(this._toOpacity-b)*a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._fromOpacity=a.opacity}});cc.FadeTo.create=function(a,b){return new cc.FadeTo(a,b)};
cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(a){cc.FadeTo.prototype.ctor.call(this);a&&this.initWithDuration(a,255)},reverse:function(){var a=new cc.FadeOut;a.initWithDuration(this._duration,0);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.FadeIn;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toOpacity);return a},startWithTarget:function(a){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity);cc.FadeTo.prototype.startWithTarget.call(this,
a)}});cc.FadeIn.create=function(a){return new cc.FadeIn(a)};cc.FadeOut=cc.FadeTo.extend({ctor:function(a){cc.FadeTo.prototype.ctor.call(this);a&&this.initWithDuration(a,0)},reverse:function(){var a=new cc.FadeIn;a._reverseAction=this;a.initWithDuration(this._duration,255);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.FadeOut;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toOpacity);return a}});cc.FadeOut.create=function(a){return new cc.FadeOut(a)};
cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(a,b,d,e){cc.ActionInterval.prototype.ctor.call(this);this._to=cc.color(0,0,0);this._from=cc.color(0,0,0);void 0!==e&&this.initWithDuration(a,b,d,e)},initWithDuration:function(a,b,d,e){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._to=cc.color(b,d,e),!0):!1},clone:function(){var a=new cc.TintTo;this._cloneDecoration(a);var b=this._to;a.initWithDuration(this._duration,b.r,b.g,b.b);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,
a);this._from=this.target.color},update:function(a){a=this._computeEaseTime(a);var b=this._from,d=this._to;b&&(this.target.color=cc.color(b.r+(d.r-b.r)*a,b.g+(d.g-b.g)*a,b.b+(d.b-b.b)*a))}});cc.TintTo.create=function(a,b,d,e){return new cc.TintTo(a,b,d,e)};
cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(a,b,d,e){cc.ActionInterval.prototype.ctor.call(this);void 0!==e&&this.initWithDuration(a,b,d,e)},initWithDuration:function(a,b,d,e){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._deltaR=b,this._deltaG=d,this._deltaB=e,!0):!1},clone:function(){var a=new cc.TintBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB);return a},
startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);a=a.color;this._fromR=a.r;this._fromG=a.g;this._fromB=a.b},update:function(a){a=this._computeEaseTime(a);this.target.color=cc.color(this._fromR+this._deltaR*a,this._fromG+this._deltaG*a,this._fromB+this._deltaB*a)},reverse:function(){var a=cc.TintBy.create(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);this._cloneDecoration(a);this._reverseEaseList(a);return a}});
cc.TintBy.create=function(a,b,d,e){return new cc.TintBy(a,b,d,e)};cc.DelayTime=cc.ActionInterval.extend({update:function(a){},reverse:function(){var a=cc.DelayTime.create(this._duration);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.DelayTime;this._cloneDecoration(a);a.initWithDuration(this._duration);return a}});cc.DelayTime.create=function(a){return new cc.DelayTime(a)};
cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._other=null;a&&this.initWithAction(a)},initWithAction:function(a){if(!a)throw"cc.ReverseTime.initWithAction(): action must be non null";if(a==this._other)throw"cc.ReverseTime.initWithAction(): the action was already passed in.";return cc.ActionInterval.prototype.initWithDuration.call(this,a._duration)?(this._other=a,!0):!1},clone:function(){var a=new cc.ReverseTime;this._cloneDecoration(a);
a.initWithAction(this._other.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._other.startWithTarget(a)},update:function(a){a=this._computeEaseTime(a);this._other&&this._other.update(1-a)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop();cc.Action.prototype.stop.call(this)}});cc.ReverseTime.create=function(a){return new cc.ReverseTime(a)};
cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._splitTimes=[];a&&this.initWithAnimation(a)},getAnimation:function(){return this._animation},setAnimation:function(a){this._animation=a},initWithAnimation:function(a){if(!a)throw"cc.Animate.initWithAnimation(): animation must be non-NULL";var b=a.getDuration();if(this.initWithDuration(b*a.getLoops())){this._nextFrame=
0;this.setAnimation(a);this._origFrame=null;this._executedLoops=0;var d=this._splitTimes,e=d.length=0,f=b/a.getTotalDelayUnits();a=a.getFrames();cc.arrayVerifyType(a,cc.AnimationFrame);for(var g=0;g<a.length;g++){var h=e*f/b,e=e+a[g].getDelayUnits();d.push(h)}return!0}return!1},clone:function(){var a=new cc.Animate;this._cloneDecoration(a);a.initWithAnimation(this._animation.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._animation.getRestoreOriginalFrame()&&
(this._origFrame=a.displayFrame());this._executedLoops=this._nextFrame=0},update:function(a){a=this._computeEaseTime(a);1>a&&(a*=this._animation.getLoops(),(0|a)>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),a%=1);for(var b=this._animation.getFrames(),d=b.length,e=this._splitTimes,f=this._nextFrame;f<d;f++)if(e[f]<=a)this.target.setSpriteFrame(b[f].getSpriteFrame()),this._nextFrame=f+1;else break},reverse:function(){var a=this._animation,b=a.getFrames(),d=[];cc.arrayVerifyType(b,
cc.AnimationFrame);if(0<b.length)for(var e=b.length-1;0<=e;e--){var f=b[e];if(!f)break;d.push(f.clone())}b=cc.Animation.create(d,a.getDelayPerUnit(),a.getLoops());b.setRestoreOriginalFrame(a.getRestoreOriginalFrame());a=cc.Animate.create(b);this._cloneDecoration(a);this._reverseEaseList(a);return a},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame);cc.Action.prototype.stop.call(this)}});cc.Animate.create=function(a){return new cc.Animate(a)};
cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);b&&this.initWithTarget(a,b)},initWithTarget:function(a,b){return this.initWithDuration(b._duration)?(this._forcedTarget=a,this._action=b,!0):!1},clone:function(){var a=new cc.TargetedAction;this._cloneDecoration(a);a.initWithTarget(this._forcedTarget,this._action.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,
a);this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(a){a=this._computeEaseTime(a);this._action.update(a)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(a){this._forcedTarget!=a&&(this._forcedTarget=a)}});cc.TargetedAction.create=function(a,b){return new cc.TargetedAction(a,b)};cc.LabelAtlas=cc.AtlasNode.extend({_string:null,_mapStartChar:null,_textureLoaded:!1,_loadedEventListeners:null,_className:"LabelAtlas",ctor:function(a,b,d,e,f){cc.AtlasNode.prototype.ctor.call(this);b&&cc.LabelAtlas.prototype.initWithString.call(this,a,b,d,e,f)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,b){this._loadedEventListeners||(this._loadedEventListeners=[]);this._loadedEventListeners.push({eventCallback:a,eventTarget:b})},_callLoadedEventCallbacks:function(){if(this._loadedEventListeners){this._textureLoaded=
!0;for(var a=this._loadedEventListeners,b=0,d=a.length;b<d;b++){var e=a[b];e.eventCallback.call(e.eventTarget,this)}a.length=0}},initWithString:function(a,b,d,e,f){var g=a+"",h,k;if(void 0===d){d=cc.loader.getRes(b);if(1!==parseInt(d.version,10))return cc.log("cc.LabelAtlas.initWithString(): Unsupported version. Upgrade cocos2d version"),!1;b=cc.path.changeBasename(b,d.textureFilename);e=cc.contentScaleFactor();h=parseInt(d.itemWidth,10)/e;k=parseInt(d.itemHeight,10)/e;d=String.fromCharCode(parseInt(d.firstChar,
10))}else h=d||0,k=e||0,d=f||" ";var m=null,m=b instanceof cc.Texture2D?b:cc.textureCache.addImage(b);(this._textureLoaded=b=m.isLoaded())||m.addLoadedEventListener(function(a){this.initWithTexture(m,h,k,g.length);this.string=g;this._callLoadedEventCallbacks()},this);return this.initWithTexture(m,h,k,g.length)?(this._mapStartChar=d,this.string=g,!0):!1},setColor:function(a){cc.AtlasNode.prototype.setColor.call(this,a);this.updateAtlasValues()},getString:function(){return this._string},draw:function(a){cc.AtlasNode.prototype.draw.call(this,
a);cc.LABELATLAS_DEBUG_DRAW&&(a=this.size,a=[cc.p(0,0),cc.p(a.width,0),cc.p(a.width,a.height),cc.p(0,a.height)],cc._drawingUtil.drawPoly(a,4,!0))},_addChildForCanvas:function(a,b,d){a._lateChild=!0;cc.Node.prototype.addChild.call(this,a,b,d)},updateAtlasValues:null,_updateAtlasValuesForCanvas:function(){for(var a=this._string||"",b=a.length,d=this.texture,e=this._itemWidth,f=this._itemHeight,g=0;g<b;g++){var h=a.charCodeAt(g)-this._mapStartChar.charCodeAt(0),k=parseInt(h%this._itemsPerRow,10),h=parseInt(h/
this._itemsPerRow,10),k=cc.rect(k*e,h*f,e,f),h=a.charCodeAt(g),m=this.getChildByTag(g);m?32==h?(m.init(),m.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):(m.initWithTexture(d,k),m.visible=!0,m.opacity=this._displayedOpacity):(m=new cc.Sprite,32==h?(m.init(),m.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):m.initWithTexture(d,k),cc.Node.prototype.addChild.call(this,m,0,g));m.setPosition(g*e+e/2,f/2)}},_updateAtlasValuesForWebGL:function(){var a=this._string,b=a.length,d=this.textureAtlas,
e=d.texture,f=e.pixelsWidth,e=e.pixelsHeight,g=this._itemWidth,h=this._itemHeight;this._ignoreContentScaleFactor||(g=this._itemWidth*cc.contentScaleFactor(),h=this._itemHeight*cc.contentScaleFactor());b>d.getCapacity()&&cc.log("cc.LabelAtlas._updateAtlasValues(): Invalid String length");for(var k=d.quads,m=this._displayedColor,m={r:m.r,g:m.g,b:m.b,a:this._displayedOpacity},n=this._itemWidth,q=0;q<b;q++){var s=a.charCodeAt(q)-this._mapStartChar.charCodeAt(0),u=s%this._itemsPerRow,t=0|s/this._itemsPerRow,
v;cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(u=(2*u*g+1)/(2*f),s=u+(2*g-2)/(2*f),t=(2*t*h+1)/(2*e),v=t+(2*h-2)/(2*e)):(u=u*g/f,s=u+g/f,t=t*h/e,v=t+h/e);var w=k[q],A=w.tl,z=w.tr,B=w.bl,w=w.br;A.texCoords.u=u;A.texCoords.v=t;z.texCoords.u=s;z.texCoords.v=t;B.texCoords.u=u;B.texCoords.v=v;w.texCoords.u=s;w.texCoords.v=v;B.vertices.x=q*n;B.vertices.y=0;B.vertices.z=0;w.vertices.x=q*n+n;w.vertices.y=0;w.vertices.z=0;A.vertices.x=q*n;A.vertices.y=this._itemHeight;A.vertices.z=0;z.vertices.x=q*n+n;z.vertices.y=
this._itemHeight;z.vertices.z=0;A.colors=m;z.colors=m;B.colors=m;w.colors=m}0<b&&(d.dirty=!0,a=d.totalQuads,b>a&&d.increaseTotalQuadsWith(b-a))},setString:null,_setStringForCanvas:function(a){a=String(a);var b=a.length;this._string=a;this.width=b*this._itemWidth;this.height=this._itemHeight;if(this._children){a=this._children;for(var b=a.length,d=0;d<b;d++){var e=a[d];e&&!e._lateChild&&(e.visible=!1)}}this.updateAtlasValues();this.quadsToDraw=b},_setStringForWebGL:function(a){a=String(a);var b=a.length;
b>this.textureAtlas.totalQuads&&this.textureAtlas.resizeCapacity(b);this._string=a;this.width=b*this._itemWidth;this.height=this._itemHeight;this.updateAtlasValues();this.quadsToDraw=b},setOpacity:null,_setOpacityForCanvas:function(a){if(this._displayedOpacity!==a){cc.AtlasNode.prototype.setOpacity.call(this,a);for(var b=this._children,d=0,e=b.length;d<e;d++)b[d]&&(b[d].opacity=a)}},_setOpacityForWebGL:function(a){this._opacity!==a&&cc.AtlasNode.prototype.setOpacity.call(this,a)}});_p=cc.LabelAtlas.prototype;
cc._renderType===cc._RENDER_TYPE_WEBGL?(_p.updateAtlasValues=_p._updateAtlasValuesForWebGL,_p.setString=_p._setStringForWebGL,_p.setOpacity=_p._setOpacityForWebGL):(_p.updateAtlasValues=_p._updateAtlasValuesForCanvas,_p.setString=_p._setStringForCanvas,_p.setOpacity=_p._setOpacityForCanvas,_p.addChild=_p._addChildForCanvas);cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);
cc.LabelAtlas.create=function(a,b,d,e,f){return new cc.LabelAtlas(a,b,d,e,f)};cc.LABEL_AUTOMATIC_WIDTH=-1;
cc.LabelBMFont=cc.SpriteBatchNode.extend({_opacityModifyRGB:!1,_string:"",_config:null,_fntFile:"",_initialString:"",_alignment:cc.TEXT_ALIGNMENT_CENTER,_width:-1,_lineBreakWithoutSpaces:!1,_imageOffset:null,_reusedChar:null,_displayedOpacity:255,_realOpacity:255,_displayedColor:null,_realColor:null,_cascadeColorEnabled:!0,_cascadeOpacityEnabled:!0,_textureLoaded:!1,_loadedEventListeners:null,_className:"LabelBMFont",_setString:function(a,b){b?this._initialString=a:this._string=a;var d=this._children;
if(d)for(var e=0;e<d.length;e++){var f=d[e];f&&f.setVisible(!1)}this._textureLoaded&&(this.createFontChars(),b&&this.updateLabel())},ctor:function(a,b,d,e,f){cc.SpriteBatchNode.prototype.ctor.call(this);this._imageOffset=cc.p(0,0);this._displayedColor=cc.color(255,255,255,255);this._realColor=cc.color(255,255,255,255);this._reusedChar=[];this.initWithString(a,b,d,e,f)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,b){this._loadedEventListeners||(this._loadedEventListeners=
[]);this._loadedEventListeners.push({eventCallback:a,eventTarget:b})},_callLoadedEventCallbacks:function(){if(this._loadedEventListeners){for(var a=this._loadedEventListeners,b=0,d=a.length;b<d;b++){var e=a[b];e.eventCallback.call(e.eventTarget,this)}a.length=0}},draw:function(a){cc.SpriteBatchNode.prototype.draw.call(this,a);if(cc.LABELBMFONT_DEBUG_DRAW){a=this.getContentSize();var b=cc.p(0|-this._anchorPointInPoints.x,0|-this._anchorPointInPoints.y);a=[cc.p(b.x,b.y),cc.p(b.x+a.width,b.y),cc.p(b.x+
a.width,b.y+a.height),cc.p(b.x,b.y+a.height)];cc._drawingUtil.setDrawColor(0,255,0,255);cc._drawingUtil.drawPoly(a,4,!0)}},setColor:function(a){var b=this._displayedColor,d=this._realColor;if(d.r!=a.r||d.g!=a.g||d.b!=a.b||d.a!=a.a)b.r=d.r=a.r,b.g=d.g=a.g,b.b=d.b=a.b,this._textureLoaded&&this._cascadeColorEnabled&&(a=cc.color.WHITE,(b=this._parent)&&b.cascadeColor&&(a=b.getDisplayedColor()),this.updateDisplayedColor(a))},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(a){this._opacityModifyRGB=
a;if(a=this._children)for(var b=0;b<a.length;b++){var d=a[b];d&&(d.opacityModifyRGB=this._opacityModifyRGB)}},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._displayedOpacity},setOpacity:function(a){this._displayedOpacity=this._realOpacity=a;if(this._cascadeOpacityEnabled){var b=255,d=this._parent;d&&d.cascadeOpacity&&(b=d.getDisplayedOpacity());this.updateDisplayedOpacity(b)}this._displayedColor.a=this._realColor.a=a},updateDisplayedOpacity:function(a){this._displayedOpacity=
this._realOpacity*a/255;a=this._children;for(var b=0;b<a.length;b++){var d=a[b];cc._renderType==cc._RENDER_TYPE_WEBGL?d.updateDisplayedOpacity(this._displayedOpacity):(cc.Node.prototype.updateDisplayedOpacity.call(d,this._displayedOpacity),d.setNodeDirty())}this._changeTextureColor()},isCascadeOpacityEnabled:function(){return!1},setCascadeOpacityEnabled:function(a){this._cascadeOpacityEnabled=a},getColor:function(){var a=this._realColor;return cc.color(a.r,a.g,a.b,a.a)},getDisplayedColor:function(){return this._displayedColor},
updateDisplayedColor:function(a){var b=this._displayedColor,d=this._realColor;b.r=d.r*a.r/255;b.g=d.g*a.g/255;b.b=d.b*a.b/255;a=this._children;for(b=0;b<a.length;b++)d=a[b],cc._renderType==cc._RENDER_TYPE_WEBGL?d.updateDisplayedColor(this._displayedColor):(cc.Node.prototype.updateDisplayedColor.call(d,this._displayedColor),d.setNodeDirty());this._changeTextureColor()},_changeTextureColor:function(){if(cc._renderType!=cc._RENDER_TYPE_WEBGL){var a=this.getTexture();if(a&&0<a.getContentSize().width){var b=
this._originalTexture.getHtmlElementObj();if(b){var d=a.getHtmlElementObj(),e=cc.rect(0,0,b.width,b.height);d instanceof HTMLCanvasElement&&!this._rectRotated?cc.generateTintImageWithMultiply(b,this._displayedColor,e,d):(d=cc.generateTintImageWithMultiply(b,this._displayedColor,e),a=new cc.Texture2D,a.initWithElement(d),a.handleLoadedTexture());this.setTexture(a)}}}},isCascadeColorEnabled:function(){return!1},setCascadeColorEnabled:function(a){this._cascadeColorEnabled=a},init:function(){return this.initWithString(null,
null,null,null,null)},initWithString:function(a,b,d,e,f){a=a||"";this._config&&cc.log("cc.LabelBMFont.initWithString(): re-init is no longer supported");if(b){var g=cc.loader.getRes(b);if(!g)return cc.log("cc.LabelBMFont.initWithString(): Impossible to create font. Please check file"),!1;this._config=g;this._fntFile=b;b=cc.textureCache.addImage(g.atlasName);(this._textureLoaded=g=b.isLoaded())||b.addLoadedEventListener(function(a){this._textureLoaded=!0;this.initWithTexture(a,this._initialString.length);
this.setString(this._initialString,!0);this._callLoadedEventCallbacks()},this)}else b=new cc.Texture2D,g=new Image,b.initWithElement(g),this._textureLoaded=!1;return this.initWithTexture(b,a.length)?(this._alignment=e||cc.TEXT_ALIGNMENT_LEFT,this._imageOffset=f||cc.p(0,0),this._width=null==d?-1:d,this._displayedOpacity=this._realOpacity=255,this._displayedColor=cc.color(255,255,255,255),this._realColor=cc.color(255,255,255,255),this._cascadeColorEnabled=this._cascadeOpacityEnabled=!0,this._contentSize.width=
0,this._contentSize.height=0,this.setAnchorPoint(0.5,0.5),cc._renderType===cc._RENDER_TYPE_WEBGL&&(d=this.textureAtlas.texture,this._opacityModifyRGB=d.hasPremultipliedAlpha(),e=this._reusedChar=new cc.Sprite,e.initWithTexture(d,cc.rect(0,0,0,0),!1),e.batchNode=this),this.setString(a,!0),!0):!1},createFontChars:function(){var a=cc._renderType,b=a===cc._RENDER_TYPE_CANVAS?this.texture:this.textureAtlas.texture,d=0,e=cc.size(0,0),f=0,g=1,h=this._string,k=h?h.length:0;if(0!==k){var m,n=this._config,
q=n.kerningDict,s=n.commonHeight,u=n.fontDefDictionary;for(m=0;m<k-1;m++)10==h.charCodeAt(m)&&g++;var t=s*g,g=-(s-s*g),v=-1;for(m=0;m<k;m++)if(s=h.charCodeAt(m),0!=s)if(10===s)d=0,g-=n.commonHeight;else{var w=q[v<<16|s&65535]||0,A=u[s];if(A){var z=cc.rect(A.rect.x,A.rect.y,A.rect.width,A.rect.height),z=cc.rectPixelsToPoints(z);z.x+=this._imageOffset.x;z.y+=this._imageOffset.y;(v=this.getChildByTag(m))?32===s&&a===cc._RENDER_TYPE_CANVAS?v.setTextureRect(z,!1,cc.size(0,0)):(v.setTextureRect(z,!1),v.visible=
!0):(v=new cc.Sprite,32===s&&a===cc._RENDER_TYPE_CANVAS&&(z=cc.rect(0,0,0,0)),v.initWithTexture(b,z,!1),v._newTextureWhenChangeColor=!0,this.addChild(v,0,m));v.opacityModifyRGB=this._opacityModifyRGB;cc._renderType==cc._RENDER_TYPE_WEBGL?(v.updateDisplayedColor(this._displayedColor),v.updateDisplayedOpacity(this._displayedOpacity)):(cc.Node.prototype.updateDisplayedColor.call(v,this._displayedColor),cc.Node.prototype.updateDisplayedOpacity.call(v,this._displayedOpacity),v.setNodeDirty());z=cc.p(d+
A.xOffset+0.5*A.rect.width+w,g+(n.commonHeight-A.yOffset)-0.5*z.height*cc.contentScaleFactor());v.setPosition(cc.pointPixelsToPoints(z));d+=A.xAdvance+w;v=s;f<d&&(f=d)}else cc.log("cocos2d: LabelBMFont: character not found "+h[m])}e.width=f;e.height=t;this.setContentSize(cc.sizePixelsToPoints(e))}},updateString:function(a){var b=this._children;if(b)for(var d=0,e=b.length;d<e;d++){var f=b[d];f&&(f.visible=!1)}this._config&&this.createFontChars();a||this.updateLabel()},getString:function(){return this._initialString},
setString:function(a,b){a=String(a);null==b&&(b=!0);if(null==a||"string"!=typeof a)a+="";this._initialString=a;this._setString(a,b)},_setStringForSetter:function(a){this.setString(a,!1)},setCString:function(a){this.setString(a,!0)},updateLabel:function(){this.string=this._initialString;if(0<this._width){for(var a=this._string.length,b=[],d=[],e=1,f=0,g=!1,h=!1,k=-1,m=-1,n=0,q,s=0,u=this._children.length;s<u;s++){for(var t=0;!(q=this.getChildByTag(s+n+t));)t++;n+=t;if(f>=a)break;var v=this._string[f];
h||(m=this._getLetterPosXLeft(q),h=!0);g||(k=m,g=!0);if(10==v.charCodeAt(0)){d.push("\n");b=b.concat(d);d.length=0;g=h=!1;k=m=-1;s--;n-=t;e++;if(f>=a)break;m||(m=this._getLetterPosXLeft(q),h=!0);k||(k=m,g=!0);f++}else if(cc.isspace_unicode(v))d.push(v),b=b.concat(d),d.length=0,h=!1,m=-1,f++;else if(this._getLetterPosXRight(q)-k>this._width)if(this._lineBreakWithoutSpaces){cc.utf8_trim_ws(d);d.push("\n");b=b.concat(d);d.length=0;g=h=!1;k=m=-1;e++;if(f>=a)break;m||(m=this._getLetterPosXLeft(q),h=!0);
k||(k=m,g=!0);s--}else d.push(v),-1!=b.lastIndexOf(" ")?cc.utf8_trim_ws(b):b=[],0<b.length&&b.push("\n"),e++,g=!1,k=-1,f++;else d.push(v),f++}b=b.concat(d);s=b.length;q="";for(f=0;f<s;++f)q+=b[f];q+=String.fromCharCode(0);this._setString(q,!1)}if(this._alignment!=cc.TEXT_ALIGNMENT_LEFT)for(b=f=0,a=this._string.length,d=[],e=0;e<a;e++)if(10==this._string[e].charCodeAt(0)||0==this._string[e].charCodeAt(0))if(s=0,g=d.length,0==g)b++;else{if(q=f+g-1+b,!(0>q)&&(s=this.getChildByTag(q),null!=s)){s=s.getPositionX()+
s._getWidth()/2;h=0;switch(this._alignment){case cc.TEXT_ALIGNMENT_CENTER:h=this.width/2-s/2;break;case cc.TEXT_ALIGNMENT_RIGHT:h=this.width-s}if(0!=h)for(s=0;s<g;s++)(q=f+s+b,0>q||!(q=this.getChildByTag(q)))||(q.x+=h);f+=g;b++;d.length=0}}else d.push(this._string[f])},setAlignment:function(a){this._alignment=a;this.updateLabel()},_getAlignment:function(){return this._alignment},setBoundingWidth:function(a){this._width=a;this.updateLabel()},_getBoundingWidth:function(){return this._width},setLineBreakWithoutSpace:function(a){this._lineBreakWithoutSpaces=
a;this.updateLabel()},setScale:function(a,b){cc.Node.prototype.setScale.call(this,a,b);this.updateLabel()},setScaleX:function(a){cc.Node.prototype.setScaleX.call(this,a);this.updateLabel()},setScaleY:function(a){cc.Node.prototype.setScaleY.call(this,a);this.updateLabel()},setFntFile:function(a){if(null!=a&&a!=this._fntFile){var b=cc.loader.getRes(a);b?(this._fntFile=a,this._config=b,a=cc.textureCache.addImage(b.atlasName),this._textureLoaded=b=a.isLoaded(),this.texture=a,cc._renderType===cc._RENDER_TYPE_CANVAS&&
(this._originalTexture=this.texture),b?this.createFontChars():a.addLoadedEventListener(function(a){this._textureLoaded=!0;this.texture=a;this.createFontChars();this._changeTextureColor();this.updateLabel();this._callLoadedEventCallbacks()},this)):cc.log("cc.LabelBMFont.setFntFile() : Impossible to create font. Please check file")}},getFntFile:function(){return this._fntFile},setAnchorPoint:function(a,b){cc.Node.prototype.setAnchorPoint.call(this,a,b);this.updateLabel()},_setAnchor:function(a){cc.Node.prototype._setAnchor.call(this,
a);this.updateLabel()},_setAnchorX:function(a){cc.Node.prototype._setAnchorX.call(this,a);this.updateLabel()},_setAnchorY:function(a){cc.Node.prototype._setAnchorY.call(this,a);this.updateLabel()},_atlasNameFromFntFile:function(a){},_kerningAmountForFirst:function(a,b){var d=0;if(this._configuration.kerningDictionary){var e=this._configuration.kerningDictionary[(a<<16|b&65535).toString()];e&&(d=e.amount)}return d},_getLetterPosXLeft:function(a){return a.getPositionX()*this._scaleX-a._getWidth()*this._scaleX*
a._getAnchorX()},_getLetterPosXRight:function(a){return a.getPositionX()*this._scaleX+a._getWidth()*this._scaleX*a._getAnchorX()}});_p=cc.LabelBMFont.prototype;
cc._renderType!==cc._RENDER_TYPE_CANVAS||cc.sys._supportCanvasNewBlendModes||(_p._changeTextureColor=function(){if(cc._renderType!=cc._RENDER_TYPE_WEBGL){var a,b=this.getTexture();b&&0<b.getContentSize().width&&(a=b.getHtmlElementObj())&&(b=cc.textureCache.getTextureColors(this._originalTexture.getHtmlElementObj()))&&(a instanceof HTMLCanvasElement&&!this._rectRotated?cc.generateTintImage(a,b,this._displayedColor,null,a):(a=cc.generateTintImage(a,b,this._displayedColor),b=new cc.Texture2D,b.initWithElement(a),
b.handleLoadedTexture(),this.setTexture(b)))}});cc.defineGetterSetter(_p,"string",_p.getString,_p._setStringForSetter);cc.defineGetterSetter(_p,"boundingWidth",_p._getBoundingWidth,_p.setBoundingWidth);cc.defineGetterSetter(_p,"textAlign",_p._getAlignment,_p.setAlignment);cc.LabelBMFont.create=function(a,b,d,e,f){return new cc.LabelBMFont(a,b,d,e,f)};
cc.isspace_unicode=function(a){a=a.charCodeAt(0);return 9<=a&&13>=a||32==a||133==a||160==a||5760==a||8192<=a&&8202>=a||8232==a||8233==a||8239==a||8287==a||12288==a};cc.utf8_trim_ws=function(a){var b=a.length;if(!(0>=b)&&(b-=1,cc.isspace_unicode(a[b]))){for(var d=b-1;0<=d;--d)if(cc.isspace_unicode(a[d]))b=d;else break;cc.utf8_trim_from(a,b)}};cc.utf8_trim_from=function(a,b){var d=a.length;b>=d||0>b||a.splice(b,d)};
cc._fntLoader={INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/,_parseStrToObj:function(a){a=a.match(this.ITEM_EXP);var b={};if(a)for(var d=0,e=a.length;d<e;d++){var f=a[d],g=f.indexOf("\x3d"),h=f.substring(0,g),f=f.substring(g+1);f.match(this.INT_EXP)?f=parseInt(f):'"'==f[0]&&(f=f.substring(1,f.length-1));b[h]=f}return b},parseFnt:function(a,
b){var d={},e=this._parseStrToObj(a.match(this.INFO_EXP)[0]).padding.split(",");parseInt(e[0]);parseInt(e[1]);parseInt(e[2]);parseInt(e[3]);e=this._parseStrToObj(a.match(this.COMMON_EXP)[0]);d.commonHeight=e.lineHeight;if(cc._renderType===cc._RENDER_TYPE_WEBGL){var f=cc.configuration.getMaxTextureSize();(e.scaleW>f.width||e.scaleH>f.height)&&cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}1!==e.pages&&cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page");
e=this._parseStrToObj(a.match(this.PAGE_EXP)[0]);0!==e.id&&cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found");d.atlasName=cc.path.changeBasename(b,e.file);for(var g=a.match(this.CHAR_EXP),h=d.fontDefDictionary={},e=0,f=g.length;e<f;e++){var k=this._parseStrToObj(g[e]);h[k.id]={rect:{x:k.x,y:k.y,width:k.width,height:k.height},xOffset:k.xoffset,yOffset:k.yoffset,xAdvance:k.xadvance}}g=d.kerningDict={};if(h=a.match(this.KERNING_EXP))for(e=0,f=h.length;e<f;e++)k=this._parseStrToObj(h[e]),
g[k.first<<16|k.second&65535]=k.amount;return d},load:function(a,b,d,e){var f=this;cc.loader.loadTxt(a,function(a,d){if(a)return e(a);e(null,f.parseFnt(d,b))})}};cc.loader.register(["fnt"],cc._fntLoader);var res={bg:"res/background.jpg",block:"res/block.png",player:"res/player.png",succeed:"res/succeed.png",failed:"res/failed.png",again:"res/replay.png",notify:"res/notify.png",start:"res/title.png",more:"res/more.png",arrow:"res/arrow.png"},resources=[],i;for(i in res)resources.push(res[i]);cc.animate=cc.Animate.create;
for(var OFFSET_X=4,OFFSET_Y=32,ROW=COL=9,BLOCK_W=32,BLOCK_H=36,BLOCK_XREGION=33,BLOCK_YREGION=28,OFFSET_ODD=16,BLOCK1_RECT=cc.rect(0,0,BLOCK_W,BLOCK_H),BLOCK2_RECT=cc.rect(BLOCK_W,0,BLOCK_W,BLOCK_H),PLAYER_W=66,PLAYER_H=118,PLAYER_OX=0,MOVING_OY=118,TRAPPED_OY=0,START_UI_SIZE=cc.size(256,454),FAIL_UI_SIZE=cc.size(292,277),WIN_UI_SIZE=cc.size(308,276),layers={},vert_passed=[],hori_passed=[],r=0;r<ROW;r++){vert_passed.push([]);hori_passed.push([]);for(var c=0;c<COL;c++)vert_passed[r][c]=!1,hori_passed[r][c]=
!1}
var reinit_passed=function(a){for(var b=0;b<ROW;b++)for(var d=0;d<COL;d++)a[b][d]&&(a[b][d]=!1)},GameLayer=cc.Layer.extend({blocks:null,batch:null,block_tex:null,player:null,player_r:4,player_c:4,moving_action:null,trapped_action:null,active_blocks:null,trapped:!1,inited:!1,active_nodes:null,step:0,ctor:function(){this._super();this.anchorY=this.anchorX=0;this.active_nodes=[];this.active_blocks=[];for(var a=0;a<ROW;a++){this.active_blocks.push([]);for(var b=0;b<COL;b++)this.active_blocks[a][b]=!1}this.blocks=
new cc.Layer;this.blocks.x=OFFSET_X;this.blocks.y=OFFSET_Y;this.addChild(this.blocks);this.batch=new cc.SpriteBatchNode(res.block,81);this.block_tex=this.batch.texture;for(var d=x=y=0,e=!1,f,g=this.batch.texture,a=0;a<ROW;a++){y=BLOCK_YREGION*a;d=e*OFFSET_ODD;for(b=0;b<COL;b++)x=d+BLOCK_XREGION*b,f=new cc.Sprite(g,BLOCK2_RECT),f.attr({anchorX:0,anchorY:0,x:x,y:y,width:BLOCK_W,height:BLOCK_H}),this.batch.addChild(f);e=!e}this.blocks.addChild(this.batch);this.blocks.bake();g=cc.textureCache.addImage(res.player);
e=cc.rect(0,0,PLAYER_W,PLAYER_H);a=[];b=[];for(f=0;6>f;f++)e.x=PLAYER_OX+f*PLAYER_W,d=new cc.SpriteFrame(g,e),b.push(d);e.y=MOVING_OY;for(f=0;4>f;f++)e.x=PLAYER_OX+f*PLAYER_W,d=new cc.SpriteFrame(g,e),a.push(d);g=new cc.Animation(a,0.2);this.moving_action=cc.animate(g).repeatForever();g=new cc.Animation(b,0.2);this.trapped_action=cc.animate(g).repeatForever();this.player=new cc.Sprite(a[0]);this.addChild(this.player,10);cc.eventManager.addListener({event:cc.EventListener.TOUCH_ALL_AT_ONCE,onTouchesBegan:function(a,
b){var d=a[0].getLocation(),e=b.getCurrentTarget();if(e.inited){d.y-=OFFSET_Y;var f=Math.floor(d.y/BLOCK_YREGION);d.x-=OFFSET_X+(1==f%2)*OFFSET_ODD;d=Math.floor(d.x/BLOCK_XREGION);0<=d&&0<=f&&d<COL&&f<ROW&&e.activateBlock(f,d)&&(e.step++,e.movePlayer())}}},this)},initGame:function(){if(!this.inited){this.player_c=this.player_r=4;for(var a=this.step=0,b=this.active_nodes.length;a<b;a++)this.active_nodes[a].removeFromParent();this.active_nodes=[];for(a=0;a<ROW;a++)for(b=0;b<COL;b++)this.active_blocks[a][b]=
!1;this.randomBlocks();this.player.attr({anchorX:0.5,anchorY:0,x:OFFSET_X+BLOCK_XREGION*this.player_c+BLOCK_W/2,y:OFFSET_Y+BLOCK_YREGION*this.player_r-5});this.player.stopAllActions();this.player.runAction(this.moving_action);this.inited=!0}},randomBlocks:function(){for(var a=Math.round(13*cc.random0To1())+7,b,d,e=0;e<a;e++)b=Math.floor(9*cc.random0To1()),d=Math.floor(9*cc.random0To1()),this.activateBlock(b,d)},activateBlock:function(a,b){if(!this.active_blocks[a][b]){var d=new cc.Sprite(this.block_tex,
BLOCK1_RECT);d.attr({anchorX:0,anchorY:0,x:OFFSET_X+(1==a%2)*OFFSET_ODD+BLOCK_XREGION*b,y:OFFSET_Y+BLOCK_YREGION*a,width:BLOCK_W,height:BLOCK_H});this.active_nodes.push(d);this.addChild(d,2);return this.active_blocks[a][b]=!0}return!1},movePlayer:function(){var a=this.player_r,b=this.player_c,d=-1,e;e=getDistance(a,b,l_choices,this.active_blocks,hori_passed,0);if(-1==d||-1!=e&&e[2]<d[2])d=e;e=getDistance(a,b,t_choices,this.active_blocks,vert_passed,0);if(-1==d||-1!=e&&e[2]<d[2])d=e;e=getDistance(a,
b,b_choices,this.active_blocks,vert_passed,0);if(-1==d||-1!=e&&e[2]<d[2])d=e;e=getDistance(a,b,r_choices,this.active_blocks,hori_passed,0);if(-1==d||-1!=e&&e[2]<d[2])d=e;reinit_passed(hori_passed);reinit_passed(vert_passed);-1==d?(this.trapped||(this.trapped=!0,this.player.stopAction(this.moving_action),this.player.runAction(this.trapped_action)),this.active_blocks[a][b-1]?this.active_blocks[a][b+1]?(d=a-1,e=a+1,a=b+(1==a%2?0:-1),this.active_blocks[d][a]?this.active_blocks[d][a+1]?this.active_blocks[e][a]?
this.active_blocks[e][a+1]?(gameScene.addChild(layers.winUI),this.inited=!1):(this.player_r=e,this.player_c=a+1):(this.player_r=e,this.player_c=a):(this.player_r=d,this.player_c=a+1):(this.player_r=d,this.player_c=a)):this.player_c=b+1:this.player_c=b-1):0==d[2]?(gameScene.addChild(layers.loseUI),this.inited=!1):(this.player_r=d[0],this.player_c=d[1]);this.player.attr({anchorX:0.5,anchorY:0,x:OFFSET_X+(1==this.player_r%2)*OFFSET_ODD+BLOCK_XREGION*this.player_c+BLOCK_W/2,y:OFFSET_Y+BLOCK_YREGION*this.player_r-
5})}}),StartUI=cc.Layer.extend({ctor:function(){this._super();var a=new cc.Sprite(res.start);a.x=cc.winSize.width/2;a.y=cc.winSize.height/2+20;this.addChild(a)},onEnter:function(){this._super();cc.eventManager.addListener({event:cc.EventListener.TOUCH_ALL_AT_ONCE,onTouchesEnded:function(a,b){a[0].getLocation().y<cc.winSize.height/3&&(layers.game.initGame(),layers.startUI.removeFromParent())}},this)}}),ResultUI=cc.Layer.extend({activate:!1,win:!1,winPanel:null,losePanel:null,ctor:function(a){this._super();
(this.win=a)?(this.winPanel=new cc.Sprite(res.succeed),this.winPanel.x=cc.winSize.width/2,this.winPanel.anchorY=0.2,this.winPanel.y=cc.winSize.height/2,this.addChild(this.winPanel)):(this.losePanel=new cc.Sprite(res.failed),this.losePanel.x=cc.winSize.width/2,this.losePanel.anchorY=0.2,this.losePanel.y=cc.winSize.height/2,this.addChild(this.losePanel));a=new cc.Sprite(res.notify);a.anchorX=a.anchorY=0;a.x=cc.winSize.width/2-FAIL_UI_SIZE.width/2;a.y=cc.winSize.height/2-FAIL_UI_SIZE.height/2;this.addChild(a);
a=new cc.Sprite(res.again);a.anchorX=1;a.anchorY=0;a.x=cc.winSize.width/2+FAIL_UI_SIZE.width/2;a.y=cc.winSize.height/2-FAIL_UI_SIZE.height/2;this.addChild(a)},onEnter:function(){this._super();var a=cc.winSize.height/2-FAIL_UI_SIZE.height/2,b=layers.game.step,d;d=4>b?99:10>b?Math.round(95+4*(10-b)/6):20>b?Math.round(85+10*(20-b)/10):95-b/2;if(this.win){this.winPanel.removeAllChildren();var e=this.winPanel.width,f=this.winPanel.height,g=new cc.LabelTTF("\u606d\u559c\u83b7\u5f97\u4ef7\u503c50\u5143\u609f\u7a7a\u4f18\u60e0\u5238\n\u7ee7\u7eed\u5237\u5c4f\uff01\n"+
b+"\u6b65\u63a8\u5012\u6211\u7684\u5c0f\u7f8a\u9a7c\n\u6253\u8d25"+d+"%\u670b\u53cb\u5708\u7684\u4eba\uff01\n\u4f60\u80fd\u8d85\u8fc7\u6211\u5417\uff1f","\u5b8b\u4f53",20);g.x=e/2;g.y=f/4;g.textAlign=cc.LabelTTF.TEXT_ALIGNMENT_CENTER;g.width=e;g.color=cc.color(0,0,0);this.winPanel.addChild(g)}else this.losePanel.removeAllChildren(),e=this.losePanel.width,f=this.losePanel.height,g=new cc.LabelTTF("\u5c0f\u7f8a\u9a7c\u5440\u5b83\u53c8\u8dd1\u6389\u4e86\nT_T \u5feb\u5e2e\u6211\u6293\u56de\u6765\uff01",
"\u5b8b\u4f53",20),g.x=e/2,g.y=f/4+5,g.textAlign=cc.LabelTTF.TEXT_ALIGNMENT_CENTER,g.width=e,g.color=cc.color(0,0,0),this.losePanel.addChild(g,10);cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(e,f){var g=f.getCurrentTarget();if(g.activate){var n=e.getLocation();n.y>a-20&&n.y<a+100&&(n.x>cc.winSize.width/2?(layers.game.initGame(),g.win?layers.winUI.removeFromParent():layers.loseUI.removeFromParent()):(gameScene.addChild(layers.shareUI,100),g.win?share(1,
b,d):share(2)))}}},this);this.activate=!0},onExit:function(){this._super();this.activate=!1}}),ShareUI=cc.LayerColor.extend({ctor:function(){this._super(cc.color(0,0,0,188),cc.winSize.width,cc.winSize.height);var a=new cc.Sprite(res.arrow);a.anchorX=1;a.anchorY=1;a.x=cc.winSize.width-15;a.y=cc.winSize.height-5;this.addChild(a);a=new cc.LabelTTF('\u8bf7\u70b9\u51fb\u53f3\u4e0a\u89d2\u7684\u83dc\u5355\u6309\u94ae\n\u518d\u70b9"\u5206\u4eab\u5230\u670b\u53cb\u5708"\n\u8ba9\u597d\u53cb\u4eec\u6311\u6218\u4f60\u7684\u5206\u6570\uff01',
"\u5b8b\u4f53",20,cc.size(0.7*cc.winSize.width,250),cc.TEXT_ALIGNMENT_CENTER);a.x=cc.winSize.width/2;a.y=cc.winSize.height-100;a.anchorY=1;this.addChild(a)},onEnter:function(){this._super();cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(a,b){layers.shareUI.removeFromParent()}},this)}}),GameScene=cc.Scene.extend({onEnter:function(){this._super();var a=new cc.Sprite(res.bg);a.attr({anchorX:0.5,anchorY:0.5,x:cc.winSize.width/2,y:cc.winSize.height/2});this.addChild(a);
layers.game=new GameLayer;this.addChild(layers.game);layers.startUI=new StartUI;this.addChild(layers.startUI);layers.winUI=new ResultUI(!0);layers.loseUI=new ResultUI(!1);layers.shareUI=new ShareUI}}),gameScene=null;var l_choices=[[[0,-1],[1,-1],[-1,-1]],[[0,-1],[1,0],[-1,0]]],r_choices=[[[0,1],[1,0],[-1,0]],[[0,1],[1,1],[-1,1]]],t_choices=[[[1,-1],[1,0]],[[1,0],[1,1]]],b_choices=[[[-1,-1],[-1,0]],[[-1,0],[-1,1]]],ROW_MINUS_1=ROW-1,COL_MINUS_1=COL-1,getDistance=function(a,b,d,e,f,g){f[a][b]=!0;if(0>=a||a>=ROW_MINUS_1||0>=b||b>=COL_MINUS_1)return[a,b,g];for(var h=d[1==a%2?1:0],k,m,n,q=0,s=h.length;q<s;q++)if(k=a+h[q][0],m=b+h[q][1],!e[k][m]&&!f[k][m]&&(g++,n=getDistance(k,m,d,e,f,g),-1!=n))return n[0]=k,n[1]=
m,n;return-1};cc.game.onStart=function(){cc.view.adjustViewPort(!0);cc.sys.isMobile?cc.view.setDesignResolutionSize(320,500,cc.ResolutionPolicy.FIXED_WIDTH):cc.view.setDesignResolutionSize(320,480,cc.ResolutionPolicy.SHOW_ALL);cc.view.resizeWithBrowserSize(!0);cc.LoaderScene.preload(resources,function(){gameScene=new GameScene;cc.director.runScene(gameScene)},this)};cc.game.run();